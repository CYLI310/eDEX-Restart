class UpdateChecker{constructor(){let e=require("https"),t=require("electron"),r,a=require("@electron/remote").app.getVersion();this._failed=!1,this._willfail=!1,this._fail=e=>{this._failed=!0,t.ipcRenderer.send("log","note","UpdateChecker: Could not fetch latest release from GitHub's API."),t.ipcRenderer.send("log","debug",`Error: ${e}`)},e.get({protocol:"https:",host:"api.github.com",path:"/repos/GitSquared/edex-ui/releases/latest",headers:{"User-Agent":"eDEX-UI UpdateChecker"}},e=>{switch(e.statusCode){case 200:break;case 404:this._fail("Got 404 (Not Found) response from server");break;default:this._willfail=!0}let r="";e.on("data",e=>{r+=e}),e.on("end",()=>{let e=r;if(!0===this._failed);else if(this._willfail)this._fail(e.toString());else try{let r=JSON.parse(e.toString());r.tag_name.slice(1)===a?t.ipcRenderer.send("log","info","UpdateChecker: Running latest version."):Number(r.tag_name.slice(1).replace(/\./g,""))<Number(a.replace("-pre","").replace(/\./g,""))?t.ipcRenderer.send("log","info","UpdateChecker: Running an unreleased, development version."):(new Modal({type:"info",title:"New version available",message:`eDEX-UI <strong>${r.tag_name}</strong> is now available.<br/>Head over to <a href="#" onclick="require('electron').shell.openExternal('${r.html_url}')">github.com</a> to download the latest version.`}),t.ipcRenderer.send("log","info",`UpdateChecker: New version ${r.tag_name} available.`))}catch(e){this._fail(e)}})}).on("error",e=>{this._fail(e)})}}module.exports={UpdateChecker};