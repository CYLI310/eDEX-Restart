class Toplist{constructor(e){if(!e)throw"Missing parameters";this.parent=document.getElementById(e),this._element=document.createElement("div"),this._element.setAttribute("id","mod_toplist"),this._element.innerHTML='<h1>TOP PROCESSES<i>PID | NAME | CPU | MEM</i></h1><br>\n        <table id="mod_toplist_table"></table>',this._element.onclick=this.processList,this.parent.append(this._element),this.currentlyUpdating=!1,this.updateList(),this.listUpdater=setInterval(()=>{this.updateList()},2e3)}updateList(){this.currentlyUpdating||(this.currentlyUpdating=!0,window.si.processes().then(e=>{!0===window.settings.excludeThreadsFromToplist&&(e.list=e.list.sort((e,t)=>e.pid-t.pid).filter((e,t,s)=>{let r=s.findIndex(t=>t.name===e.name);return-1===r||r===t||(s[r].cpu=s[r].cpu+e.cpu,s[r].mem=s[r].mem+e.mem,!1)}));let t=e.list.sort((e,t)=>100*(t.cpu-e.cpu)+t.mem-e.mem).splice(0,5);document.querySelectorAll("#mod_toplist_table > tr").forEach(e=>{e.remove()}),t.forEach(e=>{let t=document.createElement("tr");t.innerHTML=`<td>${e.pid}</td>\n                                <td><strong>${e.name}</strong></td>\n                                <td>${Math.round(10*e.cpu)/10}%</td>\n                                <td>${Math.round(10*e.mem)/10}%</td>`,document.getElementById("mod_toplist_table").append(t)}),this.currentlyUpdating=!1}))}processList(){let e,t=!1,s=!1,r=!1;function n(s){e===s?t?(e=void 0,t=!1):t=!0:(e=s,t=!1)}function a(e){const t=864e5;let s=Math.floor(e/t),r=e%t;const n=36e5;let a=Math.floor(r/n);r=e%n;let d=6e4,i=Math.floor(r/d);r=e%d;let m=Math.floor(r/1e3);return`${s<10?"0":""}${s}:${a<10?"0":""}${a}:${i<10?"0":""}${i}:${m<10?"0":""}${m}`}function d(){r||(r=!0,window.si.processes().then(n=>{!0===window.settings.excludeThreadsFromToplist&&(n.list=n.list.sort((e,t)=>e.pid-t.pid).filter((e,t,s)=>{let r=s.findIndex(t=>t.name===e.name);return-1===r||r===t||(s[r].cpu=s[r].cpu+e.cpu,s[r].mem=s[r].mem+e.mem,!1)})),n.list.forEach(e=>{e.runtime=new Date(Date.now()-Date.parse(e.started))}),r=!1;let d=n.list.sort((s,r)=>{switch(e){case"PID":return t?s.pid-r.pid:r.pid-s.pid;case"Name":return t?s.name>r.name?-1:s.name<r.name?1:0:s.name<r.name?-1:s.name>r.name?1:0;case"User":return t?s.user>r.user?-1:s.user<r.user?1:0:s.user<r.user?-1:s.user>r.user?1:0;case"CPU":return t?s.cpu-r.cpu:r.cpu-s.cpu;case"Memory":return t?s.mem-r.mem:r.mem-s.mem;case"State":return s.state<r.state?-1:s.state>r.state?1:0;case"Started":return t?Date.parse(s.started)-Date.parse(r.started):Date.parse(r.started)-Date.parse(s.started);case"Runtime":return t?s.runtime-r.runtime:r.runtime-s.runtime;default:return 100*(r.cpu-s.cpu)+r.mem-s.mem}});s?clearInterval(m):(document.querySelectorAll("#processList > tr").forEach(e=>{e.remove()}),d.forEach(e=>{let t=document.createElement("tr");t.innerHTML=`<td class="pid">${e.pid}</td>\n                            <td class="name">${e.name}</td>\n                            <td class="user">${e.user}</td>\n                            <td class="cpu">${Math.round(10*e.cpu)/10}%</td>\n                            <td class="mem">${Math.round(10*e.mem)/10}%</td>\n                            <td class="state">${e.state}</td>\n                            <td class="started">${e.started}</td>\n                            <td class="runtime">${a(e.runtime)}</td>`,document.getElementById("processList").append(t)}))}))}window.keyboard.detach(),new Modal({type:"custom",title:"Active Processes",html:'\n<table id="processContainer">\n    <thead>\n        <tr>\n            <td class="pid header">PID</td>\n            <td class="name header">Name</td>\n            <td class="user header">User</td>\n            <td class="cpu header">CPU</td>\n            <td class="mem header">Memory</td>\n            <td class="state header">State</td>\n            <td class="started header">Started</td>\n            <td class="runtime header">Runtime</td>\n        </tr>\n    </thead>\n    <tbody id="processList">\n    </tbody>\n  </table>'},()=>{s=!0});let i=document.getElementsByClassName("header");for(let s of i){let r=s.textContent;s.addEventListener("click",()=>{for(let e of i)e.textContent=e.textContent.replace("▲","").replace("▼","");n(r),e&&(s.textContent=`${r}${t?"▲":"▼"}`)})}d(),window.keyboard.attach(),window.term[window.currentTerm].term.focus();var m=setInterval(d,1e3)}}module.exports={Toplist};