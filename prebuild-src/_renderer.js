window.eval=global.eval=function(){throw new Error("eval() is disabled for security reasons.")},window._escapeHtml=e=>{let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},window._encodePathURI=e=>encodeURI(e).replace(/#/g,"%23"),window._purifyCSS=e=>void 0===e?"":("string"!=typeof e&&(e=e.toString()),e.replace(/[<]/g,"")),window._delay=e=>new Promise((t,n)=>{setTimeout(t,e)}),window.onerror=(e,t,n,o,i)=>{document.getElementById("boot_screen").innerHTML+=`${i} :  ${e}<br/>==> at ${t}  ${n}:${o}`};const path=require("path"),fs=require("fs"),electron=require("electron"),ipc=electron.ipcRenderer;let remote;ipc.send("log","info","Renderer process started!");try{remote=require("@electron/remote"),ipc.send("log","info","Remote module required successfully")}catch(e){ipc.send("log","error","Failed to require remote: "+e.message)}window.electron=electron,window.remote=remote;const settingsDir=remote.app.getPath("userData"),themesDir=path.join(settingsDir,"themes"),keyboardsDir=path.join(settingsDir,"keyboards"),fontsDir=path.join(settingsDir,"fonts"),settingsFile=path.join(settingsDir,"settings.json"),shortcutsFile=path.join(settingsDir,"shortcuts.json"),lastWindowStateFile=path.join(settingsDir,"lastWindowState.json");function initGraphicalErrorHandling(){window.edexErrorsModals=[],window.onerror=(e,t,n,o,i)=>{let r=new Modal({type:"error",title:i,message:`${e}<br/>        at ${t}  ${n}:${o}`});window.edexErrorsModals.push(r),ipc.send("log","error",`${i}: ${e}`),ipc.send("log","debug",`at ${t} ${n}:${o}`)}}function waitForFonts(){return new Promise(e=>{"complete"!==document.readyState||"loaded"!==document.fonts.status?document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&("loaded"===document.fonts.status?e():document.fonts.onloadingdone=()=>{"loaded"===document.fonts.status&&e()})}):e()})}function initSystemInformationProxy(){const{nanoid:e}=require("nanoid/non-secure");window.si=new Proxy({},{apply:()=>{throw new Error("Cannot use sysinfo proxy directly as a function")},set:()=>{throw new Error("Cannot set a property on the sysinfo proxy")},get:(t,n,o)=>function(...t){let o="function"==typeof t[t.length-1];return new Promise((i,r)=>{let s=e();ipc.once("systeminformation-reply-"+s,(e,n)=>{o&&t[t.length-1](n),i(n)}),ipc.send("systeminformation-call",n,s,...t)})}})}window.settings=require(settingsFile),window.shortcuts=require(shortcutsFile),window.lastWindowState=require(lastWindowStateFile),remote.process.argv.includes("--nointro")?window.settings.nointroOverride=!0:window.settings.nointroOverride=!1,remote.process.argv.includes("--nocursor")?window.settings.nocursorOverride=!0:window.settings.nocursorOverride=!1,ipc.once("getThemeOverride",(e,t)=>{null!==t?(window.settings.theme=t,window.settings.nointroOverride=!0,_loadTheme(require(path.join(themesDir,window.settings.theme+".json")))):_loadTheme(require(path.join(themesDir,window.settings.theme+".json")))}),ipc.send("getThemeOverride"),ipc.once("getKbOverride",(e,t)=>{null!==t&&(window.settings.keyboard=t,window.settings.nointroOverride=!0)}),ipc.send("getKbOverride"),window._loadTheme=e=>{document.querySelector("style.theming")&&document.querySelector("style.theming").remove();let t=new FontFace(e.cssvars.font_main,`url("${path.join(fontsDir,e.cssvars.font_main.toLowerCase().replace(/ /g,"_")+".woff2").replace(/\\/g,"/")}")`),n=new FontFace(e.cssvars.font_main_light,`url("${path.join(fontsDir,e.cssvars.font_main_light.toLowerCase().replace(/ /g,"_")+".woff2").replace(/\\/g,"/")}")`),o=new FontFace(e.terminal.fontFamily,`url("${path.join(fontsDir,e.terminal.fontFamily.toLowerCase().replace(/ /g,"_")+".woff2").replace(/\\/g,"/")}")`);document.fonts.add(t),document.fonts.load("12px "+e.cssvars.font_main),document.fonts.add(n),document.fonts.load("12px "+e.cssvars.font_main_light),document.fonts.add(o),document.fonts.load("12px "+e.terminal.fontFamily),document.querySelector("head").innerHTML+=`<style class="theming">\n    :root {\n        --font_main: "${window._purifyCSS(e.cssvars.font_main)}";\n        --font_main_light: "${window._purifyCSS(e.cssvars.font_main_light)}";\n        --font_mono: "${window._purifyCSS(e.terminal.fontFamily)}";\n        --color_r: ${window._purifyCSS(e.colors.r)};\n        --color_g: ${window._purifyCSS(e.colors.g)};\n        --color_b: ${window._purifyCSS(e.colors.b)};\n        --color_black: ${window._purifyCSS(e.colors.black)};\n        --color_light_black: ${window._purifyCSS(e.colors.light_black)};\n        --color_grey: ${window._purifyCSS(e.colors.grey)};\n\n        /* Used for error and warning modals */\n        --color_red: ${window._purifyCSS(e.colors.red)||"red"};\n        --color_yellow: ${window._purifyCSS(e.colors.yellow)||"yellow"};\n    }\n\n    body {\n        font-family: var(--font_main), sans-serif;\n        cursor: ${window.settings.nocursorOverride||window.settings.nocursor?"none":"default"} !important;\n    }\n\n    * {\n   \t   ${window.settings.nocursorOverride||window.settings.nocursor?"cursor: none !important;":""}\n\t}\n\n    ${window._purifyCSS(e.injectCSS||"")}\n    </style>`,window.theme=e,window.theme.r=e.colors.r,window.theme.g=e.colors.g,window.theme.b=e.colors.b},ipc.send("log","info","Initializing AudioManager...");try{window.audioManager=new AudioManager,ipc.send("log","info","AudioManager initialized.")}catch(e){ipc.send("log","error","AudioManager failed: "+e.message),window.audioManager={granted:{play:()=>{}},stdout:{play:()=>{}},theme:{play:()=>{}},expand:{play:()=>{}},keyboard:{play:()=>{}},panel:{play:()=>{}},panels:{play:()=>{}},scan:{play:()=>{}},denied:{play:()=>{}},info:{play:()=>{}},alarm:{play:()=>{}},error:{play:()=>{}},folder:{play:()=>{}}}}remote.app.focus();let i=0;function displayLine(){let e=document.getElementById("boot_screen"),t=fs.readFileSync(path.join(__dirname,"assets","misc","boot_log.txt")).toString().split("\n");function n(){return"linux"===require("os").platform()&&fs.existsSync("/etc/os-release")&&fs.readFileSync("/etc/os-release").toString().includes("arch")}if(void 0!==t[i])switch("Boot Complete"===t[i]?window.audioManager.granted.play():window.audioManager.stdout.play(),e.innerHTML+=t[i]+"<br/>",i++,!0){case 2===i:e.innerHTML+=`eDEX-UI Kernel version ${remote.app.getVersion()} boot at ${Date().toString()}; root:xnu-1699.22.73~1/RELEASE_X86_64`;case 4===i:setTimeout(displayLine,500);break;case i>4&&i<25:setTimeout(displayLine,30);break;case 25===i:setTimeout(displayLine,400);break;case 42===i:setTimeout(displayLine,300);break;case i>42&&i<82:setTimeout(displayLine,25);break;case 83===i:n()&&(e.innerHTML+="btw i use arch<br/>"),setTimeout(displayLine,25);break;case i>=t.length-2&&i<t.length:setTimeout(displayLine,300);break;default:setTimeout(displayLine,25*Math.pow(1-i/1e3,3))}else setTimeout(displayTitleScreen,300)}async function displayTitleScreen(){let e=document.getElementById("boot_screen");null===e&&(e=document.createElement("section"),e.setAttribute("id","boot_screen"),e.setAttribute("style","z-index: 9999999"),document.body.appendChild(e)),e.innerHTML="",window.audioManager.theme.play(),await _delay(400),document.body.setAttribute("class",""),e.setAttribute("class","center"),e.innerHTML="<h1>eDEX-UI</h1>";let t=document.querySelector("section > h1");if(await _delay(200),document.body.setAttribute("class","solidBackground"),await _delay(100),t.setAttribute("style",`background-color: rgb(${window.theme.r}, ${window.theme.g}, ${window.theme.b});border-bottom: 5px solid rgb(${window.theme.r}, ${window.theme.g}, ${window.theme.b});`),await _delay(300),t.setAttribute("style",`border: 5px solid rgb(${window.theme.r}, ${window.theme.g}, ${window.theme.b});`),await _delay(100),t.setAttribute("style",""),t.setAttribute("class","glitch"),await _delay(500),document.body.setAttribute("class",""),t.setAttribute("class",""),t.setAttribute("style",`border: 5px solid rgb(${window.theme.r}, ${window.theme.g}, ${window.theme.b});`),await _delay(1e3),window.term)return e.remove(),!0;initGraphicalErrorHandling(),initSystemInformationProxy(),waitForFonts().then(()=>{e.remove(),initUI()})}async function getDisplayName(){let e=settings.username||null;if(e)return e;try{const t=require("username")(),n=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),1e3));e=await Promise.race([t,n])}catch(e){}return e}async function initUI(){document.body.innerHTML+='<section class="mod_column" id="mod_column_left">\n        <h3 class="title"><p>PANEL</p><p>SYSTEM</p></h3>\n    </section>\n    <section id="main_shell" style="height:0%;width:0%;opacity:0;margin-bottom:30vh;" augmented-ui="bl-clip tr-clip exe">\n        <h3 class="title" style="opacity:0;"><p>TERMINAL</p><p>MAIN SHELL</p></h3>\n        <h1 id="main_shell_greeting"></h1>\n    </section>\n    <section class="mod_column" id="mod_column_right">\n        <h3 class="title"><p>PANEL</p><p>NETWORK</p></h3>\n    </section>',await _delay(10),window.audioManager.expand.play(),document.getElementById("main_shell").setAttribute("style","height:0%;margin-bottom:30vh;"),await _delay(500),document.getElementById("main_shell").setAttribute("style","margin-bottom: 30vh;"),document.querySelector("#main_shell > h3.title").setAttribute("style",""),await _delay(700),document.getElementById("main_shell").setAttribute("style","opacity: 0;"),document.body.innerHTML+=`\n    <section id="filesystem" style="width: 0px;" class="${window.settings.hideDotfiles?"hideDotfiles":""} ${window.settings.fsListView?"list-view":""}">\n    </section>\n    <section id="keyboard" style="opacity:0;">\n    </section>`;try{window.keyboard=new Keyboard({layout:path.join(keyboardsDir,settings.keyboard+".json"),container:"keyboard"})}catch(e){console.error("Keyboard initialization failed:",e),ipc.send("log","error","Keyboard initialization failed: "+e.message)}await _delay(10),document.getElementById("main_shell").setAttribute("style",""),await _delay(270);let e=document.getElementById("main_shell_greeting");getDisplayName().then(t=>{e.innerHTML+=t?`Welcome back, <em>${t}</em>`:"Welcome back"}),e.setAttribute("style","opacity: 1;"),document.getElementById("filesystem").setAttribute("style","");try{document.getElementById("keyboard").setAttribute("style",""),document.getElementById("keyboard").setAttribute("class","animation_state_1"),window.audioManager.keyboard.play()}catch(e){}await _delay(100);try{document.getElementById("keyboard").setAttribute("class","animation_state_1 animation_state_2")}catch(e){}await _delay(1e3),e.setAttribute("style","opacity: 0;"),await _delay(100);try{document.getElementById("keyboard").setAttribute("class","")}catch(e){}await _delay(400),e.remove(),window.mods={};try{window.mods.clock=new Clock("mod_column_left"),window.mods.sysinfo=new Sysinfo("mod_column_left"),window.mods.hardwareInspector=new HardwareInspector("mod_column_left"),window.mods.cpuinfo=new Cpuinfo("mod_column_left"),window.mods.ramwatcher=new RAMwatcher("mod_column_left"),window.mods.toplist=new Toplist("mod_column_left"),window.mods.netstat=new Netstat("mod_column_right"),window.mods.globe=new LocationGlobe("mod_column_right"),window.mods.conninfo=new Conninfo("mod_column_right")}catch(e){console.error("Modules initialization partial failure:",e)}document.querySelectorAll(".mod_column").forEach(e=>{e.setAttribute("class","mod_column activated")});let t=0,n=document.querySelectorAll("#mod_column_left > div"),o=document.querySelectorAll("#mod_column_right > div"),i=setInterval(()=>{n[t]||o[t]?(window.audioManager.panels.play(),n[t]&&n[t].setAttribute("style","animation-play-state: running;"),o[t]&&o[t].setAttribute("style","animation-play-state: running;"),t++):clearInterval(i)},500),r;await _delay(100),document.getElementById("main_shell").innerHTML+='\n        <ul id="main_shell_tabs">\n            <li id="shell_tab0" onclick="window.focusShellTab(0);" class="active"><p>MAIN SHELL</p></li>\n            <li id="shell_tab1" onclick="window.focusShellTab(1);"><p>EMPTY</p></li>\n            <li id="shell_tab2" onclick="window.focusShellTab(2);"><p>EMPTY</p></li>\n            <li id="shell_tab3" onclick="window.focusShellTab(3);"><p>EMPTY</p></li>\n            <li id="shell_tab4" onclick="window.focusShellTab(4);"><p>EMPTY</p></li>\n        </ul>\n        <div id="main_shell_innercontainer">\n            <pre id="terminal0" class="active"></pre>\n            <pre id="terminal1"></pre>\n            <pre id="terminal2"></pre>\n            <pre id="terminal3"></pre>\n            <pre id="terminal4"></pre>\n        </div>';try{window.term={0:new Terminal({role:"client",parentId:"terminal0",port:window.settings.port||3e3})},window.currentTerm=0,window.term[0].onprocesschange=e=>{document.getElementById("shell_tab0").innerHTML=`<p>MAIN - ${e}</p>`},window.onmouseup=e=>{window.keyboard.linkedToTerm&&window.term&&window.term[window.currentTerm]&&window.term[window.currentTerm].term.focus()},window.term[0].term.writeln(`[1mWelcome to eDEX-UI v${remote.app.getVersion()} - Electron v${process.versions.electron}[0m`)}catch(e){window.term={},console.error("Terminal initialization failed:",e),ipc.send("log","error","Terminal initialization failed: "+e.message),document.getElementById("shell_tab0").innerHTML="<p>ERROR</p>"}await _delay(100);try{window.fsDisp=new FilesystemDisplay({parentId:"filesystem"})}catch(e){console.error("Filesystem initialization failed:",e),ipc.send("log","error","Filesystem initialization failed: "+e.message)}await _delay(200),document.getElementById("filesystem").setAttribute("style","opacity: 1;"),1===window.performance.navigation.type&&window.term&&window.term[window.currentTerm]&&window.term[window.currentTerm].resendCWD(),await _delay(200),window.updateCheck=new UpdateChecker}window.settings.nointro||window.settings.nointroOverride?(initGraphicalErrorHandling(),initSystemInformationProxy(),document.getElementById("boot_screen").remove(),document.body.setAttribute("class",""),waitForFonts().then(initUI)):displayLine(),window.themeChanger=e=>{ipc.send("setThemeOverride",e),setTimeout(()=>{window.location.reload(!0)},100)},window.remakeKeyboard=e=>{document.getElementById("keyboard").innerHTML="",window.keyboard=new Keyboard({layout:path.join(keyboardsDir,e+".json"||settings.keyboard+".json"),container:"keyboard"}),ipc.send("setKbOverride",e)},window.focusShellTab=e=>{window.audioManager.folder.play(),e!==window.currentTerm&&window.term[e]?(window.currentTerm=e,document.querySelectorAll(`ul#main_shell_tabs > li:not(:nth-child(${e+1}))`).forEach(e=>{e.setAttribute("class","")}),document.getElementById("shell_tab"+e).setAttribute("class","active"),document.querySelectorAll(`div#main_shell_innercontainer > pre:not(:nth-child(${e+1}))`).forEach(e=>{e.setAttribute("class","")}),document.getElementById("terminal"+e).setAttribute("class","active"),window.term[e].fit(),window.term[e].term.focus(),window.term[e].resendCWD(),window.fsDisp.followTab()):e>0&&e<=4&&null!==window.term[e]&&"object"!=typeof window.term[e]&&(window.term[e]=null,document.getElementById("shell_tab"+e).innerHTML="<p>LOADING...</p>",ipc.send("ttyspawn","true"),ipc.once("ttyspawn-reply",(t,n)=>{if(n.startsWith("ERROR"))document.getElementById("shell_tab"+e).innerHTML="<p>ERROR</p>";else if(n.startsWith("SUCCESS")){let t=Number(n.substr(9));window.term[e]=new Terminal({role:"client",parentId:"terminal"+e,port:t}),window.term[e].onclose=t=>{delete window.term[e].onprocesschange,document.getElementById("shell_tab"+e).innerHTML="<p>EMPTY</p>",document.getElementById("terminal"+e).innerHTML="",window.term[e].term.dispose(),delete window.term[e],window.useAppShortcut("PREVIOUS_TAB")},window.term[e].onprocesschange=t=>{document.getElementById("shell_tab"+e).innerHTML=`<p>#${e+1} - ${t}</p>`},document.getElementById("shell_tab"+e).innerHTML=`<p>::${t}</p>`,setTimeout(()=>{window.focusShellTab(e)},500)}}))},window.openSettings=async()=>{if(document.getElementById("settingsEditor"))return;let e,t,n,o,i;fs.readdirSync(keyboardsDir).forEach(t=>{t.endsWith(".json")&&(t=t.replace(".json",""))!==window.settings.keyboard&&(e+=`<option>${t}</option>`)}),fs.readdirSync(themesDir).forEach(e=>{e.endsWith(".json")&&(e=e.replace(".json",""))!==window.settings.theme&&(t+=`<option>${e}</option>`)});for(let e=0;e<remote.screen.getAllDisplays().length;e++)e!==window.settings.monitor&&(n+=`<option>${e}</option>`);(await window.si.networkInterfaces()).forEach(e=>{e.iface!==window.mods.netstat.iface&&(o+=`<option>${e.iface}</option>`)}),window.keyboard.detach(),new Modal({type:"custom",title:`Settings <i>(v${remote.app.getVersion()})</i>`,html:`<table id="settingsEditor">\n                    <tr>\n                        <th>Key</th>\n                        <th>Description</th>\n                        <th>Value</th>\n                    </tr>\n                    <tr>\n                        <td>shell</td>\n                        <td>The program to run as a terminal emulator</td>\n                        <td><input type="text" id="settingsEditor-shell" value="${window.settings.shell}"></td>\n                    </tr>\n                    <tr>\n                        <td>shellArgs</td>\n                        <td>Arguments to pass to the shell</td>\n                        <td><input type="text" id="settingsEditor-shellArgs" value="${window.settings.shellArgs||""}"></td>\n                    </tr>\n                    <tr>\n                        <td>cwd</td>\n                        <td>Working Directory to start in</td>\n                        <td><input type="text" id="settingsEditor-cwd" value="${window.settings.cwd}"></td>\n                    </tr>\n                    <tr>\n                        <td>env</td>\n                        <td>Custom shell environment override</td>\n                        <td><input type="text" id="settingsEditor-env" value="${window.settings.env}"></td>\n                    </tr>\n                    <tr>\n                        <td>username</td>\n                        <td>Custom username to display at boot</td>\n                        <td><input type="text" id="settingsEditor-username" value="${window.settings.username}"></td>\n                    </tr>\n                    <tr>\n                        <td>keyboard</td>\n                        <td>On-screen keyboard layout code</td>\n                        <td><select id="settingsEditor-keyboard">\n                            <option>${window.settings.keyboard}</option>\n                            ${e}\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>theme</td>\n                        <td>Name of the theme to load</td>\n                        <td><select id="settingsEditor-theme">\n                            <option>${window.settings.theme}</option>\n                            ${t}\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>termFontSize</td>\n                        <td>Size of the terminal text in pixels</td>\n                        <td><input type="number" id="settingsEditor-termFontSize" value="${window.settings.termFontSize}"></td>\n                    </tr>\n                    <tr>\n                        <td>audio</td>\n                        <td>Activate audio sound effects</td>\n                        <td><select id="settingsEditor-audio">\n                            <option>${window.settings.audio}</option>\n                            <option>${!window.settings.audio}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>audioVolume</td>\n                        <td>Set default volume for sound effects (0.0 - 1.0)</td>\n                        <td><input type="number" id="settingsEditor-audioVolume" value="${window.settings.audioVolume||"1.0"}"></td>\n                    </tr>\n                    <tr>\n                        <td>disableFeedbackAudio</td>\n                        <td>Disable recurring feedback sound FX (input/output, mostly)</td>\n                        <td><select id="settingsEditor-disableFeedbackAudio">\n                            <option>${window.settings.disableFeedbackAudio}</option>\n                            <option>${!window.settings.disableFeedbackAudio}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>port</td>\n                        <td>Local port to use for UI-shell connection</td>\n                        <td><input type="number" id="settingsEditor-port" value="${window.settings.port}"></td>\n                    </tr>\n                    <tr>\n                        <td>pingAddr</td>\n                        <td>IPv4 address to test Internet connectivity</td>\n                        <td><input type="text" id="settingsEditor-pingAddr" value="${window.settings.pingAddr||"1.1.1.1"}"></td>\n                    </tr>\n                    <tr>\n                        <td>clockHours</td>\n                        <td>Clock format (12/24 hours)</td>\n                        <td><select id="settingsEditor-clockHours">\n                            <option>${12===window.settings.clockHours?"12":"24"}</option>\n                            <option>${12===window.settings.clockHours?"24":"12"}</option>\n                        </select></td>\n                    <tr>\n                        <td>monitor</td>\n                        <td>Which monitor to spawn the UI in (defaults to primary display)</td>\n                        <td><select id="settingsEditor-monitor">\n                            ${void 0!==window.settings.monitor?"<option>"+window.settings.monitor+"</option>":""}\n                            ${n}\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>nointro</td>\n                        <td>Skip the intro boot log and logo${window.settings.nointroOverride?" (Currently overridden by CLI flag)":""}</td>\n                        <td><select id="settingsEditor-nointro">\n                            <option>${window.settings.nointro}</option>\n                            <option>${!window.settings.nointro}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>nocursor</td>\n                        <td>Hide the mouse cursor${window.settings.nocursorOverride?" (Currently overridden by CLI flag)":""}</td>\n                        <td><select id="settingsEditor-nocursor">\n                            <option>${window.settings.nocursor}</option>\n                            <option>${!window.settings.nocursor}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>iface</td>\n                        <td>Override the interface used for network monitoring</td>\n                        <td><select id="settingsEditor-iface">\n                            <option>${window.mods.netstat.iface}</option>\n                            ${o}\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>allowWindowed</td>\n                        <td>Allow using F11 key to set the UI in windowed mode</td>\n                        <td><select id="settingsEditor-allowWindowed">\n                            <option>${window.settings.allowWindowed}</option>\n                            <option>${!window.settings.allowWindowed}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>keepGeometry</td>\n                        <td>Try to keep a 16:9 aspect ratio in windowed mode</td>\n                        <td><select id="settingsEditor-keepGeometry">\n                            <option>${!1===window.settings.keepGeometry?"false":"true"}</option>\n                            <option>${!1===window.settings.keepGeometry?"true":"false"}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>excludeThreadsFromToplist</td>\n                        <td>Display threads in the top processes list</td>\n                        <td><select id="settingsEditor-excludeThreadsFromToplist">\n                            <option>${window.settings.excludeThreadsFromToplist}</option>\n                            <option>${!window.settings.excludeThreadsFromToplist}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>hideDotfiles</td>\n                        <td>Hide files and directories starting with a dot in file display</td>\n                        <td><select id="settingsEditor-hideDotfiles">\n                            <option>${window.settings.hideDotfiles}</option>\n                            <option>${!window.settings.hideDotfiles}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>fsListView</td>\n                        <td>Show files in a more detailed list instead of an icon grid</td>\n                        <td><select id="settingsEditor-fsListView">\n                            <option>${window.settings.fsListView}</option>\n                            <option>${!window.settings.fsListView}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>experimentalGlobeFeatures</td>\n                        <td>Toggle experimental features for the network globe</td>\n                        <td><select id="settingsEditor-experimentalGlobeFeatures">\n                            <option>${window.settings.experimentalGlobeFeatures}</option>\n                            <option>${!window.settings.experimentalGlobeFeatures}</option>\n                        </select></td>\n                    </tr>\n                    <tr>\n                        <td>experimentalFeatures</td>\n                        <td>Toggle Chrome's experimental web features (DANGEROUS)</td>\n                        <td><select id="settingsEditor-experimentalFeatures">\n                            <option>${window.settings.experimentalFeatures}</option>\n                            <option>${!window.settings.experimentalFeatures}</option>\n                        </select></td>\n                    </tr>\n                </table>\n                <h6 id="settingsEditorStatus">Loaded values from memory</h6>\n                <br>`,buttons:[{label:"Open in External Editor",action:`electron.shell.openPath('${settingsFile}');electronWin.minimize();`},{label:"Save to Disk",action:"window.writeSettingsFile()"},{label:"Reload UI",action:"window.location.reload(true);"},{label:"Restart eDEX",action:"const remote = require('@electron/remote'); remote.app.relaunch();remote.app.quit();"}]},()=>{window.keyboard.attach(),window.term[window.currentTerm].term.focus()})},window.writeFile=e=>{fs.writeFile(e,document.getElementById("fileEdit").value,"utf-8",()=>{document.getElementById("fedit-status").innerHTML="<i>File saved.</i>"})},window.writeSettingsFile=()=>{window.settings={shell:document.getElementById("settingsEditor-shell").value,shellArgs:document.getElementById("settingsEditor-shellArgs").value,cwd:document.getElementById("settingsEditor-cwd").value,env:document.getElementById("settingsEditor-env").value,username:document.getElementById("settingsEditor-username").value,keyboard:document.getElementById("settingsEditor-keyboard").value,theme:document.getElementById("settingsEditor-theme").value,termFontSize:Number(document.getElementById("settingsEditor-termFontSize").value),audio:"true"===document.getElementById("settingsEditor-audio").value,audioVolume:Number(document.getElementById("settingsEditor-audioVolume").value),disableFeedbackAudio:"true"===document.getElementById("settingsEditor-disableFeedbackAudio").value,pingAddr:document.getElementById("settingsEditor-pingAddr").value,clockHours:Number(document.getElementById("settingsEditor-clockHours").value),port:Number(document.getElementById("settingsEditor-port").value),monitor:Number(document.getElementById("settingsEditor-monitor").value),nointro:"true"===document.getElementById("settingsEditor-nointro").value,nocursor:"true"===document.getElementById("settingsEditor-nocursor").value,iface:document.getElementById("settingsEditor-iface").value,allowWindowed:"true"===document.getElementById("settingsEditor-allowWindowed").value,forceFullscreen:window.settings.forceFullscreen,keepGeometry:"true"===document.getElementById("settingsEditor-keepGeometry").value,excludeThreadsFromToplist:"true"===document.getElementById("settingsEditor-excludeThreadsFromToplist").value,hideDotfiles:"true"===document.getElementById("settingsEditor-hideDotfiles").value,fsListView:"true"===document.getElementById("settingsEditor-fsListView").value,experimentalGlobeFeatures:"true"===document.getElementById("settingsEditor-experimentalGlobeFeatures").value,experimentalFeatures:"true"===document.getElementById("settingsEditor-experimentalFeatures").value},Object.keys(window.settings).forEach(e=>{"undefined"===window.settings[e]&&delete window.settings[e]}),fs.writeFileSync(settingsFile,JSON.stringify(window.settings,"",4)),document.getElementById("settingsEditorStatus").innerText="New values written to settings.json file at "+(new Date).toTimeString()},window.toggleFullScreen=()=>{let e=!electronWin.isFullScreen();electronWin.setFullScreen(e),window.lastWindowState.useFullscreen=e,fs.writeFileSync(lastWindowStateFile,JSON.stringify(window.lastWindowState,"",4))},window.openShortcutsHelp=()=>{if(document.getElementById("settingsEditor"))return;const e={COPY:"Copy selected buffer from the terminal.",PASTE:"Paste system clipboard to the terminal.",NEXT_TAB:"Switch to the next opened terminal tab (left to right order).",PREVIOUS_TAB:"Switch to the previous opened terminal tab (right to left order).",TAB_X:"Switch to terminal tab <strong>X</strong>, or create it if it hasn't been opened yet.",SETTINGS:"Open the settings editor.",SHORTCUTS:"List and edit available keyboard shortcuts.",FUZZY_SEARCH:"Search for entries in the current working directory.",FS_LIST_VIEW:"Toggle between list and grid view in the file browser.",FS_DOTFILES:"Toggle hidden files and directories in the file browser.",KB_PASSMODE:'Toggle the on-screen keyboard\'s "Password Mode", which allows you to safely<br>type sensitive information even if your screen might be recorded (disable visual input feedback).',DEV_DEBUG:"Open Chromium Dev Tools, for debugging purposes.",DEV_RELOAD:"Trigger front-end hot reload."};let t="";window.shortcuts.filter(e=>"app"===e.type).forEach(n=>{let o=n.action.startsWith("TAB_")?"TAB_X":n.action;t+=`<tr>\n                        <td>${n.enabled?"YES":"NO"}</td>\n                        <td><input disabled type="text" maxlength=25 value="${n.trigger}"></td>\n                        <td>${e[o]}</td>\n                    </tr>`});let n="";window.shortcuts.filter(e=>"shell"===e.type).forEach(e=>{n+=`<tr>\n                            <td>${e.enabled?"YES":"NO"}</td>\n                            <td><input disabled type="text" maxlength=25 value="${e.trigger}"></td>\n                            <td>\n                                <input disabled type="text" placeholder="Run terminal command..." value="${e.action}">\n                                <input disabled type="checkbox" name="shortcutsHelpNew_Enter" ${e.linebreak?"checked":""}>\n                                <label for="shortcutsHelpNew_Enter">Enter</label>\n                            </td>\n                        </tr>`}),window.keyboard.detach(),new Modal({type:"custom",title:`Available Keyboard Shortcuts <i>(v${remote.app.getVersion()})</i>`,html:`<h5>Using either the on-screen or a physical keyboard, you can use the following shortcuts:</h5>\n                <details open id="shortcutsHelpAccordeon1">\n                    <summary>Emulator shortcuts</summary>\n                    <table class="shortcutsHelp">\n                        <tr>\n                            <th>Enabled</th>\n                            <th>Trigger</th>\n                            <th>Action</th>\n                        </tr>\n                        ${t}\n                    </table>\n                </details>\n                <br>\n                <details id="shortcutsHelpAccordeon2">\n                    <summary>Custom command shortcuts</summary>\n                    <table class="shortcutsHelp">\n                        <tr>\n                            <th>Enabled</th>\n                            <th>Trigger</th>\n                            <th>Command</th>\n                        <tr>\n                       ${n}\n                    </table>\n                </details>\n                <br>`,buttons:[{label:"Open Shortcuts File",action:`electron.shell.openPath('${shortcutsFile}');electronWin.minimize();`},{label:"Reload UI",action:"window.location.reload(true);"}]},()=>{window.keyboard.attach(),window.term[window.currentTerm].term.focus()});let o=document.getElementById("shortcutsHelpAccordeon1"),i=document.getElementById("shortcutsHelpAccordeon2");o.addEventListener("toggle",e=>{i.open=!o.open}),i.addEventListener("toggle",e=>{o.open=!i.open})},window.useAppShortcut=e=>{switch(e){case"COPY":return window.term[window.currentTerm].clipboard.copy(),!0;case"PASTE":return window.term[window.currentTerm].clipboard.paste(),!0;case"NEXT_TAB":return window.term[window.currentTerm+1]?window.focusShellTab(window.currentTerm+1):window.term[window.currentTerm+2]?window.focusShellTab(window.currentTerm+2):window.term[window.currentTerm+3]?window.focusShellTab(window.currentTerm+3):window.term[window.currentTerm+4]?window.focusShellTab(window.currentTerm+4):window.focusShellTab(0),!0;case"PREVIOUS_TAB":let t=window.currentTerm||4;return window.term[t]&&t!==window.currentTerm?window.focusShellTab(t):window.term[t-1]?window.focusShellTab(t-1):window.term[t-2]?window.focusShellTab(t-2):window.term[t-3]?window.focusShellTab(t-3):window.term[t-4]&&window.focusShellTab(t-4),!0;case"TAB_1":return window.focusShellTab(0),!0;case"TAB_2":return window.focusShellTab(1),!0;case"TAB_3":return window.focusShellTab(2),!0;case"TAB_4":return window.focusShellTab(3),!0;case"TAB_5":return window.focusShellTab(4),!0;case"SETTINGS":return window.openSettings(),!0;case"SHORTCUTS":return window.openShortcutsHelp(),!0;case"FUZZY_SEARCH":return window.activeFuzzyFinder=new FuzzyFinder,!0;case"FS_LIST_VIEW":return window.fsDisp.toggleListview(),!0;case"FS_DOTFILES":return window.fsDisp.toggleHidedotfiles(),!0;case"KB_PASSMODE":return window.keyboard.togglePasswordMode(),!0;case"DEV_DEBUG":return remote.getCurrentWindow().webContents.toggleDevTools(),!0;case"DEV_RELOAD":return window.location.reload(!0),!0;default:return console.warn(`Unknown "${e}" app shortcut action`),!1}};const globalShortcut=remote.globalShortcut;globalShortcut.unregisterAll(),window.registerKeyboardShortcuts=()=>{window.shortcuts.forEach(e=>{if(e.enabled)if("app"===e.type)if("TAB_X"===e.action)for(let t=1;t<=5;t++){let n=e.trigger.replace("X",t),o=()=>{window.useAppShortcut(`TAB_${t}`)};globalShortcut.register(n,o)}else globalShortcut.register(e.trigger,()=>{window.useAppShortcut(e.action)});else"shell"===e.type?globalShortcut.register(e.trigger,()=>{let t=e.linebreak?"writelr":"write";window.term[window.currentTerm][t](e.action)}):console.warn(`${e.trigger} has unknown type`)})},window.registerKeyboardShortcuts(),window.addEventListener("focus",()=>{window.registerKeyboardShortcuts()}),window.addEventListener("blur",()=>{globalShortcut.unregisterAll()}),document.addEventListener("keydown",e=>{"Alt"===e.key&&e.preventDefault(),e.code.startsWith("Alt")&&e.ctrlKey&&e.shiftKey&&e.preventDefault(),"F11"!==e.key||settings.allowWindowed||e.preventDefault(),"KeyD"===e.code&&e.ctrlKey&&e.preventDefault(),"KeyA"===e.code&&e.ctrlKey&&e.preventDefault()}),window.addEventListener("keyup",e=>{"win32"===require("os").platform()&&"F4"===e.key&&!0===e.altKey&&remote.app.quit()}),electron.webFrame.setVisualZoomLevelLimits(1,1),window.onresize=()=>{void 0!==window.currentTerm&&void 0!==window.term[window.currentTerm]&&window.term[window.currentTerm].fit()},window.resizeTimeout=null;let electronWin=remote.getCurrentWindow();electronWin.on("resize",()=>{!1!==settings.keepGeometry&&(clearTimeout(window.resizeTimeout),window.resizeTimeout=setTimeout(()=>{let e=remote.getCurrentWindow();if(e.isFullScreen())return!1;if(e.isMaximized())return e.unmaximize(),e.setFullScreen(!0),!1;let t=e.getSize();t[0]>=t[1]?e.setSize(t[0],parseInt(9*t[0]/16)):e.setSize(t[1],parseInt(9*t[1]/16))},100))}),electronWin.on("leave-full-screen",()=>{remote.getCurrentWindow().setSize(960,540)});