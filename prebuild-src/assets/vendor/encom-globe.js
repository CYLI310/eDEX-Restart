!function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return n(r||e)},l,l.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){window.ENCOM=window.ENCOM||{},window.ENCOM.Globe=e("./src/Globe.js")},{"./src/Globe.js":15}],2:[function(e,t,r){var i=e("./point"),n=0,o=function(e,t,r,i){this.id=n++,null==i&&(i=!0),this.points=[e,t,r],i&&(e.registerFace(this),t.registerFace(this),r.registerFace(this))};o.prototype.getOtherPoints=function(e){for(var t=[],r=0;r<this.points.length;r++)this.points[r].toString()!==e.toString()&&t.push(this.points[r]);return t},o.prototype.findThirdPoint=function(e,t){for(var r=0;r<this.points.length;r++)if(this.points[r].toString()!==e.toString()&&this.points[r].toString()!==t.toString())return this.points[r]},o.prototype.isAdjacentTo=function(e){for(var t=0,r=0;r<this.points.length;r++)for(var i=0;i<e.points.length;i++)this.points[r].toString()==e.points[i].toString()&&t++;return 2==t},o.prototype.getCentroid=function(e){if(this.centroid&&!e)return this.centroid;var t=new i;return t.x=(this.points[0].x+this.points[1].x+this.points[2].x)/3,t.y=(this.points[0].y+this.points[1].y+this.points[2].y)/3,t.z=(this.points[0].z+this.points[1].z+this.points[2].z)/3,this.centroid=t,t},t.exports=o},{"./point":4}],3:[function(e,t,r){var i=e("./tile"),n=e("./face"),o=e("./point"),a=function(e,t,r){this.radius=e;for(var a=1.61803399,s=[new o(1e3,1e3*a,0),new o(-1e3,1e3*a,0),new o(1e3,1e3*-a,0),new o(-1e3,1e3*-a,0),new o(0,1e3,1e3*a),new o(0,-1e3,1e3*a),new o(0,1e3,1e3*-a),new o(0,-1e3,1e3*-a),new o(1e3*a,0,1e3),new o(1e3*-a,0,1e3),new o(1e3*a,0,-1e3),new o(1e3*-a,0,-1e3)],h={},l=0;l<s.length;l++)h[s[l]]=s[l];for(var c=[new n(s[0],s[1],s[4],!1),new n(s[1],s[9],s[4],!1),new n(s[4],s[9],s[5],!1),new n(s[5],s[9],s[3],!1),new n(s[2],s[3],s[7],!1),new n(s[3],s[2],s[5],!1),new n(s[7],s[10],s[2],!1),new n(s[0],s[8],s[10],!1),new n(s[0],s[4],s[8],!1),new n(s[8],s[2],s[10],!1),new n(s[8],s[4],s[5],!1),new n(s[8],s[5],s[2],!1),new n(s[1],s[0],s[6],!1),new n(s[11],s[1],s[6],!1),new n(s[3],s[9],s[11],!1),new n(s[6],s[10],s[7],!1),new n(s[3],s[11],s[7],!1),new n(s[11],s[6],s[7],!1),new n(s[6],s[0],s[10],!1),new n(s[9],s[1],s[11],!1)],u=function(e){return h[e]?h[e]:(h[e]=e,e)},f=[],p=0;p<c.length;p++)for(var d=null,m=[c[p].points[0]],v=c[p].points[0].subdivide(c[p].points[1],t,u),g=c[p].points[0].subdivide(c[p].points[2],t,u),l=1;l<=t;l++){d=m,m=v[l].subdivide(g[l],l,u);for(var y=0;y<l;y++){var x=new n(d[y],m[y],m[y+1]);f.push(x),y>0&&(x=new n(d[y-1],d[y],m[y]),f.push(x))}}c=f;var b={};for(var w in h){var _=h[w].project(e);b[_]=_}for(var w in h=b,this.tiles=[],h)this.tiles.push(new i(h[w],r))};t.exports=a},{"./face":2,"./point":4,"./tile":5}],4:[function(e,t,r){var i=function(e,t,r){void 0!==e&&void 0!==t&&void 0!==r&&(this.x=e,this.y=t,this.z=r),this.faces=[]};i.prototype.subdivide=function(e,t,r){var n=[];n.push(this);for(var o=1;o<t;o++){var a=new i(this.x*(1-o/t)+e.x*(o/t),this.y*(1-o/t)+e.y*(o/t),this.z*(1-o/t)+e.z*(o/t));a=r(a),n.push(a)}return n.push(e),n},i.prototype.segment=function(e,t){var r=new i;return t=Math.max(.01,Math.min(1,t)),r.x=e.x*(1-t)+this.x*t,r.y=e.y*(1-t)+this.y*t,r.z=e.z*(1-t)+this.z*t,r},i.prototype.midpoint=function(e,t){return this.segment(e,.5)},i.prototype.project=function(e,t){null==t&&(t=1),t=Math.max(0,Math.min(1,t));var r=this.y/this.x,i=this.z/this.x,n=this.z/this.y,o,a=e/Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2));return this.x=this.x*a*t,this.y=this.y*a*t,this.z=this.z*a*t,this},i.prototype.registerFace=function(e){this.faces.push(e)},i.prototype.getOrderedFaces=function(){for(var e=this.faces.slice(),t=[],r=0;r<this.faces.length;){if(0==r)t.push(e[r]),e.splice(r,1);else for(var i=!1,n=0;n<e.length&&!i;)e[n].isAdjacentTo(t[r-1])&&(i=!0,t.push(e[n]),e.splice(n,1)),n++;r++}return t},i.prototype.findCommonFace=function(e,t){for(var r=0;r<this.faces.length;r++)for(var i=0;i<e.faces.length;i++)if(this.faces[r].id===e.faces[i].id&&this.faces[r].id!==t.id)return this.faces[r];return null},i.prototype.toString=function(){return Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+","+Math.round(100*this.z)/100},t.exports=i},{}],5:[function(e,t,r){var i=e("./point"),n=function(e,t){null==t&&(t=1),t=Math.max(.01,Math.min(1,t)),this.centerPoint=e,this.faces=e.getOrderedFaces(),this.boundary=[],this.triangles=[];for(var r=0;r<this.faces.length;r++)this.boundary.push(this.faces[r].getCentroid().segment(this.centerPoint,t))};n.prototype.getLatLon=function(e,t){var r=this.centerPoint;"number"==typeof t&&t<this.boundary.length&&(r=this.boundary[t]);var i=Math.acos(r.y/e),n=(Math.atan2(r.x,r.z)+Math.PI+Math.PI/2)%(2*Math.PI)-Math.PI;return{lat:180*i/Math.PI-90,lon:180*n/Math.PI}},n.prototype.scaledBoundary=function(e){e=Math.max(0,Math.min(1,e));for(var t=[],r=0;r<this.boundary.length;r++)t.push(this.centerPoint.segment(this.boundary[r],1-e));return t},n.prototype.toString=function(){return this.centerPoint.toString()},t.exports=n},{"./point":4}],6:[function(e,t,r){!function(){function e(e){return(e%=360)<0?360+e:e}function r(e){return e>>>0}function i(e){return e.replace(/^\s+/,"").replace(/\s+$/,"").toLowerCase()}function n(e,t){return Array.prototype.slice.call(e,t)}function o(e,t){return e.push(t),e}function a(e,t,r){return e>t?e<r?e:r:t}function s(e,t,r){return(1-r)*e+r*t}function h(e){return(e=Math.round(255*e))>0?e<255?255&e:255:0}function l(e){return e/255}function u(e,t,r){var i=Math.max(e,t,r),n=Math.min(e,t,r),o,a,s=(i+n)/2;if(i==n)o=a=0;else{var h=i-n;switch(a=s>.5?h/(2-i-n):h/(i+n),i){case e:o=(t-r)/h+(t<r?6:0);break;case t:o=(r-e)/h+2;break;case r:o=(e-t)/h+4;break}o/=6}return[o,a,s]}function f(e,t,r){var i,n,o;if(0==t)i=n=o=r;else{function a(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}var s=r<.5?r*(1+t):r+t-r*t,h=2*r-s;i=a(h,s,e+1/3),n=a(h,s,e),o=a(h,s,e-1/3)}return[i,n,o]}function p(e){for(var t=[parseInt(e.substr(1,1),16),parseInt(e.substr(2,1),16),parseInt(e.substr(3,1),16),1],r=0;r<3;++r)t[r]=(16*t[r]+t[r])/255;return t}function d(e){return[parseInt(e.substr(1,2),16)/255,parseInt(e.substr(3,2),16)/255,parseInt(e.substr(5,2),16)/255,1]}var m={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,216],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[216,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function v(e){var t=e[0],r=e[1],i=e[2],n=Math.min(Math.min(t,r),i),o=Math.max(Math.max(t,r),i),a=o-n,s=o,h,l;return o==n?l=0:o==t?l=(r-i)/(o-n)*60%360:o==r?l=(i-t)/(o-n)*60+120:o==i&&(l=(t-r)/(o-n)*60+240),l<0&&(l+=360),h=0==o?0:1-n/o,[Math.round(l),Math.round(100*h),Math.round(100*s),e[3]]}function g(t){var r=e(t[0]),i,n,i=(i=t[1])/100,n=(n=t[2])/100,o=Math.floor(r/60%6),a=r/60-o,s=n*(1-i),h=n*(1-a*i),l=n*(1-(1-a)*i),c=[];switch(o){case 0:c=[n,l,s];break;case 1:c=[h,n,s];break;case 2:c=[s,n,l];break;case 3:c=[s,h,n];break;case 4:c=[l,s,n];break;case 5:c=[n,s,h];break}return[c[0],c[1],c[2],t[3]]}function y(t){var r=u(t[0],t[1],t[2]);return r[0]=e(Math.floor(360*r[0])),r[1]=Math.floor(100*r[1]),r[2]=Math.floor(100*r[2]),r}function x(e){var t=y(e);return t.push(e[3]),t}function b(e){var t,r,i,n=f(parseFloat(e[0])/360,parseFloat(e[1])/100,parseFloat(e[2])/100);return[n[0],n[1],n[2],1]}function w(e){var t,r,i,n=f(parseFloat(e[0])/360,parseFloat(e[1])/100,parseFloat(e[2])/100);return[n[0],n[1],n[2],parseFloat(e[3])]}var _={byteOrPercent:function(e){var t;return"string"==typeof e&&(t=e.match(/^([0-9]+)%$/))?Math.floor(255*parseFloat(t[1])/100):parseFloat(e)},floatOrPercent:function(e){var t;return"string"==typeof e&&(t=e.match(/^([0-9]+)%$/))?parseFloat(t[1])/100:parseFloat(e)},numberOrPercent:function(e,t){var r;return"string"==typeof e&&(r=e.match(/^([0-9]+)%$/))?parseFloat(r[1])/100*t:parseFloat(e)},rgba:function(e){for(var t=0;t<3;++t)e[t]=l(_.byteOrPercent(e[t]));return e[3]=_.floatOrPercent(e[t]),new S(e)},rgba8:function(e){return new S([l(_.byteOrPercent(e[0])),l(_.byteOrPercent(e[1])),l(_.byteOrPercent(e[2])),l(_.byteOrPercent(e[3]))])},float3:function(e){for(var t=0;t<3;++t)e[t]=_.floatOrPercent(e[t]);return e[3]=1,new S(e)},float4:function(e){for(var t=0;t<3;++t)e[t]=_.floatOrPercent(e[t]);return e[3]=_.floatOrPercent(e[t]),new S(e)},hsla:function(e){return e[0]=_.numberOrPercent(e[0],360),e[1]=_.numberOrPercent(e[1],100),e[2]=_.numberOrPercent(e[2],100),e[3]=_.numberOrPercent(e[3],1),new S(w(e))},hsva:function(t){return t[0]=e(parseFloat(t[0])),t[1]=Math.max(0,Math.min(100,parseFloat(t[1]))),t[2]=Math.max(0,Math.min(100,parseFloat(t[2]))),t[3]=_.floatOrPercent(t[3]),new S(g(t))}},M={keyword:{},hex3:{},hex7:{},rgb:{parse:function(e){return(e=e.slice(0)).push(1),_.rgba(e)}},rgba:{parse:_.rgba},hsl:{parse:function(e){return(e=e.slice(0)).push(1),_.hsla(e)}},hsla:{parse:_.hsla},hsv:{parse:function(e){return(e=e.slice(0)).push(1),_.hsva(e)}},hsva:{parse:_.hsva},rgb8:{parse:function(e){return(e=e.slice(0)).push(1),_.rgba(e)}},rgba8:{parse:function(e){return _.rgba8(e)}},packed_rgba:{parse:function(e){return e=[e>>24&255,e>>16&255,e>>8&255,(255&e)/255],_.rgba(e)},output:function(e){return r(h(e[0])<<24|h(e[1])<<16|h(e[2])<<8|h(e[3]))}},packed_argb:{parse:function(e){return e=[e>>16&255,e>>8&255,255&e,(e>>24&255)/255],_.rgba(e)},output:function(e){return r(h(e[3])<<24|h(e[0])<<16|h(e[1])<<8|h(e[2]))}},float3:{parse:_.float3},float4:{parse:_.float4}};function S(e){this._value=e}var T=function(){var e=null,t;if(arguments[0]instanceof S)return new S(arguments[0]._value);if("string"==typeof arguments[0])if("#"==arguments[0][0]){if(e=arguments[0].match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/i))return new S(p(e[0]));if(e=arguments[0].match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/i))return new S(d(e[0]))}else{if(e=M[arguments[0].toLowerCase()])return 2==arguments.length?e.parse(arguments[1]):e.parse(n(arguments,1));var r,o;if(e=arguments[0].match(/^\s*([A-Z][A-Z0-9_]+)\s*\(\s*([\-0-9A-FX]+)\s*\)\s*$/i))return(r=M[e[1].toLowerCase()]).parse(e[2]);if(e=arguments[0].match(/^\s*([A-Z][A-Z0-9]+)\s*\(\s*([0-9\.]+%?)\s*,\s*([0-9\.]+%?)\s*,\s*([0-9\.]+%?)\s*(,\s*([0-9\.]+%?)\s*)?\)\s*$/i)){var r=M[e[1].toLowerCase()];if(void 0===e[5]){var o=[e[2],e[3],e[4]];return r.parse(o)}var o=[e[2],e[3],e[4],e[6]];return r.parse(o)}if(1==arguments.length&&(e=m[i(arguments[0])]))return new S([l((o=e)[0]),l(o[1]),l(o[2]),1])}throw"Could not parse color '"+arguments[0]+"'"},C={white:T("white"),black:T("black"),gray:T("gray")};function A(e,t){if(null==t)return h(this._value[e]);var r=n(this._value,0),i;if("string"!=typeof t){var o=this.clone();return o._value[e]=t,o}if(i=t.match(/^([+\-\\*]=?)([0-9.]+)/)){var a=i[1],s=parseFloat(i[2]);switch(a[0]){case"+":r[e]+=s/255;break;case"-":r[e]-=s/255;break;case"*":r[e]*=s;break}return"="==a[1]?(this._value=r,this):new S(r)}}function E(t){return function(){function r(r,i,n){n=parseFloat(n);var o=v(r._value),a=0;switch(i){case"=":o[t]=n,a=1;break;case"+":o[t]+=n,a=1;break;case"+=":o[t]+=n;break;case"-":o[t]-=n,a=1;break;case"-=":o[t]-=n;break;case"*":o[t]*=n,a=1;break;case"*=":o[t]*=n;break;default:throw"Bad op "+i}return 0==t?o[t]=e(o[t]):1!=t&&2!=t||(o[t]<0?o[t]=0:o[t]>99&&(o[t]=99)),a&&(r=r.clone()),r._value=g(o),r}return 0==arguments.length?v(this._value)[t]:1==arguments.length?"string"==typeof arguments[0]&&(i=arguments[0].match(/^([\+\-\*]=?)([0-9.]+)/))?r(this,i[1],i[2]):r(this,"=",arguments[0]):2==arguments.length?r(this,arguments[0],arguments[1]):void 0;var i}}var P={clone:function(){return new S(this._value.slice(0))},html:function(){var e=this,t=this._value,r,i;return{hex3:function(){return e.hex3()},hex6:function(){return e.hex6()},rgb:function(){return"rgb("+e.rgb().join(",")+")"},rgba:function(){return"rgba("+e.rgba().join(",")+")"},hsl:function(){return"hsl("+y(t).join(",")+")"},hsla:function(){return"hsla("+x(t).join(",")+")"},keyword:function(){var e=195076,r;for(L in m){for(var i=m[L],n=0,o=0;o<3;++o){var a=t[o]-l(i[o]);n+=a*a}n<e&&(r=L,e=n)}return r}}[arguments[0]||"rgba"]()},red:function(){return A.call(this,0,arguments[0])},green:function(){return A.call(this,1,arguments[0])},blue:function(){return A.call(this,2,arguments[0])},alpha:function(){return 1==arguments.length?(c=this.clone(),c._value[3]=_.floatOrPercent(arguments[0]),c):this._value[3]},alpha8:function(){return 1==arguments.length?(c=this.clone(),c._value[3]=_.byteOrPercent(arguments[0])/255,c):Math.floor(255*this._value[3])},grayvalue:function(){var e=this._value;return(e[0]+e[1]+e[2])/3},grayvalue8:function(){return h(this.grayvalue())},luminance:function(){var e=this._value;return.2126*e[0]+.7152*e[1]+.0722*e[2]},luminance8:function(){return h(this.luminance())},hsv:function(){return v(this._value).slice(0,3)},hsva:function(){return v(this._value)},packed_rgba:function(){return M.packed_rgba.output(this._value)},packed_argb:function(){return M.packed_argb.output(this._value)},hue:E(0),saturation:E(1),value:E(2),clamp:function(){var e=this._value;return new S([a(e[0],0,1),a(e[1],0,1),a(e[2],0,1),a(e[3],0,1)])},blend:function(e,t){"number"!=typeof t&&(t=_.floatOrPercent(t));var r=this,i=T(e);return new S([s(r._value[0],i._value[0],t),s(r._value[1],i._value[1],t),s(r._value[2],i._value[2],t),s(r._value[3],i._value[3],t)])},add:function(e){var t=this._value,r=T(e)._value;return new S([t[0]+r[0]*r[3],t[1]+r[1]*r[3],t[2]+r[2]*r[3],t[3]])},inc:function(e){var t=this._value,r=T(e)._value;return t[0]+=r[0]*r[3],t[1]+=r[1]*r[3],t[2]+=r[2]*r[3],this},dec:function(e){var t=this._value,r=T(e)._value;return t[0]-=r[0]*r[3],t[1]-=r[1]*r[3],t[2]-=r[2]*r[3],this},subtract:function(e){var t=this._value,r=T(e)._value;return new S([t[0]-r[0]*r[3],t[1]-r[1]*r[3],t[2]-r[2]*r[3],t[3]])},multiply:function(e){var t=this._value,r=T(e)._value;return new S([t[0]*r[0],t[1]*r[1],t[2]*r[2],t[3]*r[3]])},scale:function(e){var t=this._value;return new S([t[0]*e,t[1]*e,t[2]*e,t[3]])},xor:function(e){var t=this.rgba8(),r=T(e).rgba8();return T("rgba8",t[0]^r[0],t[1]^r[1],t[2]^r[2],t[3])},tint:function(e){return this.blend(C.white,e)},shade:function(e){return this.blend(C.black,e)},tone:function(e){return this.blend(C.gray,e)},complement:function(){var t=this.hsva();return t[0]=e(t[0]+180),new S(g(t))},triad:function(){return[new S(this._value),this.hue("+120"),this.hue("+240")]},hueSet:function(){for(var e=0,t=[],r=100;r>=30;r-=35)for(var i=100;i>=30;i-=35)t.push(this.hue("+",0).saturation(r).value(i));return t},hueRange:function(e,t){for(var r=this.hue(),i=[],n=0;n<t;++n){var o=r+2*(n/(t-1)-.5)*e;i.push(this.hue("=",o))}return i},contrastWhiteBlack:function(){return this.value()<50?T("white"):T("black")},contrastGray:function(){var e=this.hsva(),t=e[2]<30?e[2]+20:e[2]-20;return new S(g([e[0],0,t,e[3]]))},hex3:function(){function e(e,t){return Math.min(Math.round(h(e)/16),15).toString(16)}return"#"+e(this._value[0])+e(this._value[1])+e(this._value[2])},hex6:function(){function e(e,t){var r=h(e).toString(16);return r.length<2?"0"+r:r}return"#"+e(this._value[0])+e(this._value[1])+e(this._value[2])},rgb:function(){var e=this._value;return[h(e[0]),h(e[1]),h(e[2])]},rgba:function(){var e=this._value;return[h(e[0]),h(e[1]),h(e[2]),e[3]]},rgb8:function(){var e=this._value;return[h(e[0]),h(e[1]),h(e[2])]},rgba8:function(){var e=this._value;return[h(e[0]),h(e[1]),h(e[2]),this.alpha8()]},float3:function(){return[this._value[0],this._value[1],this._value[2]]},float4:function(){return[this._value[0],this._value[1],this._value[2],this._value[3]]}};for(var L in P.sub=P.subtract,P.mul=P.multiply,P)S.prototype[L]=P[L];T.float3=function(e,t,r){return new S([e,t,r,1])},T.float4=function(e,t,r,i){return new S([e,t,r,i])},T.version="0.2.4",T.Color=S,void 0!==t&&t.exports?t.exports=T:"undefined"!=typeof window&&(window.pusher=window.pusher||{},window.pusher.color=T)}()},{}],7:[function(e,t,r){!function e(r,i,n){var o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(!(this instanceof a))return new a(e,t);o(e)?(t=e[1],e=e[0]):"object"==typeof e&&e&&(t=e.y,e=e.x),this.x=a.clean(e||0),this.y=a.clean(t||0)}a.prototype={change:function(e){if(e)this.observers?this.observers.push(e):this.observers=[e];else if(this.observers)for(var t=this.observers.length-1;t>=0;t--)this.observers[t](this);return this},ignore:function(e){if(this.observers)for(var t=this.observers,r=t.length;r--;)t[r]===e&&t.splice(r,1);return this},set:function(e,t,r){return"number"!=typeof e&&(r=t,t=e.y,e=e.x),this.x===e&&this.y===t?this:(this.x=a.clean(e),this.y=a.clean(t),!1!==r?this.change():void 0)},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(e){return e?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(e,t){return t?new this.constructor(this.x+e.x,this.y+e.y):(this.x+=e.x,this.y+=e.y,this.change())},subtract:function(e,t){return t?new this.constructor(this.x-e.x,this.y-e.y):(this.x-=e.x,this.y-=e.y,this.change())},multiply:function(e,t){var r,i;return"number"!=typeof e?(r=e.x,i=e.y):r=i=e,t?new this.constructor(this.x*r,this.y*i):this.set(this.x*r,this.y*i)},rotate:function(e,t,r){var i=this.x,n=this.y,o=Math.cos(e),a=Math.sin(e),s,h;return s=o*i-(t=t?-1:1)*a*n,h=t*a*i+o*n,r?new this.constructor(s,h):this.set(s,h)},length:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},lengthSquared:function(){var e=this.x,t=this.y;return e*e+t*t},distance:function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},normalize:function(e){var t=this.length(),r=t<Number.MIN_VALUE?0:1/t;return e?new this.constructor(this.x*r,this.y*r):this.set(this.x*r,this.y*r)},equal:function(e,t){return t===n&&(t=e.y,e=e.x),a.clean(e)===this.x&&a.clean(t)===this.y},abs:function(e){var t=Math.abs(this.x),r=Math.abs(this.y);return e?new this.constructor(t,r):this.set(t,r)},min:function(e,t){var r=this.x,i=this.y,n=e.x,o=e.y,a=r<n?r:n,s=i<o?i:o;return t?new this.constructor(a,s):this.set(a,s)},max:function(e,t){var r=this.x,i=this.y,n=e.x,o=e.y,a=r>n?r:n,s=i>o?i:o;return t?new this.constructor(a,s):this.set(a,s)},clamp:function(e,t,r){var i=this.min(t,!0).max(e);return r?i:this.set(i.x,i.y)},lerp:function(e,t){return this.add(e.subtract(this,!0).multiply(t),!0)},skew:function(){return new this.constructor(-this.y,this.x)},dot:function(e){return a.clean(this.x*e.x+e.y*this.y)},perpDot:function(e){return a.clean(this.x*e.y-this.y*e.x)},angleTo:function(e){return Math.atan2(this.perpDot(e),this.dot(e))},divide:function(e,t){var r,i;if("number"!=typeof e?(r=e.x,i=e.y):r=i=e,0===r||0===i)throw new Error("division by zero");if(isNaN(r)||isNaN(i))throw new Error("NaN detected");return t?new this.constructor(this.x/r,this.y/i):this.set(this.x/r,this.y/i)},isPointOnLine:function(e,t){return(e.y-this.y)*(e.x-t.x)===(e.y-t.y)*(e.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(e){return this.set(e[0],e[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:a},a.fromArray=function(e,t){return new(t||a)(e[0],e[1])},a.precision=i||8;var s=Math.pow(10,a.precision);return a.clean=r||function(e){if(isNaN(e))throw new Error("NaN detected");if(!isFinite(e))throw new Error("Infinity detected");return Math.round(e)===e?e:Math.round(e*s)/s},a.inject=e,r||(a.fast=e(function(e){return e}),void 0!==t&&"object"==typeof t.exports?t.exports=a:window.Vec2=window.Vec2||a),a}()},{}],8:[function(e,t,r){var i=e("vec2"),n=e("./quadtree2helper"),o=e("./quadtree2validator"),a=e("./quadtree2quadrant"),s;s=function e(t,r,s){var h,l={objects_:{},quadrants_:{},ids_:1,quadrantIds_:1,autoId_:!0,inited_:!1,debug_:!1,size_:void 0,root_:void 0,quadrantObjectsLimit_:void 0,quadrantLevelLimit_:void 0,quadrantSizeLimit_:void 0},c=new o,u={p:"pos_",r:"rad_",id:"id_"},f={data:{necessary:{size_:c.isVec2,quadrantObjectsLimit_:c.isNumber,quadrantLevelLimit_:c.isNumber}},k:{necessary:{p:c.isVec2},c:{necessary:{r:c.isNumber}}}},p={nextId:function e(){return l.ids_++},nextQuadrantId:function e(t){var r=l.quadrantIds_;return l.quadrantIds_+=t||4,r},hasCollision:function e(t,r){return t[u.r]+r[u.r]>t[u.p].distance(r[u.p])},removeQuadrantParentQuadrants:function e(t,r){t.parent_&&r[t.parent_.id_]&&(delete r[t.parent_.id_],p.removeQuadrantParentQuadrants(t.parent_,r))},getSubtreeTopQuadrant:function e(t,r){return t.parent_&&r[t.parent_.id_]?e(t.parent_,r):t},removeQuadrantChildtree:function e(t,r){var i,n=t.getChildren();for(i=0;i<n.length;i++){if(!r[n[i].id_])return;delete r[n[i].id_],p.removeQuadrantChildtree(n[i],r)}},getIntersectingQuadrants:function e(t,r,i){var n,o;if(r.intersects(t[u.p],t[u.r]))if(i.biggest[r.id_]=r,(o=r.getChildren()).length)for(n=0;n<o.length;n++)e(t,o[n],i);else i.leaves[r.id_]=r;else p.removeQuadrantParentQuadrants(r,i.biggest)},getSmallestIntersectingQuadrants:function e(t,r,i){var n,o;for(n in r||(r=l.root_),i||(i={leaves:{},biggest:{}}),p.getIntersectingQuadrants(t,r,i),i.leaves)i.biggest[n]&&(o=p.getSubtreeTopQuadrant(i.leaves[n],i.biggest),p.removeQuadrantChildtree(o,i.biggest));return i.biggest},removeQuadrantObjects:function e(t){var r,i=t.removeObjects([],1);for(r=0;r<i.length;r++)delete l.quadrants_[i[r].obj[u.id]][i[r].quadrant.id_];return i},removeObjectFromQuadrants:function e(t,r){var i;for(i in void 0===r&&(r=l.quadrants_[t[u.id]]),r)p.removeObjectFromQuadrant(t,r[i])},removeObjectFromQuadrant:function e(t,r){r.removeObject(t[u.id]),delete l.quadrants_[t[u.id]][r.id_],!r.hasChildren()&&r.parent_&&p.refactorSubtree(r.parent_)},refactorSubtree:function e(t){var r,i,n,o,a;if(!t.refactoring_){for(r=0;r<t.children_.length;r++)if((o=t.children_[r]).hasChildren())return;if(!((n=t.getObjectCountForLimit())>l.quadrantObjectsLimit_)){for(t.refactoring_=!0,r=0;r<t.children_.length;r++)for(i in(o=t.children_[r]).objects_)a=o.objects_[i],p.removeObjectFromQuadrant(a,o),p.addObjectToQuadrant(a,t);t.looseChildren(),t.refactoring_=!1,t.parent_&&p.refactorSubtree(t.parent_)}}},updateObjectQuadrants:function e(t){var r=l.quadrants_[t[u.id]],i=p.getSmallestIntersectingQuadrants(t),o=n.getIdsOfObjects(r),a=n.getIdsOfObjects(i),s=n.arrayDiffs(o,a),h=s[0],c=s[1],f;for(f=0;f<c.length;f++)p.populateSubtree(t,i[c[f]]);for(f=0;f<h.length;f++)r[h[f]]&&p.removeObjectFromQuadrant(t,r[h[f]])},addObjectToQuadrant:function e(t,r){var i=t[u.id];void 0===l.quadrants_[i]&&(l.quadrants_[i]={}),l.quadrants_[i][r.id_]=r,r.addObject(i,t)},populateSubtree:function e(t,r){var i,n,o,a,s,h;if(r||(r=l.root_),r.hasChildren())for(n in a=p.getSmallestIntersectingQuadrants(t,r)){if(a[n]===r)return void p.addObjectToQuadrant(t,r);p.populateSubtree(t,a[n])}else if(r.getObjectCount()<l.quadrantObjectsLimit_||r.size_.x<l.quadrantSizeLimit_.x)p.addObjectToQuadrant(t,r);else for(r.makeChildren(p.nextQuadrantId()),(h=p.removeQuadrantObjects(r)).push({obj:t,quadrant:r}),i=0;i<h.length;i++)p.populateSubtree(h[i].obj,h[i].quadrant)},init:function e(){var t;l.quadrantLevelLimit_||(l.quadrantLevelLimit_=6),c.byCallbackObject(l,f.data.necessary),l.root_=new a(new i(0,0),l.size_.clone(),p.nextQuadrantId(1)),t=Math.pow(2,l.quadrantLevelLimit_),l.quadrantSizeLimit_=l.size_.clone().divide(t),l.inited_=!0},checkInit:function e(t){return t&&!l.inited_&&p.init(),l.inited_},checkObjectKeys:function e(t){c.isNumber(t[u.id],u.id),c.isNumber(t[u.r],u.r),c.hasNoKey(l.objects_,t[u.id],u.id),c.byCallbackObject(t,f.k.necessary,u)},setObjId:function e(t){l.autoId_&&!t[u.id]&&(t[u.id]=p.nextId())},removeObjectById:function e(t){c.hasKey(l.objects_,t,u.id),p.removeObjectFromQuadrants(l.objects_[t]),delete l.objects_[t]},updateObjectById:function e(t){c.hasKey(l.objects_,t,u.id),p.updateObjectQuadrants(l.objects_[t])},getObjectsByObject:function e(t){var r,i,n=l.quadrants_[t[u.id]],o={objects:{},quadrants:{}};for(i in n)for(n[i].getObjectsUp(o),r=0;r<n[i].children_.length;r++)n[i].children_[r].getObjectsDown(o);return delete o.objects[t[u.id]],o.objects}},d={getQuadrants:function e(){return l.root_.getChildren(!0,[l.root_])},getLeafQuadrants:function e(){return d.getQuadrants().filter(function(e){return!e.hasChildren()})}},m={getQuadrantObjectsLimit:function e(){return l.quadrantObjectsLimit_},setQuadrantObjectsLimit:function e(t){void 0!==t&&(c.isNumber(t,"quadrantObjectsLimit_"),l.quadrantObjectsLimit_=t)},getQuadrantLevelLimit:function e(){return l.quadrantLevelLimit_},setQuadrantLevelLimit:function e(t){void 0!==t&&(c.isNumber(t,"quadrantLevelLimit_"),l.quadrantLevelLimit_=t)},setObjectKey:function e(t,r){c.fnFalse(p.checkInit),void 0!==r&&(c.hasKey(u,t,t),c.isString(r,t),"id"===t&&(l.autoId_=!1),u[t]=r)},getSize:function e(){return l.size_.clone()},setSize:function e(t){void 0!==t&&(c.isVec2(t,"size_"),l.size_=t.clone())},addObjects:function e(t){t.forEach(function(e){m.addObject(e)})},addObject:function e(t){c.isDefined(t,"obj"),c.isObject(t,"obj"),p.checkInit(!0),p.setObjId(t),p.checkObjectKeys(t),p.populateSubtree(t),l.objects_[t[u.id]]=t},removeObjects:function e(t){var r;for(r=0;r<t.length;r++)m.removeObject(t[r])},removeObject:function e(t){p.checkInit(!0),c.hasKey(t,u.id,u.id),p.removeObjectById(t[u.id])},updateObjects:function e(t){var r;for(r=0;r<t.length;r++)m.updateObject(t[r])},updateObject:function e(t){p.checkInit(!0),c.hasKey(t,u.id,u.id),p.updateObjectById(t[u.id])},getPossibleCollisionsForObject:function e(t){return p.checkInit(!0),c.hasKey(t,u.id,u.id),p.getObjectsByObject(t)},getCollisionsForObject:function e(t){var r,i;for(r in p.checkInit(!0),c.hasKey(t,u.id,u.id),i=p.getObjectsByObject(t))p.hasCollision(t,i[r])||delete i[r];return i},getCount:function e(){return Object.keys(l.objects_).length},getObjects:function e(){var t,r={};for(t in l.objects_)r[t]=l.objects_[t];return r},getQuadrantCount:function e(t){return t?Object.keys(l.quadrants_[t[u.id]]).length:1+l.root_.getChildCount(!0)},getQuadrantObjectCount:function e(){return l.root_.getObjectCount(!0)},debug:function e(t){var r;if(void 0!==t){for(r in l.debug_=t,p.checkInit(!0),d)this[r]=d[r];for(r in p)this[r]=p[r];this.data_=l}return l.debug_}};for(h in m)this[h]=m[h];this.setSize(t),this.setQuadrantObjectsLimit(r),this.setQuadrantLevelLimit(s)},t.exports=s},{"./quadtree2helper":9,"./quadtree2quadrant":10,"./quadtree2validator":11,vec2:7}],9:[function(e,t,r){var i={fnName:function e(t){var r=t.toString();return r=(r=r.substr(9)).substr(0,r.indexOf("("))},thrower:function e(t,r,i){var n=t;throw i&&(n+="_"+i),r&&(n+=" - "),r&&i&&(n+=i+": "),r&&(n+=r),new Error(n)},getIdsOfObjects:function e(t){var r=[];for(var i in t)r.push(t[i].id_);return r},compare:function e(t,r){return t-r},arrayDiffs:function e(t,r){var i=0,n=0,o=[],a=[];for(t.sort(this.compare),r.sort(this.compare);i<t.length&&n<r.length;)t[i]!==r[n]?t[i]<r[n]?(o.push(t[i]),i++):(a.push(r[n]),n++):(i++,n++);return i<t.length?o.push.apply(o,t.slice(i,t.length)):a.push.apply(a,r.slice(n,r.length)),[o,a]}};t.exports=i},{}],10:[function(e,t,r){var i=function e(t,r,i,n){this.leftTop_=t.clone(),this.children_=[],this.objects_={},this.objectCount_=0,this.id_=i||0,this.parent_=n,this.refactoring_=!1,this.setSize(r)};i.prototype={setSize:function e(t){t&&(this.size_=t,this.rad_=t.multiply(.5,!0),this.center_=this.leftTop_.add(this.rad_,!0),this.leftBot_=this.leftTop_.clone(),this.leftBot_.y+=t.y,this.rightTop_=this.leftTop_.clone(),this.rightTop_.x+=t.x,this.rightBot_=this.leftTop_.add(t,!0),this.leftMid_=this.center_.clone(),this.leftMid_.x=this.leftTop_.x,this.topMid_=this.center_.clone(),this.topMid_.y=this.leftTop_.y)},makeChildren:function e(t){return!(this.children_.length>0)&&(this.children_.push(new i(this.leftTop_,this.rad_,t++,this),new i(this.topMid_,this.rad_,t++,this),new i(this.leftMid_,this.rad_,t++,this),new i(this.center_,this.rad_,t++,this)),t)},looseChildren:function e(){this.children_=[]},addObjects:function e(t){var r;for(r in t)this.addObject(r,t[r])},addObject:function e(t,r){this.objectCount_++,this.objects_[t]=r},removeObjects:function e(t,r){var i;for(i in t||(t=[]),this.objects_)t.push({obj:this.objects_[i],quadrant:this}),delete this.objects_[i];return this.objectCount_=0,r&&1!==r||this.parent_&&this.parent_.removeObjects(t,1),r&&-1!==r||this.children_.forEach(function(e){e.removeObjects(t,-1)}),t},removeObject:function e(t){var r=this.objects_[t];return this.objectCount_--,delete this.objects_[t],r},getObjectCountForLimit:function e(){var t,r,i={};for(r in this.objects_)i[r]=!0;for(t=0;t<this.children_.length;t++)for(r in this.children_[t].objects_)i[r]=!0;return Object.keys(i).length},getObjectCount:function e(t,r){var i=this.objectCount_;return t&&this.children_.forEach(function(e){i+=e.getObjectCount(!r&&t)}),i},intersectingChildren:function e(t,r){return this.children_.filter(function(e){return e.intersects(t,r)})},intersects:function e(t,r){var i=t.subtract(this.center_,!0).abs(),n;return!(i.x>this.rad_.x+r)&&(!(i.y>this.rad_.y+r)&&(i.x<=this.rad_.x||(i.y<=this.rad_.y||(cornerDistSq=Math.pow(i.x-this.rad_.x,2)+Math.pow(i.y-this.rad_.y,2),cornerDistSq<=Math.pow(r,2)))))},hasChildren:function e(){return 0!==this.getChildCount()},getChildCount:function e(t){var r=this.children_.length;return t&&this.children_.forEach(function(e){r+=e.getChildCount(t)}),r},getChildren:function e(t,r){return r||(r=[]),r.push.apply(r,this.children_),t&&this.children_.forEach(function(e){e.getChildren(t,r)}),r},getObjectsUp:function e(t){var r;if(!t.quadrants[this.id_]){for(r in t.quadrants[this.id_]=!0,this.objects_)t.objects[r]=this.objects_[r];this.parent_&&this.parent_.getObjectsUp(t)}},getObjectsDown:function e(t){var r;if(!t.quadrants[this.id_]){for(r in t.quadrants[this.id_]=!0,this.objects_)t.objects[r]=this.objects_[r];for(r=0;r<this.children_.length;r++)this.children_[r].getObjectsDown(t)}}},t.exports=i},{}],11:[function(e,t,r){var i=e("vec2"),n=e("./quadtree2helper"),o=function e(){};o.prototype={isNumber:function e(t,r){"number"!=typeof t&&n.thrower("NaN","Not a Number",r)},isString:function e(t,r){"string"==typeof t||t instanceof String||n.thrower("NaS","Not a String",r)},isVec2:function e(t,r){var i=!1;(i="object"!=typeof t||void 0===t.x||void 0===t.y)&&n.thrower("NaV","Not a Vec2",r)},isDefined:function e(t,r){void 0===t&&n.thrower("ND","Not defined",r)},isObject:function e(t,r){"object"!=typeof t&&n.thrower("NaO","Not an Object",r)},hasKey:function e(t,r,i){this.isDefined(t,"obj"),-1===Object.keys(t).indexOf(r.toString())&&n.thrower("OhnK","Object has no key",i+r)},hasNoKey:function e(t,r,i){this.isDefined(t,"obj"),-1!==Object.keys(t).indexOf(r.toString())&&n.thrower("OhK","Object has key",i+r)},fnFalse:function e(t){t()&&n.thrower("FarT","function already returns true",n.fnName(t))},byCallbackObject:function e(t,r,i){var n;for(n in r)void 0!==i?r[n](t[i[n]],i[n]):r[n](t[n],n)}},t.exports=o},{"./quadtree2helper":9,vec2:7}],12:[function(e,t,r){var i=i||{},n={REVISION:"66"},o,a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P,L,D,F,R,V,U,z,O,N,B,I,k,j,G,W,H,X,q,Y,K,Q,Z,J,$,ee,te,re;i.console=i.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!i.requestAnimationFrame;++r)i.requestAnimationFrame=i[t[r]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[t[r]+"CancelAnimationFrame"]||i[t[r]+"CancelRequestAnimationFrame"];void 0===i.requestAnimationFrame&&void 0!==i.setTimeout&&(i.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(0,16-(r-e)),o=i.setTimeout(function(){t(r+n)},n);return e=r+n,o}),void 0===i.cancelAnimationFrame&&void 0!==i.clearTimeout&&(i.cancelAnimationFrame=function(e){i.clearTimeout(e)})}(),n.CullFaceNone=0,n.CullFaceBack=1,n.CullFaceFront=2,n.CullFaceFrontBack=3,n.FrontFaceDirectionCW=0,n.FrontFaceDirectionCCW=1,n.BasicShadowMap=0,n.PCFShadowMap=1,n.PCFSoftShadowMap=2,n.FrontSide=0,n.BackSide=1,n.DoubleSide=2,n.NoShading=0,n.FlatShading=1,n.SmoothShading=2,n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NoBlending=0,n.NormalBlending=1,n.AdditiveBlending=2,n.SubtractiveBlending=3,n.MultiplyBlending=4,n.CustomBlending=5,n.AddEquation=100,n.SubtractEquation=101,n.ReverseSubtractEquation=102,n.ZeroFactor=200,n.OneFactor=201,n.SrcColorFactor=202,n.OneMinusSrcColorFactor=203,n.SrcAlphaFactor=204,n.OneMinusSrcAlphaFactor=205,n.DstAlphaFactor=206,n.OneMinusDstAlphaFactor=207,n.DstColorFactor=208,n.OneMinusDstColorFactor=209,n.SrcAlphaSaturateFactor=210,n.MultiplyOperation=0,n.MixOperation=1,n.AddOperation=2,n.UVMapping=function(){},n.CubeReflectionMapping=function(){},n.CubeRefractionMapping=function(){},n.SphericalReflectionMapping=function(){},n.SphericalRefractionMapping=function(){},n.RepeatWrapping=1e3,n.ClampToEdgeWrapping=1001,n.MirroredRepeatWrapping=1002,n.NearestFilter=1003,n.NearestMipMapNearestFilter=1004,n.NearestMipMapLinearFilter=1005,n.LinearFilter=1006,n.LinearMipMapNearestFilter=1007,n.LinearMipMapLinearFilter=1008,n.UnsignedByteType=1009,n.ByteType=1010,n.ShortType=1011,n.UnsignedShortType=1012,n.IntType=1013,n.UnsignedIntType=1014,n.FloatType=1015,n.UnsignedShort4444Type=1016,n.UnsignedShort5551Type=1017,n.UnsignedShort565Type=1018,n.AlphaFormat=1019,n.RGBFormat=1020,n.RGBAFormat=1021,n.LuminanceFormat=1022,n.LuminanceAlphaFormat=1023,n.RGB_S3TC_DXT1_Format=2001,n.RGBA_S3TC_DXT1_Format=2002,n.RGBA_S3TC_DXT3_Format=2003,n.RGBA_S3TC_DXT5_Format=2004,n.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(e){return e instanceof n.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e},n=r<=.5?r*(1+t):r+t-r*t,o=2*r-n;this.r=i(o,n,e+1/3),this.g=i(o,n,e),this.b=i(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(n.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0},r=this.r,i=this.g,n=this.b,o=Math.max(r,i,n),a=Math.min(r,i,n),s,h,l=(a+o)/2;if(a===o)s=0,h=0;else{var c=o-a;switch(h=l<=.5?c/(o+a):c/(2-o-a),o){case r:s=(i-n)/c+(i<n?6:0);break;case i:s=(n-r)/c+2;break;case n:s=(r-i)/c+4;break}s/=6}return t.h=s,t.s=h,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new n.Color).setRGB(this.r,this.g,this.b)}},n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},n.Quaternion.prototype={constructor:n.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(e instanceof n.Euler==!1)throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),o=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),h=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=a*i*o+r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o-a*s*h):"YXZ"===e.order?(this._x=a*i*o+r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o+a*s*h):"ZXY"===e.order?(this._x=a*i*o-r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o-a*s*h):"ZYX"===e.order?(this._x=a*i*o-r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o+a*s*h):"YZX"===e.order?(this._x=a*i*o+r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o-a*s*h):"XZY"===e.order&&(this._x=a*i*o-r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o+a*s*h),!1!==t&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._updateEuler(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],i=t[4],n=t[8],o=t[1],a=t[5],s=t[9],h=t[2],l=t[6],c=t[10],u=r+a+c,f;return u>0?(f=.5/Math.sqrt(u+1),this._w=.25/f,this._x=(l-s)*f,this._y=(n-h)*f,this._z=(o-i)*f):r>a&&r>c?(f=2*Math.sqrt(1+r-a-c),this._w=(l-s)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(n+h)/f):a>c?(f=2*Math.sqrt(1+a-r-c),this._w=(n-h)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(s+l)/f):(f=2*Math.sqrt(1+c-r-a),this._w=(o-i)/f,this._x=(n+h)/f,this._y=(s+l)/f,this._z=.25*f),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,h=t._z,l=t._w;return this._x=r*l+o*a+i*h-n*s,this._y=i*l+o*s+n*a-r*h,this._z=n*l+o*h+r*s-i*a,this._w=o*l-r*a-i*s-n*h,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var l=Math.sin((1-t)*s)/h,c=Math.sin(t*s)/h;return this._w=o*l+this._w*c,this._x=r*l+this._x*c,this._y=i*l+this._y*c,this._z=n*l+this._z*c,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new n.Quaternion(this._x,this._y,this._z,this._w)}},n.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},n.Vector2=function(e,t){this.x=e||0,this.y=t||0},n.Vector2.prototype={constructor:n.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===o&&(o=new n.Vector2,a=new n.Vector2),o.set(e,e),a.set(t,t),this.clamp(o,a)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new n.Vector2(this.x,this.y)}},n.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},n.Vector3.prototype={constructor:n.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof n.Euler==0&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===l&&(l=new n.Quaternion),this.applyQuaternion(l.setFromEuler(e)),this},applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new n.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,h=s*t+o*i-a*r,l=s*r+a*t-n*i,c=s*i+n*r-o*t,u=-n*t-o*r-a*i;return this.x=h*s+u*-n+l*-a-c*-o,this.y=l*s+u*-o+c*-n-h*-a,this.z=c*s+u*-a+h*-o-l*-n,this},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new n.Vector3,t=new n.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(e){return void 0===s&&(s=new n.Vector3),s.copy(e).normalize(),h=this.dot(s),this.copy(s).multiplyScalar(h)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(n.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new n.Vector3(this.x,this.y,this.z)}},n.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},n.Vector4.prototype={constructor:n.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=.01,a=.1,s=e.elements,h=s[0],l=s[4],c=s[8],u=s[1],f=s[5],p=s[9],d=s[2],m=s[6],v=s[10];if(Math.abs(l-u)<o&&Math.abs(c-d)<o&&Math.abs(p-m)<o){if(Math.abs(l+u)<a&&Math.abs(c+d)<a&&Math.abs(p+m)<a&&Math.abs(h+f+v-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var g=(h+1)/2,y=(f+1)/2,x=(v+1)/2,b=(l+u)/4,w=(c+d)/4,_=(p+m)/4;return g>y&&g>x?g<o?(r=0,i=.707106781,n=.707106781):(i=b/(r=Math.sqrt(g)),n=w/r):y>x?y<o?(r=.707106781,i=0,n=.707106781):(r=b/(i=Math.sqrt(y)),n=_/i):x<o?(r=.707106781,i=.707106781,n=0):(r=w/(n=Math.sqrt(x)),i=_/n),this.set(r,i,n,t),this}var M=Math.sqrt((m-p)*(m-p)+(c-d)*(c-d)+(u-l)*(u-l));return Math.abs(M)<.001&&(M=1),this.x=(m-p)/M,this.y=(c-d)/M,this.z=(u-l)/M,this.w=Math.acos((h+f+v-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new n.Vector4,t=new n.Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new n.Vector4(this.x,this.y,this.z,this.w)}},n.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,_x:0,_y:0,_z:0,_order:n.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromVector:function(e,t){return this._x=e.x,this._y=e.y,this._z=e.z,this._order=t||this._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,n=i[0],o=i[4],a=i[8],s=i[1],h=i[5],l=i[9],c=i[2],u=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(a)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(u,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(l)),Math.abs(l)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(s,h)):(this._y=Math.atan2(-c,n),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(s,n))):"ZYX"===t?(this._y=Math.asin(-r(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(s,n)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===t?(this._z=Math.asin(r(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===t?(this._z=Math.asin(-r(o)),Math.abs(o)<.99999?(this._x=Math.atan2(u,h),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-l,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,r){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.x*e.x,o=e.y*e.y,a=e.z*e.z,s=e.w*e.w;return"XYZ"===(t=t||this._order)?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-n-o+a),this._y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+n-o-a)):"YXZ"===t?(this._x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-n-o+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-n+o-a)):"ZXY"===t?(this._x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-n-o+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-n+o-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-n-o+a),this._y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+n-o-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-n+o-a),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+n-o-a),this._z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-n+o-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+n-o-a),this._z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==r&&this._updateQuaternion(),this},reorder:(c=new n.Quaternion,function(e){c.setFromEuler(this),this.setFromQuaternion(c,e)}),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new n.Euler(this._x,this._y,this._z,this._order)}},n.Line3=function(e,t){this.start=void 0!==e?e:new n.Vector3,this.end=void 0!==t?t:new n.Vector3},n.Line3.prototype={constructor:n.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t;return(e||new n.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t;return(e||new n.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new n.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(u=new n.Vector3,f=new n.Vector3,function(e,t){u.subVectors(e,this.start),f.subVectors(this.end,this.start);var r=f.dot(f),i,o=f.dot(u)/r;return t&&(o=n.Math.clamp(o,0,1)),o}),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),o=r||new n.Vector3;return this.delta(o).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new n.Line3).copy(this)}},n.Box2=function(e,t){this.min=void 0!==e?e:new n.Vector2(1/0,1/0),this.max=void 0!==t?t:new n.Vector2(-1/0,-1/0)},n.Box2.prototype={constructor:n.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)(t=e[r]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new n.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t;return(e||new n.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t;return(e||new n.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){var r;return(t||new n.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var r;return(t||new n.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector2;return function(t){var r;return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box2).copy(this)}},n.Box3=function(e,t){this.min=void 0!==e?e:new n.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new n.Vector3(-1/0,-1/0,-1/0)},n.Box3.prototype={constructor:n.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)this.addPoint(e[r])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new n.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new n.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var i=t.geometry.vertices,n=0,o=i.length;n<o;n++)e.copy(i[n]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t;return(e||new n.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t;return(e||new n.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var r;return(t||new n.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){var r;return(t||new n.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r;return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new n.Vector3;return function(t){var r=t||new n.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(p=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],function(e){return p[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),p[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),p[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),p[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),p[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),p[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),p[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),p[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(p),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box3).copy(this)}},n.Matrix3=function(e,t,r,i,n,o,a,s,h){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==n?n:1,o||0,a||0,s||0,void 0!==h?h:1)},n.Matrix3.prototype={constructor:n.Matrix3,set:function(e,t,r,i,n,o,a,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=i,l[4]=n,l[7]=o,l[2]=a,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new n.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],h=e[7],l=e[8];return t*o*l-t*a*h-r*n*l+r*a*s+i*n*h-i*o*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new n.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},n.Matrix4=function(e,t,r,i,n,o,a,s,h,l,c,u,f,p,d,m){this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==e?e:1,v[4]=t||0,v[8]=r||0,v[12]=i||0,v[1]=n||0,v[5]=void 0!==o?o:1,v[9]=a||0,v[13]=s||0,v[2]=h||0,v[6]=l||0,v[10]=void 0!==c?c:1,v[14]=u||0,v[3]=f||0,v[7]=p||0,v[11]=d||0,v[15]=void 0!==m?m:1},n.Matrix4.prototype={constructor:n.Matrix4,set:function(e,t,r,i,n,o,a,s,h,l,c,u,f,p,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=i,v[1]=n,v[5]=o,v[9]=a,v[13]=s,v[2]=h,v[6]=l,v[10]=c,v[14]=u,v[3]=f,v[7]=p,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:function(){var e=new n.Vector3;return function(t){var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof n.Euler==!1&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,r=e.x,i=e.y,o=e.z,a=Math.cos(r),s=Math.sin(r),h=Math.cos(i),l=Math.sin(i),c=Math.cos(o),u=Math.sin(o);if("XYZ"===e.order){var f=a*c,p=a*u,d=s*c,m=s*u;t[0]=h*c,t[4]=-h*u,t[8]=l,t[1]=p+d*l,t[5]=f-m*l,t[9]=-s*h,t[2]=m-f*l,t[6]=d+p*l,t[10]=a*h}else if("YXZ"===e.order){var v=h*c,g=h*u,y=l*c,x=l*u;t[0]=v+x*s,t[4]=y*s-g,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=g*s-y,t[6]=x+v*s,t[10]=a*h}else if("ZXY"===e.order){var v=h*c,g=h*u,y=l*c,x=l*u;t[0]=v-x*s,t[4]=-a*u,t[8]=y+g*s,t[1]=g+y*s,t[5]=a*c,t[9]=x-v*s,t[2]=-a*l,t[6]=s,t[10]=a*h}else if("ZYX"===e.order){var f=a*c,p=a*u,d=s*c,m=s*u;t[0]=h*c,t[4]=d*l-p,t[8]=f*l+m,t[1]=h*u,t[5]=m*l+f,t[9]=p*l-d,t[2]=-l,t[6]=s*h,t[10]=a*h}else if("YZX"===e.order){var b=a*h,w=a*l,_=s*h,M=s*l;t[0]=h*c,t[4]=M-b*u,t[8]=_*u+w,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=w*u+_,t[10]=b-M*u}else if("XZY"===e.order){var b=a*h,w=a*l,_=s*h,M=s*l;t[0]=h*c,t[4]=-u,t[8]=l*c,t[1]=b*u+M,t[5]=a*c,t[9]=w*u-_,t[2]=_*u-w,t[6]=s*c,t[10]=M*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,h=n+n,l=r*a,c=r*s,u=r*h,f=i*s,p=i*h,d=n*h,m=o*a,v=o*s,g=o*h;return t[0]=1-(f+d),t[4]=c-g,t[8]=u+v,t[1]=c+g,t[5]=1-(l+d),t[9]=p-m,t[2]=u-v,t[6]=p+m,t[10]=1-(l+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(v=new n.Vector3,g=new n.Vector3,y=new n.Vector3,function(e,t,r){var i=this.elements;return y.subVectors(e,t).normalize(),0===y.length()&&(y.z=1),v.crossVectors(r,y).normalize(),0===v.length()&&(y.x+=1e-4,v.crossVectors(r,y).normalize()),g.crossVectors(y,v),i[0]=v.x,i[4]=g.x,i[8]=y.x,i[1]=v.y,i[5]=g.y,i[9]=y.y,i[2]=v.z,i[6]=g.z,i[10]=y.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],l=r[1],c=r[5],u=r[9],f=r[13],p=r[2],d=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],b=r[15],w=i[0],_=i[4],M=i[8],S=i[12],T=i[1],C=i[5],A=i[9],E=i[13],P=i[2],L=i[6],D=i[10],F=i[14],R=i[3],V=i[7],U=i[11],z=i[15];return n[0]=o*w+a*T+s*P+h*R,n[4]=o*_+a*C+s*L+h*V,n[8]=o*M+a*A+s*D+h*U,n[12]=o*S+a*E+s*F+h*z,n[1]=l*w+c*T+u*P+f*R,n[5]=l*_+c*C+u*L+f*V,n[9]=l*M+c*A+u*D+f*U,n[13]=l*S+c*E+u*F+f*z,n[2]=p*w+d*T+m*P+v*R,n[6]=p*_+d*C+m*L+v*V,n[10]=p*M+d*A+m*D+v*U,n[14]=p*S+d*E+m*F+v*z,n[3]=g*w+y*T+x*P+b*R,n[7]=g*_+y*C+x*L+b*V,n[11]=g*M+y*A+x*D+b*U,n[15]=g*S+y*E+x*F+b*z,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new n.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyProjection(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],h=e[13],l=e[2],c=e[6],u=e[10],f=e[14],p,d,m,v;return e[3]*(+n*s*c-i*h*c-n*a*u+r*h*u+i*a*f-r*s*f)+e[7]*(+t*s*f-t*h*u+n*o*u-i*o*f+i*h*l-n*s*l)+e[11]*(+t*h*c-t*a*f-n*o*c+r*o*f+n*a*l-r*h*l)+e[15]*(-i*a*l-t*s*c+t*a*u+i*o*c-r*o*u+r*s*l)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new n.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[4],a=i[8],s=i[12],h=i[1],l=i[5],c=i[9],u=i[13],f=i[2],p=i[6],d=i[10],m=i[14],v=i[3],g=i[7],y=i[11],x=i[15];r[0]=c*m*g-u*d*g+u*p*y-l*m*y-c*p*x+l*d*x,r[4]=s*d*g-a*m*g-s*p*y+o*m*y+a*p*x-o*d*x,r[8]=a*u*g-s*c*g+s*l*y-o*u*y-a*l*x+o*c*x,r[12]=s*c*p-a*u*p-s*l*d+o*u*d+a*l*m-o*c*m,r[1]=u*d*v-c*m*v-u*f*y+h*m*y+c*f*x-h*d*x,r[5]=a*m*v-s*d*v+s*f*y-n*m*y-a*f*x+n*d*x,r[9]=s*c*v-a*u*v-s*h*y+n*u*y+a*h*x-n*c*x,r[13]=a*u*f-s*c*f+s*h*d-n*u*d-a*h*m+n*c*m,r[2]=l*m*v-u*p*v+u*f*g-h*m*g-l*f*x+h*p*x,r[6]=s*p*v-o*m*v-s*f*g+n*m*g+o*f*x-n*p*x,r[10]=o*u*v-s*l*v+s*h*g-n*u*g-o*h*x+n*l*x,r[14]=s*l*f-o*u*f-s*h*p+n*u*p+o*h*m-n*l*m,r[3]=c*p*v-l*d*v-c*f*g+h*d*g+l*f*y-h*p*y,r[7]=o*d*v-a*p*v+a*f*g-n*d*g-o*f*y+n*p*y,r[11]=a*l*v-o*c*v-a*h*g+n*c*g+o*h*y-n*l*y,r[15]=o*c*f-a*l*f+a*h*p-n*c*p-o*h*d+n*l*d;var b=n*r[0]+h*r[4]+f*r[8]+v*r[12];if(0==b){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,h=n*o,l=n*a;return this.set(h*o+r,h*a-i*s,h*s+i*a,0,h*a+i*s,l*a+r,l*s-i*o,0,h*s-i*a,l*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:(d=new n.Vector3,m=new n.Matrix4,function(e,t,r){var i=this.elements,n=d.set(i[0],i[1],i[2]).length(),o=d.set(i[4],i[5],i[6]).length(),a=d.set(i[8],i[9],i[10]).length(),s;this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],m.elements.set(this.elements);var h=1/n,l=1/o,c=1/a;return m.elements[0]*=h,m.elements[1]*=h,m.elements[2]*=h,m.elements[4]*=l,m.elements[5]*=l,m.elements[6]*=l,m.elements[8]*=c,m.elements[9]*=c,m.elements[10]*=c,t.setFromRotationMatrix(m),r.x=n,r.y=o,r.z=a,this}),makeFrustum:function(e,t,r,i,n,o){var a=this.elements,s=2*n/(t-e),h=2*n/(i-r),l=(t+e)/(t-e),c=(i+r)/(i-r),u=-(o+n)/(o-n),f=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var o=r*Math.tan(n.Math.degToRad(.5*e)),a=-o,s=a*t,h=o*t;return this.makeFrustum(s,h,a,o,r,i)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,h=r-i,l=o-n,c=(t+e)/s,u=(r+i)/h,f=(o+n)/l;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new n.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},n.Ray=function(e,t){this.origin=void 0!==e?e:new n.Vector3,this.direction=void 0!==t?t:new n.Vector3},n.Ray.prototype={constructor:n.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r;return(t||new n.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new n.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new n.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,r,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize(),a=.5*e.distanceTo(t),s=this.origin.clone().sub(n),h=-this.direction.dot(o),l=s.dot(this.direction),c=-s.dot(o),u=s.lengthSq(),f=Math.abs(1-h*h),p,d,m,v;if(f>=0)if(d=h*l-c,v=a*f,(p=h*c-l)>=0)if(d>=-v)if(d<=v){var g=1/f;m=(p*=g)*(p+h*(d*=g)+2*l)+d*(h*p+d+2*c)+u}else d=a,m=-(p=Math.max(0,-(h*d+l)))*p+d*(d+2*c)+u;else d=-a,m=-(p=Math.max(0,-(h*d+l)))*p+d*(d+2*c)+u;else d<=-v?m=-(p=Math.max(0,-(-h*a+l)))*p+(d=p>0?-a:Math.min(Math.max(-a,-c),a))*(d+2*c)+u:d<=v?(p=0,m=(d=Math.min(Math.max(-a,-c),a))*(d+2*c)+u):m=-(p=Math.max(0,-(h*a+l)))*p+(d=p>0?a:Math.min(Math.max(-a,-c),a))*(d+2*c)+u;else d=h>0?-a:a,m=-(p=Math.max(0,-(h*d+l)))*p+d*(d+2*c)+u;return r&&r.copy(this.direction.clone().multiplyScalar(p).add(this.origin)),i&&i.copy(o.clone().multiplyScalar(d).add(n)),m},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin),r;return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:(M=new n.Vector3,function(e){return null!==this.intersectBox(e,M)}),intersectBox:function(e,t){var r,i,n,o,a,s,h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(r=(e.min.x-u.x)*h,i=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,i=(e.min.x-u.x)*h),l>=0?(n=(e.min.y-u.y)*l,o=(e.max.y-u.y)*l):(n=(e.max.y-u.y)*l,o=(e.min.y-u.y)*l),r>o||n>i?null:((n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),c>=0?(a=(e.min.z-u.z)*c,s=(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,s=(e.min.z-u.z)*c),r>s||a>i?null:((a>r||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,t)))},intersectTriangle:(x=new n.Vector3,b=new n.Vector3,w=new n.Vector3,_=new n.Vector3,function(e,t,r,i,n){b.subVectors(t,e),w.subVectors(r,e),_.crossVectors(b,w);var o=this.direction.dot(_),a;if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}x.subVectors(this.origin,e);var s=a*this.direction.dot(w.crossVectors(x,w));if(s<0)return null;var h=a*this.direction.dot(b.cross(x));if(h<0)return null;if(s+h>o)return null;var l=-a*x.dot(_);return l<0?null:this.at(l/o,n)}),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new n.Ray).copy(this)}},n.Sphere=function(e,t){this.center=void 0!==e?e:new n.Vector3,this.radius=void 0!==t?t:0},n.Sphere.prototype={constructor:n.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(S=new n.Box3,function(e,t){var r=this.center;void 0!==t?r.copy(t):S.setFromPoints(e).center(r);for(var i=0,n=0,o=e.length;n<o;n++)i=Math.max(i,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new n.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new n.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new n.Sphere).copy(this)}},n.Frustum=function(e,t,r,i,o,a){this.planes=[void 0!==e?e:new n.Plane,void 0!==t?t:new n.Plane,void 0!==r?r:new n.Plane,void 0!==i?i:new n.Plane,void 0!==o?o:new n.Plane,void 0!==a?a:new n.Plane]},n.Frustum.prototype={constructor:n.Frustum,set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],h=r[5],l=r[6],c=r[7],u=r[8],f=r[9],p=r[10],d=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(a-i,c-s,d-u,y-m).normalize(),t[1].setComponents(a+i,c+s,d+u,y+m).normalize(),t[2].setComponents(a+n,c+h,d+f,y+v).normalize(),t[3].setComponents(a-n,c-h,d-f,y-v).normalize(),t[4].setComponents(a-o,c-l,d-p,y-g).normalize(),t[5].setComponents(a+o,c+l,d+p,y+g).normalize(),this},intersectsObject:(A=new n.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),A.copy(t.boundingSphere),A.applyMatrix4(e.matrixWorld),this.intersectsSphere(A)}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){var o;if(t[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:(T=new n.Vector3,C=new n.Vector3,function(e){for(var t=this.planes,r=0;r<6;r++){var i=t[r];T.x=i.normal.x>0?e.min.x:e.max.x,C.x=i.normal.x>0?e.max.x:e.min.x,T.y=i.normal.y>0?e.min.y:e.max.y,C.y=i.normal.y>0?e.max.y:e.min.y,T.z=i.normal.z>0?e.min.z:e.max.z,C.z=i.normal.z>0?e.max.z:e.min.z;var n=i.distanceToPoint(T),o=i.distanceToPoint(C);if(n<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new n.Frustum).copy(this)}},n.Plane=function(e,t){this.normal=void 0!==e?e:new n.Vector3(1,0,0),this.constant=void 0!==t?t:0},n.Plane.prototype={constructor:n.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i;return(t||new n.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new n.Vector3;return function(t,r){var i=r||new n.Vector3,o=t.delta(e),a=this.normal.dot(o);if(0==a)return 0==this.distanceToPoint(t.start)?i.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/a;return s<0||s>1?void 0:i.copy(o).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t;return(e||new n.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Matrix3;return function(i,n){var o=n||r.getNormalMatrix(i),a=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new n.Plane).copy(this)}},n.Math={PI2:2*Math.PI,generateUUID:(L="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),D=new Array(36),F=0,function(){for(var e=0;e<36;e++)8==e||13==e||18==e||23==e?D[e]="-":14==e?D[e]="4":(F<=2&&(F=33554432+16777216*Math.random()|0),R=15&F,F>>=4,D[e]=L[19==e?3&R|8:R]);return D.join("")}),clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:(P=Math.PI/180,function(e){return e*P}),radToDeg:(E=180/Math.PI,function(e){return e*E}),isPowerOfTwo:function(e){return!(e&e-1)&&0!==e}},n.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},i,o,a,s,h,l,c,u,f;function p(e,t,r,i,n,o,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*n+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,o=Math.floor(i),a=i-o,t[0]=0===o?o:o-1,t[1]=o,t[2]=o>this.points.length-2?this.points.length-1:o+1,t[3]=o>this.points.length-3?this.points.length-1:o+2,l=this.points[t[0]],c=this.points[t[1]],u=this.points[t[2]],f=this.points[t[3]],h=a*(s=a*a),r.x=p(l.x,c.x,u.x,f.x,a,s,h),r.y=p(l.y,c.y,u.y,f.y,a,s,h),r.z=p(l.z,c.z,u.z,f.z,a,s,h),r},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,o,a=0,s=0,h=0,l=new n.Vector3,c=new n.Vector3,u=[],f=0;for(u[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;t<i;t++)r=t/i,o=this.getPoint(r),c.copy(o),f+=c.distanceTo(l),l.copy(o),a=(this.points.length-1)*r,(s=Math.floor(a))!=h&&(u[s]=f,h=s);return u[u.length]=f,{chunks:u,total:f}},this.reparametrizeByArcLength=function(e){var t,r,i,o,a,s,h,l,c,u=[],f=new n.Vector3,p=this.getLength();for(u.push(f.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(h=p.chunks[t]-p.chunks[t-1],l=Math.ceil(e*h/p.total),o=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;r<l-1;r++)i=o+r*(1/l)*(a-o),c=this.getPoint(i),u.push(f.copy(c).clone());u.push(f.copy(this.points[t]).clone())}this.points=u}},n.Triangle=function(e,t,r){this.a=void 0!==e?e:new n.Vector3,this.b=void 0!==t?t:new n.Vector3,this.c=void 0!==r?r:new n.Vector3},n.Triangle.normal=(V=new n.Vector3,function(e,t,r,i){var o=i||new n.Vector3;o.subVectors(r,t),V.subVectors(e,t),o.cross(V);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}),n.Triangle.barycoordFromPoint=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(i,o,a,s,h){e.subVectors(s,o),t.subVectors(a,o),r.subVectors(i,o);var l=e.dot(e),c=e.dot(t),u=e.dot(r),f=t.dot(t),p=t.dot(r),d=l*f-c*c,m=h||new n.Vector3;if(0==d)return m.set(-2,-1,-1);var v=1/d,g=(f*u-c*p)*v,y=(l*p-c*u)*v;return m.set(1-g-y,y,g)}}(),n.Triangle.containsPoint=function(){var e=new n.Vector3;return function(t,r,i,o){var a=n.Triangle.barycoordFromPoint(t,r,i,o,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new n.Vector3,t=new n.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t;return(e||new n.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t;return(e||new n.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new n.Triangle).copy(this)}},n.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},n.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new n.Vector2(e,t)},n.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=void 0!==i.performance&&void 0!==i.performance.now?i.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==i.performance&&void 0!==i.performance.now?i.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},n.EventDispatcher=function(){},n.EventDispatcher.prototype={constructor:n.EventDispatcher,apply:function(e){e.addEventListener=n.EventDispatcher.prototype.addEventListener,e.hasEventListener=n.EventDispatcher.prototype.hasEventListener,e.removeEventListener=n.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=n.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r,i=this._listeners[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:(U=[],function(e){if(void 0!==this._listeners){var t,r=this._listeners[e.type];if(void 0!==r){e.target=this;for(var i=r.length,n=0;n<i;n++)U[n]=r[n];for(var n=0;n<i;n++)U[n].call(this,e)}}})},function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.near=i||0,this.far=n||1/0};var t=new e.Sphere,r=new e.Ray,i=new e.Plane,n=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},h=new e.Vector3,l=new e.Vector3,c=new e.Vector3,u=function(i,n,s){if(i instanceof e.Sprite){var f;if(o.setFromMatrixPosition(i.matrixWorld),(f=n.ray.distanceToPoint(o))>i.scale.x)return s;s.push({distance:f,point:i.position,face:null,object:i})}else if(i instanceof e.LOD){o.setFromMatrixPosition(i.matrixWorld);var f=n.ray.origin.distanceTo(o);u(i.getObjectForDistance(f),n,s)}else if(i instanceof e.Mesh){var p;if(null===(p=i.geometry).boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(i.matrixWorld),!1===n.ray.isIntersectionSphere(t))return s;if(a.getInverse(i.matrixWorld),r.copy(n.ray).applyMatrix4(a),null!==p.boundingBox&&!1===r.isIntersectionBox(p.boundingBox))return s;if(p instanceof e.BufferGeometry){var d;if(void 0===(d=i.material))return s;var m=p.attributes,v,g,y,x=n.precision;if(void 0!==m.index)for(var b=p.offsets,w=m.index.array,_=m.position.array,M=0,S=b.length;M<S;++M)for(var T=b[M].start,C=b[M].count,A=b[M].index,E=T,P=T+C;E<P;E+=3){if(v=A+w[E],g=A+w[E+1],y=A+w[E+2],h.set(_[3*v],_[3*v+1],_[3*v+2]),l.set(_[3*g],_[3*g+1],_[3*g+2]),c.set(_[3*y],_[3*y+1],_[3*y+2]),d.side===e.BackSide)var L=r.intersectTriangle(c,l,h,!0);else var L=r.intersectTriangle(h,l,c,d.side!==e.DoubleSide);var f;if(null!==L)L.applyMatrix4(i.matrixWorld),(f=n.ray.origin.distanceTo(L))<x||f<n.near||f>n.far||s.push({distance:f,point:L,indices:[v,g,y],face:null,faceIndex:null,object:i})}else for(var b=p.offsets,_=m.position.array,E=0,P=m.position.array.length;E<P;E+=3){if(v=E,g=E+1,y=E+2,h.set(_[3*v],_[3*v+1],_[3*v+2]),l.set(_[3*g],_[3*g+1],_[3*g+2]),c.set(_[3*y],_[3*y+1],_[3*y+2]),d.side===e.BackSide)var L=r.intersectTriangle(c,l,h,!0);else var L=r.intersectTriangle(h,l,c,d.side!==e.DoubleSide);var f;if(null!==L)L.applyMatrix4(i.matrixWorld),(f=n.ray.origin.distanceTo(L))<x||f<n.near||f>n.far||s.push({distance:f,point:L,indices:[v,g,y],face:null,faceIndex:null,object:i})}}else if(p instanceof e.Geometry)for(var D=i.material instanceof e.MeshFaceMaterial,F=!0===D?i.material.materials:null,v,g,y,R,x=n.precision,V=p.vertices,U=0,z=p.faces.length;U<z;U++){var O=p.faces[U],d;if(void 0!==(d=!0===D?F[O.materialIndex]:i.material)){if(v=V[O.a],g=V[O.b],y=V[O.c],!0===d.morphTargets){var N=p.morphTargets,B=i.morphTargetInfluences;h.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(var I=0,k=N.length;I<k;I++){var j=B[I];if(0!==j){var G=N[I].vertices;h.x+=(G[O.a].x-v.x)*j,h.y+=(G[O.a].y-v.y)*j,h.z+=(G[O.a].z-v.z)*j,l.x+=(G[O.b].x-g.x)*j,l.y+=(G[O.b].y-g.y)*j,l.z+=(G[O.b].z-g.z)*j,c.x+=(G[O.c].x-y.x)*j,c.y+=(G[O.c].y-y.y)*j,c.z+=(G[O.c].z-y.z)*j}}h.add(v),l.add(g),c.add(y),v=h,g=l,y=c}if(d.side===e.BackSide)var L=r.intersectTriangle(y,g,v,!0);else var L=r.intersectTriangle(v,g,y,d.side!==e.DoubleSide);var f;if(null!==L)L.applyMatrix4(i.matrixWorld),(f=n.ray.origin.distanceTo(L))<x||f<n.near||f>n.far||s.push({distance:f,point:L,face:O,faceIndex:U,object:i})}}}else if(i instanceof e.Line){var x,W=(x=n.linePrecision)*x,p;if(null===(p=i.geometry).boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(i.matrixWorld),!1===n.ray.isIntersectionSphere(t))return s;if(a.getInverse(i.matrixWorld),r.copy(n.ray).applyMatrix4(a),p instanceof e.Geometry)for(var V,H=(V=p.vertices).length,X=new e.Vector3,q=new e.Vector3,Y=i.type===e.LineStrip?1:2,E=0;E<H-1;E+=Y){var K,f;if(!(r.distanceSqToSegment(V[E],V[E+1],q,X)>W))(f=r.origin.distanceTo(q))<n.near||f>n.far||s.push({distance:f,point:X.clone().applyMatrix4(i.matrixWorld),face:null,faceIndex:null,object:i})}}},f=function(e,t,r){for(var i=e.getDescendants(),n=0,o=i.length;n<o;n++)u(i[n],t,r)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var r=[];return!0===t&&f(e,this,r),u(e,this,r),r.sort(s),r},e.Raycaster.prototype.intersectObjects=function(e,t){for(var r=[],i=0,n=e.length;i<n;i++)u(e[i],this,r),!0===t&&f(e[i],this,r);return r.sort(s),r}}(n),n.Object3D=function(){this.id=n.Object3DIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new n.Vector3(0,1,0),this.position=new n.Vector3,this._rotation=new n.Euler,this._quaternion=new n.Quaternion,this.scale=new n.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},n.Object3D.prototype={constructor:n.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(O=new n.Quaternion,function(e,t){return O.setFromAxisAngle(e,t),this.quaternion.multiply(O),this}),rotateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n.Vector3;return function(t,r){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(z=new n.Matrix4,function(e){return e.applyMatrix4(z.getInverse(this.matrixWorld))}),lookAt:function(){var e=new n.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e!==this){if(e instanceof n.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof n.Scene&&t.__addObject(e)}}else console.warn("THREE.Object3D.add: An object can't be added as a child of itself.")},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof n.Scene&&r.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.id===e)return n;if(!0===t&&void 0!==(n=n.getObjectById(e,t)))return n}},getObjectByName:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.name===e)return n;if(!0===t&&void 0!==(n=n.getObjectByName(e,t)))return n}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;t<r;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new n.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var r=0;r<this.children.length;r++){var i=this.children[r];e.add(i.clone())}return e}},n.EventDispatcher.prototype.apply(n.Object3D.prototype),n.Object3DIdCount=0,n.Projector=function(){var e,t,r=[],i=0,o,a,s=[],h=0,l,c,u=[],f=0,p,d,m=[],v=0,g,y,x=[],b=0,w={objects:[],lights:[],elements:[]},_=new n.Vector3,M=new n.Vector3,S=new n.Vector3,T=new n.Vector3,C=new n.Vector4,A=new n.Box3(new n.Vector3(-1,-1,-1),new n.Vector3(1,1,1)),E=new n.Box3,P=new Array(3),L=new Array(4),D=new n.Matrix4,F=new n.Matrix4,R,V=new n.Matrix4,U=new n.Matrix3,z=new n.Frustum,O=new n.Vector4,N=new n.Vector4,B;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(F)},this.unprojectVector=(B=new n.Matrix4,function(e,t){return B.getInverse(t.projectionMatrix),F.multiplyMatrices(t.matrixWorld,B),e.applyProjection(F)}),this.pickingRay=function(e,t){e.z=-1;var r=new n.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new n.Raycaster(e,r)};var I=function(t){if(!1!==t.visible){t instanceof n.Light?w.lights.push(t):(t instanceof n.Mesh||t instanceof n.Line||t instanceof n.Sprite)&&(!1!==t.frustumCulled&&!0!==z.intersectsObject(t)||((e=W()).id=t.id,e.object=t,null!==t.renderDepth?e.z=t.renderDepth:(T.setFromMatrixPosition(t.matrixWorld),T.applyProjection(F),e.z=T.z),w.objects.push(e)));for(var r=0,i=t.children.length;r<i;r++)I(t.children[r])}},k=function(e,r){t=0,w.objects.length=0,w.lights.length=0,I(e),!0===r&&w.objects.sort(K)},j=function(){var e=[],t=null,r=new n.Matrix3,i,a=function(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(R),i.copy(r).applyMatrix4(F);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},h=function(e,t,r){(o=H()).position.set(e,t,r),a(o)},c=function(t,r,i){e.push(t,r,i)},u=function(e,t,r){return P[0]=e.positionScreen,P[1]=t.positionScreen,P[2]=r.positionScreen,!(!0!==e.visible&&!0!==t.visible&&!0!==r.visible&&!A.isIntersectionBox(E.setFromPoints(P)))&&(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},f=function(e,r){var i=s[e],n=s[r];(p=q()).id=t.id,p.v1.copy(i),p.v2.copy(n),p.z=(i.positionScreen.z+n.positionScreen.z)/2,p.material=t.material,w.elements.push(p)},d=function(i,n,o){var a=s[i],h=s[n],c=s[o];if(!0===u(a,h,c)){(l=X()).id=t.id,l.v1.copy(a),l.v2.copy(h),l.v3.copy(c),l.z=(a.positionScreen.z+h.positionScreen.z+c.positionScreen.z)/3;for(var f=0;f<3;f++){var p=3*arguments[f],d=l.vertexNormalsModel[f];d.set(e[p+0],e[p+1],e[p+2]),d.applyMatrix3(r).normalize()}l.vertexNormalsLength=3,l.material=t.material,w.elements.push(l)}};return{setObject:function(i){t=i,r.getNormalMatrix(t.matrixWorld),e.length=0},projectVertex:a,checkTriangleVisibility:u,pushVertex:h,pushNormal:c,pushLine:f,pushTriangle:d}},G=new j;function W(){if(t===i){var e=new n.RenderableObject;return r.push(e),i++,t++,e}return r[t++]}function H(){if(a===h){var e=new n.RenderableVertex;return s.push(e),h++,a++,e}return s[a++]}function X(){if(c===f){var e=new n.RenderableFace;return u.push(e),f++,c++,e}return u[c++]}function q(){if(d===v){var e=new n.RenderableLine;return m.push(e),v++,d++,e}return m[d++]}function Y(){if(y===b){var e=new n.RenderableSprite;return x.push(e),b++,y++,e}return x[y++]}function K(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function Q(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?r=Math.max(r,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<r)&&(e.lerp(t,r),t.lerp(e,1-i),!0))}this.projectScene=function(e,t,r,i){var o,h,u,f,m,v,x,b,T,A;c=0,d=0,y=0,w.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),D.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),F.multiplyMatrices(t.projectionMatrix,D),z.setFromMatrix(F),k(e,r);for(var E=0,P=w.objects.length;E<P;E++)if(h=(o=w.objects[E].object).geometry,G.setObject(o),R=o.matrixWorld,a=0,o instanceof n.Mesh){if(h instanceof n.BufferGeometry){var L=h.attributes,B=h.offsets;if(void 0===L.position)continue;for(var I,j=0,W=(I=L.position.array).length;j<W;j+=3)G.pushVertex(I[j],I[j+1],I[j+2]);for(var Z=L.normal.array,j=0,W=Z.length;j<W;j+=3)G.pushNormal(Z[j],Z[j+1],Z[j+2]);if(void 0!==L.index){var J=L.index.array;if(B.length>0)for(var E=0;E<B.length;E++)for(var $=B[E],ee=$.index,j=$.start,W=$.start+$.count;j<W;j+=3)G.pushTriangle(J[j]+ee,J[j+1]+ee,J[j+2]+ee);else for(var j=0,W=J.length;j<W;j+=3)G.pushTriangle(J[j],J[j+1],J[j+2])}else for(var j=0,W=I.length/3;j<W;j+=3)G.pushTriangle(j,j+1,j+2)}else if(h instanceof n.Geometry){u=h.vertices,f=h.faces,x=h.faceVertexUvs,U.getNormalMatrix(R),A=!0===(T=o.material instanceof n.MeshFaceMaterial)?o.material:null;for(var te=0,re=u.length;te<re;te++){var ie=u[te];G.pushVertex(ie.x,ie.y,ie.z)}for(var ne=0,oe=f.length;ne<oe;ne++){m=f[ne];var ae=!0===T?A.materials[m.materialIndex]:o.material;if(void 0!==ae){var se=ae.side,he=s[m.a],le=s[m.b],ce=s[m.c];if(!0===ae.morphTargets){var ue=h.morphTargets,fe=o.morphTargetInfluences,pe=he.position,de=le.position,me=ce.position;_.set(0,0,0),M.set(0,0,0),S.set(0,0,0);for(var ve=0,ge=ue.length;ve<ge;ve++){var ye=fe[ve];if(0!==ye){var xe=ue[ve].vertices;_.x+=(xe[m.a].x-pe.x)*ye,_.y+=(xe[m.a].y-pe.y)*ye,_.z+=(xe[m.a].z-pe.z)*ye,M.x+=(xe[m.b].x-de.x)*ye,M.y+=(xe[m.b].y-de.y)*ye,M.z+=(xe[m.b].z-de.z)*ye,S.x+=(xe[m.c].x-me.x)*ye,S.y+=(xe[m.c].y-me.y)*ye,S.z+=(xe[m.c].z-me.z)*ye}}he.position.add(_),le.position.add(M),ce.position.add(S),G.projectVertex(he),G.projectVertex(le),G.projectVertex(ce)}var be=G.checkTriangleVisibility(he,le,ce);if(!(!1===be&&se===n.FrontSide||!0===be&&se===n.BackSide)){(l=X()).id=o.id,l.v1.copy(he),l.v2.copy(le),l.v3.copy(ce),l.normalModel.copy(m.normal),!1!==be||se!==n.BackSide&&se!==n.DoubleSide||l.normalModel.negate(),l.normalModel.applyMatrix3(U).normalize(),l.centroidModel.copy(m.centroid).applyMatrix4(R),v=m.vertexNormals;for(var we=0,_e=Math.min(v.length,3);we<_e;we++){var Me=l.vertexNormalsModel[we];Me.copy(v[we]),!1!==be||se!==n.BackSide&&se!==n.DoubleSide||Me.negate(),Me.applyMatrix3(U).normalize()}l.vertexNormalsLength=v.length;for(var Se=0,Te=Math.min(x.length,3);Se<Te;Se++)if(void 0!==(b=x[Se][ne]))for(var Ce=0,Ae=b.length;Ce<Ae;Ce++)l.uvs[Se][Ce]=b[Ce];l.color=m.color,l.material=ae,l.z=(he.positionScreen.z+le.positionScreen.z+ce.positionScreen.z)/3,w.elements.push(l)}}}}}else if(o instanceof n.Line){var L;if(h instanceof n.BufferGeometry){if(void 0!==(L=h.attributes).position){for(var I,j=0,W=(I=L.position.array).length;j<W;j+=3)G.pushVertex(I[j],I[j+1],I[j+2]);if(void 0!==L.index)for(var J,j=0,W=(J=L.index.array).length;j<W;j+=2)G.pushLine(J[j],J[j+1]);else for(var j=0,W=I.length/3-1;j<W;j++)G.pushLine(j,j+1)}}else if(h instanceof n.Geometry){if(V.multiplyMatrices(F,R),0===(u=o.geometry.vertices).length)continue;(he=H()).positionScreen.copy(u[0]).applyMatrix4(V);for(var Ee=o.type===n.LinePieces?2:1,te=1,re=u.length;te<re;te++)(he=H()).positionScreen.copy(u[te]).applyMatrix4(V),(te+1)%Ee>0||(le=s[a-2],O.copy(he.positionScreen),N.copy(le.positionScreen),!0===Q(O,N)&&(O.multiplyScalar(1/O.w),N.multiplyScalar(1/N.w),(p=q()).id=o.id,p.v1.positionScreen.copy(O),p.v2.positionScreen.copy(N),p.z=Math.max(O.z,N.z),p.material=o.material,o.material.vertexColors===n.VertexColors&&(p.vertexColors[0].copy(o.geometry.colors[te]),p.vertexColors[1].copy(o.geometry.colors[te-1])),w.elements.push(p)))}}else if(o instanceof n.Sprite){C.set(R.elements[12],R.elements[13],R.elements[14],1),C.applyMatrix4(F);var Pe=1/C.w;C.z*=Pe,C.z>=-1&&C.z<=1&&((g=Y()).id=o.id,g.x=C.x*Pe,g.y=C.y*Pe,g.z=C.z,g.object=o,g.rotation=o.rotation,g.scale.x=o.scale.x*Math.abs(g.x-(C.x+t.projectionMatrix.elements[0])/(C.w+t.projectionMatrix.elements[12])),g.scale.y=o.scale.y*Math.abs(g.y-(C.y+t.projectionMatrix.elements[5])/(C.w+t.projectionMatrix.elements[13])),g.material=o.material,w.elements.push(g))}return!0===i&&w.elements.sort(K),w}},n.Face3=function(e,t,r,i,o,a){this.a=e,this.b=t,this.c=r,this.normal=i instanceof n.Vector3?i:new n.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=o instanceof n.Color?o:new n.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new n.Vector3},n.Face3.prototype={constructor:n.Face3,clone:function(){var e=new n.Face3(this.a,this.b,this.c),t,r;for(e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex,t=0,r=this.vertexNormals.length;t<r;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;t<r;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;t<r;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},n.Face4=function(e,t,r,i,o,a,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new n.Face3(e,t,r,o,a,s)},n.BufferGeometry=function(){this.id=n.GeometryIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.attributes={},this.offsets=[],this.boundingBox=null,this.boundingSphere=null},n.BufferGeometry.prototype={constructor:n.BufferGeometry,addAttribute:function(e,t,r,i){return this.attributes[e]={array:new t(r*i),itemSize:i},this.attributes[e]},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.multiplyVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal,i;void 0!==r&&((new n.Matrix3).getNormalMatrix(e).multiplyVector3Array(r.array),r.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;e.length>=3&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var r=3,i=e.length;r<i;r+=3){var o=e[r],a=e[r+1],s=e[r+2];o<t.min.x?t.min.x=o:o>t.max.x&&(t.max.x=o),a<t.min.y?t.min.y=a:a>t.max.y&&(t.max.y=a),s<t.min.z?t.min.z=s:s>t.max.z&&(t.max.z=s)}}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new n.Box3,t=new n.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var i=this.boundingSphere.center,o=0,a=r.length;o<a;o+=3)t.set(r[o],r[o+1],r[o+2]),e.addPoint(t);e.center(i);for(var s=0,o=0,a=r.length;o<a;o+=3)t.set(r[o],r[o+1],r[o+2]),s=Math.max(s,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,r,i,o=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(o)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var a=this.attributes.position.array,s=this.attributes.normal.array,h,l,c,u,f,p,d=new n.Vector3,m=new n.Vector3,v=new n.Vector3,g=new n.Vector3,y=new n.Vector3;if(this.attributes.index){var x=this.attributes.index.array,b=this.offsets;for(r=0,i=b.length;r<i;++r){var w=b[r].start,_=b[r].count,M=b[r].index;for(e=w,t=w+_;e<t;e+=3)h=M+x[e],l=M+x[e+1],c=M+x[e+2],u=a[3*h],f=a[3*h+1],p=a[3*h+2],d.set(u,f,p),u=a[3*l],f=a[3*l+1],p=a[3*l+2],m.set(u,f,p),u=a[3*c],f=a[3*c+1],p=a[3*c+2],v.set(u,f,p),g.subVectors(v,m),y.subVectors(d,m),g.cross(y),s[3*h]+=g.x,s[3*h+1]+=g.y,s[3*h+2]+=g.z,s[3*l]+=g.x,s[3*l+1]+=g.y,s[3*l+2]+=g.z,s[3*c]+=g.x,s[3*c+1]+=g.y,s[3*c+2]+=g.z}}else for(e=0,t=a.length;e<t;e+=9)u=a[e],f=a[e+1],p=a[e+2],d.set(u,f,p),u=a[e+3],f=a[e+4],p=a[e+5],m.set(u,f,p),u=a[e+6],f=a[e+7],p=a[e+8],v.set(u,f,p),g.subVectors(v,m),y.subVectors(d,m),g.cross(y),s[e]=g.x,s[e+1]=g.y,s[e+2]=g.z,s[e+3]=g.x,s[e+4]=g.y,s[e+5]=g.z,s[e+6]=g.x,s[e+7]=g.y,s[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,r,i,n,o=0,a=e.length;o<a;o+=3)t=e[o],r=e[o+1],i=e[o+2],n=1/Math.sqrt(t*t+r*r+i*i),e[o]*=n,e[o+1]*=n,e[o+2]*=n},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,r=this.attributes.normal.array,i=this.attributes.uv.array,o=t.length/3;if(void 0===this.attributes.tangent){var a=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(a)}}for(var s=this.attributes.tangent.array,h=[],l=[],c=0,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P,L,D,F,R,V,U,z;c<o;c++)h[c]=new n.Vector3,l[c]=new n.Vector3;var O=new n.Vector3,N=new n.Vector3,B,I,k,j,G,W,H,X=this.offsets;for(k=0,j=X.length;k<j;++k){var q=X[k].start,Y=X[k].count,K=X[k].index;for(B=q,I=q+Y;B<I;B+=3)ie(G=K+e[B],W=K+e[B+1],H=K+e[B+2])}var Q=new n.Vector3,Z=new n.Vector3,J=new n.Vector3,$=new n.Vector3,ee,te,re;for(k=0,j=X.length;k<j;++k){var q=X[k].start,Y=X[k].count,K=X[k].index;for(B=q,I=q+Y;B<I;B+=3)G=K+e[B],W=K+e[B+1],H=K+e[B+2],ne(G),ne(W),ne(H)}}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function ie(e,r,n){u=t[3*e],f=t[3*e+1],p=t[3*e+2],d=t[3*r],m=t[3*r+1],v=t[3*r+2],g=t[3*n],y=t[3*n+1],x=t[3*n+2],b=i[2*e],w=i[2*e+1],_=i[2*r],M=i[2*r+1],S=i[2*n],T=i[2*n+1],C=d-u,A=g-u,E=m-f,P=y-f,L=v-p,D=x-p,z=1/((F=_-b)*(U=T-w)-(R=S-b)*(V=M-w)),O.set((U*C-V*A)*z,(U*E-V*P)*z,(U*L-V*D)*z),N.set((F*A-R*C)*z,(F*P-R*E)*z,(F*D-R*L)*z),h[e].add(O),h[r].add(O),h[n].add(O),l[e].add(N),l[r].add(N),l[n].add(N)}function ne(e){J.x=r[3*e],J.y=r[3*e+1],J.z=r[3*e+2],$.copy(J),te=h[e],Q.copy(te),Q.sub(J.multiplyScalar(J.dot(te))).normalize(),Z.crossVectors($,te),re=Z.dot(l[e]),ee=re<0?-1:1,s[4*e]=Q.x,s[4*e+1]=Q.y,s[4*e+2]=Q.z,s[4*e+3]=ee}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535);for(var r=Date.now(),i=this.attributes.index.array,n=this.attributes.position.array,o=n.length/3,a=i.length/3,s=new Uint16Array(i.length),h=0,l=0,c=[{start:0,count:0,index:0}],u=c[0],f=0,p=0,d=new Int32Array(6),m=new Int32Array(n.length),v=new Int32Array(n.length),g=0;g<n.length;g++)m[g]=-1,v[g]=-1;for(var y=0;y<a;y++){p=0;for(var x=0;x<3;x++){var b;-1==m[b=i[3*y+x]]?(d[2*x]=b,d[2*x+1]=-1,p++):m[b]<u.index?(d[2*x]=b,d[2*x+1]=-1,f++):(d[2*x]=b,d[2*x+1]=m[b])}var w;if(l+p>u.index+t){var _={start:h,count:0,index:l};c.push(_),u=_;for(var M=0;M<6;M+=2){var S;(S=d[M+1])>-1&&S<u.index&&(d[M+1]=-1)}}for(var M=0;M<6;M+=2){var b=d[M],S;-1===(S=d[M+1])&&(S=l++),m[b]=S,v[S]=b,s[h++]=S-u.index,u.count++}}return this.reorderBuffers(s,v,l),this.offsets=c,c},reorderBuffers:function(e,t,r){var i={},n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var o in this.attributes)if("index"!=o)for(var a=this.attributes[o].array,s=0,h=n.length;s<h;s++){var l=n[s];if(a instanceof l){i[o]=new l(this.attributes[o].itemSize*r);break}}for(var c=0;c<r;c++){var u=t[c];for(var o in this.attributes)if("index"!=o)for(var f=this.attributes[o].array,p=this.attributes[o].itemSize,d=i[o],m=0;m<p;m++)d[c*p+m]=f[u*p+m]}for(var o in this.attributes.index.array=e,this.attributes)"index"!=o&&(this.attributes[o].array=i[o],this.attributes[o].numItems=this.attributes[o].itemSize*r)},clone:function(){var e=new n.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){for(var i=this.attributes[r],o=i.array,a={itemSize:i.itemSize,array:null},s=0,h=t.length;s<h;s++){var l=t[s];if(o instanceof l){a.array=new l(o);break}}e.attributes[r]=a}for(var s=0,h=this.offsets.length;s<h;s++){var c=this.offsets[s];e.offsets.push({start:c.start,index:c.index,count:c.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype),n.Geometry=function(){this.id=n.GeometryIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(e){for(var t=(new n.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){var o;this.vertices[r].applyMatrix4(e)}for(var r=0,i=this.faces.length;r<i;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var s=0,h=a.vertexNormals.length;s<h;s++)a.vertexNormals[s].applyMatrix3(t).normalize();a.centroid.applyMatrix4(e)}this.boundingBox instanceof n.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof n.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;e<t;e++)(r=this.faces[e]).centroid.set(0,0,0),r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new n.Vector3,t=new n.Vector3,r=0,i=this.faces.length;r<i;r++){var o=this.faces[r],a=this.vertices[o.a],s=this.vertices[o.b],h=this.vertices[o.c];e.subVectors(h,s),t.subVectors(a,s),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,o,a,s;for(s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new n.Vector3;if(e){var h,l,c,u,f=new n.Vector3,p=new n.Vector3,d=new n.Vector3,m=new n.Vector3,v=new n.Vector3;for(i=0,o=this.faces.length;i<o;i++)a=this.faces[i],h=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],f.subVectors(c,l),p.subVectors(h,l),f.cross(p),s[a.a].add(f),s[a.b].add(f),s[a.c].add(f)}else for(i=0,o=this.faces.length;i<o;i++)s[(a=this.faces[i]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(i=0,o=this.faces.length;i<o;i++)(a=this.faces[i]).vertexNormals[0]=s[a.a].clone(),a.vertexNormals[1]=s[a.b].clone(),a.vertexNormals[2]=s[a.c].clone()},computeMorphNormals:function(){var e,t,r,i,o;for(r=0,i=this.faces.length;r<i;r++)for((o=this.faces[r]).__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new n.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,h=this.morphNormals[e].vertexNormals,l,c;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],l=new n.Vector3,c={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3},s.push(l),h.push(c)}var u=this.morphNormals[e],l,c;for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)o=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(o.normal),c.a.copy(o.vertexNormals[0]),c.b.copy(o.vertexNormals[1]),c.c.copy(o.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(o=this.faces[r]).normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){var e,t,r,i,o,a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P=[],L=[],D=new n.Vector3,F=new n.Vector3,R=new n.Vector3,V=new n.Vector3,U=new n.Vector3,z;for(r=0,i=this.vertices.length;r<i;r++)P[r]=new n.Vector3,L[r]=new n.Vector3;function O(e,t,r,i,n,o,a){c=e.vertices[t],u=e.vertices[r],f=e.vertices[i],p=l[n],d=l[o],m=l[a],v=u.x-c.x,g=f.x-c.x,y=u.y-c.y,x=f.y-c.y,b=u.z-c.z,w=f.z-c.z,_=d.x-p.x,M=m.x-p.x,S=d.y-p.y,T=m.y-p.y,C=1/(_*T-M*S),D.set((T*v-S*g)*C,(T*y-S*x)*C,(T*b-S*w)*C),F.set((_*g-M*v)*C,(_*x-M*y)*C,(_*w-M*b)*C),P[t].add(D),P[r].add(D),P[i].add(D),L[t].add(F),L[r].add(F),L[i].add(F)}for(e=0,t=this.faces.length;e<t;e++)h=this.faces[e],l=this.faceVertexUvs[0][e],O(this,h.a,h.b,h.c,0,1,2);var N=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(h=this.faces[e],o=0;o<Math.min(h.vertexNormals.length,3);o++)U.copy(h.vertexNormals[o]),s=h[N[o]],A=P[s],R.copy(A),R.sub(U.multiplyScalar(U.dot(A))).normalize(),V.crossVectors(h.vertexNormals[o],A),z=(E=V.dot(L[s]))<0?-1:1,h.vertexTangents[o]=new n.Vector4(R.x,R.y,R.z,z);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;r<i;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e={},t=[],r=[],i,n,o=4,a=Math.pow(10,4),s,h,l,c,u,f,p,d;for(s=0,h=this.vertices.length;s<h;s++)i=this.vertices[s],void 0===e[n=Math.round(i.x*a)+"_"+Math.round(i.y*a)+"_"+Math.round(i.z*a)]?(e[n]=s,t.push(this.vertices[s]),r[s]=t.length-1):r[s]=r[e[n]];var m=[];for(s=0,h=this.faces.length;s<h;s++){(l=this.faces[s]).a=r[l.a],l.b=r[l.b],l.c=r[l.c],c=[l.a,l.b,l.c];for(var v=-1,g=0;g<3;g++)if(c[g]==c[(g+1)%3]){v=g,m.push(s);break}}for(s=m.length-1;s>=0;s--){var y=m[s];for(this.faces.splice(y,1),f=0,p=this.faceVertexUvs.length;f<p;f++)this.faceVertexUvs[f].splice(y,1)}var x=this.vertices.length-t.length;return this.vertices=t,x},makeGroups:(N=0,function(e){var t,r,i,n,o,a={},s=this.morphTargets.length,h=this.morphNormals.length;for(this.geometryGroups={},t=0,r=this.faces.length;t<r;t++)i=this.faces[t],(n=e?i.materialIndex:0)in a||(a[n]={hash:n,counter:0}),(o=a[n].hash+"_"+a[n].counter)in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:n,vertices:0,numMorphTargets:s,numMorphNormals:h}),this.geometryGroups[o].vertices+3>65535&&(a[n].counter+=1,(o=a[n].hash+"_"+a[n].counter)in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:n,vertices:0,numMorphTargets:s,numMorphNormals:h})),this.geometryGroups[o].faces3.push(t),this.geometryGroups[o].vertices+=3;for(var l in this.geometryGroupsList=[],this.geometryGroups)this.geometryGroups[l].id=N++,this.geometryGroupsList.push(this.geometryGroups[l])}),clone:function(){for(var e=new n.Geometry,t=this.vertices,r=0,i=t.length;r<i;r++)e.vertices.push(t[r].clone());for(var o=this.faces,r=0,i=o.length;r<i;r++)e.faces.push(o[r].clone());for(var a=this.faceVertexUvs[0],r=0,i=a.length;r<i;r++){for(var s=a[r],h=[],l=0,c=s.length;l<c;l++)h.push(new n.Vector2(s[l].x,s[l].y));e.faceVertexUvs[0].push(h)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Geometry.prototype),n.GeometryIdCount=0,n.Geometry2=function(e){n.BufferGeometry.call(this),this.vertices=this.addAttribute("position",Float32Array,e,3).array,this.normals=this.addAttribute("normal",Float32Array,e,3).array,this.uvs=this.addAttribute("uv",Float32Array,e,2).array,this.boundingBox=null,this.boundingSphere=null},n.Geometry2.prototype=Object.create(n.BufferGeometry.prototype),n.Camera=function(){n.Object3D.call(this),this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4},n.Camera.prototype=Object.create(n.Object3D.prototype),n.Camera.prototype.lookAt=function(){var e=new n.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),n.Camera.prototype.clone=function(e){return void 0===e&&(e=new n.Camera),n.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},n.OrthographicCamera=function(e,t,r,i,o,a){n.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=Object.create(n.Camera.prototype),n.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},n.OrthographicCamera.prototype.clone=function(){var e=new n.OrthographicCamera;return n.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},n.PerspectiveCamera=function(e,t,r,i){n.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=Object.create(n.Camera.prototype),n.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*n.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(n.Math.degToRad(.5*this.fov))*this.near,r=-t,i=e*r,o=e*t,a=Math.abs(o-i),s=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*a/this.fullWidth,i+(this.x+this.width)*a/this.fullWidth,t-(this.y+this.height)*s/this.fullHeight,t-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},n.PerspectiveCamera.prototype.clone=function(){var e=new n.PerspectiveCamera;return n.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},n.Light=function(e){n.Object3D.call(this),this.color=new n.Color(e)},n.Light.prototype=Object.create(n.Object3D.prototype),n.Light.prototype.clone=function(e){return void 0===e&&(e=new n.Light),n.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},n.AmbientLight=function(e){n.Light.call(this,e)},n.AmbientLight.prototype=Object.create(n.Light.prototype),n.AmbientLight.prototype.clone=function(){var e=new n.AmbientLight;return n.Light.prototype.clone.call(this,e),e},n.AreaLight=function(e,t){n.Light.call(this,e),this.normal=new n.Vector3(0,-1,0),this.right=new n.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},n.AreaLight.prototype=Object.create(n.Light.prototype),n.DirectionalLight=function(e,t){n.Light.call(this,e),this.position.set(0,1,0),this.target=new n.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new n.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.DirectionalLight.prototype=Object.create(n.Light.prototype),n.DirectionalLight.prototype.clone=function(){var e=new n.DirectionalLight;return n.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},n.HemisphereLight=function(e,t,r){n.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new n.Color(t),this.intensity=void 0!==r?r:1},n.HemisphereLight.prototype=Object.create(n.Light.prototype),n.HemisphereLight.prototype.clone=function(){var e=new n.HemisphereLight;return n.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},n.PointLight=function(e,t,r){n.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},n.PointLight.prototype=Object.create(n.Light.prototype),n.PointLight.prototype.clone=function(){var e=new n.PointLight;return n.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},n.SpotLight=function(e,t,r,i,o){n.Light.call(this,e),this.position.set(0,1,0),this.target=new n.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==o?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.SpotLight.prototype=Object.create(n.Light.prototype),n.SpotLight.prototype.clone=function(){var e=new n.SpotLight;return n.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},n.Loader=function(e){this.showStatus=e,this.statusDomElement=e?n.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},n.Loader.prototype={constructor:n.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=n.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++){var i;if(e[t]instanceof n.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var r=this;function i(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function o(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function a(e,t){var n=new Image;n.onload=function(){if(i(this.width)&&i(this.height))e.image=this;else{var t=o(this.width),r=o(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},void 0!==r.crossOrigin&&(n.crossOrigin=r.crossOrigin),n.src=t}function s(e,r,i,o,s,h,l){var c=/\.dds$/i.test(i),u=t+i;if(c){var f=n.ImageUtils.loadCompressedTexture(u);e[r]=f}else{var f=document.createElement("canvas");e[r]=new n.Texture(f)}if(e[r].sourceFile=i,o&&(e[r].repeat.set(o[0],o[1]),1!==o[0]&&(e[r].wrapS=n.RepeatWrapping),1!==o[1]&&(e[r].wrapT=n.RepeatWrapping)),s&&e[r].offset.set(s[0],s[1]),h){var p={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};void 0!==p[h[0]]&&(e[r].wrapS=p[h[0]]),void 0!==p[h[1]]&&(e[r].wrapT=p[h[1]])}l&&(e[r].anisotropy=l),c||a(e[r],u)}function h(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var l="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var u=e.shading.toLowerCase();"phong"===u?l="MeshPhongMaterial":"basic"===u&&(l="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==n[e.blending]&&(c.blending=n[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(c.transparent=e.transparent),void 0!==e.depthTest&&(c.depthTest=e.depthTest),void 0!==e.depthWrite&&(c.depthWrite=e.depthWrite),void 0!==e.visible&&(c.visible=e.visible),void 0!==e.flipSided&&(c.side=n.BackSide),void 0!==e.doubleSided&&(c.side=n.DoubleSide),void 0!==e.wireframe&&(c.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?c.vertexColors=n.FaceColors:e.vertexColors&&(c.vertexColors=n.VertexColors)),e.colorDiffuse?c.color=h(e.colorDiffuse):e.DbgColor&&(c.color=e.DbgColor),e.colorSpecular&&(c.specular=h(e.colorSpecular)),e.colorAmbient&&(c.ambient=h(e.colorAmbient)),e.transparency&&(c.opacity=e.transparency),e.specularCoef&&(c.shininess=e.specularCoef),e.mapDiffuse&&t&&s(c,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&s(c,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&s(c,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&s(c,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&s(c,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(c.bumpScale=e.mapBumpScale),e.mapNormal){var f=n.ShaderLib.normalmap,p=n.UniformsUtils.clone(f.uniforms);p.tNormal.value=c.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),c.map&&(p.tDiffuse.value=c.map,p.enableDiffuse.value=!0),c.specularMap&&(p.tSpecular.value=c.specularMap,p.enableSpecular.value=!0),c.lightMap&&(p.tAO.value=c.lightMap,p.enableAO.value=!0),p.diffuse.value.setHex(c.color),p.specular.value.setHex(c.specular),p.ambient.value.setHex(c.ambient),p.shininess.value=c.shininess,void 0!==c.opacity&&(p.opacity.value=c.opacity);var d={fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:p,lights:!0,fog:!0},m=new n.ShaderMaterial(d);c.transparent&&(m.transparent=!0)}else var m=new n[l](c);return void 0!==e.DbgName&&(m.name=e.DbgName),m}},n.XHRLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(e,t,r,i){var n=this,o=new XMLHttpRequest;void 0!==t&&o.addEventListener("load",function(r){t(r.target.responseText),n.manager.itemEnd(e)},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&o.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),n.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},n.ImageLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(e,t,r,i){var n=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(r){n.manager.itemEnd(e),t(this)},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&o.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=e,n.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},n.JSONLoader=function(e){n.Loader.call(this,e),this.withCredentials=!1},n.JSONLoader.prototype=Object.create(n.Loader.prototype),n.JSONLoader.prototype.load=function(e,t,r){var i=this;r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},n.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,n){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);if("scene"===s.metadata.type)return void console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var h=e.parse(s,i);r(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+o.status+")");else o.readyState===o.LOADING?n&&(0===a&&(a=o.getResponseHeader("Content-Length")),n({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==n&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},n.JSONLoader.prototype.parse=function(e,t){var r=this,i=new n.Geometry,o=void 0!==e.scale?1/e.scale:1;function a(t){function r(e,t){return e&1<<t}var o,a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P,L,D,F,R=e.faces,V=e.vertices,U=e.normals,z=e.colors,O=0;if(void 0!==e.uvs){for(o=0;o<e.uvs.length;o++)e.uvs[o].length&&O++;for(o=0;o<O;o++)i.faceVertexUvs[o]=[]}for(h=0,l=V.length;h<l;)(_=new n.Vector3).x=V[h++]*t,_.y=V[h++]*t,_.z=V[h++]*t,i.vertices.push(_);for(h=0,l=R.length;h<l;)if(m=r(d=R[h++],0),v=r(d,1),g=r(d,3),y=r(d,4),x=r(d,5),b=r(d,6),w=r(d,7),m){if((S=new n.Face3).a=R[h],S.b=R[h+1],S.c=R[h+3],(T=new n.Face3).a=R[h+1],T.b=R[h+2],T.c=R[h+3],h+=4,v&&(p=R[h++],S.materialIndex=p,T.materialIndex=p),s=i.faces.length,g)for(o=0;o<O;o++)for(P=e.uvs[o],i.faceVertexUvs[o][s]=[],i.faceVertexUvs[o][s+1]=[],a=0;a<4;a++)D=P[2*(f=R[h++])],F=P[2*f+1],L=new n.Vector2(D,F),2!==a&&i.faceVertexUvs[o][s].push(L),0!==a&&i.faceVertexUvs[o][s+1].push(L);if(y&&(u=3*R[h++],S.normal.set(U[u++],U[u++],U[u]),T.normal.copy(S.normal)),x)for(o=0;o<4;o++)u=3*R[h++],E=new n.Vector3(U[u++],U[u++],U[u]),2!==o&&S.vertexNormals.push(E),0!==o&&T.vertexNormals.push(E);if(b&&(A=z[c=R[h++]],S.color.setHex(A),T.color.setHex(A)),w)for(o=0;o<4;o++)A=z[c=R[h++]],2!==o&&S.vertexColors.push(new n.Color(A)),0!==o&&T.vertexColors.push(new n.Color(A));i.faces.push(S),i.faces.push(T)}else{if((M=new n.Face3).a=R[h++],M.b=R[h++],M.c=R[h++],v&&(p=R[h++],M.materialIndex=p),s=i.faces.length,g)for(o=0;o<O;o++)for(P=e.uvs[o],i.faceVertexUvs[o][s]=[],a=0;a<3;a++)D=P[2*(f=R[h++])],F=P[2*f+1],L=new n.Vector2(D,F),i.faceVertexUvs[o][s].push(L);if(y&&(u=3*R[h++],M.normal.set(U[u++],U[u++],U[u])),x)for(o=0;o<3;o++)u=3*R[h++],E=new n.Vector3(U[u++],U[u++],U[u]),M.vertexNormals.push(E);if(b&&(c=R[h++],M.color.setHex(z[c])),w)for(o=0;o<3;o++)c=R[h++],M.vertexColors.push(new n.Color(z[c]));i.faces.push(M)}}function s(){if(e.skinWeights)for(var t=0,r=e.skinWeights.length;t<r;t+=2){var o=e.skinWeights[t],a=e.skinWeights[t+1],s=0,h=0;i.skinWeights.push(new n.Vector4(o,a,0,0))}if(e.skinIndices)for(var t=0,r=e.skinIndices.length;t<r;t+=2){var l=e.skinIndices[t],c=e.skinIndices[t+1],u=0,f=0;i.skinIndices.push(new n.Vector4(l,c,0,0))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&console.warn("When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match."),i.animation=e.animation,i.animations=e.animations}function h(t){var r,o,a,s,h,l,r,o,c,u,f,p,d;if(void 0!==e.morphTargets)for(r=0,o=e.morphTargets.length;r<o;r++)for(i.morphTargets[r]={},i.morphTargets[r].name=e.morphTargets[r].name,i.morphTargets[r].vertices=[],h=i.morphTargets[r].vertices,a=0,s=(l=e.morphTargets[r].vertices).length;a<s;a+=3){var m=new n.Vector3;m.x=l[a]*t,m.y=l[a+1]*t,m.z=l[a+2]*t,h.push(m)}if(void 0!==e.morphColors)for(r=0,o=e.morphColors.length;r<o;r++)for(i.morphColors[r]={},i.morphColors[r].name=e.morphColors[r].name,i.morphColors[r].colors=[],f=i.morphColors[r].colors,c=0,u=(p=e.morphColors[r].colors).length;c<u;c+=3)(d=new n.Color(16755200)).setRGB(p[c],p[c+1],p[c+2]),f.push(d)}if(a(o),s(),h(o),i.computeCentroids(),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials)return{geometry:i};var l=this.initMaterials(e.materials,t);return this.needsTangents(l)&&i.computeTangents(),{geometry:i,materials:l}},n.LoadingManager=function(e,t,r){var i=this,n=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,void 0!==i.onProgress&&i.onProgress(e,n,o),n===o&&void 0!==i.onLoad&&i.onLoad()}},n.DefaultLoadingManager=new n.LoadingManager,n.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n.BufferGeometry,r=e.attributes,o=e.offsets,a=e.boundingSphere;for(var s in r){var h=r[s];t.attributes[s]={itemSize:h.itemSize,array:new i[h.type](h.array)}}return void 0!==o&&(t.offsets=JSON.parse(JSON.stringify(o))),void 0!==a&&(t.boundingSphere=new n.Sphere((new n.Vector3).fromArray(void 0!==a.center?a.center:[0,0,0]),a.radius)),t}},n.Geometry2Loader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.Geometry2Loader.prototype={constructor:n.Geometry2Loader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n.Geometry2(e.vertices.length/3),r=["vertices","normals","uvs"],i=e.boundingSphere;for(var o in r){var a=r[o];t[a].set(e[a])}return void 0!==i&&(t.boundingSphere=new n.Sphere((new n.Vector3).fromArray(void 0!==i.center?i.center:[0,0,0]),i.radius)),t}},n.MaterialLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var r=0,i=e.materials.length;r<i;r++)t.materials.push(this.parse(e.materials[r]));return t}},n.ObjectLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials),i;return this.parseObject(e.object,t,r)},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new n.JSONLoader,i=new n.Geometry2Loader,o=new n.BufferGeometryLoader,a=0,s=e.length;a<s;a++){var h,l=e[a];switch(l.type){case"PlaneGeometry":h=new n.PlaneGeometry(l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"CubeGeometry":h=new n.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":h=new n.CircleGeometry(l.radius,l.segments);break;case"CylinderGeometry":h=new n.CylinderGeometry(l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded);break;case"SphereGeometry":h=new n.SphereGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"IcosahedronGeometry":h=new n.IcosahedronGeometry(l.radius,l.detail);break;case"TorusGeometry":h=new n.TorusGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":h=new n.TorusKnotGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.p,l.q,l.heightScale);break;case"BufferGeometry":h=o.parse(l.data);break;case"Geometry2":h=i.parse(l.data);break;case"Geometry":h=r.parse(l.data).geometry;break}h.uuid=l.uuid,void 0!==l.name&&(h.name=l.name),t[l.uuid]=h}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new n.MaterialLoader,i=0,o=e.length;i<o;i++){var a=e[i],s=r.parse(a);s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseObject:function(){var e=new n.Matrix4;return function(t,r,i){var o;switch(t.type){case"Scene":o=new n.Scene;break;case"PerspectiveCamera":o=new n.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new n.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new n.AmbientLight(t.color);break;case"DirectionalLight":o=new n.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new n.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":o=new n.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":o=new n.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var a=r[t.geometry],s=i[t.material];void 0===a&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),o=new n.Mesh(a,s);break;case"Sprite":var s;void 0===(s=i[t.material])&&console.error("THREE.ObjectLoader: Undefined material "+t.material),o=new n.Sprite(s);break;default:o=new n.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var h in t.children)o.add(this.parseObject(t.children[h],r,i));return o}}()},n.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",n.JSONLoader)},n.SceneLoader.prototype={constructor:n.SceneLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(r){o.parse(JSON.parse(r),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,r){var i=this,o=n.Loader.prototype.extractUrlBase(r),a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w=[],_=e;for(var M in this.geometryHandlers){var S=this.geometryHandlers[M].loaderClass;this.geometryHandlers[M].loaderObject=new S}for(var M in this.hierarchyHandlers){var S=this.hierarchyHandlers[M].loaderClass;this.hierarchyHandlers[M].loaderObject=new S}if(v=0,g=0,b={scene:new n.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},_.transform){var T=_.transform.position,C=_.transform.rotation,A=_.transform.scale;T&&b.scene.position.fromArray(T),C&&b.scene.rotation.fromArray(C),A&&b.scene.scale.fromArray(A),(T||C||A)&&(b.scene.updateMatrix(),b.scene.updateMatrixWorld())}function E(e,t){return"relativeToHTML"==t?e:o+e}function P(){L(b.scene,_.objects)}function L(e,t){var r,o,l,c,u,f;for(var d in t){var m=b.objects[d],v=t[d];if(void 0===m){if(v.type&&v.type in i.hierarchyHandlers){if(void 0===v.loading){var g={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},y={};for(var x in v)x in g||(y[x]=v[x]);s=b.materials[v.material],v.loading=!0;var w=i.hierarchyHandlers[v.type].loaderObject;w.options?w.load(E(v.url,_.urlBaseType),V(d,e,s,v)):w.load(E(v.url,_.urlBaseType),V(d,e,s,v),y)}}else if(void 0!==v.geometry){if(a=b.geometries[v.geometry]){var M=!1;if(M=(s=b.materials[v.material])instanceof n.ShaderMaterial,l=v.position,c=v.rotation,u=v.scale,r=v.matrix,f=v.quaternion,v.material||(s=new n.MeshFaceMaterial(b.face_materials[v.geometry])),s instanceof n.MeshFaceMaterial&&0===s.materials.length&&(s=new n.MeshFaceMaterial(b.face_materials[v.geometry])),s instanceof n.MeshFaceMaterial)for(var S=0;S<s.materials.length;S++)M=M||s.materials[S]instanceof n.ShaderMaterial;M&&a.computeTangents(),v.skin?m=new n.SkinnedMesh(a,s):v.morph?(m=new n.MorphAnimMesh(a,s),void 0!==v.duration&&(m.duration=v.duration),void 0!==v.time&&(m.time=v.time),void 0!==v.mirroredLoop&&(m.mirroredLoop=v.mirroredLoop),s.morphNormals&&a.computeMorphNormals()):m=new n.Mesh(a,s),m.name=d,r?(m.matrixAutoUpdate=!1,m.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(m.position.fromArray(l),f?m.quaternion.fromArray(f):m.rotation.fromArray(c),m.scale.fromArray(u)),m.visible=v.visible,m.castShadow=v.castShadow,m.receiveShadow=v.receiveShadow,e.add(m),b.objects[d]=m}}else if("AmbientLight"===v.type||"PointLight"===v.type||"DirectionalLight"===v.type||"SpotLight"===v.type||"HemisphereLight"===v.type||"AreaLight"===v.type){var T=v.color,C=v.intensity,A=v.distance,P=v.position,D=v.rotation;switch(v.type){case"AmbientLight":p=new n.AmbientLight(T);break;case"PointLight":(p=new n.PointLight(T,C,A)).position.fromArray(P);break;case"DirectionalLight":(p=new n.DirectionalLight(T,C)).position.fromArray(v.direction);break;case"SpotLight":(p=new n.SpotLight(T,C,A,1)).angle=v.angle,p.position.fromArray(P),p.target.set(P[0],P[1]-A,P[2]),p.target.applyEuler(new n.Euler(D[0],D[1],D[2],"XYZ"));break;case"HemisphereLight":(p=new n.DirectionalLight(T,C,A)).target.set(P[0],P[1]-A,P[2]),p.target.applyEuler(new n.Euler(D[0],D[1],D[2],"XYZ"));break;case"AreaLight":(p=new n.AreaLight(T,C)).position.fromArray(P),p.width=v.size,p.height=v.size_y;break}e.add(p),p.name=d,b.lights[d]=p,b.objects[d]=p}else"PerspectiveCamera"===v.type||"OrthographicCamera"===v.type?(l=v.position,c=v.rotation,f=v.quaternion,"PerspectiveCamera"===v.type?h=new n.PerspectiveCamera(v.fov,v.aspect,v.near,v.far):"OrthographicCamera"===v.type&&(h=new n.OrthographicCamera(v.left,v.right,v.top,v.bottom,v.near,v.far)),h.name=d,h.position.fromArray(l),void 0!==f?h.quaternion.fromArray(f):void 0!==c&&h.rotation.fromArray(c),e.add(h),b.cameras[d]=h,b.objects[d]=h):(l=v.position,c=v.rotation,u=v.scale,f=v.quaternion,(m=new n.Object3D).name=d,m.position.fromArray(l),f?m.quaternion.fromArray(f):m.rotation.fromArray(c),m.scale.fromArray(u),m.visible=void 0!==v.visible&&v.visible,e.add(m),b.objects[d]=m,b.empties[d]=m);if(m){if(void 0!==v.userData)for(var F in v.userData){var R=v.userData[F];m.userData[F]=R}if(void 0!==v.groups)for(var S=0;S<v.groups.length;S++){var U=v.groups[S];void 0===b.groups[U]&&(b.groups[U]=[]),b.groups[U].push(d)}}}void 0!==m&&void 0!==v.children&&L(m,v.children)}}function D(e,t,r){b.geometries[r]=e,b.face_materials[r]=t,P()}function F(e,t,r,i,n){var o=n.position,a=n.rotation,s=n.quaternion,h=n.scale;e.position.fromArray(o),s?e.quaternion.fromArray(s):e.rotation.fromArray(a),e.scale.fromArray(h),i&&e.traverse(function(e){e.material=i});var l=void 0===n.visible||n.visible;e.traverse(function(e){e.visible=l}),r.add(e),e.name=t,b.objects[t]=e,P()}function R(e){return function(t,r){t.name=e,D(t,r,e),v-=1,i.onLoadComplete(),z()}}function V(e,t,r,n){return function(o){var a;F(a=o.content?o.content:o.dae?o.scene:o,e,t,r,n),v-=1,i.onLoadComplete(),z()}}function U(e){return function(t,r){t.name=e,b.geometries[e]=t,b.face_materials[e]=r}}function z(){var e={totalModels:y,totalTextures:x,loadedModels:y-v,loadedTextures:x-g};i.callbackProgress(e,b),i.onLoadProgress(),0===v&&0===g&&(O(),t(b))}function O(){for(var e=0;e<w.length;e++){var t=w[e],r=b.objects[t.targetName];r?t.object.target=r:(t.object.target=new n.Object3D,b.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}var N=function(e){g-=e,z(),i.onLoadComplete()},B=function(e){return function(){N(e)}},I,k,j,G,W,H,X,q,Y;function K(e,t){if(t(e),void 0!==e.children)for(var r in e.children)K(e.children[r],t)}for(I in _.fogs)"linear"===(k=_.fogs[I]).type?l=new n.Fog(0,k.near,k.far):"exp2"===k.type&&(l=new n.FogExp2(0,k.density)),f=k.color,l.color.setRGB(f[0],f[1],f[2]),b.fogs[I]=l;for(j in _.geometries)(G=_.geometries[j]).type in this.geometryHandlers&&(v+=1,i.onLoadStart());for(var Q in _.objects)K(_.objects[Q],function(e){e.type&&e.type in i.hierarchyHandlers&&(v+=1,i.onLoadStart())});for(j in y=v,_.geometries)if("cube"===(G=_.geometries[j]).type)(a=new n.BoxGeometry(G.width,G.height,G.depth,G.widthSegments,G.heightSegments,G.depthSegments)).name=j,b.geometries[j]=a;else if("plane"===G.type)(a=new n.PlaneGeometry(G.width,G.height,G.widthSegments,G.heightSegments)).name=j,b.geometries[j]=a;else if("sphere"===G.type)(a=new n.SphereGeometry(G.radius,G.widthSegments,G.heightSegments)).name=j,b.geometries[j]=a;else if("cylinder"===G.type)(a=new n.CylinderGeometry(G.topRad,G.botRad,G.height,G.radSegs,G.heightSegs)).name=j,b.geometries[j]=a;else if("torus"===G.type)(a=new n.TorusGeometry(G.radius,G.tube,G.segmentsR,G.segmentsT)).name=j,b.geometries[j]=a;else if("icosahedron"===G.type)(a=new n.IcosahedronGeometry(G.radius,G.subdivisions)).name=j,b.geometries[j]=a;else if(G.type in this.geometryHandlers){var Z={},J;for(var $ in G)"type"!==$&&"url"!==$&&(Z[$]=G[$]);this.geometryHandlers[G.type].loaderObject.load(E(G.url,_.urlBaseType),R(j),Z)}else if("embedded"===G.type){var ee=_.embeds[G.id],te="";if(ee.metadata=_.metadata,ee){var re,ie=this.geometryHandlers.ascii.loaderObject.parse(ee,te);U(j)(ie.geometry,ie.materials)}}for(W in _.textures)if((H=_.textures[W]).url instanceof Array){g+=H.url.length;for(var ne=0;ne<H.url.length;ne++)i.onLoadStart()}else g+=1,i.onLoadStart();for(W in x=g,_.textures){if(void 0!==(H=_.textures[W]).mapping&&void 0!==n[H.mapping]&&(H.mapping=new n[H.mapping]),H.url instanceof Array){for(var oe=H.url.length,ae=[],se=0;se<oe;se++)ae[se]=E(H.url[se],_.urlBaseType);var he;c=(he=/\.dds$/i.test(ae[0]))?n.ImageUtils.loadCompressedTextureCube(ae,H.mapping,B(oe)):n.ImageUtils.loadTextureCube(ae,H.mapping,B(oe))}else{var he=/\.dds$/i.test(H.url),le=E(H.url,_.urlBaseType),ce=B(1);if(c=he?n.ImageUtils.loadCompressedTexture(le,H.mapping,ce):n.ImageUtils.loadTexture(le,H.mapping,ce),void 0!==n[H.minFilter]&&(c.minFilter=n[H.minFilter]),void 0!==n[H.magFilter]&&(c.magFilter=n[H.magFilter]),H.anisotropy&&(c.anisotropy=H.anisotropy),H.repeat&&(c.repeat.set(H.repeat[0],H.repeat[1]),1!==H.repeat[0]&&(c.wrapS=n.RepeatWrapping),1!==H.repeat[1]&&(c.wrapT=n.RepeatWrapping)),H.offset&&c.offset.set(H.offset[0],H.offset[1]),H.wrap){var ue={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};void 0!==ue[H.wrap[0]]&&(c.wrapS=ue[H.wrap[0]]),void 0!==ue[H.wrap[1]]&&(c.wrapT=ue[H.wrap[1]])}}b.textures[W]=c}for(X in _.materials){for(Y in(q=_.materials[X]).parameters)if("envMap"===Y||"map"===Y||"lightMap"===Y||"bumpMap"===Y)q.parameters[Y]=b.textures[q.parameters[Y]];else if("shading"===Y)q.parameters[Y]="flat"===q.parameters[Y]?n.FlatShading:n.SmoothShading;else if("side"===Y)"double"==q.parameters[Y]?q.parameters[Y]=n.DoubleSide:"back"==q.parameters[Y]?q.parameters[Y]=n.BackSide:q.parameters[Y]=n.FrontSide;else if("blending"===Y)q.parameters[Y]=q.parameters[Y]in n?n[q.parameters[Y]]:n.NormalBlending;else if("combine"===Y)q.parameters[Y]=q.parameters[Y]in n?n[q.parameters[Y]]:n.MultiplyOperation;else if("vertexColors"===Y)"face"==q.parameters[Y]?q.parameters[Y]=n.FaceColors:q.parameters[Y]&&(q.parameters[Y]=n.VertexColors);else if("wrapRGB"===Y){var fe=q.parameters[Y];q.parameters[Y]=new n.Vector3(fe[0],fe[1],fe[2])}if(void 0!==q.parameters.opacity&&q.parameters.opacity<1&&(q.parameters.transparent=!0),q.parameters.normalMap){var pe=n.ShaderLib.normalmap,de=n.UniformsUtils.clone(pe.uniforms),me=q.parameters.color,ve=q.parameters.specular,ge=q.parameters.ambient,ye=q.parameters.shininess;de.tNormal.value=b.textures[q.parameters.normalMap],q.parameters.normalScale&&de.uNormalScale.value.set(q.parameters.normalScale[0],q.parameters.normalScale[1]),q.parameters.map&&(de.tDiffuse.value=q.parameters.map,de.enableDiffuse.value=!0),q.parameters.envMap&&(de.tCube.value=q.parameters.envMap,de.enableReflection.value=!0,de.reflectivity.value=q.parameters.reflectivity),q.parameters.lightMap&&(de.tAO.value=q.parameters.lightMap,de.enableAO.value=!0),q.parameters.specularMap&&(de.tSpecular.value=b.textures[q.parameters.specularMap],de.enableSpecular.value=!0),q.parameters.displacementMap&&(de.tDisplacement.value=b.textures[q.parameters.displacementMap],de.enableDisplacement.value=!0,de.uDisplacementBias.value=q.parameters.displacementBias,de.uDisplacementScale.value=q.parameters.displacementScale),de.diffuse.value.setHex(me),de.specular.value.setHex(ve),de.ambient.value.setHex(ge),de.shininess.value=ye,q.parameters.opacity&&(de.opacity.value=q.parameters.opacity);var xe={fragmentShader:pe.fragmentShader,vertexShader:pe.vertexShader,uniforms:de,lights:!0,fog:!0};s=new n.ShaderMaterial(xe)}else s=new n[q.type](q.parameters);s.name=X,b.materials[X]=s}for(X in _.materials)if((q=_.materials[X]).parameters.materials){for(var be=[],se=0;se<q.parameters.materials.length;se++){var we=q.parameters.materials[se];be.push(b.materials[we])}b.materials[X].materials=be}P(),b.cameras&&_.defaults.camera&&(b.currentCamera=b.cameras[_.defaults.camera]),b.fogs&&_.defaults.fog&&(b.scene.fog=b.fogs[_.defaults.fog]),i.callbackSync(b),z()}},n.TextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(e,t,r,i){var o=this,a=new n.ImageLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){var r=new n.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)})},setCrossOrigin:function(e){this.crossOrigin=e}},n.Material=function(){this.id=n.MaterialIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.blending=n.NormalBlending,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},n.Material.prototype={constructor:n.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof n.Color?i.set(r):i instanceof n.Vector3&&r instanceof n.Vector3?i.copy(r):this[t]="overdraw"==t?Number(r):r}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new n.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Material.prototype),n.MaterialIdCount=0,n.LineBasicMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.LineBasicMaterial.prototype=Object.create(n.Material.prototype),n.LineBasicMaterial.prototype.clone=function(){var e=new n.LineBasicMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.LineDashedMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.LineDashedMaterial.prototype=Object.create(n.Material.prototype),n.LineDashedMaterial.prototype.clone=function(){var e=new n.LineDashedMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.MeshBasicMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype),n.MeshBasicMaterial.prototype.clone=function(){var e=new n.MeshBasicMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},n.MeshLambertMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.wrapAround=!1,this.wrapRGB=new n.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype),n.MeshLambertMaterial.prototype.clone=function(){var e=new n.MeshLambertMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.MeshPhongMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new n.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhongMaterial.prototype.clone=function(){var e=new n.MeshPhongMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.MeshDepthMaterial=function(e){n.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype),n.MeshDepthMaterial.prototype.clone=function(){var e=new n.MeshDepthMaterial;return n.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},n.MeshNormalMaterial=function(e){n.Material.call(this,e),this.shading=n.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype),n.MeshNormalMaterial.prototype.clone=function(){var e=new n.MeshNormalMaterial;return n.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},n.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},n.MeshFaceMaterial.prototype.clone=function(){for(var e=new n.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},n.ParticleSystemMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.ParticleSystemMaterial.prototype=Object.create(n.Material.prototype),n.ParticleSystemMaterial.prototype.clone=function(){var e=new n.ParticleSystemMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.ParticleBasicMaterial=n.ParticleSystemMaterial,n.ShaderMaterial=function(e){n.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=n.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},n.ShaderMaterial.prototype=Object.create(n.Material.prototype),n.ShaderMaterial.prototype.clone=function(){var e=new n.ShaderMaterial;return n.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=n.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.SpriteMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},n.SpriteMaterial.prototype=Object.create(n.Material.prototype),n.SpriteMaterial.prototype.clone=function(){var e=new n.SpriteMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},n.SpriteCanvasMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.program=function(e,t){},this.setValues(e)},n.SpriteCanvasMaterial.prototype=Object.create(n.Material.prototype),n.SpriteCanvasMaterial.prototype.clone=function(){var e=new n.SpriteCanvasMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},n.ParticleCanvasMaterial=n.SpriteCanvasMaterial,n.Texture=function(e,t,r,i,o,a,s,h,l){this.id=n.TextureIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new n.UVMapping,this.wrapS=void 0!==r?r:n.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:n.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:n.LinearFilter,this.minFilter=void 0!==a?a:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:n.RGBAFormat,this.type=void 0!==h?h:n.UnsignedByteType,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},n.Texture.prototype={constructor:n.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new n.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Texture.prototype),n.TextureIdCount=0,n.CompressedTexture=function(e,t,r,i,o,a,s,h,l,c,u){n.Texture.call(this,null,a,s,h,l,c,i,o,u),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.clone=function(){var e=new n.CompressedTexture;return n.Texture.prototype.clone.call(this,e),e},n.DataTexture=function(e,t,r,i,o,a,s,h,l,c,u){n.Texture.call(this,null,a,s,h,l,c,i,o,u),this.image={data:e,width:t,height:r}},n.DataTexture.prototype=Object.create(n.Texture.prototype),n.DataTexture.prototype.clone=function(){var e=new n.DataTexture;return n.Texture.prototype.clone.call(this,e),e},n.ParticleSystem=function(e,t){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.ParticleSystemMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},n.ParticleSystem.prototype=Object.create(n.Object3D.prototype),n.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new n.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,n.Object3D.prototype.clone.call(this,e),e},n.Line=function(e,t,r){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:n.LineStrip},n.LineStrip=0,n.LinePieces=1,n.Line.prototype=Object.create(n.Object3D.prototype),n.Line.prototype.clone=function(e){return void 0===e&&(e=new n.Line(this.geometry,this.material,this.type)),n.Object3D.prototype.clone.call(this,e),e},n.Mesh=function(e,t){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},n.Mesh.prototype=Object.create(n.Object3D.prototype),n.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},n.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},n.Mesh.prototype.clone=function(e){return void 0===e&&(e=new n.Mesh(this.geometry,this.material)),n.Object3D.prototype.clone.call(this,e),e},n.Bone=function(e){n.Object3D.call(this),this.skin=e,this.skinMatrix=new n.Matrix4},n.Bone.prototype=Object.create(n.Object3D.prototype),n.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i,n=this.children.length;for(i=0;i<n;i++)this.children[i].update(this.skinMatrix,t)},n.SkinnedMesh=function(e,t,r){var i,o,a,s,h,l;if(n.Mesh.call(this,e,t),this.useVertexTexture=void 0===r||r,this.identityMatrix=new n.Matrix4,this.bones=[],this.boneMatrices=[],this.geometry&&void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)s=(a=this.geometry.bones[i]).pos,h=a.rotq,l=a.scl,(o=this.addBone()).name=a.name,o.position.set(s[0],s[1],s[2]),o.quaternion.set(h[0],h[1],h[2],h[3]),void 0!==l?o.scale.set(l[0],l[1],l[2]):o.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)a=this.geometry.bones[i],o=this.bones[i],-1===a.parent?this.add(o):this.bones[a.parent].add(o);var c=this.bones.length,u;if(this.useVertexTexture)u=c>256?64:c>64?32:c>16?16:8,this.boneTextureWidth=u,this.boneTextureHeight=u,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType),this.boneTexture.minFilter=n.NearestFilter,this.boneTexture.magFilter=n.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1;else this.boneMatrices=new Float32Array(16*c);this.pose()}},n.SkinnedMesh.prototype=Object.create(n.Mesh.prototype),n.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new n.Bone(this)),this.bones.push(e),e},n.SkinnedMesh.prototype.updateMatrixWorld=(B=new n.Matrix4,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++){var i=this.children[t];i instanceof n.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}if(null==this.boneInverses){this.boneInverses=[];for(var o=0,a=this.bones.length;o<a;o++){var s=new n.Matrix4;s.getInverse(this.bones[o].skinMatrix),this.boneInverses.push(s)}}for(var o=0,a=this.bones.length;o<a;o++)B.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]),B.flattenToArrayOffset(this.boneMatrices,16*o);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),n.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},n.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof n.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},n.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new n.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),n.Mesh.prototype.clone.call(this,e),e},n.MorphAnimMesh=function(e,t){n.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},n.MorphAnimMesh.prototype=Object.create(n.Mesh.prototype),n.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},n.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},n.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},n.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;n<o;n++){var a,s=e.morphTargets[n].name.match(i);if(s&&s.length>1){var h=s[1],l=s[2];r[h]||(r[h]={start:1/0,end:-1/0});var c=r[h];n<c.start&&(c.start=n),n>c.end&&(c.end=n),t||(t=h)}}e.firstAnimation=t},n.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},n.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=(r.end-r.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},n.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+n.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},n.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new n.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,n.Mesh.prototype.clone.call(this,e),e},n.LOD=function(){n.Object3D.call(this),this.objects=[]},n.LOD.prototype=Object.create(n.Object3D.prototype),n.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},n.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},n.LOD.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var n=1,o=this.objects.length;n<o&&i>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;n<o;n++)this.objects[n].object.visible=!1}}}(),n.LOD.prototype.clone=function(e){void 0===e&&(e=new n.LOD),n.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;t<r;t++){var i=this.objects[t].object.clone();i.visible=0===t,e.addLevel(i,this.objects[t].distance)}return e},n.Sprite=((I=new n.Geometry2(3)).vertices.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]),function(e){n.Object3D.call(this),this.geometry=I,this.material=void 0!==e?e:new n.SpriteMaterial}),n.Sprite.prototype=Object.create(n.Object3D.prototype),n.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},n.Sprite.prototype.clone=function(e){return void 0===e&&(e=new n.Sprite(this.material)),n.Object3D.prototype.clone.call(this,e),e},n.Particle=n.Sprite,n.Scene=function(){n.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},n.Scene.prototype=Object.create(n.Object3D.prototype),n.Scene.prototype.__addObject=function(e){if(e instanceof n.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof n.Camera||e instanceof n.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},n.Scene.prototype.__removeObject=function(e){var t;if(e instanceof n.Light){if(-1!==(t=this.__lights.indexOf(e))&&this.__lights.splice(t,1),e.shadowCascadeArray)for(var r=0;r<e.shadowCascadeArray.length;r++)this.__removeObject(e.shadowCascadeArray[r])}else if(!(e instanceof n.Camera)){var t;this.__objectsRemoved.push(e),-1!==(t=this.__objectsAdded.indexOf(e))&&this.__objectsAdded.splice(t,1)}this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},n.Scene.prototype.clone=function(e){return void 0===e&&(e=new n.Scene),n.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},n.Fog=function(e,t,r){this.name="",this.color=new n.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)},n.FogExp2=function(e,t){this.name="",this.color=new n.Color(e),this.density=void 0!==t?t:25e-5},n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)},n.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",n.REVISION);var t=n.Math.smoothstep;e=e||{};var r=this,o,a,s,h=new n.Projector,l=void 0!==e.canvas?e.canvas:document.createElement("canvas"),c=l.width,u=l.height,f=Math.floor(c/2),p=Math.floor(u/2),d=l.getContext("2d",{alpha:!0===e.alpha}),m=new n.Color(0),v=0,g=1,y=0,x=null,b=null,w=null,_=null,M=null,S=null,T=0,C,A,E,P,L,D=new n.RenderableVertex,F=new n.RenderableVertex,R,V,U,z,O,N,B,I,k,j,G,W,H=new n.Color,X=new n.Color,q=new n.Color,Y=new n.Color,K=new n.Color,Q=new n.Color,Z=new n.Color,J=new n.Color,$={},ee,te,re,ie,ne,oe,ae,se,he,le,ce=new n.Box2,ue=new n.Box2,fe=new n.Box2,pe=new n.Color,de=new n.Color,me=new n.Color,ve=new n.Vector3,ge=new n.Vector3,ye=new n.Matrix3,xe,be,we,_e,Me,Se,Te=16;function Ce(){pe.setRGB(0,0,0),de.setRGB(0,0,0),me.setRGB(0,0,0);for(var e=0,t=s.length;e<t;e++){var r=s[e],i=r.color;r instanceof n.AmbientLight?pe.add(i):r instanceof n.DirectionalLight?de.add(i):r instanceof n.PointLight&&me.add(i)}}function Ae(e,t,r){for(var i=0,o=s.length;i<o;i++){var a=s[i];if(J.copy(a.color),a instanceof n.DirectionalLight){var h=ve.setFromMatrixPosition(a.matrixWorld).normalize(),l;if((l=t.dot(h))<=0)continue;l*=a.intensity,r.add(J.multiplyScalar(l))}else if(a instanceof n.PointLight){var h=ve.setFromMatrixPosition(a.matrixWorld),l;if((l=t.dot(ve.subVectors(h,e).normalize()))<=0)continue;if(0==(l*=0==a.distance?1:1-Math.min(e.distanceTo(h)/a.distance,1)))continue;l*=a.intensity,r.add(J.multiplyScalar(l))}}}function Ee(e,t,r){Ie(r.opacity),ke(r.blending);var i=t.scale.x*f,o=t.scale.y*p,a=.5*Math.sqrt(i*i+o*o);if(fe.min.set(e.x-a,e.y-a),fe.max.set(e.x+a,e.y+a),r instanceof n.SpriteMaterial||r instanceof n.ParticleSystemMaterial){var s=r.map;if(null!==s){!1===s.hasEventListener("update",Ve)&&(void 0!==s.image&&s.image.width>0&&Ue(s),s.addEventListener("update",Ve));var h=$[s.id];Xe(void 0!==h?h:"rgba( 0, 0, 0, 1 )");var l=s.image,c=l.width*s.offset.x,u=l.height*s.offset.y,m=l.width*s.repeat.x,v=l.height*s.repeat.y,g=i/m,y=o/v;d.save(),d.translate(e.x,e.y),0!==r.rotation&&d.rotate(r.rotation),d.translate(-i/2,-o/2),d.scale(g,y),d.translate(-c,-u),d.fillRect(c,u,m,v),d.restore()}else Xe(r.color.getStyle()),d.save(),d.translate(e.x,e.y),0!==r.rotation&&d.rotate(r.rotation),d.scale(i,-o),d.fillRect(-.5,-.5,1,1),d.restore()}else r instanceof n.SpriteCanvasMaterial&&(He(r.color.getStyle()),Xe(r.color.getStyle()),d.save(),d.translate(e.x,e.y),0!==r.rotation&&d.rotate(r.rotation),d.scale(i,o),r.program(d),d.restore())}function Pe(e,t,r,i){if(Ie(i.opacity),ke(i.blending),d.beginPath(),d.moveTo(e.positionScreen.x,e.positionScreen.y),d.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof n.LineBasicMaterial){if(je(i.linewidth),Ge(i.linecap),We(i.linejoin),i.vertexColors!==n.VertexColors)He(i.color.getStyle());else{var o=r.vertexColors[0].getStyle(),a=r.vertexColors[1].getStyle();if(o===a)He(o);else{try{var s=d.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);s.addColorStop(0,o),s.addColorStop(1,a)}catch(e){s=o}He(s)}}d.stroke(),fe.expandByScalar(2*i.linewidth)}else i instanceof n.LineDashedMaterial&&(je(i.linewidth),Ge(i.linecap),We(i.linejoin),He(i.color.getStyle()),qe(i.dashSize,i.gapSize),d.stroke(),fe.expandByScalar(2*i.linewidth),qe(null,null))}function Le(e,i,o,a,s,h,l,c){r.info.render.vertices+=3,r.info.render.faces++,Ie(c.opacity),ke(c.blending),R=e.positionScreen.x,V=e.positionScreen.y,U=i.positionScreen.x,z=i.positionScreen.y,O=o.positionScreen.x,N=o.positionScreen.y,De(R,V,U,z,O,N),(c instanceof n.MeshLambertMaterial||c instanceof n.MeshPhongMaterial)&&null===c.map?(Q.copy(c.color),Z.copy(c.emissive),c.vertexColors===n.FaceColors&&Q.multiply(l.color),!1===c.wireframe&&c.shading===n.SmoothShading&&3===l.vertexNormalsLength?(X.copy(pe),q.copy(pe),Y.copy(pe),Ae(l.v1.positionWorld,l.vertexNormalsModel[0],X),Ae(l.v2.positionWorld,l.vertexNormalsModel[1],q),Ae(l.v3.positionWorld,l.vertexNormalsModel[2],Y),X.multiply(Q).add(Z),q.multiply(Q).add(Z),Y.multiply(Q).add(Z),K.addColors(q,Y).multiplyScalar(.5),re=Ne(X,q,Y,K),Oe(R,V,U,z,O,N,0,0,1,0,0,1,re)):(H.copy(pe),Ae(l.centroidModel,l.normalModel,H),H.multiply(Q).add(Z),!0===c.wireframe?Fe(H,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):Re(H))):c instanceof n.MeshBasicMaterial||c instanceof n.MeshLambertMaterial||c instanceof n.MeshPhongMaterial?null!==c.map?c.map.mapping instanceof n.UVMapping&&(ie=l.uvs[0],ze(R,V,U,z,O,N,ie[a].x,ie[a].y,ie[s].x,ie[s].y,ie[h].x,ie[h].y,c.map)):null!==c.envMap?c.envMap.mapping instanceof n.SphericalReflectionMapping&&(ge.copy(l.vertexNormalsModel[a]).applyMatrix3(ye),ne=.5*ge.x+.5,oe=.5*ge.y+.5,ge.copy(l.vertexNormalsModel[s]).applyMatrix3(ye),ae=.5*ge.x+.5,se=.5*ge.y+.5,ge.copy(l.vertexNormalsModel[h]).applyMatrix3(ye),he=.5*ge.x+.5,le=.5*ge.y+.5,ze(R,V,U,z,O,N,ne,oe,ae,se,he,le,c.envMap)):(H.copy(c.color),c.vertexColors===n.FaceColors&&H.multiply(l.color),!0===c.wireframe?Fe(H,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):Re(H)):c instanceof n.MeshDepthMaterial?(ee=C.near,te=C.far,X.r=X.g=X.b=1-t(e.positionScreen.z*e.positionScreen.w,ee,te),q.r=q.g=q.b=1-t(i.positionScreen.z*i.positionScreen.w,ee,te),Y.r=Y.g=Y.b=1-t(o.positionScreen.z*o.positionScreen.w,ee,te),K.addColors(q,Y).multiplyScalar(.5),re=Ne(X,q,Y,K),Oe(R,V,U,z,O,N,0,0,1,0,0,1,re)):c instanceof n.MeshNormalMaterial&&(c.shading===n.FlatShading?(ge.copy(l.normalModel).applyMatrix3(ye),H.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),!0===c.wireframe?Fe(H,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):Re(H)):c.shading===n.SmoothShading&&(ge.copy(l.vertexNormalsModel[a]).applyMatrix3(ye),X.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),ge.copy(l.vertexNormalsModel[s]).applyMatrix3(ye),q.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),ge.copy(l.vertexNormalsModel[h]).applyMatrix3(ye),Y.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),K.addColors(q,Y).multiplyScalar(.5),re=Ne(X,q,Y,K),Oe(R,V,U,z,O,N,0,0,1,0,0,1,re)))}function De(e,t,r,i,n,o){d.beginPath(),d.moveTo(e,t),d.lineTo(r,i),d.lineTo(n,o),d.closePath()}function Fe(e,t,r,i){je(t),Ge(r),We(i),He(e.getStyle()),d.stroke(),fe.expandByScalar(2*t)}function Re(e){Xe(e.getStyle()),d.fill()}function Ve(e){Ue(e.target)}function Ue(e){var t=e.wrapS===n.RepeatWrapping,r=e.wrapT===n.RepeatWrapping,i=e.image,o=document.createElement("canvas");o.width=i.width,o.height=i.height;var a=o.getContext("2d");a.setTransform(1,0,0,-1,0,i.height),a.drawImage(i,0,0),$[e.id]=d.createPattern(o,!0===t&&!0===r?"repeat":!0===t&&!1===r?"repeat-x":!1===t&&!0===r?"repeat-y":"no-repeat")}function ze(e,t,r,i,o,a,s,h,l,c,u,f,p){if(!(p instanceof n.DataTexture)){!1===p.hasEventListener("update",Ve)&&(void 0!==p.image&&p.image.width>0&&Ue(p),p.addEventListener("update",Ve));var m=$[p.id];if(void 0===m)return Xe("rgba(0,0,0,1)"),void d.fill();Xe(m);var v,g,y,x,b,w,_,M,S=p.offset.x/p.repeat.x,T=p.offset.y/p.repeat.y,C=p.image.width*p.repeat.x,A=p.image.height*p.repeat.y;l=(l+S)*C,c=(c+T)*A,u=(u+S)*C,f=(f+T)*A,r-=e,i-=t,o-=e,a-=t,0!==(_=(l-=s=(s+S)*C)*(f-=h=(h+T)*A)-(u-=s)*(c-=h))&&(b=e-(v=(f*r-c*o)*(M=1/_))*s-(y=(l*o-u*r)*M)*h,w=t-(g=(f*i-c*a)*M)*s-(x=(l*a-u*i)*M)*h,d.save(),d.transform(v,g,y,x,b,w),d.fill(),d.restore())}}function Oe(e,t,r,i,n,o,a,s,h,l,c,u,f){var p,m,v,g,y,x,b,w,_=f.width-1,M=f.height-1;h*=_,l*=M,c*=_,u*=M,y=e-(p=((u-=s*=M)*(r-=e)-(l-=s)*(n-=e))*(w=1/(b=(h-=a*=_)*u-(c-=a)*l)))*a-(v=(h*n-c*r)*w)*s,x=t-(m=(u*(i-=t)-l*(o-=t))*w)*a-(g=(h*o-c*i)*w)*s,d.save(),d.transform(p,m,v,g,y,x),d.clip(),d.drawImage(f,0,0),d.restore()}function Ne(e,t,r,i){return _e[0]=255*e.r|0,_e[1]=255*e.g|0,_e[2]=255*e.b|0,_e[4]=255*t.r|0,_e[5]=255*t.g|0,_e[6]=255*t.b|0,_e[8]=255*r.r|0,_e[9]=255*r.g|0,_e[10]=255*r.b|0,_e[12]=255*i.r|0,_e[13]=255*i.g|0,_e[14]=255*i.b|0,be.putImageData(we,0,0),Se.drawImage(xe,0,0),Me}function Be(e,t,r){var i=t.x-e.x,n=t.y-e.y,o=i*i+n*n,a;0!==o&&(i*=a=r/Math.sqrt(o),n*=a,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}function Ie(e){g!==e&&(d.globalAlpha=e,g=e)}function ke(e){y!==e&&(e===n.NormalBlending?d.globalCompositeOperation="source-over":e===n.AdditiveBlending?d.globalCompositeOperation="lighter":e===n.SubtractiveBlending&&(d.globalCompositeOperation="darker"),y=e)}function je(e){w!==e&&(d.lineWidth=e,w=e)}function Ge(e){_!==e&&(d.lineCap=e,_=e)}function We(e){M!==e&&(d.lineJoin=e,M=e)}function He(e){x!==e&&(d.strokeStyle=e,x=e)}function Xe(e){b!==e&&(d.fillStyle=e,b=e)}function qe(e,t){S===e&&T===t||(d.setLineDash([e,t]),S=e,T=t)}(xe=document.createElement("canvas")).width=xe.height=2,(be=xe.getContext("2d")).fillStyle="rgba(0,0,0,1)",be.fillRect(0,0,2,2),we=be.getImageData(0,0,2,2),_e=we.data,(Me=document.createElement("canvas")).width=Me.height=Te,(Se=Me.getContext("2d")).translate(-Te/2,-Te/2),Se.scale(Te,Te),Te--,void 0===d.setLineDash&&(void 0!==d.mozDash?d.setLineDash=function(e){d.mozDash=null!==e[0]?e:null}:d.setLineDash=function(){}),this.domElement=l,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==i.devicePixelRatio?i.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){c=e*this.devicePixelRatio,u=t*this.devicePixelRatio,f=Math.floor(c/2),p=Math.floor(u/2),l.width=c,l.height=u,1!==this.devicePixelRatio&&!1!==r&&(l.style.width=e+"px",l.style.height=t+"px"),ce.min.set(-f,-p),ce.max.set(f,p),ue.min.set(-f,-p),ue.max.set(f,p),g=1,y=0,x=null,b=null,w=null,_=null,M=null},this.setClearColor=function(e,t){m.set(e),v=void 0!==t?t:1,ue.min.set(-f,-p),ue.max.set(f,p)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){d.setTransform(1,0,0,-1,f,p),!1===ue.empty()&&(ue.intersect(ce),ue.expandByScalar(2),v<1&&d.clearRect(0|ue.min.x,0|ue.min.y,ue.max.x-ue.min.x|0,ue.max.y-ue.min.y|0),v>0&&(ke(n.NormalBlending),Ie(1),Xe("rgba("+Math.floor(255*m.r)+","+Math.floor(255*m.g)+","+Math.floor(255*m.b)+","+v+")"),d.fillRect(0|ue.min.x,0|ue.min.y,ue.max.x-ue.min.x|0,ue.max.y-ue.min.y|0)),ue.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof n.Camera!=!1){!0===this.autoClear&&this.clear(),d.setTransform(1,0,0,-1,f,p),r.info.render.vertices=0,r.info.render.faces=0,o=h.projectScene(e,t,this.sortObjects,this.sortElements),a=o.elements,s=o.lights,C=t,ye.getNormalMatrix(t.matrixWorldInverse),Ce();for(var i=0,l=a.length;i<l;i++){var c=a[i],u=c.material;if(void 0!==u&&!1!==u.visible){if(fe.makeEmpty(),c instanceof n.RenderableSprite)(A=c).x*=f,A.y*=p,Ee(A,c,u);else if(c instanceof n.RenderableLine)A=c.v1,E=c.v2,A.positionScreen.x*=f,A.positionScreen.y*=p,E.positionScreen.x*=f,E.positionScreen.y*=p,fe.setFromPoints([A.positionScreen,E.positionScreen]),!0===ce.isIntersectionBox(fe)&&Pe(A,E,c,u);else if(c instanceof n.RenderableFace){if(A=c.v1,E=c.v2,P=c.v3,A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(E.positionScreen.z<-1||E.positionScreen.z>1)continue;if(P.positionScreen.z<-1||P.positionScreen.z>1)continue;A.positionScreen.x*=f,A.positionScreen.y*=p,E.positionScreen.x*=f,E.positionScreen.y*=p,P.positionScreen.x*=f,P.positionScreen.y*=p,u.overdraw>0&&(Be(A.positionScreen,E.positionScreen,u.overdraw),Be(E.positionScreen,P.positionScreen,u.overdraw),Be(P.positionScreen,A.positionScreen,u.overdraw)),fe.setFromPoints([A.positionScreen,E.positionScreen,P.positionScreen]),!0===ce.isIntersectionBox(fe)&&Le(A,E,P,0,1,2,c,u)}ue.union(fe)}}d.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},n.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},n.UniformsUtils={merge:function(e){var t,r,i,n={};for(t=0;t<e.length;t++)for(r in i=this.clone(e[t]))n[r]=i[r];return n},clone:function(e){var t,r,i,o,a={};for(t in e)for(r in a[t]={},e[t])(o=e[t][r])instanceof n.Color||o instanceof n.Vector2||o instanceof n.Vector3||o instanceof n.Vector4||o instanceof n.Matrix4||o instanceof n.Texture?a[t][r]=o.clone():a[t][r]=o instanceof Array?o.slice():o;return a}},n.UniformsLib={common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},n.ShaderLib={basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.shadowmap]),vertexShader:[n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"#endif",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_lambert_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_lambert_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.bump,n.UniformsLib.normalmap,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_phong_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_phong_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.lights_phong_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.bumpmap_pars_fragment,n.ShaderChunk.normalmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lights_phong_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.particle,n.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",n.ShaderChunk.color_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_particle_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",n.ShaderChunk.map_particle_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk.color_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.color_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",n.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new n.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new n.Color(16777215)},specular:{type:"c",value:new n.Color(1118481)},ambient:{type:"c",value:new n.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new n.Vector2(0,0)},uRepeat:{type:"v2",value:new n.Vector2(1,1)},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},n.WebGLRenderer=function(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),r=void 0!==e.context?e.context:null,o=void 0!==e.precision?e.precision:"highp",a=void 0!==e.alpha&&e.alpha,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,h=void 0!==e.antialias&&e.antialias,l=void 0===e.stencil||e.stencil,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=new n.Color(0),f=0;this.domElement=t,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==i.devicePixelRatio?i.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=n.PCFShadowMap,this.shadowMapCullFace=n.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var p=this,d=[],m=0,v=null,g=null,y=-1,x=null,b=null,w=0,_=-1,M=-1,S=-1,T=-1,C=-1,A=-1,E=-1,P=-1,L=null,D=null,F=null,R=null,V=0,U=0,z=t.width,O=t.height,N=0,B=0,I=new Uint8Array(16),k=new n.Frustum,j=new n.Matrix4,G=new n.Matrix4,W=new n.Vector3,H=new n.Vector3,X=!0,q={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},Y,K,Q,Z,J,$;Jt(),$t(),this.context=Y;var ee=Y.getParameter(Y.MAX_TEXTURE_IMAGE_UNITS),te=Y.getParameter(Y.MAX_VERTEX_TEXTURE_IMAGE_UNITS),re=Y.getParameter(Y.MAX_TEXTURE_SIZE),ie=Y.getParameter(Y.MAX_CUBE_MAP_TEXTURE_SIZE),ne=J?Y.getParameter(J.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,oe=te>0,ae=oe&&K,se=$?Y.getParameter(Y.COMPRESSED_TEXTURE_FORMATS):[],he=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.HIGH_FLOAT),le=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.MEDIUM_FLOAT),ce=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.LOW_FLOAT),ue=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.HIGH_FLOAT),fe=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.MEDIUM_FLOAT),pe=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.LOW_FLOAT),de=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.HIGH_INT),me=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.MEDIUM_INT),ve=Y.getShaderPrecisionFormat(Y.VERTEX_SHADER,Y.LOW_INT),ge=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.HIGH_INT),ye=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.MEDIUM_INT),xe=Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.LOW_INT),be=he.precision>0&&ue.precision>0,we=le.precision>0&&fe.precision>0;function _e(e){e.__webglVertexBuffer=Y.createBuffer(),e.__webglColorBuffer=Y.createBuffer(),p.info.memory.geometries++}function Me(e){e.__webglVertexBuffer=Y.createBuffer(),e.__webglColorBuffer=Y.createBuffer(),e.__webglLineDistanceBuffer=Y.createBuffer(),p.info.memory.geometries++}function Se(e){var t,r;if(e.__webglVertexBuffer=Y.createBuffer(),e.__webglNormalBuffer=Y.createBuffer(),e.__webglTangentBuffer=Y.createBuffer(),e.__webglColorBuffer=Y.createBuffer(),e.__webglUVBuffer=Y.createBuffer(),e.__webglUV2Buffer=Y.createBuffer(),e.__webglSkinIndicesBuffer=Y.createBuffer(),e.__webglSkinWeightsBuffer=Y.createBuffer(),e.__webglFaceBuffer=Y.createBuffer(),e.__webglLineBuffer=Y.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;t<r;t++)e.__webglMorphTargetsBuffers.push(Y.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;t<r;t++)e.__webglMorphNormalsBuffers.push(Y.createBuffer());p.info.memory.geometries++}"highp"!==o||be||(we?(o="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(o="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==o||we||(o="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Y},this.supportsVertexTextures=function(){return oe},this.supportsFloatTextures=function(){return K},this.supportsStandardDerivatives=function(){return Z},this.supportsCompressedTextureS3TC=function(){return $},this.getMaxAnisotropy=function(){return ne},this.getPrecision=function(){return o},this.setSize=function(e,r,i){t.width=e*this.devicePixelRatio,t.height=r*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r)},this.setViewport=function(e,t,r,i){V=e*this.devicePixelRatio,U=t*this.devicePixelRatio,z=r*this.devicePixelRatio,O=i*this.devicePixelRatio,Y.viewport(V,U,z,O)},this.setScissor=function(e,t,r,i){Y.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,i*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Y.enable(Y.SCISSOR_TEST):Y.disable(Y.SCISSOR_TEST)},this.setClearColor=function(e,t){u.set(e),f=void 0!==t?t:1,Y.clearColor(u.r,u.g,u.b,f)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return u},this.getClearAlpha=function(){return f},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Y.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Y.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Y.STENCIL_BUFFER_BIT),Y.clear(i)},this.clearColor=function(){Y.clear(Y.COLOR_BUFFER_BIT)},this.clearDepth=function(){Y.clear(Y.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Y.clear(Y.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){v=null,S=-1,E=-1,P=-1,x=-1,y=-1,X=!0,_=-1,M=-1,this.shadowMapPlugin.update(e,t)};var Te=function(e){var t=e.target;t.removeEventListener("dispose",Te),Le(t)},Ce=function(e){var t=e.target;t.removeEventListener("dispose",Ce),De(t),p.info.memory.textures--},Ae=function(e){var t=e.target;t.removeEventListener("dispose",Ae),Fe(t),p.info.memory.textures--},Ee=function(e){var t=e.target;t.removeEventListener("dispose",Ee),Re(t)},Pe=function(e){if(void 0!==e.__webglVertexBuffer&&Y.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Y.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Y.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Y.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Y.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Y.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Y.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Y.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Y.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Y.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Y.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Y.deleteBuffer(e.__webglCustomAttributesList[t].buffer);p.info.memory.geometries--},Le=function(e){if(e.__webglInit=void 0,e instanceof n.BufferGeometry){var t=e.attributes;for(var r in t)void 0!==t[r].buffer&&Y.deleteBuffer(t[r].buffer);p.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var i in e.geometryGroups){var o=e.geometryGroups[i];if(void 0!==o.numMorphTargets)for(var a=0,s=o.numMorphTargets;a<s;a++)Y.deleteBuffer(o.__webglMorphTargetsBuffers[a]);if(void 0!==o.numMorphNormals)for(var a=0,s=o.numMorphNormals;a<s;a++)Y.deleteBuffer(o.__webglMorphNormalsBuffers[a]);Pe(o)}else Pe(e)},De=function(e){if(e.image&&e.image.__webglTextureCube)Y.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Y.deleteTexture(e.__webglTexture)}},Fe=function(e){if(e&&e.__webglTexture)if(Y.deleteTexture(e.__webglTexture),e instanceof n.WebGLRenderTargetCube)for(var t=0;t<6;t++)Y.deleteFramebuffer(e.__webglFramebuffer[t]),Y.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Y.deleteFramebuffer(e.__webglFramebuffer),Y.deleteRenderbuffer(e.__webglRenderbuffer)},Re=function(e){var t=e.program;if(void 0!==t){var r,i,n;e.program=void 0;var o=!1;for(r=0,i=d.length;r<i;r++)if((n=d[r]).program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(r=0,i=d.length;r<i;r++)(n=d[r]).program!==t&&a.push(n);d=a,Y.deleteProgram(t),p.info.memory.programs--}}};function Ve(e,t){var r=e.vertices.length,i=t.material;if(i.attributes)for(var n in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),i.attributes){var o=i.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=Y.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function Ue(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,Ve(e,t)}function ze(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,Ve(e,t)}function Oe(e,t){var r=t.geometry,i=e.faces3,n=3*i.length,o=1*i.length,a=3*i.length,s=Ne(t,e),h=je(s),l=Ie(s),c=ke(s),u,f;if(e.__vertexArray=new Float32Array(3*n),l&&(e.__normalArray=new Float32Array(3*n)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),c&&(e.__colorArray=new Float32Array(3*n)),h&&(r.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*n)),r.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*n))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n)),e.__faceArray=new Uint16Array(3*o),e.__lineArray=new Uint16Array(2*a),e.numMorphTargets)for(e.__morphTargetsArrays=[],u=0,f=e.numMorphTargets;u<f;u++)e.__morphTargetsArrays.push(new Float32Array(3*n));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],u=0,f=e.numMorphNormals;u<f;u++)e.__morphNormalsArrays.push(new Float32Array(3*n));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes)for(var p in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),s.attributes){var d=s.attributes[p],m={};for(var v in d)m[v]=d[v];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var g=1;"v2"===m.type?g=2:"v3"===m.type?g=3:"v4"===m.type?g=4:"c"===m.type&&(g=3),m.size=g,m.array=new Float32Array(n*g),m.buffer=Y.createBuffer(),m.buffer.belongsToAttribute=p,d.needsUpdate=!0,m.__original=d}e.__webglCustomAttributesList.push(m)}e.__inittedArrays=!0}function Ne(e,t){return e.material instanceof n.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Be(e){return e&&void 0!==e.shading&&e.shading===n.SmoothShading}function Ie(e){return!(e instanceof n.MeshBasicMaterial&&!e.envMap||e instanceof n.MeshDepthMaterial)&&(Be(e)?n.SmoothShading:n.FlatShading)}function ke(e){return!!e.vertexColors&&e.vertexColors}function je(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof n.ShaderMaterial)}function Ge(e){var t,r,i;for(t in e.attributes)i="index"===t?Y.ELEMENT_ARRAY_BUFFER:Y.ARRAY_BUFFER,(r=e.attributes[t]).buffer=Y.createBuffer(),Y.bindBuffer(i,r.buffer),Y.bufferData(i,r.array,Y.STATIC_DRAW)}function We(e,t,r){var i,n,o,a,s,h,l=e.vertices,c=l.length,u=e.colors,f=u.length,p=e.__vertexArray,d=e.__colorArray,m=e.__sortArray,v=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,x=e.__webglCustomAttributesList,b,w,_,M,S,T,C;if(r.sortParticles){for(G.copy(j),G.multiply(r.matrixWorld),i=0;i<c;i++)o=l[i],W.copy(o),W.applyProjection(G),m[i]=[W.z,i];for(m.sort($e),i=0;i<c;i++)o=l[m[i][1]],p[a=3*i]=o.x,p[a+1]=o.y,p[a+2]=o.z;for(n=0;n<f;n++)a=3*n,h=u[m[n][1]],d[a]=h.r,d[a+1]=h.g,d[a+2]=h.b;if(x)for(b=0,w=x.length;b<w;b++)if(void 0===(C=x[b]).boundTo||"vertices"===C.boundTo)if(a=0,S=C.value.length,1===C.size)for(M=0;M<S;M++)s=m[M][1],C.array[M]=C.value[s];else if(2===C.size)for(M=0;M<S;M++)s=m[M][1],T=C.value[s],C.array[a]=T.x,C.array[a+1]=T.y,a+=2;else if(3===C.size)if("c"===C.type)for(M=0;M<S;M++)s=m[M][1],T=C.value[s],C.array[a]=T.r,C.array[a+1]=T.g,C.array[a+2]=T.b,a+=3;else for(M=0;M<S;M++)s=m[M][1],T=C.value[s],C.array[a]=T.x,C.array[a+1]=T.y,C.array[a+2]=T.z,a+=3;else if(4===C.size)for(M=0;M<S;M++)s=m[M][1],T=C.value[s],C.array[a]=T.x,C.array[a+1]=T.y,C.array[a+2]=T.z,C.array[a+3]=T.w,a+=4}else{if(v)for(i=0;i<c;i++)o=l[i],p[a=3*i]=o.x,p[a+1]=o.y,p[a+2]=o.z;if(y)for(n=0;n<f;n++)h=u[n],d[a=3*n]=h.r,d[a+1]=h.g,d[a+2]=h.b;if(x)for(b=0,w=x.length;b<w;b++)if((C=x[b]).needsUpdate&&(void 0===C.boundTo||"vertices"===C.boundTo))if(S=C.value.length,a=0,1===C.size)for(M=0;M<S;M++)C.array[M]=C.value[M];else if(2===C.size)for(M=0;M<S;M++)T=C.value[M],C.array[a]=T.x,C.array[a+1]=T.y,a+=2;else if(3===C.size)if("c"===C.type)for(M=0;M<S;M++)T=C.value[M],C.array[a]=T.r,C.array[a+1]=T.g,C.array[a+2]=T.b,a+=3;else for(M=0;M<S;M++)T=C.value[M],C.array[a]=T.x,C.array[a+1]=T.y,C.array[a+2]=T.z,a+=3;else if(4===C.size)for(M=0;M<S;M++)T=C.value[M],C.array[a]=T.x,C.array[a+1]=T.y,C.array[a+2]=T.z,C.array[a+3]=T.w,a+=4}if((v||r.sortParticles)&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglVertexBuffer),Y.bufferData(Y.ARRAY_BUFFER,p,t)),(y||r.sortParticles)&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglColorBuffer),Y.bufferData(Y.ARRAY_BUFFER,d,t)),x)for(b=0,w=x.length;b<w;b++)((C=x[b]).needsUpdate||r.sortParticles)&&(Y.bindBuffer(Y.ARRAY_BUFFER,C.buffer),Y.bufferData(Y.ARRAY_BUFFER,C.array,t))}function He(e,t){var r,i,n,o,a,s,h=e.vertices,l=e.colors,c=e.lineDistances,u=h.length,f=l.length,p=c.length,d=e.__vertexArray,m=e.__colorArray,v=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,x=e.lineDistancesNeedUpdate,b=e.__webglCustomAttributesList,w,_,M,S,T,C,A;if(g){for(r=0;r<u;r++)o=h[r],d[a=3*r]=o.x,d[a+1]=o.y,d[a+2]=o.z;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglVertexBuffer),Y.bufferData(Y.ARRAY_BUFFER,d,t)}if(y){for(i=0;i<f;i++)s=l[i],m[a=3*i]=s.r,m[a+1]=s.g,m[a+2]=s.b;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglColorBuffer),Y.bufferData(Y.ARRAY_BUFFER,m,t)}if(x){for(n=0;n<p;n++)v[n]=c[n];Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Y.bufferData(Y.ARRAY_BUFFER,v,t)}if(b)for(w=0,_=b.length;w<_;w++)if((A=b[w]).needsUpdate&&(void 0===A.boundTo||"vertices"===A.boundTo)){if(a=0,T=A.value.length,1===A.size)for(S=0;S<T;S++)A.array[S]=A.value[S];else if(2===A.size)for(S=0;S<T;S++)C=A.value[S],A.array[a]=C.x,A.array[a+1]=C.y,a+=2;else if(3===A.size)if("c"===A.type)for(S=0;S<T;S++)C=A.value[S],A.array[a]=C.r,A.array[a+1]=C.g,A.array[a+2]=C.b,a+=3;else for(S=0;S<T;S++)C=A.value[S],A.array[a]=C.x,A.array[a+1]=C.y,A.array[a+2]=C.z,a+=3;else if(4===A.size)for(S=0;S<T;S++)C=A.value[S],A.array[a]=C.x,A.array[a+1]=C.y,A.array[a+2]=C.z,A.array[a+3]=C.w,a+=4;Y.bindBuffer(Y.ARRAY_BUFFER,A.buffer),Y.bufferData(Y.ARRAY_BUFFER,A.array,t)}}function Xe(e,t,r,i,o){if(e.__inittedArrays){var a=Ie(o),s=ke(o),h=je(o),l=a===n.SmoothShading,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P,L,D,F,R,V,U,z,O,N,B,I,k,j,G,W,H,X,q,K,Q,Z,J,$,ee,te,re,ie,ne,oe,ae,se,he,le,ce,ue,fe,pe,de,me=0,ve=0,ge=0,ye=0,xe=0,be=0,we=0,_e=0,Me=0,Se=0,Te=0,Ce=0,Ae=0,Ee,Pe=e.__vertexArray,Le=e.__uvArray,De=e.__uv2Array,Fe=e.__normalArray,Re=e.__tangentArray,Ve=e.__colorArray,Ue=e.__skinIndexArray,ze=e.__skinWeightArray,Oe=e.__morphTargetsArrays,Ne=e.__morphNormalsArrays,Be=e.__webglCustomAttributesList,Ge,We=e.__faceArray,He=e.__lineArray,Xe=t.geometry,qe=Xe.verticesNeedUpdate,Ye=Xe.elementsNeedUpdate,Ke=Xe.uvsNeedUpdate,Qe=Xe.normalsNeedUpdate,Ze=Xe.tangentsNeedUpdate,Je=Xe.colorsNeedUpdate,$e=Xe.morphTargetsNeedUpdate,et=Xe.vertices,tt=e.faces3,rt=Xe.faces,it=Xe.faceVertexUvs[0],nt=Xe.faceVertexUvs[1],ot=Xe.colors,at=Xe.skinIndices,st=Xe.skinWeights,ht=Xe.morphTargets,lt=Xe.morphNormals;if(qe){for(c=0,u=tt.length;c<u;c++)_=et[(p=rt[tt[c]]).a],M=et[p.b],S=et[p.c],Pe[ve]=_.x,Pe[ve+1]=_.y,Pe[ve+2]=_.z,Pe[ve+3]=M.x,Pe[ve+4]=M.y,Pe[ve+5]=M.z,Pe[ve+6]=S.x,Pe[ve+7]=S.y,Pe[ve+8]=S.z,ve+=9;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglVertexBuffer),Y.bufferData(Y.ARRAY_BUFFER,Pe,r)}if($e)for(he=0,le=ht.length;he<le;he++){for(Te=0,c=0,u=tt.length;c<u;c++)p=rt[fe=tt[c]],_=ht[he].vertices[p.a],M=ht[he].vertices[p.b],S=ht[he].vertices[p.c],(ce=Oe[he])[Te]=_.x,ce[Te+1]=_.y,ce[Te+2]=_.z,ce[Te+3]=M.x,ce[Te+4]=M.y,ce[Te+5]=M.z,ce[Te+6]=S.x,ce[Te+7]=S.y,ce[Te+8]=S.z,o.morphNormals&&(l?(L=(pe=lt[he].vertexNormals[fe]).a,D=pe.b,F=pe.c):(D=L=lt[he].faceNormals[fe],F=L),(ue=Ne[he])[Te]=L.x,ue[Te+1]=L.y,ue[Te+2]=L.z,ue[Te+3]=D.x,ue[Te+4]=D.y,ue[Te+5]=D.z,ue[Te+6]=F.x,ue[Te+7]=F.y,ue[Te+8]=F.z),Te+=9;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[he]),Y.bufferData(Y.ARRAY_BUFFER,Oe[he],r),o.morphNormals&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[he]),Y.bufferData(Y.ARRAY_BUFFER,Ne[he],r))}if(st.length){for(c=0,u=tt.length;c<u;c++)N=st[(p=rt[tt[c]]).a],B=st[p.b],I=st[p.c],ze[Se]=N.x,ze[Se+1]=N.y,ze[Se+2]=N.z,ze[Se+3]=N.w,ze[Se+4]=B.x,ze[Se+5]=B.y,ze[Se+6]=B.z,ze[Se+7]=B.w,ze[Se+8]=I.x,ze[Se+9]=I.y,ze[Se+10]=I.z,ze[Se+11]=I.w,j=at[p.a],G=at[p.b],W=at[p.c],Ue[Se]=j.x,Ue[Se+1]=j.y,Ue[Se+2]=j.z,Ue[Se+3]=j.w,Ue[Se+4]=G.x,Ue[Se+5]=G.y,Ue[Se+6]=G.z,Ue[Se+7]=G.w,Ue[Se+8]=W.x,Ue[Se+9]=W.y,Ue[Se+10]=W.z,Ue[Se+11]=W.w,Se+=12;Se>0&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Y.bufferData(Y.ARRAY_BUFFER,Ue,r),Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Y.bufferData(Y.ARRAY_BUFFER,ze,r))}if(Je&&s){for(c=0,u=tt.length;c<u;c++)g=(p=rt[tt[c]]).vertexColors,y=p.color,3===g.length&&s===n.VertexColors?(V=g[0],U=g[1],z=g[2]):(V=y,U=y,z=y),Ve[Me]=V.r,Ve[Me+1]=V.g,Ve[Me+2]=V.b,Ve[Me+3]=U.r,Ve[Me+4]=U.g,Ve[Me+5]=U.b,Ve[Me+6]=z.r,Ve[Me+7]=z.g,Ve[Me+8]=z.b,Me+=9;Me>0&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglColorBuffer),Y.bufferData(Y.ARRAY_BUFFER,Ve,r))}if(Ze&&Xe.hasTangents){for(c=0,u=tt.length;c<u;c++)C=(x=(p=rt[tt[c]]).vertexTangents)[0],A=x[1],E=x[2],Re[we]=C.x,Re[we+1]=C.y,Re[we+2]=C.z,Re[we+3]=C.w,Re[we+4]=A.x,Re[we+5]=A.y,Re[we+6]=A.z,Re[we+7]=A.w,Re[we+8]=E.x,Re[we+9]=E.y,Re[we+10]=E.z,Re[we+11]=E.w,we+=12;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglTangentBuffer),Y.bufferData(Y.ARRAY_BUFFER,Re,r)}if(Qe&&a){for(c=0,u=tt.length;c<u;c++)if(d=(p=rt[tt[c]]).vertexNormals,m=p.normal,3===d.length&&l)for(ie=0;ie<3;ie++)oe=d[ie],Fe[be]=oe.x,Fe[be+1]=oe.y,Fe[be+2]=oe.z,be+=3;else for(ie=0;ie<3;ie++)Fe[be]=m.x,Fe[be+1]=m.y,Fe[be+2]=m.z,be+=3;Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglNormalBuffer),Y.bufferData(Y.ARRAY_BUFFER,Fe,r)}if(Ke&&it&&h){for(c=0,u=tt.length;c<u;c++)if(void 0!==(b=it[f=tt[c]]))for(ie=0;ie<3;ie++)ae=b[ie],Le[ge]=ae.x,Le[ge+1]=ae.y,ge+=2;ge>0&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglUVBuffer),Y.bufferData(Y.ARRAY_BUFFER,Le,r))}if(Ke&&nt&&h){for(c=0,u=tt.length;c<u;c++)if(void 0!==(w=nt[f=tt[c]]))for(ie=0;ie<3;ie++)se=w[ie],De[ye]=se.x,De[ye+1]=se.y,ye+=2;ye>0&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglUV2Buffer),Y.bufferData(Y.ARRAY_BUFFER,De,r))}if(Ye){for(c=0,u=tt.length;c<u;c++)We[xe]=me,We[xe+1]=me+1,We[xe+2]=me+2,xe+=3,He[_e]=me,He[_e+1]=me+1,He[_e+2]=me,He[_e+3]=me+2,He[_e+4]=me+1,He[_e+5]=me+2,_e+=6,me+=3;Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Y.bufferData(Y.ELEMENT_ARRAY_BUFFER,We,r),Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Y.bufferData(Y.ELEMENT_ARRAY_BUFFER,He,r)}if(Be)for(ie=0,ne=Be.length;ie<ne;ie++)if((Ge=Be[ie]).__original.needsUpdate){if(Ce=0,Ae=0,1===Ge.size){if(void 0===Ge.boundTo||"vertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)p=rt[tt[c]],Ge.array[Ce]=Ge.value[p.a],Ge.array[Ce+1]=Ge.value[p.b],Ge.array[Ce+2]=Ge.value[p.c],Ce+=3;else if("faces"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)Ee=Ge.value[tt[c]],Ge.array[Ce]=Ee,Ge.array[Ce+1]=Ee,Ge.array[Ce+2]=Ee,Ce+=3}else if(2===Ge.size){if(void 0===Ge.boundTo||"vertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)p=rt[tt[c]],_=Ge.value[p.a],M=Ge.value[p.b],S=Ge.value[p.c],Ge.array[Ce]=_.x,Ge.array[Ce+1]=_.y,Ge.array[Ce+2]=M.x,Ge.array[Ce+3]=M.y,Ge.array[Ce+4]=S.x,Ge.array[Ce+5]=S.y,Ce+=6;else if("faces"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)_=Ee=Ge.value[tt[c]],M=Ee,S=Ee,Ge.array[Ce]=_.x,Ge.array[Ce+1]=_.y,Ge.array[Ce+2]=M.x,Ge.array[Ce+3]=M.y,Ge.array[Ce+4]=S.x,Ge.array[Ce+5]=S.y,Ce+=6}else if(3===Ge.size){var ct;if(ct="c"===Ge.type?["r","g","b"]:["x","y","z"],void 0===Ge.boundTo||"vertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)p=rt[tt[c]],_=Ge.value[p.a],M=Ge.value[p.b],S=Ge.value[p.c],Ge.array[Ce]=_[ct[0]],Ge.array[Ce+1]=_[ct[1]],Ge.array[Ce+2]=_[ct[2]],Ge.array[Ce+3]=M[ct[0]],Ge.array[Ce+4]=M[ct[1]],Ge.array[Ce+5]=M[ct[2]],Ge.array[Ce+6]=S[ct[0]],Ge.array[Ce+7]=S[ct[1]],Ge.array[Ce+8]=S[ct[2]],Ce+=9;else if("faces"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)_=Ee=Ge.value[tt[c]],M=Ee,S=Ee,Ge.array[Ce]=_[ct[0]],Ge.array[Ce+1]=_[ct[1]],Ge.array[Ce+2]=_[ct[2]],Ge.array[Ce+3]=M[ct[0]],Ge.array[Ce+4]=M[ct[1]],Ge.array[Ce+5]=M[ct[2]],Ge.array[Ce+6]=S[ct[0]],Ge.array[Ce+7]=S[ct[1]],Ge.array[Ce+8]=S[ct[2]],Ce+=9;else if("faceVertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)_=(Ee=Ge.value[tt[c]])[0],M=Ee[1],S=Ee[2],Ge.array[Ce]=_[ct[0]],Ge.array[Ce+1]=_[ct[1]],Ge.array[Ce+2]=_[ct[2]],Ge.array[Ce+3]=M[ct[0]],Ge.array[Ce+4]=M[ct[1]],Ge.array[Ce+5]=M[ct[2]],Ge.array[Ce+6]=S[ct[0]],Ge.array[Ce+7]=S[ct[1]],Ge.array[Ce+8]=S[ct[2]],Ce+=9}else if(4===Ge.size)if(void 0===Ge.boundTo||"vertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)p=rt[tt[c]],_=Ge.value[p.a],M=Ge.value[p.b],S=Ge.value[p.c],Ge.array[Ce]=_.x,Ge.array[Ce+1]=_.y,Ge.array[Ce+2]=_.z,Ge.array[Ce+3]=_.w,Ge.array[Ce+4]=M.x,Ge.array[Ce+5]=M.y,Ge.array[Ce+6]=M.z,Ge.array[Ce+7]=M.w,Ge.array[Ce+8]=S.x,Ge.array[Ce+9]=S.y,Ge.array[Ce+10]=S.z,Ge.array[Ce+11]=S.w,Ce+=12;else if("faces"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)_=Ee=Ge.value[tt[c]],M=Ee,S=Ee,Ge.array[Ce]=_.x,Ge.array[Ce+1]=_.y,Ge.array[Ce+2]=_.z,Ge.array[Ce+3]=_.w,Ge.array[Ce+4]=M.x,Ge.array[Ce+5]=M.y,Ge.array[Ce+6]=M.z,Ge.array[Ce+7]=M.w,Ge.array[Ce+8]=S.x,Ge.array[Ce+9]=S.y,Ge.array[Ce+10]=S.z,Ge.array[Ce+11]=S.w,Ce+=12;else if("faceVertices"===Ge.boundTo)for(c=0,u=tt.length;c<u;c++)_=(Ee=Ge.value[tt[c]])[0],M=Ee[1],S=Ee[2],Ge.array[Ce]=_.x,Ge.array[Ce+1]=_.y,Ge.array[Ce+2]=_.z,Ge.array[Ce+3]=_.w,Ge.array[Ce+4]=M.x,Ge.array[Ce+5]=M.y,Ge.array[Ce+6]=M.z,Ge.array[Ce+7]=M.w,Ge.array[Ce+8]=S.x,Ge.array[Ce+9]=S.y,Ge.array[Ce+10]=S.z,Ge.array[Ce+11]=S.w,Ce+=12;Y.bindBuffer(Y.ARRAY_BUFFER,Ge.buffer),Y.bufferData(Y.ARRAY_BUFFER,Ge.array,r)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function qe(e,t,r,i){var n,o,a,s;for(o in t)a=t[o],n=r[o],a>=0&&(n?(s=n.itemSize,Y.bindBuffer(Y.ARRAY_BUFFER,n.buffer),Ke(a),Y.vertexAttribPointer(a,s,Y.FLOAT,!1,0,i*s*4)):e.defaultAttributeValues&&(2===e.defaultAttributeValues[o].length?Y.vertexAttrib2fv(a,e.defaultAttributeValues[o]):3===e.defaultAttributeValues[o].length&&Y.vertexAttrib3fv(a,e.defaultAttributeValues[o])))}function Ye(e,t){var r=e.attributes,i,n;for(i in r)(n=r[i]).needsUpdate&&("index"===i?(Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,n.buffer),Y.bufferData(Y.ELEMENT_ARRAY_BUFFER,n.array,t)):(Y.bindBuffer(Y.ARRAY_BUFFER,n.buffer),Y.bufferData(Y.ARRAY_BUFFER,n.array,t)),n.needsUpdate=!1)}function Ke(e){0===I[e]&&(Y.enableVertexAttribArray(e),I[e]=1)}function Qe(){for(var e in I)1===I[e]&&(Y.disableVertexAttribArray(e),I[e]=0)}function Ze(e,t,r){var i=e.program.attributes;if(-1!==r.morphTargetBase&&i.position>=0?(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),Ke(i.position),Y.vertexAttribPointer(i.position,3,Y.FLOAT,!1,0,0)):i.position>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglVertexBuffer),Ke(i.position),Y.vertexAttribPointer(i.position,3,Y.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var n=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)i["morphTarget"+n]>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),Ke(i["morphTarget"+n]),Y.vertexAttribPointer(i["morphTarget"+n],3,Y.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),Ke(i["morphNormal"+n]),Y.vertexAttribPointer(i["morphNormal"+n],3,Y.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,h=[],a,l,c=(a=r.morphTargetInfluences).length;for(l=0;l<c;l++)(s=a[l])>0&&h.push([s,l]);h.length>e.numSupportedMorphTargets?(h.sort($e),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort($e):0===h.length&&h.push([0,0]);for(var u,n=0;n<e.numSupportedMorphTargets;)h[n]?(u=h[n][1],i["morphTarget"+n]>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),Ke(i["morphTarget"+n]),Y.vertexAttribPointer(i["morphTarget"+n],3,Y.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Y.bindBuffer(Y.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),Ke(i["morphNormal"+n]),Y.vertexAttribPointer(i["morphNormal"+n],3,Y.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[u]):r.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&Y.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function Je(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function $e(e,t){return t[0]-e[0]}function et(e,t,r){if(e.length)for(var i=0,n=e.length;i<n;i++)v=null,b=null,S=-1,E=-1,P=-1,_=-1,M=-1,x=-1,y=-1,X=!0,e[i].render(t,r,N,B),v=null,b=null,S=-1,E=-1,P=-1,_=-1,M=-1,x=-1,y=-1,X=!0}function tt(e,t,r,i,o,a,s,h){var l,c,u,f,d,m,v;t?(d=e.length-1,m=-1,v=-1):(d=0,m=e.length,v=1);for(var g=d;g!==m;g+=v)if((l=e[g]).render){if(c=l.object,u=l.buffer,h)f=h;else{if(!(f=l[r]))continue;s&&p.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),p.setDepthTest(f.depthTest),p.setDepthWrite(f.depthWrite),Rt(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}p.setMaterialFaces(f),u instanceof n.BufferGeometry?p.renderBufferDirect(i,o,a,f,u,c):p.renderBuffer(i,o,a,f,u,c)}}function rt(e,t,r,i,n,o,a){for(var s,h,l,c,u=0,f=e.length;u<f;u++)if((h=(s=e[u]).object).visible){if(a)l=a;else{if(!(l=s[t]))continue;o&&p.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),p.setDepthTest(l.depthTest),p.setDepthWrite(l.depthWrite),Rt(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}p.renderImmediateObject(r,i,n,l,h)}}function it(e){var t,r=e.object.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function nt(e){var t=e.object,r=e.buffer,i=t.geometry,o=t.material;if(o instanceof n.MeshFaceMaterial){var a=i instanceof n.BufferGeometry?0:r.materialIndex;(o=o.materials[a]).transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null)}else o&&(o.transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null))}function ot(e,t){var r,i,o,a;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new n.Matrix4,e._normalMatrix=new n.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Te)),void 0===(i=e.geometry));else if(i instanceof n.BufferGeometry)Ge(i);else if(e instanceof n.Mesh)for(r in o=e.material,void 0===i.geometryGroups&&i.makeGroups(o instanceof n.MeshFaceMaterial),i.geometryGroups)(a=i.geometryGroups[r]).__webglVertexBuffer||(Se(a),Oe(a,e),i.verticesNeedUpdate=!0,i.morphTargetsNeedUpdate=!0,i.elementsNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.tangentsNeedUpdate=!0,i.colorsNeedUpdate=!0);else e instanceof n.Line?i.__webglVertexBuffer||(Me(i),ze(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):e instanceof n.ParticleSystem&&(i.__webglVertexBuffer||(_e(i),Ue(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof n.Mesh){if((i=e.geometry)instanceof n.BufferGeometry)at(t.__webglObjects,i,e);else if(i instanceof n.Geometry)for(r in i.geometryGroups)a=i.geometryGroups[r],at(t.__webglObjects,a,e)}else e instanceof n.Line||e instanceof n.ParticleSystem?(i=e.geometry,at(t.__webglObjects,i,e)):e instanceof n.ImmediateRenderObject||e.immediateRenderCallback?st(t.__webglObjectsImmediate,e):e instanceof n.Sprite?t.__webglSprites.push(e):e instanceof n.LensFlare&&t.__webglFlares.push(e);e.__webglActive=!0}}function at(e,t,r){e.push({id:null,buffer:t,object:r,opaque:null,transparent:null,z:0})}function st(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function ht(e){var t=e.geometry,r,i,o;if(t instanceof n.BufferGeometry)Ye(t,Y.DYNAMIC_DRAW);else if(e instanceof n.Mesh){for(var a=0,s=t.geometryGroupsList.length;a<s;a++)o=Ne(e,r=t.geometryGroupsList[a]),t.buffersNeedUpdate&&Oe(r,e),i=o.attributes&&lt(o),(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||i)&&Xe(r,e,Y.DYNAMIC_DRAW,!t.dynamic,o);t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,t.buffersNeedUpdate=!1,o.attributes&&ct(o)}else e instanceof n.Line?(i=(o=Ne(e,t)).attributes&&lt(o),(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||i)&&He(t,Y.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,o.attributes&&ct(o)):e instanceof n.ParticleSystem&&(i=(o=Ne(e,t)).attributes&&lt(o),(t.verticesNeedUpdate||t.colorsNeedUpdate||e.sortParticles||i)&&We(t,Y.DYNAMIC_DRAW,e),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,o.attributes&&ct(o))}function lt(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function ct(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function ut(e,t){e instanceof n.Mesh||e instanceof n.ParticleSystem||e instanceof n.Line?ft(t.__webglObjects,e):e instanceof n.Sprite?pt(t.__webglSprites,e):e instanceof n.LensFlare?pt(t.__webglFlares,e):(e instanceof n.ImmediateRenderObject||e.immediateRenderCallback)&&ft(t.__webglObjectsImmediate,e),delete e.__webglActive}function ft(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function pt(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function dt(e,t){e.uniforms=n.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function mt(e,t,r,i,o){w=0,i.needsUpdate&&(i.program&&Re(i),p.initMaterial(i,t,r,o),i.needsUpdate=!1),i.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(p.maxMorphTargets)));var a=!1,s=i.program,h=s.uniforms,l=i.uniforms;if(s!==v&&(Y.useProgram(s),v=s,a=!0),i.id!==y&&(y=i.id,a=!0),(a||e!==b)&&(Y.uniformMatrix4fv(h.projectionMatrix,!1,e.projectionMatrix.elements),e!==b&&(b=e)),i.skinning)if(ae&&o.useVertexTexture){if(null!==h.boneTexture){var c=Ct();Y.uniform1i(h.boneTexture,c),p.setTexture(o.boneTexture,c)}null!==h.boneTextureWidth&&Y.uniform1i(h.boneTextureWidth,o.boneTextureWidth),null!==h.boneTextureHeight&&Y.uniform1i(h.boneTextureHeight,o.boneTextureHeight)}else null!==h.boneGlobalMatrices&&Y.uniformMatrix4fv(h.boneGlobalMatrices,!1,o.boneMatrices);return a&&(r&&i.fog&&bt(l,r),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i.lights)&&(X&&(Dt(s,t),X=!1),Mt(l,q)),(i instanceof n.MeshBasicMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhongMaterial)&&vt(l,i),i instanceof n.LineBasicMaterial?gt(l,i):i instanceof n.LineDashedMaterial?(gt(l,i),yt(l,i)):i instanceof n.ParticleSystemMaterial?xt(l,i):i instanceof n.MeshPhongMaterial?wt(l,i):i instanceof n.MeshLambertMaterial?_t(l,i):i instanceof n.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=i.opacity):i instanceof n.MeshNormalMaterial&&(l.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&St(l,t),At(s,i.uniformsList),(i instanceof n.ShaderMaterial||i instanceof n.MeshPhongMaterial||i.envMap)&&null!==h.cameraPosition&&(W.setFromMatrixPosition(e.matrixWorld),Y.uniform3f(h.cameraPosition,W.x,W.y,W.z)),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.ShaderMaterial||i.skinning)&&null!==h.viewMatrix&&Y.uniformMatrix4fv(h.viewMatrix,!1,e.matrixWorldInverse.elements)),Tt(h,o),null!==h.modelMatrix&&Y.uniformMatrix4fv(h.modelMatrix,!1,o.matrixWorld.elements),s}function vt(e,t){var r;if(e.opacity.value=t.opacity,p.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap),void 0!==r){var i=r.offset,o=r.repeat;e.offsetRepeat.value.set(i.x,i.y,o.x,o.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof n.WebGLRenderTargetCube?1:-1,p.gammaInput,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof n.CubeRefractionMapping}function gt(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function yt(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function xt(e,r){e.psColor.value=r.color,e.opacity.value=r.opacity,e.size.value=r.size,e.scale.value=t.height/2,e.map.value=r.map}function bt(e,t){e.fogColor.value=t.color,t instanceof n.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof n.FogExp2&&(e.fogDensity.value=t.density)}function wt(e,t){e.shininess.value=t.shininess,p.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function _t(e,t){p.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Mt(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function St(e,t){if(e.shadowMatrix)for(var r=0,i=0,o=t.length;i<o;i++){var a=t[i];a.castShadow&&((a instanceof n.SpotLight||a instanceof n.DirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[r]=a.shadowMap,e.shadowMapSize.value[r]=a.shadowMapSize,e.shadowMatrix.value[r]=a.shadowMatrix,e.shadowDarkness.value[r]=a.shadowDarkness,e.shadowBias.value[r]=a.shadowBias,r++))}}function Tt(e,t){Y.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Y.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function Ct(){var e=w;return e>=ee&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ee),w+=1,e}function At(e,t){var r,i,o,a,s,h,l,c,u,f,d;for(u=0,f=t.length;u<f;u++)if(a=e.uniforms[t[u][1]])if(o=(r=t[u][0]).type,i=r.value,"i"===o)Y.uniform1i(a,i);else if("f"===o)Y.uniform1f(a,i);else if("v2"===o)Y.uniform2f(a,i.x,i.y);else if("v3"===o)Y.uniform3f(a,i.x,i.y,i.z);else if("v4"===o)Y.uniform4f(a,i.x,i.y,i.z,i.w);else if("c"===o)Y.uniform3f(a,i.r,i.g,i.b);else if("iv1"===o)Y.uniform1iv(a,i);else if("iv"===o)Y.uniform3iv(a,i);else if("fv1"===o)Y.uniform1fv(a,i);else if("fv"===o)Y.uniform3fv(a,i);else if("v2v"===o){for(void 0===r._array&&(r._array=new Float32Array(2*i.length)),l=0,c=i.length;l<c;l++)d=2*l,r._array[d]=i[l].x,r._array[d+1]=i[l].y;Y.uniform2fv(a,r._array)}else if("v3v"===o){for(void 0===r._array&&(r._array=new Float32Array(3*i.length)),l=0,c=i.length;l<c;l++)d=3*l,r._array[d]=i[l].x,r._array[d+1]=i[l].y,r._array[d+2]=i[l].z;Y.uniform3fv(a,r._array)}else if("v4v"===o){for(void 0===r._array&&(r._array=new Float32Array(4*i.length)),l=0,c=i.length;l<c;l++)d=4*l,r._array[d]=i[l].x,r._array[d+1]=i[l].y,r._array[d+2]=i[l].z,r._array[d+3]=i[l].w;Y.uniform4fv(a,r._array)}else if("m4"===o)void 0===r._array&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),Y.uniformMatrix4fv(a,!1,r._array);else if("m4v"===o){for(void 0===r._array&&(r._array=new Float32Array(16*i.length)),l=0,c=i.length;l<c;l++)i[l].flattenToArrayOffset(r._array,16*l);Y.uniformMatrix4fv(a,!1,r._array)}else if("t"===o){if(s=i,h=Ct(),Y.uniform1i(a,h),!s)continue;s.image instanceof Array&&6===s.image.length?jt(s,h):s instanceof n.WebGLRenderTargetCube?Gt(s,h):p.setTexture(s,h)}else if("tv"===o){for(void 0===r._array&&(r._array=[]),l=0,c=r.value.length;l<c;l++)r._array[l]=Ct();for(Y.uniform1iv(a,r._array),l=0,c=r.value.length;l<c;l++)s=r.value[l],h=r._array[l],s&&p.setTexture(s,h)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+o)}function Et(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Pt(e,t,r,i){e[t]=r.r*r.r*i,e[t+1]=r.g*r.g*i,e[t+2]=r.b*r.b*i}function Lt(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function Dt(e,t){var r,i,o,a,s=0,h=0,l=0,c,u,f,d,m,v,g,y=q,x=y.directional.colors,b=y.directional.positions,w=y.point.colors,_=y.point.positions,M=y.point.distances,S=y.spot.colors,T=y.spot.positions,C=y.spot.distances,A=y.spot.directions,E=y.spot.anglesCos,P=y.spot.exponents,L=y.hemi.skyColors,D=y.hemi.groundColors,F=y.hemi.positions,R=0,V=0,U=0,z=0,O=0,N=0,B=0,I=0,k=0,j=0,G=0,X=0;for(r=0,i=t.length;r<i;r++)if(!(o=t[r]).onlyShadow)if(c=o.color,d=o.intensity,g=o.distance,o instanceof n.AmbientLight){if(!o.visible)continue;p.gammaInput?(s+=c.r*c.r,h+=c.g*c.g,l+=c.b*c.b):(s+=c.r,h+=c.g,l+=c.b)}else if(o instanceof n.DirectionalLight){if(O+=1,!o.visible)continue;if(H.setFromMatrixPosition(o.matrixWorld),W.setFromMatrixPosition(o.target.matrixWorld),H.sub(W),H.normalize(),0===H.x&&0===H.y&&0===H.z)continue;b[k=3*R]=H.x,b[k+1]=H.y,b[k+2]=H.z,p.gammaInput?Pt(x,k,c,d*d):Lt(x,k,c,d),R+=1}else if(o instanceof n.PointLight){if(N+=1,!o.visible)continue;j=3*V,p.gammaInput?Pt(w,j,c,d*d):Lt(w,j,c,d),W.setFromMatrixPosition(o.matrixWorld),_[j]=W.x,_[j+1]=W.y,_[j+2]=W.z,M[V]=g,V+=1}else if(o instanceof n.SpotLight){if(B+=1,!o.visible)continue;G=3*U,p.gammaInput?Pt(S,G,c,d*d):Lt(S,G,c,d),W.setFromMatrixPosition(o.matrixWorld),T[G]=W.x,T[G+1]=W.y,T[G+2]=W.z,C[U]=g,H.copy(W),W.setFromMatrixPosition(o.target.matrixWorld),H.sub(W),H.normalize(),A[G]=H.x,A[G+1]=H.y,A[G+2]=H.z,E[U]=Math.cos(o.angle),P[U]=o.exponent,U+=1}else if(o instanceof n.HemisphereLight){if(I+=1,!o.visible)continue;if(H.setFromMatrixPosition(o.matrixWorld),H.normalize(),0===H.x&&0===H.y&&0===H.z)continue;F[X=3*z]=H.x,F[X+1]=H.y,F[X+2]=H.z,u=o.color,f=o.groundColor,p.gammaInput?(Pt(L,X,u,m=d*d),Pt(D,X,f,m)):(Lt(L,X,u,d),Lt(D,X,f,d)),z+=1}for(r=3*R,i=Math.max(x.length,3*O);r<i;r++)x[r]=0;for(r=3*V,i=Math.max(w.length,3*N);r<i;r++)w[r]=0;for(r=3*U,i=Math.max(S.length,3*B);r<i;r++)S[r]=0;for(r=3*z,i=Math.max(L.length,3*I);r<i;r++)L[r]=0;for(r=3*z,i=Math.max(D.length,3*I);r<i;r++)D[r]=0;y.directional.length=R,y.point.length=V,y.spot.length=U,y.hemi.length=z,y.ambient[0]=s,y.ambient[1]=h,y.ambient[2]=l}function Ft(e){e!==R&&(Y.lineWidth(e),R=e)}function Rt(e,t,r){L!==e&&(e?Y.enable(Y.POLYGON_OFFSET_FILL):Y.disable(Y.POLYGON_OFFSET_FILL),L=e),!e||D===t&&F===r||(Y.polygonOffset(t,r),D=t,F=r)}function Vt(e){var t,r,i=[];for(var n in e)!1!==(t=e[n])&&(r="#define "+n+" "+t,i.push(r));return i.join("\n")}function Ut(e,t,r,i,a,s,h,l){var c,u,f,v,g,y=[];for(f in e?y.push(e):(y.push(t),y.push(r)),s)y.push(f),y.push(s[f]);for(c in h)y.push(c),y.push(h[c]);for(g=y.join(),c=0,u=d.length;c<u;c++){var x=d[c];if(x.code===g)return x.usedTimes++,x.program}var b="SHADOWMAP_TYPE_BASIC";h.shadowMapType===n.PCFShadowMap?b="SHADOWMAP_TYPE_PCF":h.shadowMapType===n.PCFSoftShadowMap&&(b="SHADOWMAP_TYPE_PCF_SOFT");var w=Vt(s);v=Y.createProgram();var _=["precision "+o+" float;","precision "+o+" int;",w,oe?"#define VERTEX_TEXTURES":"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+b:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),M=["precision "+o+" float;","precision "+o+" int;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",w,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+b:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),S=Bt("vertex",_+r),T=Bt("fragment",M+t),C,A,E,P;for(A in Y.attachShader(v,S),Y.attachShader(v,T),void 0!==l&&Y.bindAttribLocation(v,0,l),Y.linkProgram(v),!1===Y.getProgramParameter(v,Y.LINK_STATUS)&&(console.error("Could not initialise shader"),console.error("gl.VALIDATE_STATUS",Y.getProgramParameter(v,Y.VALIDATE_STATUS)),console.error("gl.getError()",Y.getError())),Y.getProgramInfoLog(v),Y.deleteShader(T),Y.deleteShader(S),v.uniforms={},v.attributes={},C=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],h.useVertexTexture?(C.push("boneTexture"),C.push("boneTextureWidth"),C.push("boneTextureHeight")):C.push("boneGlobalMatrices"),i)C.push(A);for(zt(v,C),C=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],P=0;P<h.maxMorphTargets;P++)C.push("morphTarget"+P);for(P=0;P<h.maxMorphNormals;P++)C.push("morphNormal"+P);for(E in a)C.push(E);return Ot(v,C),v.id=m++,d.push({program:v,code:g,usedTimes:1}),p.info.memory.programs=d.length,v}function zt(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.uniforms[n]=Y.getUniformLocation(e,n)}function Ot(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.attributes[n]=Y.getAttribLocation(e,n)}function Nt(e){for(var t=e.split("\n"),r=0,i=t.length;r<i;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function Bt(e,t){var r;return"fragment"===e?r=Y.createShader(Y.FRAGMENT_SHADER):"vertex"===e&&(r=Y.createShader(Y.VERTEX_SHADER)),Y.shaderSource(r,t),Y.compileShader(r),Y.getShaderParameter(r,Y.COMPILE_STATUS)?r:(console.error(Y.getShaderInfoLog(r)),console.error(Nt(t)),null)}function It(e,t,r){r?(Y.texParameteri(e,Y.TEXTURE_WRAP_S,Yt(t.wrapS)),Y.texParameteri(e,Y.TEXTURE_WRAP_T,Yt(t.wrapT)),Y.texParameteri(e,Y.TEXTURE_MAG_FILTER,Yt(t.magFilter)),Y.texParameteri(e,Y.TEXTURE_MIN_FILTER,Yt(t.minFilter))):(Y.texParameteri(e,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(e,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(e,Y.TEXTURE_MAG_FILTER,qt(t.magFilter)),Y.texParameteri(e,Y.TEXTURE_MIN_FILTER,qt(t.minFilter))),J&&t.type!==n.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Y.texParameterf(e,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,ne)),t.__oldAnisotropy=t.anisotropy)}function kt(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),i=Math.floor(e.width*t/r),n=Math.floor(e.height*t/r),o=document.createElement("canvas"),a;return o.width=i,o.height=n,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i,n),o}function jt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Ce),e.image.__webglTextureCube=Y.createTexture(),p.info.memory.textures++),Y.activeTexture(Y.TEXTURE0+t),Y.bindTexture(Y.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof n.CompressedTexture,i=[],o=0;o<6;o++)p.autoScaleCubemaps&&!r?i[o]=kt(e.image[o],ie):i[o]=e.image[o];var a=i[0],s=n.Math.isPowerOfTwo(a.width)&&n.Math.isPowerOfTwo(a.height),h=Yt(e.format),l=Yt(e.type);It(Y.TEXTURE_CUBE_MAP,e,s);for(var o=0;o<6;o++)if(r)for(var c,u=i[o].mipmaps,f=0,d=u.length;f<d;f++)c=u[f],e.format!==n.RGBAFormat?Y.compressedTexImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,c.width,c.height,0,c.data):Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,c.width,c.height,0,h,l,c.data);else Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,h,h,l,i[o]);e.generateMipmaps&&s&&Y.generateMipmap(Y.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Y.activeTexture(Y.TEXTURE0+t),Y.bindTexture(Y.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function Gt(e,t){Y.activeTexture(Y.TEXTURE0+t),Y.bindTexture(Y.TEXTURE_CUBE_MAP,e.__webglTexture)}function Wt(e,t,r){Y.bindFramebuffer(Y.FRAMEBUFFER,e),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function Ht(e,t){Y.bindRenderbuffer(Y.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_COMPONENT16,t.width,t.height),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_STENCIL,t.width,t.height),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_STENCIL_ATTACHMENT,Y.RENDERBUFFER,e)):Y.renderbufferStorage(Y.RENDERBUFFER,Y.RGBA4,t.width,t.height)}function Xt(e){e instanceof n.WebGLRenderTargetCube?(Y.bindTexture(Y.TEXTURE_CUBE_MAP,e.__webglTexture),Y.generateMipmap(Y.TEXTURE_CUBE_MAP),Y.bindTexture(Y.TEXTURE_CUBE_MAP,null)):(Y.bindTexture(Y.TEXTURE_2D,e.__webglTexture),Y.generateMipmap(Y.TEXTURE_2D),Y.bindTexture(Y.TEXTURE_2D,null))}function qt(e){return e===n.NearestFilter||e===n.NearestMipMapNearestFilter||e===n.NearestMipMapLinearFilter?Y.NEAREST:Y.LINEAR}function Yt(e){if(e===n.RepeatWrapping)return Y.REPEAT;if(e===n.ClampToEdgeWrapping)return Y.CLAMP_TO_EDGE;if(e===n.MirroredRepeatWrapping)return Y.MIRRORED_REPEAT;if(e===n.NearestFilter)return Y.NEAREST;if(e===n.NearestMipMapNearestFilter)return Y.NEAREST_MIPMAP_NEAREST;if(e===n.NearestMipMapLinearFilter)return Y.NEAREST_MIPMAP_LINEAR;if(e===n.LinearFilter)return Y.LINEAR;if(e===n.LinearMipMapNearestFilter)return Y.LINEAR_MIPMAP_NEAREST;if(e===n.LinearMipMapLinearFilter)return Y.LINEAR_MIPMAP_LINEAR;if(e===n.UnsignedByteType)return Y.UNSIGNED_BYTE;if(e===n.UnsignedShort4444Type)return Y.UNSIGNED_SHORT_4_4_4_4;if(e===n.UnsignedShort5551Type)return Y.UNSIGNED_SHORT_5_5_5_1;if(e===n.UnsignedShort565Type)return Y.UNSIGNED_SHORT_5_6_5;if(e===n.ByteType)return Y.BYTE;if(e===n.ShortType)return Y.SHORT;if(e===n.UnsignedShortType)return Y.UNSIGNED_SHORT;if(e===n.IntType)return Y.INT;if(e===n.UnsignedIntType)return Y.UNSIGNED_INT;if(e===n.FloatType)return Y.FLOAT;if(e===n.AlphaFormat)return Y.ALPHA;if(e===n.RGBFormat)return Y.RGB;if(e===n.RGBAFormat)return Y.RGBA;if(e===n.LuminanceFormat)return Y.LUMINANCE;if(e===n.LuminanceAlphaFormat)return Y.LUMINANCE_ALPHA;if(e===n.AddEquation)return Y.FUNC_ADD;if(e===n.SubtractEquation)return Y.FUNC_SUBTRACT;if(e===n.ReverseSubtractEquation)return Y.FUNC_REVERSE_SUBTRACT;if(e===n.ZeroFactor)return Y.ZERO;if(e===n.OneFactor)return Y.ONE;if(e===n.SrcColorFactor)return Y.SRC_COLOR;if(e===n.OneMinusSrcColorFactor)return Y.ONE_MINUS_SRC_COLOR;if(e===n.SrcAlphaFactor)return Y.SRC_ALPHA;if(e===n.OneMinusSrcAlphaFactor)return Y.ONE_MINUS_SRC_ALPHA;if(e===n.DstAlphaFactor)return Y.DST_ALPHA;if(e===n.OneMinusDstAlphaFactor)return Y.ONE_MINUS_DST_ALPHA;if(e===n.DstColorFactor)return Y.DST_COLOR;if(e===n.OneMinusDstColorFactor)return Y.ONE_MINUS_DST_COLOR;if(e===n.SrcAlphaSaturateFactor)return Y.SRC_ALPHA_SATURATE;if(void 0!==$){if(e===n.RGB_S3TC_DXT1_Format)return $.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT1_Format)return $.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT3_Format)return $.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===n.RGBA_S3TC_DXT5_Format)return $.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Kt(e){if(ae&&e&&e.useVertexTexture)return 1024;var t=Y.getParameter(Y.MAX_VERTEX_UNIFORM_VECTORS),r,i=Math.floor((t-20)/4);return void 0!==e&&e instanceof n.SkinnedMesh&&(i=Math.min(e.bones.length,i))<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)"),i}function Qt(e){for(var t=0,r=0,i=0,o=0,a=0,s=e.length;a<s;a++){var h=e[a];h.onlyShadow||!1===h.visible||(h instanceof n.DirectionalLight&&t++,h instanceof n.PointLight&&r++,h instanceof n.SpotLight&&i++,h instanceof n.HemisphereLight&&o++)}return{directional:t,point:r,spot:i,hemi:o}}function Zt(e){for(var t=0,r=0,i=e.length;r<i;r++){var o=e[r];o.castShadow&&(o instanceof n.SpotLight&&t++,o instanceof n.DirectionalLight&&!o.shadowCascade&&t++)}return t}function Jt(){try{var e={alpha:a,premultipliedAlpha:s,antialias:h,stencil:l,preserveDrawingBuffer:c};if(null===(Y=r||t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw"Error creating WebGL context."}catch(e){console.error(e)}K=Y.getExtension("OES_texture_float"),Q=Y.getExtension("OES_texture_float_linear"),Z=Y.getExtension("OES_standard_derivatives"),J=Y.getExtension("EXT_texture_filter_anisotropic")||Y.getExtension("MOZ_EXT_texture_filter_anisotropic")||Y.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),$=Y.getExtension("WEBGL_compressed_texture_s3tc")||Y.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Y.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),K||console.log("THREE.WebGLRenderer: Float textures not supported."),Z||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),J||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),$||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Y.getShaderPrecisionFormat&&(Y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function $t(){Y.clearColor(0,0,0,1),Y.clearDepth(1),Y.clearStencil(0),Y.enable(Y.DEPTH_TEST),Y.depthFunc(Y.LEQUAL),Y.frontFace(Y.CCW),Y.cullFace(Y.BACK),Y.enable(Y.CULL_FACE),Y.enable(Y.BLEND),Y.blendEquation(Y.FUNC_ADD),Y.blendFunc(Y.SRC_ALPHA,Y.ONE_MINUS_SRC_ALPHA),Y.viewport(V,U,z,O),Y.clearColor(u.r,u.g,u.b,f)}this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Y.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Y.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Y.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Y.createBuffer()),e.hasPositions&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglVertexBuffer),Y.bufferData(Y.ARRAY_BUFFER,e.positionArray,Y.DYNAMIC_DRAW),Y.enableVertexAttribArray(t.attributes.position),Y.vertexAttribPointer(t.attributes.position,3,Y.FLOAT,!1,0,0)),e.hasNormals){if(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===n.FlatShading){var i,o,a,s,h,l,c,u,f,p,d,m,v,g,y=3*e.count;for(g=0;g<y;g+=9)s=(v=e.normalArray)[g],c=v[g+1],p=v[g+2],h=v[g+3],u=v[g+4],d=v[g+5],i=(s+h+(l=v[g+6]))/3,o=(c+u+(f=v[g+7]))/3,a=(p+d+(m=v[g+8]))/3,v[g]=i,v[g+1]=o,v[g+2]=a,v[g+3]=i,v[g+4]=o,v[g+5]=a,v[g+6]=i,v[g+7]=o,v[g+8]=a}Y.bufferData(Y.ARRAY_BUFFER,e.normalArray,Y.DYNAMIC_DRAW),Y.enableVertexAttribArray(t.attributes.normal),Y.vertexAttribPointer(t.attributes.normal,3,Y.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglUvBuffer),Y.bufferData(Y.ARRAY_BUFFER,e.uvArray,Y.DYNAMIC_DRAW),Y.enableVertexAttribArray(t.attributes.uv),Y.vertexAttribPointer(t.attributes.uv,2,Y.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==n.NoColors&&(Y.bindBuffer(Y.ARRAY_BUFFER,e.__webglColorBuffer),Y.bufferData(Y.ARRAY_BUFFER,e.colorArray,Y.DYNAMIC_DRAW),Y.enableVertexAttribArray(t.attributes.color),Y.vertexAttribPointer(t.attributes.color,3,Y.FLOAT,!1,0,0)),Y.drawArrays(Y.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,o,a){if(!1!==i.visible){var s,h,l,c,u,f,d,m=mt(e,t,r,i,a),v=m.attributes,g=o.attributes,y=!1,b=i.wireframe?1:0,w=16777215*o.id+2*m.id+b,_;if(w!==x&&(x=w,y=!0),y&&Qe(),a instanceof n.Mesh)if(_=g.index){var M;(M=o.offsets).length>1&&(y=!0);for(var S=0,T=M.length;S<T;S++){var C=M[S].index;if(y){for(u in v)f=v[u],c=g[u],f>=0&&(c?(d=c.itemSize,Y.bindBuffer(Y.ARRAY_BUFFER,c.buffer),Ke(f),Y.vertexAttribPointer(f,d,Y.FLOAT,!1,0,C*d*4)):i.defaultAttributeValues&&(2===i.defaultAttributeValues[u].length?Y.vertexAttrib2fv(f,i.defaultAttributeValues[u]):3===i.defaultAttributeValues[u].length&&Y.vertexAttrib3fv(f,i.defaultAttributeValues[u])));Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,_.buffer)}Y.drawElements(Y.TRIANGLES,M[S].count,Y.UNSIGNED_SHORT,2*M[S].start),p.info.render.calls++,p.info.render.vertices+=M[S].count,p.info.render.faces+=M[S].count/3}}else{if(y)for(u in v)"index"!==u&&(f=v[u],c=g[u],f>=0&&(c?(d=c.itemSize,Y.bindBuffer(Y.ARRAY_BUFFER,c.buffer),Ke(f),Y.vertexAttribPointer(f,d,Y.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[u]&&(2===i.defaultAttributeValues[u].length?Y.vertexAttrib2fv(f,i.defaultAttributeValues[u]):3===i.defaultAttributeValues[u].length&&Y.vertexAttrib3fv(f,i.defaultAttributeValues[u]))));var A=o.attributes.position;Y.drawArrays(Y.TRIANGLES,0,A.array.length/3),p.info.render.calls++,p.info.render.vertices+=A.array.length/3,p.info.render.faces+=A.array.length/3/3}else if(a instanceof n.ParticleSystem){if(y)for(u in v)f=v[u],c=g[u],f>=0&&(c?(d=c.itemSize,Y.bindBuffer(Y.ARRAY_BUFFER,c.buffer),Ke(f),Y.vertexAttribPointer(f,d,Y.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[u]&&(2===i.defaultAttributeValues[u].length?Y.vertexAttrib2fv(f,i.defaultAttributeValues[u]):3===i.defaultAttributeValues[u].length&&Y.vertexAttrib3fv(f,i.defaultAttributeValues[u])));var A=g.position;Y.drawArrays(Y.POINTS,0,A.array.length/3),p.info.render.calls++,p.info.render.points+=A.array.length/3}else if(a instanceof n.Line){var E=a.type===n.LineStrip?Y.LINE_STRIP:Y.LINES,_;if(Ft(i.linewidth),_=g.index){var M;(M=o.offsets).length>1&&(y=!0);for(var S=0,T=M.length;S<T;S++){var C=M[S].index;y&&(qe(i,v,g,C),Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,_.buffer)),Y.drawElements(Y.LINES,M[S].count,Y.UNSIGNED_SHORT,2*M[S].start),p.info.render.calls++,p.info.render.vertices+=M[S].count}}else{y&&qe(i,v,g,0);var A=g.position;Y.drawArrays(E,0,A.array.length/3),p.info.render.calls++,p.info.render.points+=A.array.length}}}},this.renderBuffer=function(e,t,r,i,o,a){if(!1!==i.visible){var s,h,l,c,u,f=mt(e,t,r,i,a),d=f.attributes,m=!1,v=i.wireframe?1:0,g=16777215*o.id+2*f.id+v;if(g!==x&&(x=g,m=!0),m&&Qe(),!i.morphTargets&&d.position>=0?m&&(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglVertexBuffer),Ke(d.position),Y.vertexAttribPointer(d.position,3,Y.FLOAT,!1,0,0)):a.morphTargetBase&&Ze(i,o,a),m){if(o.__webglCustomAttributesList)for(c=0,u=o.__webglCustomAttributesList.length;c<u;c++)d[(l=o.__webglCustomAttributesList[c]).buffer.belongsToAttribute]>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,l.buffer),Ke(d[l.buffer.belongsToAttribute]),Y.vertexAttribPointer(d[l.buffer.belongsToAttribute],l.size,Y.FLOAT,!1,0,0));d.color>=0&&(a.geometry.colors.length>0||a.geometry.faces.length>0?(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglColorBuffer),Ke(d.color),Y.vertexAttribPointer(d.color,3,Y.FLOAT,!1,0,0)):i.defaultAttributeValues&&Y.vertexAttrib3fv(d.color,i.defaultAttributeValues.color)),d.normal>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglNormalBuffer),Ke(d.normal),Y.vertexAttribPointer(d.normal,3,Y.FLOAT,!1,0,0)),d.tangent>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglTangentBuffer),Ke(d.tangent),Y.vertexAttribPointer(d.tangent,4,Y.FLOAT,!1,0,0)),d.uv>=0&&(a.geometry.faceVertexUvs[0]?(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglUVBuffer),Ke(d.uv),Y.vertexAttribPointer(d.uv,2,Y.FLOAT,!1,0,0)):i.defaultAttributeValues&&Y.vertexAttrib2fv(d.uv,i.defaultAttributeValues.uv)),d.uv2>=0&&(a.geometry.faceVertexUvs[1]?(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglUV2Buffer),Ke(d.uv2),Y.vertexAttribPointer(d.uv2,2,Y.FLOAT,!1,0,0)):i.defaultAttributeValues&&Y.vertexAttrib2fv(d.uv2,i.defaultAttributeValues.uv2)),i.skinning&&d.skinIndex>=0&&d.skinWeight>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),Ke(d.skinIndex),Y.vertexAttribPointer(d.skinIndex,4,Y.FLOAT,!1,0,0),Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),Ke(d.skinWeight),Y.vertexAttribPointer(d.skinWeight,4,Y.FLOAT,!1,0,0)),d.lineDistance>=0&&(Y.bindBuffer(Y.ARRAY_BUFFER,o.__webglLineDistanceBuffer),Ke(d.lineDistance),Y.vertexAttribPointer(d.lineDistance,1,Y.FLOAT,!1,0,0))}if(a instanceof n.Mesh)i.wireframe?(Ft(i.wireframeLinewidth),m&&Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),Y.drawElements(Y.LINES,o.__webglLineCount,Y.UNSIGNED_SHORT,0)):(m&&Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),Y.drawElements(Y.TRIANGLES,o.__webglFaceCount,Y.UNSIGNED_SHORT,0)),p.info.render.calls++,p.info.render.vertices+=o.__webglFaceCount,p.info.render.faces+=o.__webglFaceCount/3;else if(a instanceof n.Line){var y=a.type===n.LineStrip?Y.LINE_STRIP:Y.LINES;Ft(i.linewidth),Y.drawArrays(y,0,o.__webglLineCount),p.info.render.calls++}else a instanceof n.ParticleSystem&&(Y.drawArrays(Y.POINTS,0,o.__webglParticleCount),p.info.render.calls++,p.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,r,i){if(t instanceof n.Camera!=!1){var o,a,s,h,l,c=e.__lights,u=e.fog;for(y=-1,X=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),k.setFromMatrix(j),this.autoUpdateObjects&&this.initWebGLObjects(e),et(this.renderPluginsPre,e,t),p.info.render.calls=0,p.info.render.vertices=0,p.info.render.faces=0,p.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),o=0,a=(l=e.__webglObjects).length;o<a;o++)h=(s=l[o]).object,s.id=o,s.render=!1,h.visible&&((h instanceof n.Mesh||h instanceof n.ParticleSystem)&&h.frustumCulled&&!k.intersectsObject(h)||(Et(h,t),nt(s),s.render=!0,!0===this.sortObjects&&(null!==h.renderDepth?s.z=h.renderDepth:(W.setFromMatrixPosition(h.matrixWorld),W.applyProjection(j),s.z=W.z))));for(this.sortObjects&&l.sort(Je),o=0,a=(l=e.__webglObjectsImmediate).length;o<a;o++)(h=(s=l[o]).object).visible&&(Et(h,t),it(s));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),Rt(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),tt(e.__webglObjects,!1,"",t,c,u,!0,f),rt(e.__webglObjectsImmediate,"",t,c,u,!1,f)}else{var f=null;this.setBlending(n.NoBlending),tt(e.__webglObjects,!0,"opaque",t,c,u,!1,f),rt(e.__webglObjectsImmediate,"opaque",t,c,u,!1,f),tt(e.__webglObjects,!1,"transparent",t,c,u,!0,f),rt(e.__webglObjectsImmediate,"transparent",t,c,u,!0,f)}et(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==n.NearestFilter&&r.minFilter!==n.LinearFilter&&Xt(r),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,r,i,n){var o=mt(e,t,r,i,n);x=-1,p.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(o,Y,k):n.render(function(e){p.renderBufferImmediate(e,o,i)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)ot(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)ut(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;t<r;t++){var i=e.__webglObjects[t].object;void 0===i.__webglInit&&(void 0!==i.__webglActive&&ut(i,e),ot(i,e)),ht(i)}},this.initMaterial=function(e,t,r,i){var o,a,s,h,l,c,u,f,p;e.addEventListener("dispose",Ee),e instanceof n.MeshDepthMaterial?p="depth":e instanceof n.MeshNormalMaterial?p="normal":e instanceof n.MeshBasicMaterial?p="basic":e instanceof n.MeshLambertMaterial?p="lambert":e instanceof n.MeshPhongMaterial?p="phong":e instanceof n.LineBasicMaterial?p="basic":e instanceof n.LineDashedMaterial?p="dashed":e instanceof n.ParticleSystemMaterial&&(p="particle_basic"),p&&dt(e,n.ShaderLib[p]),c=Qt(t),f=Zt(t),u=Kt(i),l={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof n.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:u,useVertexTexture:ae&&i&&i.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:c.directional,maxPointLights:c.point,maxSpotLights:c.spot,maxHemiLights:c.hemi,maxShadows:f,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow&&f>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===n.DoubleSide,flipSided:e.side===n.BackSide},e.program=Ut(p,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,l,e.index0AttributeName);var d=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var m,v="morphTarget";for(h=0;h<this.maxMorphTargets;h++)d[m=v+h]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var m,v="morphNormal";for(h=0;h<this.maxMorphNormals;h++)d[m=v+h]>=0&&e.numSupportedMorphNormals++}for(o in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[o],o])},this.setFaceCulling=function(e,t){e===n.CullFaceNone?Y.disable(Y.CULL_FACE):(t===n.FrontFaceDirectionCW?Y.frontFace(Y.CW):Y.frontFace(Y.CCW),e===n.CullFaceBack?Y.cullFace(Y.BACK):e===n.CullFaceFront?Y.cullFace(Y.FRONT):Y.cullFace(Y.FRONT_AND_BACK),Y.enable(Y.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===n.DoubleSide,r=e.side===n.BackSide;_!==t&&(t?Y.disable(Y.CULL_FACE):Y.enable(Y.CULL_FACE),_=t),M!==r&&(r?Y.frontFace(Y.CW):Y.frontFace(Y.CCW),M=r)},this.setDepthTest=function(e){E!==e&&(e?Y.enable(Y.DEPTH_TEST):Y.disable(Y.DEPTH_TEST),E=e)},this.setDepthWrite=function(e){P!==e&&(Y.depthMask(e),P=e)},this.setBlending=function(e,t,r,i){e!==S&&(e===n.NoBlending?Y.disable(Y.BLEND):e===n.AdditiveBlending?(Y.enable(Y.BLEND),Y.blendEquation(Y.FUNC_ADD),Y.blendFunc(Y.SRC_ALPHA,Y.ONE)):e===n.SubtractiveBlending?(Y.enable(Y.BLEND),Y.blendEquation(Y.FUNC_ADD),Y.blendFunc(Y.ZERO,Y.ONE_MINUS_SRC_COLOR)):e===n.MultiplyBlending?(Y.enable(Y.BLEND),Y.blendEquation(Y.FUNC_ADD),Y.blendFunc(Y.ZERO,Y.SRC_COLOR)):e===n.CustomBlending?Y.enable(Y.BLEND):(Y.enable(Y.BLEND),Y.blendEquationSeparate(Y.FUNC_ADD,Y.FUNC_ADD),Y.blendFuncSeparate(Y.SRC_ALPHA,Y.ONE_MINUS_SRC_ALPHA,Y.ONE,Y.ONE_MINUS_SRC_ALPHA)),S=e),e===n.CustomBlending?(t!==T&&(Y.blendEquation(Yt(t)),T=t),r===C&&i===A||(Y.blendFunc(Yt(r),Yt(i)),C=r,A=i)):(T=null,C=null,A=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Ce),e.__webglTexture=Y.createTexture(),p.info.memory.textures++),Y.activeTexture(Y.TEXTURE0+t),Y.bindTexture(Y.TEXTURE_2D,e.__webglTexture),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,e.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=n.Math.isPowerOfTwo(r.width)&&n.Math.isPowerOfTwo(r.height),o=Yt(e.format),a=Yt(e.type);It(Y.TEXTURE_2D,e,i);var s,h=e.mipmaps;if(e instanceof n.DataTexture)if(h.length>0&&i){for(var l=0,c=h.length;l<c;l++)s=h[l],Y.texImage2D(Y.TEXTURE_2D,l,o,s.width,s.height,0,o,a,s.data);e.generateMipmaps=!1}else Y.texImage2D(Y.TEXTURE_2D,0,o,r.width,r.height,0,o,a,r.data);else if(e instanceof n.CompressedTexture)for(var l=0,c=h.length;l<c;l++)s=h[l],e.format!==n.RGBAFormat?Y.compressedTexImage2D(Y.TEXTURE_2D,l,o,s.width,s.height,0,s.data):Y.texImage2D(Y.TEXTURE_2D,l,o,s.width,s.height,0,o,a,s.data);else if(h.length>0&&i){for(var l=0,c=h.length;l<c;l++)s=h[l],Y.texImage2D(Y.TEXTURE_2D,l,o,o,a,s);e.generateMipmaps=!1}else Y.texImage2D(Y.TEXTURE_2D,0,o,o,a,e.image);e.generateMipmaps&&i&&Y.generateMipmap(Y.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Y.activeTexture(Y.TEXTURE0+t),Y.bindTexture(Y.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof n.WebGLRenderTargetCube,r,i,o,a,s;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Ae),e.__webglTexture=Y.createTexture(),p.info.memory.textures++;var h=n.Math.isPowerOfTwo(e.width)&&n.Math.isPowerOfTwo(e.height),l=Yt(e.format),c=Yt(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Y.bindTexture(Y.TEXTURE_CUBE_MAP,e.__webglTexture),It(Y.TEXTURE_CUBE_MAP,e,h);for(var u=0;u<6;u++)e.__webglFramebuffer[u]=Y.createFramebuffer(),e.__webglRenderbuffer[u]=Y.createRenderbuffer(),Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,l,e.width,e.height,0,l,c,null),Wt(e.__webglFramebuffer[u],e,Y.TEXTURE_CUBE_MAP_POSITIVE_X+u),Ht(e.__webglRenderbuffer[u],e);h&&Y.generateMipmap(Y.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Y.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=Y.createRenderbuffer(),Y.bindTexture(Y.TEXTURE_2D,e.__webglTexture),It(Y.TEXTURE_2D,e,h),Y.texImage2D(Y.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),Wt(e.__webglFramebuffer,e,Y.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_STENCIL_ATTACHMENT,Y.RENDERBUFFER,e.__webglRenderbuffer):Ht(e.__webglRenderbuffer,e),h&&Y.generateMipmap(Y.TEXTURE_2D);t?Y.bindTexture(Y.TEXTURE_CUBE_MAP,null):Y.bindTexture(Y.TEXTURE_2D,null),Y.bindRenderbuffer(Y.RENDERBUFFER,null),Y.bindFramebuffer(Y.FRAMEBUFFER,null)}e?(r=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,o=e.height,a=0,s=0):(r=null,i=z,o=O,a=V,s=U),r!==g&&(Y.bindFramebuffer(Y.FRAMEBUFFER,r),Y.viewport(a,s,i,o),g=r),N=i,B=o},this.shadowMapPlugin=new n.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new n.SpritePlugin),this.addPostPlugin(new n.LensFlarePlugin)},n.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:n.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:n.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:n.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.format=void 0!==r.format?r.format:n.RGBAFormat,this.type=void 0!==r.type?r.type:n.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},n.WebGLRenderTarget.prototype={constructor:n.WebGLRenderTarget,clone:function(){var e=new n.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube=function(e,t,r){n.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype),n.RenderableVertex=function(){this.position=new n.Vector3,this.positionWorld=new n.Vector3,this.positionScreen=new n.Vector4,this.visible=!0},n.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},n.RenderableFace=function(){this.id=0,this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.v3=new n.RenderableVertex,this.centroidModel=new n.Vector3,this.normalModel=new n.Vector3,this.vertexNormalsModel=[new n.Vector3,new n.Vector3,new n.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=0},n.RenderableObject=function(){this.id=0,this.object=null,this.z=0},n.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new n.Vector2,this.material=null},n.RenderableLine=function(){this.id=0,this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.vertexColors=[new n.Color,new n.Color],this.material=null,this.z=0},n.GeometryUtils={merge:function(e,t,r){var i,o,a=e.vertices.length,s=e.faceVertexUvs[0].length,h=t instanceof n.Mesh?t.geometry:t,l=e.vertices,c=h.vertices,u=e.faces,f=h.faces,p=e.faceVertexUvs[0],d=h.faceVertexUvs[0];void 0===r&&(r=0),t instanceof n.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,o=(new n.Matrix3).getNormalMatrix(i));for(var m=0,v=c.length;m<v;m++){var g,y=c[m].clone();i&&y.applyMatrix4(i),l.push(y)}for(m=0,v=f.length;m<v;m++){var x=f[m],b,w,_,M=x.vertexNormals,S=x.vertexColors;(b=new n.Face3(x.a+a,x.b+a,x.c+a)).normal.copy(x.normal),o&&b.normal.applyMatrix3(o).normalize();for(var T=0,C=M.length;T<C;T++)w=M[T].clone(),o&&w.applyMatrix3(o).normalize(),b.vertexNormals.push(w);b.color.copy(x.color);for(var T=0,C=S.length;T<C;T++)_=S[T],b.vertexColors.push(_.clone());b.materialIndex=x.materialIndex+r,b.centroid.copy(x.centroid),i&&b.centroid.applyMatrix4(i),u.push(b)}for(m=0,v=d.length;m<v;m++){for(var A=d[m],E=[],T=0,C=A.length;T<C;T++)E.push(new n.Vector2(A[T].x,A[T].y));p.push(E)}},randomPointInTriangle:function(){var e=new n.Vector3;return function(t,r,i){var o=new n.Vector3,a=n.Math.random16(),s=n.Math.random16();a+s>1&&(a=1-a,s=1-s);var h=1-a-s;return o.copy(t),o.multiplyScalar(a),e.copy(r),e.multiplyScalar(s),o.add(e),e.copy(i),e.multiplyScalar(h),o.add(e),o}}(),randomPointInFace:function(e,t,r){var i,o,a,s;return i=t.vertices[e.a],o=t.vertices[e.b],a=t.vertices[e.c],n.GeometryUtils.randomPointInTriangle(i,o,a)},randomPointsInGeometry:function(e,t){var r,i,o=e.faces,a=e.vertices,s=o.length,h=0,l=[],c,u,f,p;for(i=0;i<s;i++)c=a[(r=o[i]).a],u=a[r.b],f=a[r.c],r._area=n.GeometryUtils.triangleArea(c,u,f),h+=r._area,l[i]=h;function d(e){function t(r,i){if(i<r)return r;var n=r+Math.floor((i-r)/2);return l[n]>e?t(r,n-1):l[n]<e?t(n+1,i):n}var r;return t(0,l.length-1)}var m,v,g=[],y={};for(i=0;i<t;i++)v=d(m=n.Math.random16()*h),g[i]=n.GeometryUtils.randomPointInFace(o[v],e,!0),y[v]?y[v]+=1:y[v]=1;return g},triangleArea:(k=new n.Vector3,j=new n.Vector3,function(e,t,r){return k.subVectors(t,e),j.subVectors(r,e),k.cross(j),.5*k.length()}),center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new n.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new n.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},triangulateQuads:function(e){var t,r,i,n,o=[],a=[];for(t=0,r=e.faceVertexUvs.length;t<r;t++)a[t]=[];for(t=0,r=e.faces.length;t<r;t++){var s=e.faces[t];for(o.push(s),i=0,n=e.faceVertexUvs.length;i<n;i++)a[i].push(e.faceVertexUvs[i][t])}e.faces=o,e.faceVertexUvs=a,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},n.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){var o=new n.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new n.Texture(void 0,t),s=o.load(e,function(){a.needsUpdate=!0,r&&r(a)});return a.image=s,a.sourceFile=e,a},loadCompressedTexture:function(e,t,r,i){var o=new n.CompressedTexture;o.mapping=t;var a=new XMLHttpRequest;return a.onload=function(){var e=a.response,t=n.ImageUtils.parseDDS(e,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,r&&r(o)},a.onerror=i,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),o},loadTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.Texture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1;for(var s=0,h=e.length;s<h;++s){var l=new Image;o[s]=l,l.onload=function(){o.loadCount+=1,6===o.loadCount&&(a.needsUpdate=!0,r&&r(a))},l.onerror=i,l.crossOrigin=this.crossOrigin,l.src=e[s]}return a},loadCompressedTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.CompressedTexture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var s=function(e,t){return function(){var i=e.response,s=n.ImageUtils.parseDDS(i,!0);t.format=s.format,t.mipmaps=s.mipmaps,t.width=s.width,t.height=s.height,o.loadCount+=1,6===o.loadCount&&(a.format=s.format,a.needsUpdate=!0,r&&r(a))}};if(e instanceof Array)for(var h=0,l=e.length;h<l;++h){var c={},u;o[h]=c,(u=new XMLHttpRequest).onload=s(u,c),u.onerror=i;var f=e[h];u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}else{var f=e,u;(u=new XMLHttpRequest).onload=function(){var e=u.response,t=n.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,s=0;s<i;s++){o[s]={mipmaps:[]};for(var h=0;h<t.mipmapCount;h++)o[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+h]),o[s].format=t.format,o[s].width=t.width,o[s].height=t.height}a.format=t.format,a.needsUpdate=!0,r&&r(a)}},u.onerror=i,u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}return a},loadDDSTexture:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.CompressedTexture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var s=new XMLHttpRequest;return s.onload=function(){var e=s.response,t=n.ImageUtils.parseDDS(e,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,h=0;h<i;h++){o[h]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)o[h].mipmaps.push(t.mipmaps[h*t.mipmapCount+l]),o[h].format=t.format,o[h].width=t.width,o[h].height=t.height}else a.image.width=t.width,a.image.height=t.height,a.mipmaps=t.mipmaps;a.format=t.format,a.needsUpdate=!0,r&&r(a)},s.onerror=i,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),a},parseDDS:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},i=542327876,o=1,a=2,s=4,h=8,l=4096,c=131072,u=524288,f=8388608,p=8,d=4194304,m=4096,v=512,g=1024,y=2048,x=4096,b=8192,w=16384,_=32768,M=2097152,S=1,T=2,C=4,A=64,E=512,P=131072;function L(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function D(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function F(e,t,r,i){for(var n=r*i*4,o=new Uint8Array(e,t,n),a=new Uint8Array(n),s=0,h=0,l=0;l<i;l++)for(var c=0;c<r;c++){var u=o[h],f=o[++h],p=o[++h],d=o[++h];h++,a[s]=p,a[++s]=f,a[++s]=u,a[++s]=d,s++}return a}var R=L("DXT1"),V=L("DXT3"),U=L("DXT5"),z,O=0,N=1,B=2,I=3,k=4,j=7,G=20,W=21,H=22,X=23,q=24,Y=25,K=26,Q=27,Z=28,J=29,$=30,ee=new Int32Array(e,0,31),te;if(ee[0]!==i)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!ee[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var re=ee[21],ie=!1;switch(re){case R:te=8,r.format=n.RGB_S3TC_DXT1_Format;break;case V:te=16,r.format=n.RGBA_S3TC_DXT3_Format;break;case U:te=16,r.format=n.RGBA_S3TC_DXT5_Format;break;default:if(!(32==ee[22]&&16711680&ee[23]&&65280&ee[24]&&255&ee[25]&&4278190080&ee[26]))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",D(re)),r;ie=!0,te=64,r.format=n.RGBAFormat}r.mipmapCount=1,ee[2]&c&&!1!==t&&(r.mipmapCount=Math.max(1,ee[7])),r.isCubemap=!!(ee[28]&v),r.width=ee[4],r.height=ee[3];for(var ne=ee[1]+4,oe=r.width,ae=r.height,se=r.isCubemap?6:1,he=0;he<se;he++){for(var le=0;le<r.mipmapCount;le++){if(ie)var ce,ue=(ce=F(e,ne,oe,ae)).length;else var ue=Math.max(4,oe)/4*Math.max(4,ae)/4*te,ce=new Uint8Array(e,ne,ue);var fe={data:ce,width:oe,height:ae};r.mipmaps.push(fe),ne+=ue,oe=Math.max(.5*oe,1),ae=Math.max(.5*ae,1)}oe=r.width,ae=r.height}return r},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var h=s.getContext("2d");h.drawImage(e,0,0);for(var l=h.getImageData(0,0,o,a).data,c=h.createImageData(o,a),u=c.data,f=0;f<o;f++)for(var p=0;p<a;p++){var d=p-1<0?0:p-1,m=p+1>a-1?a-1:p+1,v=f-1<0?0:f-1,g=f+1>o-1?o-1:f+1,y=[],x=[0,0,l[4*(p*o+f)]/255*t];y.push([-1,0,l[4*(p*o+v)]/255*t]),y.push([-1,-1,l[4*(d*o+v)]/255*t]),y.push([0,-1,l[4*(d*o+f)]/255*t]),y.push([1,-1,l[4*(d*o+g)]/255*t]),y.push([1,0,l[4*(p*o+g)]/255*t]),y.push([1,1,l[4*(m*o+g)]/255*t]),y.push([0,1,l[4*(m*o+f)]/255*t]),y.push([-1,1,l[4*(m*o+v)]/255*t]);for(var b=[],w=y.length,_=0;_<w;_++){var M=y[_],S=y[(_+1)%w];M=i(M,x),S=i(S,x),b.push(n(r(M,S)))}for(var T=[0,0,0],_=0;_<b.length;_++)T[0]+=b[_][0],T[1]+=b[_][1],T[2]+=b[_][2];T[0]/=b.length,T[1]/=b.length,T[2]/=b.length;var C=4*(p*o+f);u[C]=(T[0]+1)/2*255|0,u[C+1]=(T[1]+1)/2*255|0,u[C+2]=255*T[2]|0,u[C+3]=255}return h.putImageData(c,0,0),s},generateDataTexture:function(e,t,r){for(var i=e*t,o=new Uint8Array(3*i),a=Math.floor(255*r.r),s=Math.floor(255*r.g),h=Math.floor(255*r.b),l=0;l<i;l++)o[3*l]=a,o[3*l+1]=s,o[3*l+2]=h;var c=new n.DataTexture(o,e,t,n.RGBFormat);return c.needsUpdate=!0,c}},n.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new n.Object3D,i=0,o=t.length;i<o;i++)r.add(new n.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new n.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},n.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var i=r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],r=[],i,o,a=this.getFace(),s=this.size/a.resolution,h=0,l=String(e).split(""),c=l.length,u=[],f;for(i=0;i<c;i++){var p=new n.Path,d=this.extractGlyphPoints(l[i],a,s,h,p);h+=d.offset,u.push(d.path)}return{paths:u,offset:h/2}},extractGlyphPoints:function(e,t,r,i,o){var a=[],s,h,l,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C=t.glyphs[e]||t.glyphs["?"];if(C){if(C.o)for(f=(c=C._cachedOutline||(C._cachedOutline=C.o.split(" "))).length,p=r,d=r,s=0;s<f;)switch(u=c[s++]){case"m":m=c[s++]*p+i,v=c[s++]*d,o.moveTo(m,v);break;case"l":m=c[s++]*p+i,v=c[s++]*d,o.lineTo(m,v);break;case"q":if(g=c[s++]*p+i,y=c[s++]*d,w=c[s++]*p+i,_=c[s++]*d,o.quadraticCurveTo(w,_,g,y),T=a[a.length-1])for(x=T.x,b=T.y,h=1,l=this.divisions;h<=l;h++)var A=h/l,E=n.Shape.Utils.b2(A,x,w,g),P=n.Shape.Utils.b2(A,b,_,y);break;case"b":if(g=c[s++]*p+i,y=c[s++]*d,w=c[s++]*p+i,_=c[s++]*-d,M=c[s++]*p+i,S=c[s++]*-d,o.bezierCurveTo(g,y,w,_,M,S),T=a[a.length-1])for(x=T.x,b=T.y,h=1,l=this.divisions;h<=l;h++)var A=h/l,E=n.Shape.Utils.b3(A,x,w,M,g),P=n.Shape.Utils.b3(A,b,_,S,y);break}return{offset:C.ha*r,path:o}}}},n.FontUtils.generateShapes=function(e,t){var r=void 0!==(t=t||{}).size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",a=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";n.FontUtils.size=r,n.FontUtils.divisions=i,n.FontUtils.face=o,n.FontUtils.weight=a,n.FontUtils.style=s;for(var h,l=n.FontUtils.drawText(e).paths,c=[],u=0,f=l.length;u<f;u++)Array.prototype.push.apply(c,l[u].toShapes());return c},G=n.FontUtils,W=1e-10,H=function(e,t){var r=e.length;if(r<3)return null;var i=[],n=[],o=[],a,s,h;if(X(e)>0)for(s=0;s<r;s++)n[s]=s;else for(s=0;s<r;s++)n[s]=r-1-s;var l=r,c=2*l;for(s=l-1;l>2;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),t?o:i;if(l<=(a=s)&&(a=0),l<=(s=a+1)&&(s=0),l<=(h=s+1)&&(h=0),q(e,a,s,h,l,n)){var u,f,p,d,m;for(u=n[a],f=n[s],p=n[h],i.push([e[u],e[f],e[p]]),o.push([n[a],n[s],n[h]]),d=s,m=s+1;m<l;d++,m++)n[d]=n[m];c=2*--l}}return t?o:i},X=function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},q=function(e,t,r,i,n,o){var a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w,_,M,S,T,C,A,E,P;if(s=e[o[t]].x,h=e[o[t]].y,l=e[o[r]].x,c=e[o[r]].y,u=e[o[i]].x,f=e[o[i]].y,W>(l-s)*(f-h)-(c-h)*(u-s))return!1;for(m=u-l,v=f-c,g=s-u,y=h-f,x=l-s,b=c-h,a=0;a<n;a++)if(p=e[o[a]].x,d=e[o[a]].y,!(p===s&&d===h||p===l&&d===c||p===u&&d===f)&&(P=m*(S=d-c)-v*(M=p-l))>=-1e-10&&(E=g*(C=d-f)-y*(T=p-u))>=-1e-10&&(A=x*(_=d-h)-b*(w=p-s))>=-1e-10)return!1;return!0},G.Triangulate=H,G.Triangulate.area=X,i._typeface_js={faces:n.FontUtils.faces,loadFace:n.FontUtils.loadFace},n.typeface_js=i._typeface_js,n.Curve=function(){},n.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},n.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},n.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},n.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},n.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},n.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],r,i=this.getPoint(0),n,o=0;for(t.push(0),n=1;n<=e;n++)o+=(r=this.getPoint(n/e)).distanceTo(i),t.push(o),i=r;return this.cacheArcLengths=t,t},n.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},n.Curve.prototype.getUtoTmapping=function(e,t){var r=this.getLengths(),i=0,n=r.length,o;o=t||e*r[n-1];for(var a=0,s=n-1,h,l;a<=s;)if((h=r[i=Math.floor(a+(s-a)/2)]-o)<0)a=i+1;else{if(!(h>0)){s=i;break}s=i-1}if(r[i=s]==o)return l=i/(n-1);var c=r[i],u,f,p,l;return l=(i+(o-c)/(r[i+1]-c))/(n-1)},n.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,i=e+t;r<0&&(r=0),i>1&&(i=1);var n=this.getPoint(r),o,a;return this.getPoint(i).clone().sub(n).normalize()},n.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},n.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var o,a,s,h;return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,h;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}},n.Curve.create=function(e,t){return e.prototype=Object.create(n.Curve.prototype),e.prototype.getPoint=t,e},n.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},n.CurvePath.prototype=Object.create(n.Curve.prototype),n.CurvePath.prototype.add=function(e){this.curves.push(e)},n.CurvePath.prototype.checkConnection=function(){},n.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new n.LineCurve(t,e))},n.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0,n,o;i<r.length;){if(r[i]>=t){var a=1-(n=r[i]-t)/(o=this.curves[i]).getLength();return o.getPointAt(a);break}i++}return null},n.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,r,i=this.curves.length;for(r=0;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},n.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,r,i,o,a,s,h,l,c,u;t=r=Number.NEGATIVE_INFINITY,o=a=Number.POSITIVE_INFINITY;var f=e[0]instanceof n.Vector3;for(u=f?new n.Vector3:new n.Vector2,l=0,c=e.length;l<c;l++)(h=e[l]).x>t?t=h.x:h.x<o&&(o=h.x),h.y>r?r=h.y:h.y<a&&(a=h.y),f&&(h.z>i?i=h.z:h.z<s&&(s=h.z)),u.add(h);var p={minX:o,minY:a,maxX:t,maxY:r,centroid:u.divideScalar(c)};return f&&(p.maxZ=i,p.minZ=s),p},n.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createGeometry=function(e){for(var t=new n.Geometry,r=0;r<e.length;r++)t.vertices.push(new n.Vector3(e[r].x,e[r].y,e[r].z||0));return t},n.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},n.CurvePath.prototype.getTransformedPoints=function(e,t){var r=this.getPoints(e),i,n;for(t||(t=this.bends),i=0,n=t.length;i<n;i++)r=this.getWrapPoints(r,t[i]);return r},n.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r=this.getSpacedPoints(e),i,n;for(t||(t=this.bends),i=0,n=t.length;i<n;i++)r=this.getWrapPoints(r,t[i]);return r},n.CurvePath.prototype.getWrapPoints=function(e,t){var r=this.getBoundingBox(),i,n,o,a,s,h;for(i=0,n=e.length;i<n;i++){a=(o=e[i]).x,s=o.y,h=a/r.maxX,h=t.getUtoTmapping(h,a);var l=t.getPoint(h),c=t.getTangent(h);c.set(-c.y,c.x).multiplyScalar(s),o.x=l.x+c.x,o.y=l.y+c.y}return e},n.Gyroscope=function(){n.Object3D.call(this)},n.Gyroscope.prototype=Object.create(n.Object3D.prototype),n.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},n.Gyroscope.prototype.translationWorld=new n.Vector3,n.Gyroscope.prototype.translationObject=new n.Vector3,n.Gyroscope.prototype.quaternionWorld=new n.Quaternion,n.Gyroscope.prototype.quaternionObject=new n.Quaternion,n.Gyroscope.prototype.scaleWorld=new n.Vector3,n.Gyroscope.prototype.scaleObject=new n.Vector3,n.Path=function(e){n.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},n.Path.prototype=Object.create(n.CurvePath.prototype),n.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},n.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},n.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:n.PathActions.MOVE_TO,args:r})},n.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,o=i[i.length-2],a=i[i.length-1],s=new n.LineCurve(new n.Vector2(o,a),new n.Vector2(e,t));this.curves.push(s),this.actions.push({action:n.PathActions.LINE_TO,args:r})},n.Path.prototype.quadraticCurveTo=function(e,t,r,i){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1],l=new n.QuadraticBezierCurve(new n.Vector2(s,h),new n.Vector2(e,t),new n.Vector2(r,i));this.curves.push(l),this.actions.push({action:n.PathActions.QUADRATIC_CURVE_TO,args:o})},n.Path.prototype.bezierCurveTo=function(e,t,r,i,o,a){var s=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,l=h[h.length-2],c=h[h.length-1],u=new n.CubicBezierCurve(new n.Vector2(l,c),new n.Vector2(e,t),new n.Vector2(r,i),new n.Vector2(o,a));this.curves.push(u),this.actions.push({action:n.PathActions.BEZIER_CURVE_TO,args:s})},n.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],a=[new n.Vector2(i,o)];Array.prototype.push.apply(a,e);var s=new n.SplineCurve(a);this.curves.push(s),this.actions.push({action:n.PathActions.CSPLINE_THRU,args:t})},n.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(e+s,t+h,r,i,n,o)},n.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},n.Path.prototype.ellipse=function(e,t,r,i,n,o,a){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1];this.absellipse(e+h,t+l,r,i,n,o,a)},n.Path.prototype.absellipse=function(e,t,r,i,o,a,s){var h=Array.prototype.slice.call(arguments),l=new n.EllipseCurve(e,t,r,i,o,a,s);this.curves.push(l);var c=l.getPoint(1);h.push(c.x),h.push(c.y),this.actions.push({action:n.PathActions.ELLIPSE,args:h})},n.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;i<e;i++)r.push(this.getPoint(i/e));return r},n.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r=[],i,o,a,s,h,l,c,u,f,p,d,m,v,g,y,x,b,w;for(i=0,o=this.actions.length;i<o;i++)switch(s=(a=this.actions[i]).action,h=a.args,s){case n.PathActions.MOVE_TO:r.push(new n.Vector2(h[0],h[1]));break;case n.PathActions.LINE_TO:r.push(new n.Vector2(h[0],h[1]));break;case n.PathActions.QUADRATIC_CURVE_TO:for(l=h[2],c=h[3],p=h[0],d=h[1],r.length>0?(m=(g=r[r.length-1]).x,v=g.y):(m=(g=this.actions[i-1].args)[g.length-2],v=g[g.length-1]),y=1;y<=e;y++)x=y/e,b=n.Shape.Utils.b2(x,m,p,l),w=n.Shape.Utils.b2(x,v,d,c),r.push(new n.Vector2(b,w));break;case n.PathActions.BEZIER_CURVE_TO:for(l=h[4],c=h[5],p=h[0],d=h[1],u=h[2],f=h[3],r.length>0?(m=(g=r[r.length-1]).x,v=g.y):(m=(g=this.actions[i-1].args)[g.length-2],v=g[g.length-1]),y=1;y<=e;y++)x=y/e,b=n.Shape.Utils.b3(x,m,p,u,l),w=n.Shape.Utils.b3(x,v,d,f,c),r.push(new n.Vector2(b,w));break;case n.PathActions.CSPLINE_THRU:g=this.actions[i-1].args;var _,M=[new n.Vector2(g[g.length-2],g[g.length-1])],S=e*h[0].length;M=M.concat(h[0]);var T=new n.SplineCurve(M);for(y=1;y<=S;y++)r.push(T.getPointAt(y/S));break;case n.PathActions.ARC:var C=h[0],A=h[1],E=h[2],P=h[3],L=h[4],D=!!h[5],F=L-P,R,V=2*e;for(y=1;y<=V;y++)x=y/V,D||(x=1-x),R=P+x*F,b=C+E*Math.cos(R),w=A+E*Math.sin(R),r.push(new n.Vector2(b,w));break;case n.PathActions.ELLIPSE:var C=h[0],A=h[1],U=h[2],z=h[3],P=h[4],L=h[5],D=!!h[6],F=L-P,R,V=2*e;for(y=1;y<=V;y++)x=y/V,D||(x=1-x),R=P+x*F,b=C+U*Math.cos(R),w=A+z*Math.sin(R),r.push(new n.Vector2(b,w));break}var O=r[r.length-1],N=1e-10;return Math.abs(O.x-r[0].x)<N&&Math.abs(O.y-r[0].y)<N&&r.splice(r.length-1,1),t&&r.push(r[0]),r},n.Path.prototype.toShapes=function(e){function t(e,t){for(var r=1e-10,i=t.length,n=!1,o=i-1,a=0;a<i;o=a++){var s=t[o],h=t[a],l=h.x-s.x,c=h.y-s.y;if(Math.abs(c)>r){if(c<0&&(s=t[a],l=-l,h=t[o],c=-c),e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var u=c*(e.x-s.x)-l*(e.y-s.y);if(0==u)return!0;if(u<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return!0}}return n}var r,i,o,a,s,h=[],l=new n.Path;for(r=0,i=this.actions.length;r<i;r++)s=(o=this.actions[r]).args,(a=o.action)==n.PathActions.MOVE_TO&&0!=l.actions.length&&(h.push(l),l=new n.Path),l[a].apply(l,s);if(0!=l.actions.length&&h.push(l),0==h.length)return[];var c,u,f,p=[];if(1==h.length)return u=h[0],(f=new n.Shape).actions=u.actions,f.curves=u.curves,p.push(f),p;var d=!n.Shape.Utils.isClockWise(h[0].getPoints());d=e?!d:d;var m=[],v=[],g=[],y=0,x,b,w,_;for(v[y]=void 0,g[y]=[],r=0,i=h.length;r<i;r++)x=(u=h[r]).getPoints(),c=n.Shape.Utils.isClockWise(x),(c=e?!c:c)?(!d&&v[y]&&y++,v[y]={s:new n.Shape,p:x},v[y].s.actions=u.actions,v[y].s.curves=u.curves,d&&y++,g[y]=[]):g[y].push({h:u,p:x[0]});if(v.length>1){for(var M=!1,S=[],T=0,C=v.length;T<C;T++)m[T]=[];for(var T=0,C=v.length;T<C;T++)for(var A=v[T],E=g[T],P=0;P<E.length;P++){for(var L=E[P],D=!0,F=0;F<v.length;F++)t(L.p,v[F].p)&&(T!=F&&S.push({froms:T,tos:F,hole:P}),D?(D=!1,m[F].push(L)):M=!0);D&&m[T].push(L)}S.length>0&&(M||(g=m))}for(r=0,i=v.length;r<i;r++)for(f=v[r].s,p.push(f),w=0,_=(b=g[r]).length;w<_;w++)f.holes.push(b[w].h);return p},n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.create(n.Path.prototype),n.Shape.prototype.extrude=function(e){var t;return new n.ExtrudeGeometry(this,e)},n.Shape.prototype.makeGeometry=function(e){var t;return new n.ShapeGeometry(this,e)},n.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},n.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},n.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},n.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},n.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},n.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function i(e,t,i,n,o){var a=1e-10,s=t.x-e.x,h=t.y-e.y,l=n.x-i.x,c=n.y-i.y,u=e.x-i.x,f=e.y-i.y,p=h*l-s*c,d=h*u-s*f;if(Math.abs(p)>a){var m;if(p>0){if(d<0||d>p)return[];if((m=c*u-l*f)<0||m>p)return[]}else{if(d>0||d<p)return[];if((m=c*u-l*f)>0||m<p)return[]}if(0==m)return!o||0!=d&&d!=p?[e]:[];if(m==p)return!o||0!=d&&d!=p?[t]:[];if(0==d)return[i];if(d==p)return[n];var v=m/p;return[{x:e.x+v*s,y:e.y+v*h}]}if(0!=d||c*u!=l*f)return[];var g=0==s&&0==h,y=0==l&&0==c,x,b,w,_,M,S,T,C;return g&&y?e.x!=i.x||e.y!=i.y?[]:[e]:g?r(i,n,e)?[e]:[]:y?r(e,t,i)?[i]:[]:(0!=s?(e.x<t.x?(x=e,w=e.x,b=t,_=t.x):(x=t,w=t.x,b=e,_=e.x),i.x<n.x?(M=i,T=i.x,S=n,C=n.x):(M=n,T=n.x,S=i,C=i.x)):(e.y<t.y?(x=e,w=e.y,b=t,_=t.y):(x=t,w=t.y,b=e,_=e.y),i.y<n.y?(M=i,T=i.y,S=n,C=n.y):(M=n,T=n.y,S=i,C=i.y)),w<=T?_<T?[]:_==T?o?[]:[M]:_<=C?[M,b]:[M,S]:w>C?[]:w==C?o?[]:[x]:_<=C?[x,b]:[x,S])}function o(e,t,r,i){var n=1e-10,o=t.x-e.x,a=t.y-e.y,s=r.x-e.x,h=r.y-e.y,l=i.x-e.x,c=i.y-e.y,u=o*h-a*s,f=o*c-a*l;if(Math.abs(u)>n){var p=l*h-c*s;return u>0?f>=0&&p>=0:f>=0||p>=0}return f>0}function a(e,t){var r=e.concat(),n;function a(e,t){var i=r.length-1,a=e-1;a<0&&(a=i);var s=e+1;s>i&&(s=0);var h=o(r[e],r[a],r[s],n[t]);if(!h)return!1;var l=n.length-1,c=t-1;c<0&&(c=l);var u=t+1;return u>l&&(u=0),!!(h=o(n[t],n[c],n[u],r[e]))}function s(e,t){var n,o,a;for(n=0;n<r.length;n++)if(o=n+1,o%=r.length,(a=i(e,t,r[n],r[o],!0)).length>0)return!0;return!1}var h=[];function l(e,r){var n,o,a,s,l;for(n=0;n<h.length;n++)for(o=t[h[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,(l=i(e,r,o[a],o[s],!0)).length>0)return!0;return!1}for(var c,u,f,p,d,m,v=[],g,y,x,b,w=0,_=t.length;w<_;w++)h.push(w);for(var M=2*h.length;h.length>0;){if(--M<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(u=0;u<r.length;u++){f=r[u],c=-1;for(var w=0;w<h.length;w++)if(d=h[w],void 0===v[m=f.x+":"+f.y+":"+d]){n=t[d];for(var S=0;S<n.length;S++)if(p=n[S],a(u,S)&&!s(f,p)&&!l(f,p)){c=S,h.splice(w,1),g=r.slice(0,u+1),y=r.slice(u),x=n.slice(c),b=n.slice(0,c+1),r=g.concat(x).concat(b).concat(y);break}if(c>=0)break;v[m]=!0}if(c>=0)break}}return r}for(var s,h,l,c,u,f,p={},d=e.concat(),m=0,v=t.length;m<v;m++)Array.prototype.push.apply(d,t[m]);for(s=0,h=d.length;s<h;s++)void 0!==p[u=d[s].x+":"+d[s].y]&&console.log("Duplicate point",u),p[u]=s;var g=a(e,t),y=n.FontUtils.Triangulate(g,!1);for(s=0,h=y.length;s<h;s++)for(c=y[s],l=0;l<3;l++)void 0!==(f=p[u=c[l].x+":"+c[l].y])&&(c[l]=f);return y.concat()},isClockWise:function(e){return n.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r;return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},n.LineCurve=function(e,t){this.v1=e,this.v2=t},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},n.LineCurve.prototype.getTangent=function(e){var t;return this.v2.clone().sub(this.v1).normalize()},n.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype),n.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new n.Vector2(t,r)},n.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new n.Vector2(t,r);return i.normalize(),i},n.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype),n.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new n.Vector2(t,r)},n.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=n.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new n.Vector2(t,r);return i.normalize(),i},n.SplineCurve=function(e){this.points=null==e?[]:e},n.SplineCurve.prototype=Object.create(n.Curve.prototype),n.SplineCurve.prototype.getPoint=function(e){var t=new n.Vector2,r=[],i=this.points,o,a,s;return s=(o=(i.length-1)*e)-(a=Math.floor(o)),r[0]=0==a?a:a-1,r[1]=a,r[2]=a>i.length-2?i.length-1:a+1,r[3]=a>i.length-3?i.length-1:a+2,t.x=n.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),t.y=n.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),t},n.EllipseCurve=function(e,t,r,i,n,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var i=this.aX+this.xRadius*Math.cos(t),o=this.aY+this.yRadius*Math.sin(t);return new n.Vector2(i,o)},n.ArcCurve=function(e,t,r,i,o,a){n.EllipseCurve.call(this,e,t,r,r,i,o,a)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.LineCurve3=n.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new n.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),n.QuadraticBezierCurve3=n.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r,i;return t=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=n.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new n.Vector3(t,r,i)}),n.CubicBezierCurve3=n.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t,r,i;return t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=n.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new n.Vector3(t,r,i)}),n.SplineCurve3=n.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=new n.Vector3,r=[],i=this.points,o,a,s;s=(o=(i.length-1)*e)-(a=Math.floor(o)),r[0]=0==a?a:a-1,r[1]=a,r[2]=a>i.length-2?i.length-1:a+1,r[3]=a>i.length-3?i.length-1:a+2;var h=i[r[0]],l=i[r[1]],c=i[r[2]],u=i[r[3]];return t.x=n.Curve.Utils.interpolate(h.x,l.x,c.x,u.x,s),t.y=n.Curve.Utils.interpolate(h.y,l.y,c.y,u.y,s),t.z=n.Curve.Utils.interpolate(h.z,l.z,c.z,u.z,s),t}),n.ClosedSplineCurve3=n.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=new n.Vector3,r=[],i=this.points,o,a,s;return s=(o=(i.length-0)*e)-(a=Math.floor(o)),a+=a>0?0:(Math.floor(Math.abs(a)/i.length)+1)*i.length,r[0]=(a-1)%i.length,r[1]=a%i.length,r[2]=(a+1)%i.length,r[3]=(a+2)%i.length,t.x=n.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),t.y=n.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),t.z=n.Curve.Utils.interpolate(i[r[0]].z,i[r[1]].z,i[r[2]].z,i[r[3]].z,s),t}),n.AnimationHandler=(Y=[],K={},Q={update:function(e){for(var t=0;t<Y.length;t++)Y[t].update(e)},addToUpdate:function(e){-1===Y.indexOf(e)&&Y.push(e)},removeFromUpdate:function(e){var t=Y.indexOf(e);-1!==t&&Y.splice(t,1)},add:function(e){void 0!==K[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),K[e.name]=e,J(e)},get:function(e){if("string"==typeof e)return K[e]?K[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof n.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else Z(e,t);return t}},Z=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)Z(e.children[r],t)},J=function(e){if(!0!==e.initialized){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof n.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=new n.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},r=0;r<e.hierarchy[t].keys.length;r++)for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++){var s;o[s=e.hierarchy[t].keys[r].morphTargets[a]]=-1}e.hierarchy[t].usedMorphTargets=o;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var s in o){for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++)if(e.hierarchy[t].keys[r].morphTargets[a]===s){h[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[r].morphTargets.length&&(h[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}e.initialized=!0}},Q.LINEAR=0,Q.CATMULLROM=1,Q.CATMULLROM_FORWARD=2,Q),n.Animation=function(e,t){this.root=e,this.data=n.AnimationHandler.get(t),this.hierarchy=n.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=n.AnimationHandler.LINEAR},n.Animation.prototype.play=function(e){this.currentTime=void 0!==e?e:0,!1===this.isPlaying&&(this.isPlaying=!0,this.reset(),this.update(0)),this.isPaused=!1,n.AnimationHandler.addToUpdate(this)},n.Animation.prototype.pause=function(){!0===this.isPaused?n.AnimationHandler.addToUpdate(this):n.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},n.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,n.AnimationHandler.removeFromUpdate(this)},n.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof n.Bone?r.skinMatrix:r.matrix);var i=r.animationCache.prevKey,o=r.animationCache.nextKey;i.pos=this.data.hierarchy[e].keys[0],i.rot=this.data.hierarchy[e].keys[0],i.scl=this.data.hierarchy[e].keys[0],o.pos=this.getNextKeyWith("pos",e,1),o.rot=this.getNextKeyWith("rot",e,1),o.scl=this.getNextKeyWith("scl",e,1)}},n.Animation.prototype.update=function(){var e=[],t=new n.Vector3,r=function(e,t){var r=[],n=[],o,a,s,h,l,c,u,f,p;return s=(o=(e.length-1)*t)-(a=Math.floor(o)),r[0]=0===a?a:a-1,r[1]=a,r[2]=a>e.length-2?a:a+1,r[3]=a>e.length-3?a:a+2,c=e[r[0]],u=e[r[1]],f=e[r[2]],p=e[r[3]],l=s*(h=s*s),n[0]=i(c[0],u[0],f[0],p[0],s,h,l),n[1]=i(c[1],u[1],f[1],p[1],s,h,l),n[2]=i(c[2],u[2],f[2],p[2],s,h,l),n},i=function(e,t,r,i,n,o,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*n+t};return function(i){if(!1!==this.isPlaying){var o;this.currentTime+=i*this.timeScale;var a=["pos","rot","scl"],s=this.data.length;if(!0===this.loop&&this.currentTime>s)this.currentTime%=s,this.reset();else if(!1===this.loop&&this.currentTime>s)return void this.stop();this.currentTime=Math.min(this.currentTime,s);for(var h=0,l=this.hierarchy.length;h<l;h++)for(var c=this.hierarchy[h],u=c.animationCache,f=0;f<3;f++){var p=a[f],d=u.prevKey[p],m=u.nextKey[p];if(m.time<=this.currentTime){for(d=this.data.hierarchy[h].keys[0],m=this.getNextKeyWith(p,h,1);m.time<this.currentTime&&m.index>d.index;)d=m,m=this.getNextKeyWith(p,h,m.index+1);u.prevKey[p]=d,u.nextKey[p]=m}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0;var v=(this.currentTime-d.time)/(m.time-d.time),g=d[p],y=m[p];if(v<0&&(v=0),v>1&&(v=1),"pos"===p){if(o=c.position,this.interpolationType===n.AnimationHandler.LINEAR)o.x=g[0]+(y[0]-g[0])*v,o.y=g[1]+(y[1]-g[1])*v,o.z=g[2]+(y[2]-g[2])*v;else if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",h,d.index-1).pos,e[1]=g,e[2]=y,e[3]=this.getNextKeyWith("pos",h,m.index+1).pos;var x=r(e,v=.33*v+.33);if(o.x=x[0],o.y=x[1],o.z=x[2],this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){var b=r(e,1.01*v);t.set(b[0],b[1],b[2]),t.sub(o),t.y=0,t.normalize();var w=Math.atan2(t.x,t.z);c.rotation.set(0,w,0)}}}else"rot"===p?n.Quaternion.slerp(g,y,c.quaternion,v):"scl"===p&&((o=c.scale).x=g[0]+(y[0]-g[0])*v,o.y=g[1]+(y[1]-g[1])*v,o.z=g[2]+(y[2]-g[2])*v)}}}}(),n.Animation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},n.Animation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},n.KeyFrameAnimation=function(e,t){this.root=e,this.data=n.AnimationHandler.get(t),this.hierarchy=n.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var r=0,i=this.hierarchy.length;r<i;r++){var o=this.data.hierarchy[r].keys,a=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(o.length&&a){for(var h=0;h<a.length;h++){var l=a[h],c=this.getNextKeyWith(l,r,0);c&&c.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},n.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,r=this.hierarchy.length,i,o;for(t=0;t<r;t++){i=this.hierarchy[t],void 0===(o=this.data.hierarchy[t]).animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=i instanceof n.Bone?i.skinMatrix:i.matrix);var a=this.data.hierarchy[t].keys;a.length&&(o.animationCache.prevKey=a[0],o.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,n.AnimationHandler.addToUpdate(this)},n.KeyFrameAnimation.prototype.pause=function(){this.isPaused?n.AnimationHandler.addToUpdate(this):n.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},n.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,n.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof n.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},n.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,i=this.hierarchy.length;r<i;r++){var n=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var h=s.prevKey,l=s.nextKey;if(l.time<=this.currentTime){for(;l.time<this.currentTime&&l.index>h.index;)l=a[(h=l).index+1];s.prevKey=h,s.nextKey=l}l.time>=this.currentTime?h.interpolate(l,this.currentTime):h.interpolate(l,l.time),this.data.hierarchy[r].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},n.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];return i[0]},n.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]},n.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},n.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:($=0,ee=0,function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,r=Math.floor(this.currentTime/t);r!=ee&&(this.mesh.morphTargetInfluences[$]=0,this.mesh.morphTargetInfluences[ee]=1,this.mesh.morphTargetInfluences[r]=0,$=ee,ee=r),this.mesh.morphTargetInfluences[r]=this.currentTime%t/t,this.mesh.morphTargetInfluences[$]=1-this.mesh.morphTargetInfluences[r]}})},n.CubeCamera=function(e,t,r){n.Object3D.call(this);var i=90,o=1,a=new n.PerspectiveCamera(i,1,e,t);a.up.set(0,-1,0),a.lookAt(new n.Vector3(1,0,0)),this.add(a);var s=new n.PerspectiveCamera(i,1,e,t);s.up.set(0,-1,0),s.lookAt(new n.Vector3(-1,0,0)),this.add(s);var h=new n.PerspectiveCamera(i,1,e,t);h.up.set(0,0,1),h.lookAt(new n.Vector3(0,1,0)),this.add(h);var l=new n.PerspectiveCamera(i,1,e,t);l.up.set(0,0,-1),l.lookAt(new n.Vector3(0,-1,0)),this.add(l);var c=new n.PerspectiveCamera(i,1,e,t);c.up.set(0,-1,0),c.lookAt(new n.Vector3(0,0,1)),this.add(c);var u=new n.PerspectiveCamera(i,1,e,t);u.up.set(0,-1,0),u.lookAt(new n.Vector3(0,0,-1)),this.add(u),this.renderTarget=new n.WebGLRenderTargetCube(r,r,{format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,a,r),r.activeCubeFace=1,e.render(t,s,r),r.activeCubeFace=2,e.render(t,h,r),r.activeCubeFace=3,e.render(t,l,r),r.activeCubeFace=4,e.render(t,c,r),r.generateMipmaps=i,r.activeCubeFace=5,e.render(t,u,r)}},n.CubeCamera.prototype=Object.create(n.Object3D.prototype),n.CombinedCamera=function(e,t,r,i,o,a,s){n.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new n.OrthographicCamera(e/-2,e/2,t/2,t/-2,a,s),this.cameraP=new n.PerspectiveCamera(r,e/t,i,o),this.zoom=1,this.toPerspective();var h=e/t},n.CombinedCamera.prototype=Object.create(n.Camera.prototype),n.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},n.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r,i,n=(this.cameraP.near+this.cameraP.far)/2,o=Math.tan(e/2)*n,a,s,h=2*o*t/2;o/=this.zoom,h/=this.zoom,this.cameraO.left=-h,this.cameraO.right=h,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},n.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},n.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},n.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},n.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*n.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},n.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},n.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.BoxGeometry=function(e,t,r,i,o,a){n.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=i||1,this.heightSegments=o||1,this.depthSegments=a||1;var h=this.width/2,l=this.height/2,c=this.depth/2;function u(e,t,r,i,o,a,h,l){var c,u,f,p=s.widthSegments,d=s.heightSegments,m=o/2,v=a/2,g=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",d=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",p=s.depthSegments);var y=p+1,x=d+1,b=o/p,w=a/d,_=new n.Vector3;for(_[c]=h>0?1:-1,f=0;f<x;f++)for(u=0;u<y;u++){var M=new n.Vector3;M[e]=(u*b-m)*r,M[t]=(f*w-v)*i,M[c]=h,s.vertices.push(M)}for(f=0;f<d;f++)for(u=0;u<p;u++){var S=u+y*f,T=u+y*(f+1),C=u+1+y*(f+1),A=u+1+y*f,E=new n.Vector2(u/p,1-f/d),P=new n.Vector2(u/p,1-(f+1)/d),L=new n.Vector2((u+1)/p,1-(f+1)/d),D=new n.Vector2((u+1)/p,1-f/d),F=new n.Face3(S+g,T+g,A+g);F.normal.copy(_),F.vertexNormals.push(_.clone(),_.clone(),_.clone()),F.materialIndex=l,s.faces.push(F),s.faceVertexUvs[0].push([E,P,D]),(F=new n.Face3(T+g,C+g,A+g)).normal.copy(_),F.vertexNormals.push(_.clone(),_.clone(),_.clone()),F.materialIndex=l,s.faces.push(F),s.faceVertexUvs[0].push([P.clone(),L,D.clone()])}}u("z","y",-1,-1,this.depth,this.height,h,0),u("z","y",1,-1,this.depth,this.height,-h,1),u("x","z",1,1,this.width,this.depth,l,2),u("x","z",1,-1,this.width,this.depth,-l,3),u("x","y",1,-1,this.width,this.height,c,4),u("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},n.BoxGeometry.prototype=Object.create(n.Geometry.prototype),n.CircleGeometry=function(e,t,r,i){n.Geometry.call(this),this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=r=void 0!==r?r:0,this.thetaLength=i=void 0!==i?i:2*Math.PI;var o,a=[],s=new n.Vector3,h=new n.Vector2(.5,.5);for(this.vertices.push(s),a.push(h),o=0;o<=t;o++){var l=new n.Vector3,c=r+o/t*i;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),a.push(new n.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new n.Vector3(0,0,1);for(o=1;o<=t;o++){var f=o,p=o+1,d=0;this.faces.push(new n.Face3(f,p,0,[u.clone(),u.clone(),u.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[o+1].clone(),h.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.CircleGeometry.prototype=Object.create(n.Geometry.prototype),n.CubeGeometry=n.BoxGeometry,n.CylinderGeometry=function(e,t,r,i,o,a){n.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=r=void 0!==r?r:100,this.radialSegments=i=i||8,this.heightSegments=o=o||1,this.openEnded=a=void 0!==a&&a;var s=r/2,h,l,c=[],u=[];for(l=0;l<=o;l++){var f=[],p=[],d=l/o,m=d*(t-e)+e;for(h=0;h<=i;h++){var v=h/i,g=new n.Vector3;g.x=m*Math.sin(v*Math.PI*2),g.y=-d*r+s,g.z=m*Math.cos(v*Math.PI*2),this.vertices.push(g),f.push(this.vertices.length-1),p.push(new n.Vector2(v,1-d))}c.push(f),u.push(p)}var y=(t-e)/r,x,b;for(h=0;h<i;h++)for(0!==e?(x=this.vertices[c[0][h]].clone(),b=this.vertices[c[0][h+1]].clone()):(x=this.vertices[c[1][h]].clone(),b=this.vertices[c[1][h+1]].clone()),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*y).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*y).normalize(),l=0;l<o;l++){var w=c[l][h],_=c[l+1][h],M=c[l+1][h+1],S=c[l][h+1],T=x.clone(),C=x.clone(),A=b.clone(),E=b.clone(),P=u[l][h].clone(),L=u[l+1][h].clone(),D=u[l+1][h+1].clone(),F=u[l][h+1].clone();this.faces.push(new n.Face3(w,_,S,[T,C,E])),this.faceVertexUvs[0].push([P,L,F]),this.faces.push(new n.Face3(_,M,S,[C.clone(),A,E.clone()])),this.faceVertexUvs[0].push([L.clone(),D,F.clone()])}if(!1===a&&e>0)for(this.vertices.push(new n.Vector3(0,s,0)),h=0;h<i;h++){var w=c[0][h],_=c[0][h+1],M=this.vertices.length-1,T=new n.Vector3(0,1,0),C=new n.Vector3(0,1,0),A=new n.Vector3(0,1,0),P=u[0][h].clone(),L=u[0][h+1].clone(),D=new n.Vector2(L.x,0);this.faces.push(new n.Face3(w,_,M,[T,C,A])),this.faceVertexUvs[0].push([P,L,D])}if(!1===a&&t>0)for(this.vertices.push(new n.Vector3(0,-s,0)),h=0;h<i;h++){var w=c[l][h+1],_=c[l][h],M=this.vertices.length-1,T=new n.Vector3(0,-1,0),C=new n.Vector3(0,-1,0),A=new n.Vector3(0,-1,0),P=u[l][h+1].clone(),L=u[l][h].clone(),D=new n.Vector2(L.x,1);this.faces.push(new n.Face3(w,_,M,[T,C,A])),this.faceVertexUvs[0].push([P,L,D])}this.computeCentroids(),this.computeFaceNormals()},n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry=function(e,t){void 0!==e?(n.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()):e=[]},n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++){var n=e[i];this.addShape(n,t)}},n.ExtrudeGeometry.prototype.addShape=function(e,t){var r=void 0!==t.amount?t.amount:100,i=void 0!==t.bevelThickness?t.bevelThickness:6,o=void 0!==t.bevelSize?t.bevelSize:i-2,a=void 0!==t.bevelSegments?t.bevelSegments:3,s=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.curveSegments?t.curveSegments:12,l=void 0!==t.steps?t.steps:1,c=t.extrudePath,u,f=!1,p=t.material,d=t.extrudeMaterial,m=void 0!==t.UVGenerator?t.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator,v=this.shapebb,g,y,x,b,w,_,M;c&&(u=c.getSpacedPoints(l),f=!0,s=!1,g=void 0!==t.frames?t.frames:new n.TubeGeometry.FrenetFrames(c,l,!1),y=new n.Vector3,x=new n.Vector3,b=new n.Vector3),s||(a=0,i=0,o=0);var S=this,T=[],C=this.vertices.length,A=e.extractPoints(h),E=A.shape,P=A.holes,L=!n.Shape.Utils.isClockWise(E);if(L){for(E=E.reverse(),_=0,M=P.length;_<M;_++)w=P[_],n.Shape.Utils.isClockWise(w)&&(P[_]=w.reverse());L=!1}var D=n.Shape.Utils.triangulateShape(E,P),F=E;for(_=0,M=P.length;_<M;_++)w=P[_],E=E.concat(w);function R(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}var V,U,z,O,N,B=E.length,I,k=D.length,j,G=F.length,W=180/Math.PI;function H(e,t,r){var i=1e-10,o=n.Math.sign,a,s,h=1,l=e.x-t.x,c=e.y-t.y,u=r.x-e.x,f=r.y-e.y,p=l*l+c*c,d=l*f-c*u;if(Math.abs(d)>i){var m=Math.sqrt(p),v=Math.sqrt(u*u+f*f),g=t.x-c/m,y=t.y+l/m,x,b,w=((r.x-f/v-g)*f-(r.y+u/v-y)*u)/(l*f-c*u),_=(a=g+l*w-e.x)*a+(s=y+c*w-e.y)*s;if(_<=2)return new n.Vector2(a,s);h=Math.sqrt(_/2)}else{var M=!1;l>i?u>i&&(M=!0):l<-1e-10?u<-1e-10&&(M=!0):o(c)==o(f)&&(M=!0),M?(a=-c,s=l,h=Math.sqrt(p)):(a=l,s=c,h=Math.sqrt(p/2))}return new n.Vector2(a/h,s/h)}for(var X=[],q=0,Y=F.length,K=Y-1,Q=q+1;q<Y;q++,K++,Q++){K===Y&&(K=0),Q===Y&&(Q=0);var Z=F[q],J=F[K],$=F[Q];X[q]=H(F[q],F[K],F[Q])}var ee=[],te,re=X.concat(),ie;for(_=0,M=P.length;_<M;_++){for(w=P[_],te=[],q=0,K=(Y=w.length)-1,Q=q+1;q<Y;q++,K++,Q++)K===Y&&(K=0),Q===Y&&(Q=0),te[q]=H(w[q],w[K],w[Q]);ee.push(te),re=re.concat(te)}for(V=0;V<a;V++){for(O=i*(1-(z=V/a)),U=o*Math.sin(z*Math.PI/2),q=0,Y=F.length;q<Y;q++)se((N=R(F[q],X[q],U)).x,N.y,-O);for(_=0,M=P.length;_<M;_++)for(w=P[_],te=ee[_],q=0,Y=w.length;q<Y;q++)se((N=R(w[q],te[q],U)).x,N.y,-O)}for(U=o,q=0;q<B;q++)N=s?R(E[q],re[q],U):E[q],f?(x.copy(g.normals[0]).multiplyScalar(N.x),y.copy(g.binormals[0]).multiplyScalar(N.y),b.copy(u[0]).add(x).add(y),se(b.x,b.y,b.z)):se(N.x,N.y,0);for(ie=1;ie<=l;ie++)for(q=0;q<B;q++)N=s?R(E[q],re[q],U):E[q],f?(x.copy(g.normals[ie]).multiplyScalar(N.x),y.copy(g.binormals[ie]).multiplyScalar(N.y),b.copy(u[ie]).add(x).add(y),se(b.x,b.y,b.z)):se(N.x,N.y,r/l*ie);for(V=a-1;V>=0;V--){for(O=i*(1-(z=V/a)),U=o*Math.sin(z*Math.PI/2),q=0,Y=F.length;q<Y;q++)se((N=R(F[q],X[q],U)).x,N.y,r+O);for(_=0,M=P.length;_<M;_++)for(w=P[_],te=ee[_],q=0,Y=w.length;q<Y;q++)N=R(w[q],te[q],U),f?se(N.x,N.y+u[l-1].y,u[l-1].x+O):se(N.x,N.y,r+O)}function ne(){if(s){var e=0,t=B*e;for(q=0;q<k;q++)he((I=D[q])[2]+t,I[1]+t,I[0]+t,!0);for(t=B*(e=l+2*a),q=0;q<k;q++)he((I=D[q])[0]+t,I[1]+t,I[2]+t,!1)}else{for(q=0;q<k;q++)he((I=D[q])[2],I[1],I[0],!0);for(q=0;q<k;q++)he((I=D[q])[0]+B*l,I[1]+B*l,I[2]+B*l,!1)}}function oe(){var e=0;for(ae(F,e),e+=F.length,_=0,M=P.length;_<M;_++)ae(w=P[_],e),e+=w.length}function ae(e,t){var r,i;for(q=e.length;--q>=0;){r=q,(i=q-1)<0&&(i=e.length-1);var n=0,o=l+2*a;for(n=0;n<o;n++){var s=B*n,h=B*(n+1),c,u,f,p;le(t+r+s,t+i+s,t+i+h,t+r+h,e,n,o,r,i)}}}function se(e,t,r){S.vertices.push(new n.Vector3(e,t,r))}function he(r,i,o,a){r+=C,i+=C,o+=C,S.faces.push(new n.Face3(r,i,o,null,null,p));var s=a?m.generateBottomUV(S,e,t,r,i,o):m.generateTopUV(S,e,t,r,i,o);S.faceVertexUvs[0].push(s)}function le(r,i,o,a,s,h,l,c,u){r+=C,i+=C,o+=C,a+=C,S.faces.push(new n.Face3(r,i,a,null,null,d)),S.faces.push(new n.Face3(i,o,a,null,null,d));var f=m.generateSideWallUV(S,e,s,t,r,i,o,a,h,l,c,u);S.faceVertexUvs[0].push([f[0],f[1],f[3]]),S.faceVertexUvs[0].push([f[1],f[2],f[3]])}ne(),oe()},n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,o,a){var s=e.vertices[i].x,h=e.vertices[i].y,l=e.vertices[o].x,c=e.vertices[o].y,u=e.vertices[a].x,f=e.vertices[a].y;return[new n.Vector2(s,h),new n.Vector2(l,c),new n.Vector2(u,f)]},generateBottomUV:function(e,t,r,i,n,o){return this.generateTopUV(e,t,r,i,n,o)},generateSideWallUV:function(e,t,r,i,o,a,s,h,l,c,u,f){var p=e.vertices[o].x,d=e.vertices[o].y,m=e.vertices[o].z,v=e.vertices[a].x,g=e.vertices[a].y,y=e.vertices[a].z,x=e.vertices[s].x,b=e.vertices[s].y,w=e.vertices[s].z,_=e.vertices[h].x,M=e.vertices[h].y,S=e.vertices[h].z;return Math.abs(d-g)<.01?[new n.Vector2(p,1-m),new n.Vector2(v,1-y),new n.Vector2(x,1-w),new n.Vector2(_,1-S)]:[new n.Vector2(d,1-m),new n.Vector2(g,1-y),new n.Vector2(b,1-w),new n.Vector2(M,1-S)]}},n.ExtrudeGeometry.__v1=new n.Vector2,n.ExtrudeGeometry.__v2=new n.Vector2,n.ExtrudeGeometry.__v3=new n.Vector2,n.ExtrudeGeometry.__v4=new n.Vector2,n.ExtrudeGeometry.__v5=new n.Vector2,n.ExtrudeGeometry.__v6=new n.Vector2,n.ShapeGeometry=function(e,t){n.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype),n.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},n.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r=void 0!==t.curveSegments?t.curveSegments:12,i=t.material,o=void 0===t.UVGenerator?n.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,a=this.shapebb,s,h,l,c,u=this.vertices.length,f=e.extractPoints(r),p=f.shape,d=f.holes,m=!n.Shape.Utils.isClockWise(p);if(m){for(p=p.reverse(),s=0,h=d.length;s<h;s++)l=d[s],n.Shape.Utils.isClockWise(l)&&(d[s]=l.reverse());m=!1}var v=n.Shape.Utils.triangulateShape(p,d),g=p;for(s=0,h=d.length;s<h;s++)l=d[s],p=p.concat(l);var y,x=p.length,b,w=v.length,_,M=g.length;for(s=0;s<x;s++)y=p[s],this.vertices.push(new n.Vector3(y.x,y.y,0));for(s=0;s<w;s++){var S=(b=v[s])[0]+u,T=b[1]+u,C=b[2]+u;this.faces.push(new n.Face3(S,T,C,null,null,i)),this.faceVertexUvs[0].push(o.generateBottomUV(this,e,t,S,T,C))}},n.LatheGeometry=function(e,t,r,i){n.Geometry.call(this),t=t||12,r=r||0,i=i||2*Math.PI;for(var o=1/(e.length-1),a=1/t,s=0,h=t;s<=h;s++)for(var l=r+s*a*i,c=Math.cos(l),u=Math.sin(l),f=0,p=e.length;f<p;f++){var d=e[f],m=new n.Vector3;m.x=c*d.x-u*d.y,m.y=u*d.x+c*d.y,m.z=d.z,this.vertices.push(m)}for(var v=e.length,s=0,h=t;s<h;s++)for(var f=0,p=e.length-1;f<p;f++){var g=f+v*s,y=g,x=g+v,c=g+1+v,b=g+1,w=s*a,_=f*o,M=w+a,S=_+o;this.faces.push(new n.Face3(y,x,b)),this.faceVertexUvs[0].push([new n.Vector2(w,_),new n.Vector2(M,_),new n.Vector2(w,S)]),this.faces.push(new n.Face3(x,c,b)),this.faceVertexUvs[0].push([new n.Vector2(M,_),new n.Vector2(M,S),new n.Vector2(w,S)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.LatheGeometry.prototype=Object.create(n.Geometry.prototype),n.PlaneGeometry=function(e,t,r,i){var o,a;n.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=i||1;var s=e/2,h=t/2,l=this.widthSegments,c=this.heightSegments,u=l+1,f=c+1,p=this.width/l,d=this.height/c,m=new n.Vector3(0,0,1);for(a=0;a<f;a++)for(o=0;o<u;o++){var v=o*p-s,g=a*d-h;this.vertices.push(new n.Vector3(v,-g,0))}for(a=0;a<c;a++)for(o=0;o<l;o++){var y=o+u*a,x=o+u*(a+1),b=o+1+u*(a+1),w=o+1+u*a,_=new n.Vector2(o/l,1-a/c),M=new n.Vector2(o/l,1-(a+1)/c),S=new n.Vector2((o+1)/l,1-(a+1)/c),T=new n.Vector2((o+1)/l,1-a/c),C=new n.Face3(y,x,w);C.normal.copy(m),C.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(C),this.faceVertexUvs[0].push([_,M,T]),(C=new n.Face3(x,b,w)).normal.copy(m),C.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(C),this.faceVertexUvs[0].push([M.clone(),S,T.clone()])}this.computeCentroids()},n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype),n.RingGeometry=function(e,t,r,i,o,a){n.Geometry.call(this),e=e||0,t=t||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var s,h,l=[],c=e,u=(t-e)/(i=void 0!==i?Math.max(3,i):8);for(s=0;s<=i;s++){for(h=0;h<=r;h++){var f=new n.Vector3,p=o+h/r*a;f.x=c*Math.cos(p),f.y=c*Math.sin(p),this.vertices.push(f),l.push(new n.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}c+=u}var d=new n.Vector3(0,0,1);for(s=0;s<i;s++){var m=s*r;for(h=0;h<=r;h++){var p,v=(p=h+m)+s,g=p+r+s,y=p+r+1+s;this.faces.push(new n.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()]),v=p+s,g=p+r+1+s,y=p+1+s,this.faces.push(new n.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,c)},n.RingGeometry.prototype=Object.create(n.Geometry.prototype),n.SphereGeometry=function(e,t,r,i,o,a,s){n.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=i=void 0!==i?i:0,this.phiLength=o=void 0!==o?o:2*Math.PI,this.thetaStart=a=void 0!==a?a:0,this.thetaLength=s=void 0!==s?s:Math.PI;var h,l,c=[],u=[];for(l=0;l<=r;l++){var f=[],p=[];for(h=0;h<=t;h++){var d=h/t,m=l/r,v=new n.Vector3;v.x=-e*Math.cos(i+d*o)*Math.sin(a+m*s),v.y=e*Math.cos(a+m*s),v.z=e*Math.sin(i+d*o)*Math.sin(a+m*s),this.vertices.push(v),f.push(this.vertices.length-1),p.push(new n.Vector2(d,1-m))}c.push(f),u.push(p)}for(l=0;l<this.heightSegments;l++)for(h=0;h<this.widthSegments;h++){var g=c[l][h+1],y=c[l][h],x=c[l+1][h],b=c[l+1][h+1],w=this.vertices[g].clone().normalize(),_=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),S=this.vertices[b].clone().normalize(),T=u[l][h+1].clone(),C=u[l][h].clone(),A=u[l+1][h].clone(),E=u[l+1][h+1].clone();Math.abs(this.vertices[g].y)===this.radius?(T.x=(T.x+C.x)/2,this.faces.push(new n.Face3(g,x,b,[w,M,S])),this.faceVertexUvs[0].push([T,A,E])):Math.abs(this.vertices[x].y)===this.radius?(A.x=(A.x+E.x)/2,this.faces.push(new n.Face3(g,y,x,[w,_,M])),this.faceVertexUvs[0].push([T,C,A])):(this.faces.push(new n.Face3(g,y,b,[w,_,S])),this.faceVertexUvs[0].push([T,C,E]),this.faces.push(new n.Face3(y,x,b,[_.clone(),M,S.clone()])),this.faceVertexUvs[0].push([C.clone(),A,E.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.SphereGeometry.prototype=Object.create(n.Geometry.prototype),n.TextGeometry=function(e,t){t=t||{};var r=n.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),n.ExtrudeGeometry.call(this,r,t)},n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype),n.TorusGeometry=function(e,t,r,i,o){n.Geometry.call(this);var a=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=o||2*Math.PI;for(var s=new n.Vector3,h=[],l=[],c=0;c<=this.radialSegments;c++)for(var u=0;u<=this.tubularSegments;u++){var f=u/this.tubularSegments*this.arc,p=c/this.radialSegments*Math.PI*2;s.x=this.radius*Math.cos(f),s.y=this.radius*Math.sin(f);var d=new n.Vector3;d.x=(this.radius+this.tube*Math.cos(p))*Math.cos(f),d.y=(this.radius+this.tube*Math.cos(p))*Math.sin(f),d.z=this.tube*Math.sin(p),this.vertices.push(d),h.push(new n.Vector2(u/this.tubularSegments,c/this.radialSegments)),l.push(d.clone().sub(s).normalize())}for(var c=1;c<=this.radialSegments;c++)for(var u=1;u<=this.tubularSegments;u++){var m=(this.tubularSegments+1)*c+u-1,v=(this.tubularSegments+1)*(c-1)+u-1,g=(this.tubularSegments+1)*(c-1)+u,y=(this.tubularSegments+1)*c+u,x=new n.Face3(m,v,y,[l[m].clone(),l[v].clone(),l[y].clone()]);this.faces.push(x),this.faceVertexUvs[0].push([h[m].clone(),h[v].clone(),h[y].clone()]),x=new n.Face3(v,g,y,[l[v].clone(),l[g].clone(),l[y].clone()]),this.faces.push(x),this.faceVertexUvs[0].push([h[v].clone(),h[g].clone(),h[y].clone()])}this.computeCentroids(),this.computeFaceNormals()},n.TorusGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusKnotGeometry=function(e,t,r,i,o,a,s){n.Geometry.call(this);var h=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=o||2,this.q=a||3,this.heightScale=s||1,this.grid=new Array(this.radialSegments);for(var l=new n.Vector3,c=new n.Vector3,u=new n.Vector3,f=0;f<this.radialSegments;++f){this.grid[f]=new Array(this.tubularSegments);var p=f/this.radialSegments*2*this.p*Math.PI,d=D(p,this.q,this.p,this.radius,this.heightScale),m=D(p+.01,this.q,this.p,this.radius,this.heightScale);l.subVectors(m,d),c.addVectors(m,d),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize();for(var v=0;v<this.tubularSegments;++v){var g=v/this.tubularSegments*2*Math.PI,y=-this.tube*Math.cos(g),x=this.tube*Math.sin(g),b=new n.Vector3;b.x=d.x+y*c.x+x*u.x,b.y=d.y+y*c.y+x*u.y,b.z=d.z+y*c.z+x*u.z,this.grid[f][v]=h.vertices.push(b)-1}}for(var f=0;f<this.radialSegments;++f)for(var v=0;v<this.tubularSegments;++v){var w=(f+1)%this.radialSegments,_=(v+1)%this.tubularSegments,M=this.grid[f][v],S=this.grid[w][v],T=this.grid[w][_],C=this.grid[f][_],A=new n.Vector2(f/this.radialSegments,v/this.tubularSegments),E=new n.Vector2((f+1)/this.radialSegments,v/this.tubularSegments),P=new n.Vector2((f+1)/this.radialSegments,(v+1)/this.tubularSegments),L=new n.Vector2(f/this.radialSegments,(v+1)/this.tubularSegments);this.faces.push(new n.Face3(M,S,C)),this.faceVertexUvs[0].push([A,E,L]),this.faces.push(new n.Face3(S,T,C)),this.faceVertexUvs[0].push([E.clone(),P,L.clone()])}function D(e,t,r,i,o){var a=Math.cos(e),s=Math.sin(e),h=t/r*e,l=Math.cos(h),c=i*(2+l)*.5*a,u=i*(2+l)*s*.5,f=o*i*Math.sin(h)*.5;return new n.Vector3(c,u,f)}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry=function(e,t,r,i,o){n.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=r||1,this.radialSegments=i||8,this.closed=o||!1,this.grid=[];var a=this,s,h,l,c=this.segments+1,u,f,p,d,m,v,g,y,x,b,w,_=new n.Vector3,M,S,T,C,A,E,P,L,D,F,R,V,U=new n.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),z=U.tangents,O=U.normals,N=U.binormals;function B(e,t,r){return a.vertices.push(new n.Vector3(e,t,r))-1}for(this.tangents=z,this.normals=O,this.binormals=N,M=0;M<c;M++)for(this.grid[M]=[],g=M/(c-1),w=e.getPointAt(g),s=z[M],h=O[M],l=N[M],S=0;S<this.radialSegments;S++)y=S/this.radialSegments*2*Math.PI,x=-this.radius*Math.cos(y),b=this.radius*Math.sin(y),_.copy(w),_.x+=x*h.x+b*l.x,_.y+=x*h.y+b*l.y,_.z+=x*h.z+b*l.z,this.grid[M][S]=B(_.x,_.y,_.z);for(M=0;M<this.segments;M++)for(S=0;S<this.radialSegments;S++)T=this.closed?(M+1)%this.segments:M+1,C=(S+1)%this.radialSegments,A=this.grid[M][S],E=this.grid[T][S],P=this.grid[T][C],L=this.grid[M][C],D=new n.Vector2(M/this.segments,S/this.radialSegments),F=new n.Vector2((M+1)/this.segments,S/this.radialSegments),R=new n.Vector2((M+1)/this.segments,(S+1)/this.radialSegments),V=new n.Vector2(M/this.segments,(S+1)/this.radialSegments),this.faces.push(new n.Face3(A,E,L)),this.faceVertexUvs[0].push([D,F,V]),this.faces.push(new n.Face3(E,P,L)),this.faceVertexUvs[0].push([F.clone(),R,V.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.TubeGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry.FrenetFrames=function(e,t,r){var i=new n.Vector3,o=new n.Vector3,a=new n.Vector3,s=[],h=[],l=[],c=new n.Vector3,u=new n.Matrix4,f=t+1,p,d=1e-4,m,v,g,y,x,b,w;for(this.tangents=s,this.normals=h,this.binormals=l,x=0;x<f;x++)b=x/(f-1),s[x]=e.getTangentAt(b),s[x].normalize();function _(e){h[0]=new n.Vector3,l[0]=new n.Vector3,void 0===e&&(e=new n.Vector3(0,0,1)),h[0].crossVectors(e,s[0]).normalize(),l[0].crossVectors(s[0],h[0]).normalize()}function M(){var t=e.getTangentAt(d);h[0]=(new n.Vector3).subVectors(t,s[0]).normalize(),l[0]=(new n.Vector3).crossVectors(s[0],h[0]),h[0].crossVectors(l[0],s[0]).normalize(),l[0].crossVectors(s[0],h[0]).normalize()}function S(){h[0]=new n.Vector3,l[0]=new n.Vector3,m=Number.MAX_VALUE,v=Math.abs(s[0].x),g=Math.abs(s[0].y),y=Math.abs(s[0].z),v<=m&&(m=v,o.set(1,0,0)),g<=m&&(m=g,o.set(0,1,0)),y<=m&&o.set(0,0,1),c.crossVectors(s[0],o).normalize(),h[0].crossVectors(s[0],c),l[0].crossVectors(s[0],h[0])}for(S(),x=1;x<f;x++)h[x]=h[x-1].clone(),l[x]=l[x-1].clone(),c.crossVectors(s[x-1],s[x]),c.length()>d&&(c.normalize(),p=Math.acos(n.Math.clamp(s[x-1].dot(s[x]),-1,1)),h[x].applyMatrix4(u.makeRotationAxis(c,p))),l[x].crossVectors(s[x],h[x]);if(r)for(p=Math.acos(n.Math.clamp(h[0].dot(h[f-1]),-1,1)),p/=f-1,s[0].dot(c.crossVectors(h[0],h[f-1]))>0&&(p=-p),x=1;x<f;x++)h[x].applyMatrix4(u.makeRotationAxis(s[x],p*x)),l[x].crossVectors(s[x],h[x])},n.PolyhedronGeometry=function(e,t,r,i){n.Geometry.call(this),r=r||1,i=i||0;for(var o=this,a=0,s=e.length;a<s;a++)b(new n.Vector3(e[a][0],e[a][1],e[a][2]));for(var h=[],l=this.vertices,c=[],a=0,s=t.length;a<s;a++){var u=l[t[a][0]],f=l[t[a][1]],p=l[t[a][2]];c[a]=new n.Face3(u.index,f.index,p.index,[u.clone(),f.clone(),p.clone()])}for(var a=0,s=c.length;a<s;a++)_(c[a],i);for(var a=0,s=this.faceVertexUvs[0].length;a<s;a++){var d=this.faceVertexUvs[0][a],m=d[0].x,v=d[1].x,g=d[2].x,y=Math.max(m,Math.max(v,g)),x=Math.min(m,Math.min(v,g));y>.9&&x<.1&&(m<.2&&(d[0].x+=1),v<.2&&(d[1].x+=1),g<.2&&(d[2].x+=1))}for(var a=0,s=this.vertices.length;a<s;a++)this.vertices[a].multiplyScalar(r);function b(e){var t=e.normalize().clone();t.index=o.vertices.push(t)-1;var r=M(e)/2/Math.PI+.5,i=S(e)/Math.PI+.5;return t.uv=new n.Vector2(r,1-i),t}function w(e,t,r){var i=new n.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.centroid.add(e).add(t).add(r).divideScalar(3),o.faces.push(i);var a=M(i.centroid);o.faceVertexUvs[0].push([T(e.uv,e,a),T(t.uv,t,a),T(r.uv,r,a)])}function _(e,t){for(var r=Math.pow(2,t),i=Math.pow(4,t),n=b(o.vertices[e.a]),a=b(o.vertices[e.b]),s=b(o.vertices[e.c]),h=[],l=0;l<=r;l++){h[l]=[];for(var c=b(n.clone().lerp(s,l/r)),u=b(a.clone().lerp(s,l/r)),f=r-l,p=0;p<=f;p++)h[l][p]=0==p&&l==r?c:b(c.clone().lerp(u,p/f))}for(var l=0;l<r;l++)for(var p=0;p<2*(r-l)-1;p++){var d=Math.floor(p/2);p%2==0?w(h[l][d+1],h[l+1][d],h[l][d]):w(h[l][d+1],h[l+1][d+1],h[l+1][d])}}function M(e){return Math.atan2(e.z,-e.x)}function S(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function T(e,t,r){return r<0&&1===e.x&&(e=new n.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new n.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,r)},n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype),n.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var r=(1+Math.sqrt(5))/2,i=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],o=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];n.PolyhedronGeometry.call(this,i,o,e,t)},n.IcosahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.OctahedronGeometry=function(e,t){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];n.PolyhedronGeometry.call(this,r,i,e,t)},n.OctahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.TetrahedronGeometry=function(e,t){var r=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],i=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];n.PolyhedronGeometry.call(this,r,i,e,t)},n.TetrahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.ParametricGeometry=function(e,t,r){n.Geometry.call(this);var i=this.vertices,o=this.faces,a=this.faceVertexUvs[0],s,h,l,c,u,f,p=r+1,d=t+1,m,v,g,y,x,b,w,_;for(s=0;s<=r;s++)for(f=s/r,l=0;l<=t;l++)c=e(u=l/t,f),i.push(c);for(s=0;s<r;s++)for(l=0;l<t;l++)m=s*d+l,v=s*d+l+1,g=(s+1)*d+l+1,y=(s+1)*d+l,x=new n.Vector2(l/t,s/r),b=new n.Vector2((l+1)/t,s/r),w=new n.Vector2((l+1)/t,(s+1)/r),_=new n.Vector2(l/t,(s+1)/r),o.push(new n.Face3(m,v,y)),a.push([x,b,_]),o.push(new n.Face3(v,g,y)),a.push([b.clone(),w,_.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype),n.AxisHelper=function(e){e=e||1;var t=new n.Geometry;t.vertices.push(new n.Vector3,new n.Vector3(e,0,0),new n.Vector3,new n.Vector3(0,e,0),new n.Vector3,new n.Vector3(0,0,e)),t.colors.push(new n.Color(16711680),new n.Color(16755200),new n.Color(65280),new n.Color(11206400),new n.Color(255),new n.Color(43775));var r=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.Line.call(this,t,r,n.LinePieces)},n.AxisHelper.prototype=Object.create(n.Line.prototype),n.ArrowHelper=function(e,t,r,i,o,a){n.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),void 0===o&&(o=.2*r),void 0===a&&(a=.2*o),this.position=t;var s=new n.Geometry;s.vertices.push(new n.Vector3(0,0,0)),s.vertices.push(new n.Vector3(0,1,0)),this.line=new n.Line(s,new n.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line);var h=new n.CylinderGeometry(0,.5,1,5,1);h.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0)),this.cone=new n.Mesh(h,new n.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,a)},n.ArrowHelper.prototype=Object.create(n.Object3D.prototype),n.ArrowHelper.prototype.setDirection=(te=new n.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(te.set(e.z,0,-e.x).normalize(),re=Math.acos(e.y),this.quaternion.setFromAxisAngle(te,re))}),n.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},n.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},n.BoxHelper=function(e){var t=[new n.Vector3(1,1,1),new n.Vector3(-1,1,1),new n.Vector3(-1,-1,1),new n.Vector3(1,-1,1),new n.Vector3(1,1,-1),new n.Vector3(-1,1,-1),new n.Vector3(-1,-1,-1),new n.Vector3(1,-1,-1)];this.vertices=t;var r=new n.Geometry;r.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),n.Line.call(this,r,new n.LineBasicMaterial({color:16776960}),n.LinePieces),void 0!==e&&this.update(e)},n.BoxHelper.prototype=Object.create(n.Line.prototype),n.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,i=t.boundingBox.max,n=this.vertices;n[0].set(i.x,i.y,i.z),n[1].set(r.x,i.y,i.z),n[2].set(r.x,r.y,i.z),n[3].set(i.x,r.y,i.z),n[4].set(i.x,i.y,r.z),n[5].set(r.x,i.y,r.z),n[6].set(r.x,r.y,r.z),n[7].set(i.x,r.y,r.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new n.Box3,n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:r,wireframe:!0}))},n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype),n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},n.CameraHelper=function(e){var t=new n.Geometry,r=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors}),i={},o=16755200,a=16711680,s=43775,h=16777215,l=3355443;function c(e,t,r){u(e,r),u(t,r)}function u(e,r){t.vertices.push(new n.Vector3),t.colors.push(new n.Color(r)),void 0===i[e]&&(i[e]=[]),i[e].push(t.vertices.length-1)}c("n1","n2",o),c("n2","n4",o),c("n4","n3",o),c("n3","n1",o),c("f1","f2",o),c("f2","f4",o),c("f4","f3",o),c("f3","f1",o),c("n1","f1",o),c("n2","f2",o),c("n3","f3",o),c("n4","f4",o),c("p","n1",a),c("p","n2",a),c("p","n3",a),c("p","n4",a),c("u1","u2",s),c("u2","u3",s),c("u3","u1",s),c("c","t",h),c("p","c",l),c("cn1","cn2",l),c("cn3","cn4",l),c("cf1","cf2",l),c("cf3","cf4",l),n.Line.call(this,t,r,n.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},n.CameraHelper.prototype=Object.create(n.Line.prototype),n.CameraHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Camera,r=new n.Projector;return function(){var i=this,n=1,o=1;function a(n,o,a,s){e.set(o,a,s),r.unprojectVector(e,t);var h=i.pointMap[n];if(void 0!==h)for(var l=0,c=h.length;l<c;l++)i.geometry.vertices[h[l]].copy(e)}t.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-1,-1,-1),a("n2",1,-1,-1),a("n3",-1,1,-1),a("n4",1,1,-1),a("f1",-1,-1,1),a("f2",1,-1,1),a("f3",-1,1,1),a("f4",1,1,1),a("u1",.7,1.1,-1),a("u2",-.7,1.1,-1),a("u3",0,2,-1),a("cf1",-1,0,1),a("cf2",1,0,1),a("cf3",0,-1,1),a("cf4",0,1,1),a("cn1",-1,0,-1),a("cn2",1,0,-1),a("cn3",0,-1,-1),a("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),n.DirectionalLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new n.PlaneGeometry(t,t),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new n.Mesh(r,i),this.add(this.lightPlane),(r=new n.Geometry).vertices.push(new n.Vector3),r.vertices.push(new n.Vector3),(i=new n.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new n.Line(r,i),this.add(this.targetLine),this.update()},n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype),n.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},n.DirectionalLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),n.EdgesHelper=function(e,t){var r=void 0!==t?t:16777215,i=[0,0],o={},a=function(e,t){return e-t},s=["a","b","c"],h=new n.BufferGeometry,l=e.geometry.clone();l.mergeVertices(),l.computeFaceNormals();for(var c=l.vertices,u=l.faces,f=0,p=0,d=u.length;p<d;p++)for(var m=u[p],v=0;v<3;v++){var g;i[0]=m[s[v]],i[1]=m[s[(v+1)%3]],i.sort(a),void 0===o[g=i.toString()]?(o[g]={vert1:i[0],vert2:i[1],face1:p,face2:void 0},f++):o[g].face2=p}h.addAttribute("position",Float32Array,2*f,3);var y=h.attributes.position.array,x=0;for(var g in o){var b=o[g];if(void 0===b.face2||u[b.face1].normal.dot(u[b.face2].normal)<.9999){var w=c[b.vert1];y[x++]=w.x,y[x++]=w.y,y[x++]=w.z,w=c[b.vert2],y[x++]=w.x,y[x++]=w.y,y[x++]=w.z}}n.Line.call(this,h,new n.LineBasicMaterial({color:r}),n.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.EdgesHelper.prototype=Object.create(n.Line.prototype),n.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16776960,a=void 0!==i?i:1,s=new n.Geometry,h,l=0,c=this.object.geometry.faces.length;l<c;l++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new n.Matrix3,this.update()},n.FaceNormalsHelper.prototype=Object.create(n.Line.prototype),n.FaceNormalsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.faces,n=this.object.matrixWorld,o=0,a=i.length;o<a;o++){var s=i[o];t.copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var h=2*o;r[h].copy(s.centroid).applyMatrix4(n),r[h+1].addVectors(r[h],t)}return this.geometry.verticesNeedUpdate=!0,this}}(),n.GridHelper=function(e,t){var r=new n.Geometry,i=new n.LineBasicMaterial({vertexColors:n.VertexColors});this.color1=new n.Color(4473924),this.color2=new n.Color(8947848);for(var o=-e;o<=e;o+=t){r.vertices.push(new n.Vector3(-e,0,o),new n.Vector3(e,0,o),new n.Vector3(o,0,-e),new n.Vector3(o,0,e));var a=0===o?this.color1:this.color2;r.colors.push(a,a,a,a)}n.Line.call(this,r,i,n.LinePieces)},n.GridHelper.prototype=Object.create(n.Line.prototype),n.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},n.HemisphereLightHelper=function(e,t,r,i){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new n.Color,new n.Color];var o=new n.SphereGeometry(t,4,2);o.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));for(var a=0,s=8;a<8;a++)o.faces[a].color=this.colors[a<4?0:1];var h=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:!0});this.lightSphere=new n.Mesh(o,h),this.add(this.lightSphere),this.update()},n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype),n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},n.HemisphereLightHelper.prototype.update=function(){var e=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),n.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new n.SphereGeometry(t,4,2),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.Mesh.call(this,r,i),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},n.PointLightHelper.prototype=Object.create(n.Mesh.prototype),n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},n.SpotLightHelper=function(e){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new n.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));var r=new n.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new n.Mesh(t,r),this.add(this.cone),this.update()},n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype),n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.SpotLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),n.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16711680,a=void 0!==i?i:1,s=new n.Geometry,h=e.geometry.vertices,l=e.geometry.faces,c=0,u=l.length;c<u;c++)for(var f,p=0,d=l[c].vertexNormals.length;p<d;p++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new n.Matrix3,this.update()},n.VertexNormalsHelper.prototype=Object.create(n.Line.prototype),n.VertexNormalsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=o.length;h<l;h++)for(var c=o[h],u=0,f=c.vertexNormals.length;u<f;u++){var p,d=n[c[r[u]]],m=c.vertexNormals[u];i[s].copy(d).applyMatrix4(a),t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),n.VertexTangentsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:255,a=void 0!==i?i:1,s=new n.Geometry,h=e.geometry.vertices,l=e.geometry.faces,c=0,u=l.length;c<u;c++)for(var f,p=0,d=l[c].vertexTangents.length;p<d;p++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.update()},n.VertexTangentsHelper.prototype=Object.create(n.Line.prototype),n.VertexTangentsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=o.length;h<l;h++)for(var c=o[h],u=0,f=c.vertexTangents.length;u<f;u++){var p,d=n[c[r[u]]],m=c.vertexTangents[u];i[s].copy(d).applyMatrix4(a),t.copy(m).transformDirection(a).multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),n.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215,i=[0,0],o={},a=function(e,t){return e-t},s=["a","b","c"],h=new n.BufferGeometry;if(e.geometry instanceof n.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,u=0,f=new Uint32Array(6*c.length),p=0,d=c.length;p<d;p++)for(var m=c[p],v=0;v<3;v++){var g;i[0]=m[s[v]],i[1]=m[s[(v+1)%3]],i.sort(a),void 0===o[g=i.toString()]&&(f[2*u]=i[0],f[2*u+1]=i[1],o[g]=!0,u++)}h.addAttribute("position",Float32Array,2*u,3);for(var y=h.attributes.position.array,p=0,d=u;p<d;p++)for(var v=0;v<2;v++){var x=l[f[2*p+v]],b;y[(b=6*p+3*v)+0]=x.x,y[b+1]=x.y,y[b+2]=x.z}}else if(e.geometry instanceof n.BufferGeometry&&void 0!==e.geometry.attributes.index){for(var l=e.geometry.attributes.position.array,w=e.geometry.attributes.index.array,_=e.geometry.offsets,u=0,f=new Uint32Array(2*w.length),M=0,S=_.length;M<S;++M)for(var T=_[M].start,C=_[M].count,b=_[M].index,p=T,A=T+C;p<A;p+=3)for(var v=0;v<3;v++){var g;i[0]=b+w[p+v],i[1]=b+w[p+(v+1)%3],i.sort(a),void 0===o[g=i.toString()]&&(f[2*u]=i[0],f[2*u+1]=i[1],o[g]=!0,u++)}h.addAttribute("position",Float32Array,2*u,3);for(var y=h.attributes.position.array,p=0,d=u;p<d;p++)for(var v=0;v<2;v++){var b=6*p+3*v,E=3*f[2*p+v];y[b+0]=l[E],y[b+1]=l[E+1],y[b+2]=l[E+2]}}else if(e.geometry instanceof n.BufferGeometry){var l,u,P=(u=(l=e.geometry.attributes.position.array).length/3)/3;h.addAttribute("position",Float32Array,2*u,3);for(var y=h.attributes.position.array,p=0,d=P;p<d;p++)for(var v=0;v<3;v++){var b,L=9*p+3*v;y[(b=18*p+6*v)+0]=l[L],y[b+1]=l[L+1],y[b+2]=l[L+2];var E=9*p+(v+1)%3*3;y[b+3]=l[E],y[b+4]=l[E+1],y[b+5]=l[E+2]}}n.Line.call(this,h,new n.LineBasicMaterial({color:r}),n.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.WireframeHelper.prototype=Object.create(n.Line.prototype),n.ImmediateRenderObject=function(){n.Object3D.call(this),this.render=function(e){}},n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype),n.LensFlare=function(e,t,r,i,o){n.Object3D.call(this),this.lensFlares=[],this.positionScreen=new n.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,o)},n.LensFlare.prototype=Object.create(n.Object3D.prototype),n.LensFlare.prototype.add=function(e,t,r,i,o,a){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=new n.Color(16777215)),void 0===i&&(i=n.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:i})},n.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,r,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<t;e++)(r=this.lensFlares[e]).x=this.positionScreen.x+i*r.distance,r.y=this.positionScreen.y+n*r.distance,r.wantedRotation=r.x*Math.PI*.25,r.rotation+=.25*(r.wantedRotation-r.rotation)},n.MorphBlendMesh=function(e,t){n.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",o=0,a=r-1,s=r/1;this.createAnimation(i,0,a,s),this.setAnimationWeight(i,1)},n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype),n.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},n.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,r,i={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s,h=n.morphTargets[o].name.match(t);if(h&&h.length>1){var l=h[1],c=h[2],u;i[l]||(i[l]={start:1/0,end:-1/0}),o<(u=i[l]).start&&(u.start=o),o>u.end&&(u.end=o),r||(r=l)}}for(var l in i){var u=i[l];this.createAnimation(l,u.start,u.end,e)}this.firstAnimation=r},n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},n.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},n.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},n.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},n.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},n.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},n.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},n.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},n.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},n.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var o=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.startFrame+n.Math.clamp(Math.floor(i.time/o),0,i.length-1),s=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var h=i.time%o/o;i.directionBackwards&&(h=1-h),this.morphTargetInfluences[i.currentFrame]=h*s,this.morphTargetInfluences[i.lastFrame]=(1-h)*s}}},n.LensFlarePlugin=function(){var e,t,r,i={};function o(t,r){var i=e.createProgram(),n=e.createShader(e.FRAGMENT_SHADER),o=e.createShader(e.VERTEX_SHADER),a="precision "+r+" float;\n";return e.shaderSource(n,a+t.fragmentShader),e.shaderSource(o,a+t.vertexShader),e.compileShader(n),e.compileShader(o),e.attachShader(i,n),e.attachShader(i,o),e.linkProgram(i),i}this.init=function(a){e=a.context,t=a,r=a.getPrecision(),i.vertices=new Float32Array(16),i.faces=new Uint16Array(6);var s=0;i.vertices[s++]=-1,i.vertices[s++]=-1,i.vertices[s++]=0,i.vertices[s++]=0,i.vertices[s++]=1,i.vertices[s++]=-1,i.vertices[s++]=1,i.vertices[s++]=0,i.vertices[s++]=1,i.vertices[s++]=1,i.vertices[s++]=1,i.vertices[s++]=1,i.vertices[s++]=-1,i.vertices[s++]=1,i.vertices[s++]=0,i.vertices[s++]=1,s=0,i.faces[s++]=0,i.faces[s++]=1,i.faces[s++]=2,i.faces[s++]=0,i.faces[s++]=2,i.faces[s++]=3,i.vertexBuffer=e.createBuffer(),i.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,i.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW),i.tempTexture=e.createTexture(),i.occlusionTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,i.occlusionTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(i.hasVertexTexture=!1,i.program=o(n.ShaderFlares.lensFlare,r)):(i.hasVertexTexture=!0,i.program=o(n.ShaderFlares.lensFlareVertexTexture,r)),i.attributes={},i.uniforms={},i.attributes.vertex=e.getAttribLocation(i.program,"position"),i.attributes.uv=e.getAttribLocation(i.program,"uv"),i.uniforms.renderType=e.getUniformLocation(i.program,"renderType"),i.uniforms.map=e.getUniformLocation(i.program,"map"),i.uniforms.occlusionMap=e.getUniformLocation(i.program,"occlusionMap"),i.uniforms.opacity=e.getUniformLocation(i.program,"opacity"),i.uniforms.color=e.getUniformLocation(i.program,"color"),i.uniforms.scale=e.getUniformLocation(i.program,"scale"),i.uniforms.rotation=e.getUniformLocation(i.program,"rotation"),i.uniforms.screenPosition=e.getUniformLocation(i.program,"screenPosition")},this.render=function(r,o,a,s){var h=r.__webglFlares,l=h.length;if(l){var c=new n.Vector3,u=s/a,f=.5*a,p=.5*s,d=16/s,m=new n.Vector2(d*u,d),v=new n.Vector3(1,1,0),g=new n.Vector2(1,1),y=i.uniforms,x=i.attributes,b,w,_,M,S;for(e.useProgram(i.program),e.enableVertexAttribArray(i.attributes.vertex),e.enableVertexAttribArray(i.attributes.uv),e.uniform1i(y.occlusionMap,0),e.uniform1i(y.map,1),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.vertexAttribPointer(x.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(x.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.disable(e.CULL_FACE),e.depthMask(!1),b=0;b<l;b++)if(d=16/s,m.set(d*u,d),M=h[b],c.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),c.applyMatrix4(o.matrixWorldInverse),c.applyProjection(o.projectionMatrix),v.copy(c),g.x=v.x*f+f,g.y=v.y*p+p,i.hasVertexTexture||g.x>0&&g.x<a&&g.y>0&&g.y<s)for(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,g.x-8,g.y-8,16,16,0),e.uniform1i(y.renderType,0),e.uniform2f(y.scale,m.x,m.y),e.uniform3f(y.screenPosition,v.x,v.y,v.z),e.disable(e.BLEND),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.occlusionTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,g.x-8,g.y-8,16,16,0),e.uniform1i(y.renderType,1),e.disable(e.DEPTH_TEST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i.tempTexture),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),M.positionScreen.copy(v),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),e.uniform1i(y.renderType,2),e.enable(e.BLEND),w=0,_=M.lensFlares.length;w<_;w++)(S=M.lensFlares[w]).opacity>.001&&S.scale>.001&&(v.x=S.x,v.y=S.y,v.z=S.z,d=S.size*S.scale/s,m.x=d*u,m.y=d,e.uniform3f(y.screenPosition,v.x,v.y,v.z),e.uniform2f(y.scale,m.x,m.y),e.uniform1f(y.rotation,S.rotation),e.uniform1f(y.opacity,S.opacity),e.uniform3f(y.color,S.color.r,S.color.g,S.color.b),t.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),t.setTexture(S.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthMask(!0)}}},n.ShadowMapPlugin=function(){var e,t,r,i,o,a,s=new n.Frustum,h=new n.Matrix4,l=new n.Vector3,c=new n.Vector3,u=new n.Vector3;function f(e,t){var r=new n.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,o=r.pointsFrustum,a=0;a<8;a++)i[a]=new n.Vector3,o[a]=new n.Vector3;var s=e.shadowCascadeNearZ[t],h=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,s),o[1].set(1,-1,s),o[2].set(-1,1,s),o[3].set(1,1,s),o[4].set(-1,-1,h),o[5].set(1,-1,h),o[6].set(-1,1,h),o[7].set(1,1,h),r}function p(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function d(e,t){var r=t.shadowCamera,i=t.pointsFrustum,o=t.pointsWorld;l.set(1/0,1/0,1/0),c.set(-1/0,-1/0,-1/0);for(var a=0;a<8;a++){var s=o[a];s.copy(i[a]),n.ShadowMapPlugin.__projector.unprojectVector(s,e),s.applyMatrix4(r.matrixWorldInverse),s.x<l.x&&(l.x=s.x),s.x>c.x&&(c.x=s.x),s.y<l.y&&(l.y=s.y),s.y>c.y&&(c.y=s.y),s.z<l.z&&(l.z=s.z),s.z>c.z&&(c.z=s.z)}r.left=l.x,r.right=c.x,r.top=c.y,r.bottom=l.y,r.updateProjectionMatrix()}function m(e){return e.material instanceof n.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(s){e=s.context,t=s;var h=n.ShaderLib.depthRGBA,l=n.UniformsUtils.clone(h.uniforms);r=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l}),i=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,morphTargets:!0}),o=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,skinning:!0}),a=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(e,r){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,r)},this.update=function(l,c){var v,g,y,x,b,w,_,M,S,T,C,A,E,P,L,D=[],F=0,R=null;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===n.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),v=0,g=l.__lights.length;v<g;v++)if((P=l.__lights[v]).castShadow)if(P instanceof n.DirectionalLight&&P.shadowCascade)for(b=0;b<P.shadowCascadeCount;b++){var V;if(P.shadowCascadeArray[b])V=P.shadowCascadeArray[b];else{(V=f(P,b)).originalCamera=c;var U=new n.Gyroscope;U.position=P.shadowCascadeOffset,U.add(V),U.add(V.target),c.add(U),P.shadowCascadeArray[b]=V,console.log("Created virtualLight",V)}p(P,b),D[F]=V,F++}else D[F]=P,F++;for(v=0,g=D.length;v<g;v++){if(!(P=D[v]).shadowMap){var z=n.LinearFilter;t.shadowMapType===n.PCFSoftShadowMap&&(z=n.NearestFilter);var O={minFilter:z,magFilter:z,format:n.RGBAFormat};P.shadowMap=new n.WebGLRenderTarget(P.shadowMapWidth,P.shadowMapHeight,O),P.shadowMapSize=new n.Vector2(P.shadowMapWidth,P.shadowMapHeight),P.shadowMatrix=new n.Matrix4}if(!P.shadowCamera){if(P instanceof n.SpotLight)P.shadowCamera=new n.PerspectiveCamera(P.shadowCameraFov,P.shadowMapWidth/P.shadowMapHeight,P.shadowCameraNear,P.shadowCameraFar);else{if(!(P instanceof n.DirectionalLight)){console.error("Unsupported light type for shadow");continue}P.shadowCamera=new n.OrthographicCamera(P.shadowCameraLeft,P.shadowCameraRight,P.shadowCameraTop,P.shadowCameraBottom,P.shadowCameraNear,P.shadowCameraFar)}l.add(P.shadowCamera),!0===l.autoUpdate&&l.updateMatrixWorld()}for(P.shadowCameraVisible&&!P.cameraHelper&&(P.cameraHelper=new n.CameraHelper(P.shadowCamera),P.shadowCamera.add(P.cameraHelper)),P.isVirtual&&V.originalCamera==c&&d(c,P),w=P.shadowMap,_=P.shadowMatrix,(M=P.shadowCamera).position.setFromMatrixPosition(P.matrixWorld),u.setFromMatrixPosition(P.target.matrixWorld),M.lookAt(u),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),P.cameraHelper&&(P.cameraHelper.visible=P.shadowCameraVisible),P.shadowCameraVisible&&P.cameraHelper.update(),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(M.projectionMatrix),_.multiply(M.matrixWorldInverse),h.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),s.setFromMatrix(h),t.setRenderTarget(w),t.clear(),y=0,x=(L=l.__webglObjects).length;y<x;y++)E=(A=L[y]).object,A.render=!1,E.visible&&E.castShadow&&((E instanceof n.Mesh||E instanceof n.ParticleSystem)&&E.frustumCulled&&!s.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,E.matrixWorld),A.render=!0));var N,B,I;for(y=0,x=L.length;y<x;y++)(A=L[y]).render&&(E=A.object,T=A.buffer,N=m(E),B=void 0!==E.geometry.morphTargets&&E.geometry.morphTargets.length>0&&N.morphTargets,I=E instanceof n.SkinnedMesh&&N.skinning,C=E.customDepthMaterial?E.customDepthMaterial:I?B?a:o:B?i:r,T instanceof n.BufferGeometry?t.renderBufferDirect(M,l.__lights,R,C,T,E):t.renderBuffer(M,l.__lights,R,C,T,E));for(y=0,x=(L=l.__webglObjectsImmediate).length;y<x;y++)(E=(A=L[y]).object).visible&&E.castShadow&&(E._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,E.matrixWorld),t.renderImmediateObject(M,l.__lights,R,r,E))}var k=t.getClearColor(),j=t.getClearAlpha();e.clearColor(k.r,k.g,k.b,j),e.enable(e.BLEND),t.shadowMapCullFace===n.CullFaceFront&&e.cullFace(e.BACK)}},n.ShadowMapPlugin.__projector=new n.Projector,n.SpritePlugin=function(){var e,t,r,i,o,a,s,h,l,c;function u(){var r=e.createProgram(),i=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),e.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),e.compileShader(i),e.compileShader(n),e.attachShader(r,i),e.attachShader(r,n),e.linkProgram(r),r}function f(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.init=function(f){e=f.context,t=f,i=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),o=new Uint16Array([0,1,2,0,2,3]),a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),h=u(),l={position:e.getAttribLocation(h,"position"),uv:e.getAttribLocation(h,"uv")},c={uvOffset:e.getUniformLocation(h,"uvOffset"),uvScale:e.getUniformLocation(h,"uvScale"),rotation:e.getUniformLocation(h,"rotation"),scale:e.getUniformLocation(h,"scale"),color:e.getUniformLocation(h,"color"),map:e.getUniformLocation(h,"map"),opacity:e.getUniformLocation(h,"opacity"),modelViewMatrix:e.getUniformLocation(h,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(h,"projectionMatrix"),fogType:e.getUniformLocation(h,"fogType"),fogDensity:e.getUniformLocation(h,"fogDensity"),fogNear:e.getUniformLocation(h,"fogNear"),fogFar:e.getUniformLocation(h,"fogFar"),fogColor:e.getUniformLocation(h,"fogColor"),alphaTest:e.getUniformLocation(h,"alphaTest")};var p=document.createElement("canvas");p.width=8,p.height=8;var d=p.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,p.width,p.height),(r=new n.Texture(p)).needsUpdate=!0},this.render=function(i,o,u,p){var d=i.__webglSprites,m=d.length;if(m){e.useProgram(h),e.enableVertexAttribArray(l.position),e.enableVertexAttribArray(l.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.uniformMatrix4fv(c.projectionMatrix,!1,o.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(c.map,0);var v=0,g=0,y=i.fog;y?(e.uniform3f(c.fogColor,y.color.r,y.color.g,y.color.b),y instanceof n.Fog?(e.uniform1f(c.fogNear,y.near),e.uniform1f(c.fogFar,y.far),e.uniform1i(c.fogType,1),v=1,g=1):y instanceof n.FogExp2&&(e.uniform1f(c.fogDensity,y.density),e.uniform1i(c.fogType,2),v=2,g=2)):(e.uniform1i(c.fogType,0),v=0,g=0);var x,b,w,_,M=[];for(x=0;x<m;x++)w=(b=d[x]).material,!1!==b.visible&&(b._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,b.matrixWorld),b.z=-b._modelViewMatrix.elements[14]);for(d.sort(f),x=0;x<m;x++)!1!==(b=d[x]).visible&&(w=b.material,e.uniform1f(c.alphaTest,w.alphaTest),e.uniformMatrix4fv(c.modelViewMatrix,!1,b._modelViewMatrix.elements),M[0]=b.scale.x,M[1]=b.scale.y,v!==(_=i.fog&&w.fog?g:0)&&(e.uniform1i(c.fogType,_),v=_),null!==w.map?(e.uniform2f(c.uvOffset,w.map.offset.x,w.map.offset.y),e.uniform2f(c.uvScale,w.map.repeat.x,w.map.repeat.y)):(e.uniform2f(c.uvOffset,0,0),e.uniform2f(c.uvScale,1,1)),e.uniform1f(c.opacity,w.opacity),e.uniform3f(c.color,w.color.r,w.color.g,w.color.b),e.uniform1f(c.rotation,w.rotation),e.uniform2fv(c.scale,M),t.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst),t.setDepthTest(w.depthTest),t.setDepthWrite(w.depthWrite),w.map&&w.map.image&&w.map.image.width?t.setTexture(w.map,0):t.setTexture(r,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE)}}},n.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,r,i,o,a,s=new n.Frustum,h=new n.Matrix4;function l(e){return e.material instanceof n.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(s){e=s.context,t=s;var h=n.ShaderLib.depthRGBA,l=n.UniformsUtils.clone(h.uniforms);r=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l}),i=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,morphTargets:!0}),o=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,skinning:!0}),a=new n.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(c,u){var f,p,d,m,v,g,y,x,b,w,_,M,S=null,T,C,A;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===c.autoUpdate&&c.updateMatrixWorld(),u.matrixWorldInverse.getInverse(u.matrixWorld),h.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),s.setFromMatrix(h),t.setRenderTarget(this.renderTarget),t.clear(),d=0,m=(M=c.__webglObjects).length;d<m;d++)w=(b=M[d]).object,b.render=!1,w.visible&&((w instanceof n.Mesh||w instanceof n.ParticleSystem)&&w.frustumCulled&&!s.intersectsObject(w)||(w._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,w.matrixWorld),b.render=!0));for(d=0,m=M.length;d<m;d++)if((b=M[d]).render){if(w=b.object,y=b.buffer,w instanceof n.ParticleSystem&&!w.customDepthMaterial)continue;(T=l(w))&&t.setMaterialFaces(w.material),C=w.geometry.morphTargets.length>0&&T.morphTargets,A=w instanceof n.SkinnedMesh&&T.skinning,x=w.customDepthMaterial?w.customDepthMaterial:A?C?a:o:C?i:r,y instanceof n.BufferGeometry?t.renderBufferDirect(u,c.__lights,S,x,y,w):t.renderBuffer(u,c.__lights,S,x,y,w)}for(d=0,m=(M=c.__webglObjectsImmediate).length;d<m;d++)(w=(b=M[d]).object).visible&&(w._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,w.matrixWorld),t.renderImmediateObject(u,c.__lights,S,r,w));var E=t.getClearColor(),P=t.getClearAlpha();e.clearColor(E.r,E.g,E.b,P),e.enable(e.BLEND)}},n.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},void 0!==r?(void 0!==t&&t.exports&&(r=t.exports=n),r.THREE=n):this.THREE=n},{}],13:[function(e,t,r){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var i=i||(n=[],{REVISION:"13",getAll:function(){return n},removeAll:function(){n=[]},add:function(e){n.push(e)},remove:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)},update:function(e){if(0===n.length)return!1;var t=0;for(e=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();t<n.length;)n[t].update(e)?t++:n.splice(t,1);return!0}}),n,o;i.Tween=function(e){var t=e,r={},n={},o={},a=1e3,s=0,h=!1,l=!1,c=!1,u=0,f=null,p=i.Easing.Linear.None,d=i.Interpolation.Linear,m=[],v=null,g=!1,y=null,x=null,b=null;for(var w in e)r[w]=parseFloat(e[w],10);this.to=function(e,t){return void 0!==t&&(a=t),n=e,this},this.start=function(e){for(var a in i.add(this),l=!0,g=!1,f=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),f+=u,n){if(n[a]instanceof Array){if(0===n[a].length)continue;n[a]=[t[a]].concat(n[a])}r[a]=t[a],r[a]instanceof Array==!1&&(r[a]*=1),o[a]=r[a]||0}return this},this.stop=function(){return l?(i.remove(this),l=!1,null!==b&&b.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=m.length;e<t;e++)m[e].stop()},this.delay=function(e){return u=e,this},this.repeat=function(e){return s=e,this},this.yoyo=function(e){return h=e,this},this.easing=function(e){return p=e,this},this.interpolation=function(e){return d=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return v=e,this},this.onUpdate=function(e){return y=e,this},this.onComplete=function(e){return x=e,this},this.onStop=function(e){return b=e,this},this.update=function(e){var i;if(e<f)return!0;!1===g&&(null!==v&&v.call(t),g=!0);var l=(e-f)/a,b=p(l=l>1?1:l);for(i in n){var w=r[i]||0,_=n[i];_ instanceof Array?t[i]=d(_,b):("string"==typeof _&&(_=w+parseFloat(_,10)),"number"==typeof _&&(t[i]=w+(_-w)*b))}if(null!==y&&y.call(t,b),1==l){if(s>0){for(i in isFinite(s)&&s--,o){if("string"==typeof n[i]&&(o[i]=o[i]+parseFloat(n[i],10)),h){var M=o[i];o[i]=n[i],n[i]=M}r[i]=o[i]}return h&&(c=!c),f=e+u,!0}null!==x&&x.call(t);for(var S=0,T=m.length;S<T;S++)m[S].start(e);return!1}return!0}},i.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,r=.1,i=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=.1):t=i*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i))},Out:function(e){var t,r=.1,i=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=.1):t=i*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/i)+1)},InOut:function(e){var t,r=.1,i=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=.1):t=i*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*-.5:r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-i.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*i.Easing.Bounce.In(2*e):.5*i.Easing.Bounce.Out(2*e-1)+.5}}},i.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,o=Math.floor(n),a=i.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[o],e[o+1>r?r:o+1],n-o)},Bezier:function(e,t){var r=0,n=e.length-1,o=Math.pow,a=i.Interpolation.Utils.Bernstein,s;for(s=0;s<=n;s++)r+=o(1-t,n-s)*o(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,o=Math.floor(n),a=i.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(o=Math.floor(n=r*(1+t))),a(e[(o-1+r)%r],e[o],e[(o+1)%r],e[(o+2)%r],n-o)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[o?o-1:0],e[o],e[r<o+1?r:o+1],e[r<o+2?r:o+2],n-o)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=i.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(o=[1],function(e){var t=1,r;if(o[e])return o[e];for(r=e;r>1;r--)t*=r;return o[e]=t}),CatmullRom:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,h;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}}},t.exports=i},{}],14:[function(e,t,r){!function e(r,i,n){var o=function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=function(e){return e!==n};function s(e,t){if(!(this instanceof s))return new s(e,t);o(e)?(t=e[1],e=e[0]):"object"==typeof e&&e&&(t=e.y,e=e.x),this.x=s.clean(e||0),this.y=s.clean(t||0)}s.prototype={change:function(e){if("function"==typeof e)this.observers?this.observers.push(e):this.observers=[e];else if(this.observers&&this.observers.length)for(var t=this.observers.length-1;t>=0;t--)this.observers[t](this,e);return this},ignore:function(e){if(this.observers)if(e)for(var t=this.observers,r=t.length;r--;)t[r]===e&&t.splice(r,1);else this.observers=[];return this},set:function(e,t,r){if("number"!=typeof e&&(r=t,t=e.y,e=e.x),this.x===e&&this.y===t)return this;var i=null;return!1!==r&&this.observers&&this.observers.length&&(i=this.clone()),this.x=s.clean(e),this.y=s.clean(t),!1!==r?this.change(i):void 0},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(e){return e?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(e,t,r){return"number"!=typeof e&&(r=t,o(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),e+=this.x,t+=this.y,r?new this.constructor(e,t):this.set(e,t)},subtract:function(e,t,r){return"number"!=typeof e&&(r=t,o(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),e=this.x-e,t=this.y-t,r?new this.constructor(e,t):this.set(e,t)},multiply:function(e,t,r){return"number"!=typeof e?(r=t,o(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)):"number"!=typeof t&&(r=t,t=e),e*=this.x,t*=this.y,r?new this.constructor(e,t):this.set(e,t)},rotate:function(e,t,r){var i=this.x,n=this.y,o=Math.cos(e),a=Math.sin(e),s,h;return s=o*i-(t=t?-1:1)*a*n,h=t*a*i+o*n,r?new this.constructor(s,h):this.set(s,h)},length:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},lengthSquared:function(){var e=this.x,t=this.y;return e*e+t*t},distance:function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},normalize:function(e){var t=this.length(),r=t<Number.MIN_VALUE?0:1/t;return e?new this.constructor(this.x*r,this.y*r):this.set(this.x*r,this.y*r)},equal:function(e,t){return"number"!=typeof e&&(o(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),s.clean(e)===this.x&&s.clean(t)===this.y},abs:function(e){var t=Math.abs(this.x),r=Math.abs(this.y);return e?new this.constructor(t,r):this.set(t,r)},min:function(e,t){var r=this.x,i=this.y,n=e.x,o=e.y,a=r<n?r:n,s=i<o?i:o;return t?new this.constructor(a,s):this.set(a,s)},max:function(e,t){var r=this.x,i=this.y,n=e.x,o=e.y,a=r>n?r:n,s=i>o?i:o;return t?new this.constructor(a,s):this.set(a,s)},clamp:function(e,t,r){var i=this.min(t,!0).max(e);return r?i:this.set(i.x,i.y)},lerp:function(e,t,r){return this.add(e.subtract(this,!0).multiply(t),r)},skew:function(e){return e?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(e){return s.clean(this.x*e.x+e.y*this.y)},perpDot:function(e){return s.clean(this.x*e.y-this.y*e.x)},angleTo:function(e){return Math.atan2(this.perpDot(e),this.dot(e))},divide:function(e,t,r){if("number"!=typeof e?(r=t,o(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)):"number"!=typeof t&&(r=t,t=e),0===e||0===t)throw new Error("division by zero");if(isNaN(e)||isNaN(t))throw new Error("NaN detected");return r?new this.constructor(this.x/e,this.y/t):this.set(this.x/e,this.y/t)},isPointOnLine:function(e,t){return(e.y-this.y)*(e.x-t.x)===(e.y-t.y)*(e.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(e){return this.set(e[0],e[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:s},s.fromArray=function(e,t){return new(t||s)(e[0],e[1])},s.precision=i||8;var h=Math.pow(10,s.precision);return s.clean=r||function(e){if(isNaN(e))throw new Error("NaN detected");if(!isFinite(e))throw new Error("Infinity detected");return Math.round(e)===e?e:Math.round(e*h)/h},s.inject=e,r||(s.fast=e(function(e){return e}),void 0!==t&&"object"==typeof t.exports?t.exports=s:window.Vec2=window.Vec2||s),s}()},{}],15:[function(e,t,r){var i=e("tween.js"),n=e("three"),o=e("hexasphere.js"),a=e("quadtree2"),s=e("vec2"),h=e("./Pin"),l=e("./Marker"),c=e("./Satellite"),u=e("./SmokeProvider"),f=e("pusher.color"),p=e("./utils"),d=function(e,t,r,i){var n,o;return{x:Math.floor(e/2+e/360*i),y:Math.floor(t/2+t/180*r)}},m=function(e,t){var r;return{x:e+90,y:t+180,rad:2+Math.abs(e)/90*15}},v=function(){if(0!=this.data.length){for(;this.data.length>0&&this.firstRunTime+(next=this.data.pop()).when<Date.now();)this.addPin(next.lat,next.lng,next.label);this.firstRunTime+next.when>=Date.now()&&this.data.push(next)}},g=function(){this.hexGrid&&this.scene.remove(this.hexGrid);var e=["#define PI 3.141592653589793238462643","#define DISTANCE 500.0","#define INTRODURATION "+(parseFloat(this.introLinesDuration)+1e-5),"#define INTROALTITUDE "+(parseFloat(this.introLinesAltitude)+1e-5),"attribute float lng;","uniform float currentTime;","varying vec4 vColor;","","void main()","{","   vec3 newPos = position;","   float opacityVal = 0.0;","   float introStart = INTRODURATION * ((180.0 + lng)/360.0);","   if(currentTime > introStart){","      opacityVal = 1.0;","   }","   if(currentTime > introStart && currentTime < introStart + INTRODURATION / 8.0){","      newPos = position * INTROALTITUDE;","      opacityVal = .3;","   }","   if(currentTime > introStart + INTRODURATION / 8.0 && currentTime < introStart + INTRODURATION / 8.0 + 200.0){","      newPos = position * (1.0 + ((INTROALTITUDE-1.0) * (1.0-(currentTime - introStart-(INTRODURATION/8.0))/200.0)));","   }","   vColor = vec4( color, opacityVal );","   gl_Position = projectionMatrix * modelViewMatrix * vec4(newPos, 1.0);","}"].join("\n"),t=["varying vec4 vColor;","void main()","{","   gl_FragColor = vColor;","   float depth = gl_FragCoord.z / gl_FragCoord.w;","   float fogFactor = smoothstep("+parseInt(this.cameraDistance)+".0,"+parseInt(this.cameraDistance+300)+".0, depth );","   vec3 fogColor = vec3(0.0);","   gl_FragColor = mix( vColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),r={lng:{type:"f",value:null}};this.pointUniforms={currentTime:{type:"f",value:0}};var i=new n.ShaderMaterial({uniforms:this.pointUniforms,attributes:r,vertexShader:e,fragmentShader:t,transparent:!0,vertexColors:n.VertexColors,side:n.DoubleSide}),o=4*this.tiles.length,a=new n.BufferGeometry;a.addAttribute("index",Uint16Array,3*o,1),a.addAttribute("position",Float32Array,3*o,3),a.addAttribute("normal",Float32Array,3*o,3),a.addAttribute("color",Float32Array,3*o,3),a.addAttribute("lng",Float32Array,3*o,1);for(var s=a.attributes.lng.array,h=f(this.baseColor).hueSet(),l=[],c=0;c<h.length;c++)l.push(h[c].shade(Math.random()/3));for(var u=21845,p=a.attributes.index.array,c=0;c<p.length;c++)p[c]=c%65535;for(var d=a.attributes.position.array,m=a.attributes.color.array,v=800,g=400,y=12,x=6,b=function(e,t,r,i,n,o,a,h,c,u,f,p,v){var g=3*e,y=3*g,x=Math.floor(Math.random()*l.length),b=l[x].rgb();s[g]=p,s[g+1]=p,s[g+2]=p,d[y]=t,d[y+1]=r,d[y+2]=i,d[y+3]=n,d[y+4]=o,d[y+5]=a,d[y+6]=h,d[y+7]=c,d[y+8]=u,m[y]=v.r,m[y+1]=v.g,m[y+2]=v.b,m[y+3]=v.r,m[y+4]=v.g,m[y+5]=v.b,m[y+6]=v.r,m[y+7]=v.g,m[y+8]=v.b},c=0;c<this.tiles.length;c++){var w=this.tiles[c],_=4*c,M=Math.floor(Math.random()*l.length),S=l[M].rgb(),T=new n.Color;T.setRGB(S[0]/255,S[1]/255,S[2]/255),b(_,w.b[0].x,w.b[0].y,w.b[0].z,w.b[1].x,w.b[1].y,w.b[1].z,w.b[2].x,w.b[2].y,w.b[2].z,w.lat,w.lon,T),b(_+1,w.b[0].x,w.b[0].y,w.b[0].z,w.b[2].x,w.b[2].y,w.b[2].z,w.b[3].x,w.b[3].y,w.b[3].z,w.lat,w.lon,T),b(_+2,w.b[0].x,w.b[0].y,w.b[0].z,w.b[3].x,w.b[3].y,w.b[3].z,w.b[4].x,w.b[4].y,w.b[4].z,w.lat,w.lon,T),w.b.length>5&&b(_+3,w.b[0].x,w.b[0].y,w.b[0].z,w.b[5].x,w.b[5].y,w.b[5].z,w.b[4].x,w.b[4].y,w.b[4].z,w.lat,w.lon,T)}a.offsets=[];for(var C=o/u,c=0;c<C;c++){var A={start:c*u*3,index:c*u*3,count:3*Math.min(o-c*u,u)};a.offsets.push(A)}a.computeBoundingSphere(),this.hexGrid=new n.Mesh(a,i),this.scene.add(this.hexGrid)},y=function(){for(var e,t=new n.LineBasicMaterial({color:this.introLinesColor,transparent:!0,linewidth:2,opacity:.5}),r=0;r<this.introLinesCount;r++){var i=new n.Geometry,o=180*Math.random()+90,a=5*Math.random(),s=4+Math.floor(5*Math.random());Math.random()<.3&&(a=30*Math.random()-50,s=3+Math.floor(3*Math.random()));for(var h=0;h<s;h++){var l=p.mapPoint(o,a-5*h);e=new n.Vector3(l.x*this.introLinesAltitude,l.y*this.introLinesAltitude,l.z*this.introLinesAltitude),i.vertices.push(e)}this.introLines.add(new n.Line(i,t))}this.scene.add(this.introLines)};function x(e,t,r){var i=.7;r||(r={}),this.width=e,this.height=t,this.points=[],this.introLines=new n.Object3D,this.pins=[],this.markers=[],this.satelliteAnimations=[],this.satelliteMeshes=[],this.satellites={},this.quadtree=new a(new s(180,360),5),this.active=!0;var o={font:"Inconsolata",baseColor:"#ffcc00",markerColor:"#ffcc00",pinColor:"#00eeee",satelliteColor:"#ff0000",blankPercentage:0,thinAntarctica:.01,mapUrl:"resources/equirectangle_projection.png",introLinesAltitude:1.1,introLinesDuration:2e3,introLinesColor:"#8FD8D8",introLinesCount:60,scale:1,dayLength:28e3,pointsPerDegree:1.1,pointSize:.6,pointsVariance:.2,maxPins:500,maxMarkers:4,data:[],tiles:[],viewAngle:0};for(var h in o)this[h]||(this[h]=o[h],r[h]&&(this[h]=r[h]));this.setScale(this.scale),this.renderer=new n.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(this.width,this.height),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.domElement=this.renderer.domElement,this.data.sort(function(e,t){return t.lng-2*t.label.length-(e.lng-2*e.label.length)});for(var h=0;h<this.data.length;h++)this.data[h].when=this.introLinesDuration*((180+this.data[h].lng)/360)+500}x.prototype.init=function(e,t){this.camera=new n.PerspectiveCamera(50,this.width/this.height,1,this.cameraDistance+900),this.camera.position.z=this.cameraDistance,this.cameraAngle=Math.PI,this.scene=new n.Scene,this.scene.fog=new n.Fog(new n.Color(e||0),this.cameraDistance,this.cameraDistance+300),y.call(this),this.smokeProvider=new u(this.scene),g.call(this),setTimeout(t,500)},x.prototype.destroy=function(e){var t=this;this.active=!1,setTimeout(function(){for(;t.scene.children.length>0;)t.scene.remove(t.scene.children[0]);"function"==typeof e&&e()},1e3)},x.prototype.addPin=function(e,t,r,i){e=parseFloat(e),t=parseFloat(t);var n={lineColor:this.pinColor,topColor:this.pinColor},i,o=new h(e,t,r,i=i||1.2,this.scene,this.smokeProvider,n);this.pins.push(o);var a=m(e,t);if(o.pos_=new s(parseInt(a.x),parseInt(a.y)),r.length>0?o.rad_=a.rad:o.rad_=1,this.quadtree.addObject(o),r.length>0){var l=this.quadtree.getCollisionsForObject(o),c=0,u=0,f=[];for(var p in l)l[p].text.length>0&&(c++,l[p].age()>5e3?f.push(l[p]):u++);if(c>0&&0==u)for(var p=0;p<f.length;p++)f[p].hideLabel(),f[p].hideSmoke(),f[p].hideTop(),f[p].changeAltitude(.05*Math.random()+1.1);else c>0&&(o.hideLabel(),o.hideSmoke(),o.hideTop(),o.changeAltitude(.05*Math.random()+1.1))}if(this.pins.length>this.maxPins){var d=this.pins.shift();this.quadtree.removeObject(d),d.remove()}return o},x.prototype.addMarker=function(e,t,r,i,n,o){var a,s={markerColor:o||this.markerColor,lineColor:this.markerColor},n;return a=new l(e,t,r,n=n||1.2,"boolean"==typeof i&&i?this.markers[this.markers.length-1]:"object"==typeof i?i:null,this.scene,s),this.markers.push(a),this.markers.length>this.maxMarkers&&this.markers.shift().remove(),a},x.prototype.addSatellite=function(e,t,r,i,n,o){i||(i={}),null==i.coreColor&&(i.coreColor=this.satelliteColor);var a=new c(e,t,r,this.scene,i,n,o);return this.satellites[a.toString()]||(this.satellites[a.toString()]=a),a.onRemove(function(){delete this.satellites[a.toString()]}.bind(this)),a},x.prototype.addConstellation=function(e,t){for(var r,i,n,o=[],a=0;a<e.length;a++)n=0===a?this.addSatellite(e[a].lat,e[a].lon,e[a].altitude,t):this.addSatellite(e[a].lat,e[a].lon,e[a].altitude,t,o[0].canvas,o[0].texture),o.push(n);return o},x.prototype.setMaxPins=function(e){for(this.maxPins=e;this.pins.length>this.maxPins;){var t=this.pins.shift();this.quadtree.removeObject(t),t.remove()}},x.prototype.setMaxMarkers=function(e){for(this.maxMarkers=e;this.markers.length>this.maxMarkers;)this.markers.shift().remove()},x.prototype.setBaseColor=function(e){this.baseColor=e,g.call(this)},x.prototype.setMarkerColor=function(e){this.markerColor=e,this.scene._encom_markerTexture=null},x.prototype.setPinColor=function(e){this.pinColor=e},x.prototype.setScale=function(e){this.scale=e,this.cameraDistance=1700/e,this.scene&&this.scene.fog&&(this.scene.fog.near=this.cameraDistance,this.scene.fog.far=this.cameraDistance+300,g.call(this),this.camera.far=this.cameraDistance+300,this.camera.updateProjectionMatrix())},x.prototype.tick=function(){if(this.camera){this.firstRunTime||(this.firstRunTime=Date.now()),v.call(this),i.update(),this.lastRenderDate||(this.lastRenderDate=new Date),this.firstRenderDate||(this.firstRenderDate=new Date),this.totalRunTime=new Date-this.firstRenderDate;var e=new Date-this.lastRenderDate;this.lastRenderDate=new Date;var t=2*Math.PI/(this.dayLength/e);for(var r in this.cameraAngle+=t,this.active||(this.cameraDistance+=1e3*e/1e3),this.camera.position.x=this.cameraDistance*Math.cos(this.cameraAngle)*Math.cos(this.viewAngle),this.camera.position.y=Math.sin(this.viewAngle)*this.cameraDistance,this.camera.position.z=this.cameraDistance*Math.sin(this.cameraAngle)*Math.cos(this.viewAngle),this.satellites)this.satellites[r].tick(this.camera.position,this.cameraAngle,e);for(var r=0;r<this.satelliteMeshes.length;r++){var n=this.satelliteMeshes[r];n.lookAt(this.camera.position),n.rotateZ(n.tiltDirection*Math.PI/2),n.rotateZ(Math.sin(this.cameraAngle+n.lon/180*Math.PI)*n.tiltMultiplier*n.tiltDirection*-1)}for(this.introLinesDuration>this.totalRunTime?(this.totalRunTime/this.introLinesDuration<.1&&(this.introLines.children[0].material.opacity=this.totalRunTime/this.introLinesDuration*10-.2),this.totalRunTime/this.introLinesDuration>.8?this.introLines.children[0].material.opacity=5*Math.max(1-this.totalRunTime/this.introLinesDuration,0):this.introLines.children[0].material.opacity=1,this.introLines.rotateY(2*Math.PI/(this.introLinesDuration/e))):this.introLines&&(this.scene.remove(this.introLines),this.introLines),this.pointUniforms.currentTime.value=this.totalRunTime,this.smokeProvider.tick(this.totalRunTime),this.camera.lookAt(this.scene.position),this.renderer.render(this.scene,this.camera);this.pins.find(e=>e.removed);)this.pins.splice(this.pins.findIndex(e=>e.removed),1);for(;this.markers.find(e=>e.removed);)this.markers.splice(this.markers.findIndex(e=>e.removed),1)}},t.exports=x},{"./Marker":16,"./Pin":17,"./Satellite":18,"./SmokeProvider":19,"./utils":21,"hexasphere.js":3,"pusher.color":6,quadtree2:8,three:12,"tween.js":13,vec2:14}],16:[function(e,t,r){var i=e("three"),n=e("tween.js"),o=e("./utils"),a=function(e){var t=30,r=30,n,a;return"transparent"===e&&(t=0,r=0),n=o.renderToCanvas(t,r,function(i){i.fillStyle=e,i.strokeStyle=e,i.lineWidth=3,i.beginPath(),i.arc(t/2,r/2,t/3,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(t/2,r/2,t/5,0,2*Math.PI),i.fill()}),(a=new i.Texture(n)).needsUpdate=!0,a},s=function(e,t,r,s,h,l,c){var u={lineColor:"#FFCC00",lineWidth:1,markerColor:"#FFCC00",labelColor:"#FFF",font:"Inconsolata",fontSize:20,drawTime:2e3,lineSegments:150},f,p,d,m,v,g;if(this.lat=parseFloat(e),this.lon=parseFloat(t),this.text=r,this.altitude=parseFloat(s),this.scene=l,this.previous=h,this.next=[],this.previous&&this.previous.next.push(this),c)for(var y in u)null!=c[y]&&(u[y]=c[y]);this.opts=u,f=o.mapPoint(e,t),h&&(p=o.mapPoint(h.lat,h.lon)),l._encom_markerTexture||(l._encom_markerTexture=a(this.opts.markerColor)),d=new i.SpriteMaterial({map:l._encom_markerTexture,opacity:.7,depthTest:!0,fog:!0}),this.marker=new i.Sprite(d),this.marker.scale.set(0,0),this.marker.position.set(f.x*s,f.y*s,f.z*s),m=o.createLabel(r.toUpperCase(),this.opts.fontSize,this.opts.labelColor,this.opts.font,this.opts.markerColor),(v=new i.Texture(m)).needsUpdate=!0,g=new i.SpriteMaterial({map:v,useScreenCoordinates:!1,opacity:0,depthTest:!0,fog:!0}),this.labelSprite=new i.Sprite(g),this.labelSprite.position={x:f.x*s*1.1,y:f.y*s*1.05+(f.y<0?-15:30),z:f.z*s*1.1},this.labelSprite.scale.set(m.width,m.height),new n.Tween({opacity:0}).to({opacity:1},500).onUpdate(function(){g.opacity=this.opacity}).start();var x=this;if(new n.Tween({x:0,y:0}).to({x:50,y:50},2e3).easing(n.Easing.Elastic.Out).onUpdate(function(){x.marker.scale.set(this.x,this.y)}).delay(this.previous?x.opts.drawTime:0).start(),this.previous){var b,w,_,M,S,T=[],C=[],A,E,P,L,D,F,R;x.geometrySpline=new i.Geometry,b=new i.LineBasicMaterial({color:this.opts.lineColor,transparent:!0,linewidth:3,opacity:.5}),x.geometrySplineDotted=new i.Geometry,w=new i.LineBasicMaterial({color:this.opts.lineColor,linewidth:1,transparent:!0,opacity:.5}),_=(e-h.lat)/x.opts.lineSegments,M=(t-h.lon)/x.opts.lineSegments,S=o.mapPoint(h.lat,h.lon),T=[],C=[];for(var V=0;V<x.opts.lineSegments+1;V++){var A=((90+h.lat+V*_)%180-90)*(.5+Math.cos(V*(5*Math.PI/2)/x.opts.lineSegments)/2)+V*e/x.opts.lineSegments/2,E=(180+h.lon+V*M)%360-180;T.push({lat:A,lon:E,index:V}),0==V||V==x.opts.lineSegments?C.push({lat:A,lon:E,index:V}):C.push({lat:A+1,lon:E,index:V}),sPoint=new i.Vector3(1.2*S.x,1.2*S.y,1.2*S.z),sPoint2=new i.Vector3(1.2*S.x,1.2*S.y,1.2*S.z),sPoint.globe_index=V,sPoint2.globe_index=V,x.geometrySpline.vertices.push(sPoint),x.geometrySplineDotted.vertices.push(sPoint2)}P=h.lat,L=h.lon,(R=function(){for(var e=T.shift(),t=C.shift(),r=0;r<x.geometrySpline.vertices.length;r++)F=x.geometrySpline.vertices[r],D=o.mapPoint(e.lat,e.lon),currentVert2=x.geometrySplineDotted.vertices[r],currentPoint2=o.mapPoint(t.lat,t.lon),r>=e.index&&(F.set(1.2*D.x,1.2*D.y,1.2*D.z),currentVert2.set(1.19*currentPoint2.x,1.19*currentPoint2.y,1.19*currentPoint2.z)),x.geometrySpline.verticesNeedUpdate=!0,x.geometrySplineDotted.verticesNeedUpdate=!0;T.length>0&&setTimeout(R,x.opts.drawTime/x.opts.lineSegments)})(),this.scene.add(new i.Line(x.geometrySpline,b)),this.scene.add(new i.Line(x.geometrySplineDotted,w,i.LinePieces))}this.scene.add(this.marker),this.scene.add(this.labelSprite)};s.prototype.remove=function(){for(var e=0,t=this,r=function(i){for(var n=0;n<e;n++)i.geometrySpline.vertices[n].set(i.geometrySpline.vertices[n+1]),i.geometrySplineDotted.vertices[n].set(i.geometrySplineDotted.vertices[n+1]),i.geometrySpline.verticesNeedUpdate=!0,i.geometrySplineDotted.verticesNeedUpdate=!0;++e<i.geometrySpline.vertices.length?setTimeout(function(){r(i)},t.opts.drawTime/t.opts.lineSegments):(t.scene.remove(i.geometrySpline),t.scene.remove(i.geometrySplineDotted))},i=0;i<t.next.length;i++)(function(e){r(t.next[e])})(i);t.scene.remove(t.marker),t.scene.remove(t.labelSprite),t.removed=!0},t.exports=s},{"./utils":21,three:12,"tween.js":13}],17:[function(e,t,r){var i=e("three"),n=e("tween.js"),o=e("./utils"),a=function(e){var t=20,r=20;return o.renderToCanvas(t,r,function(t){t.fillStyle=e,t.beginPath(),t.arc(10,10,5,0,2*Math.PI),t.fill()})},s=function(e,t,r,s,h,l,c){var u={lineColor:"#8FD8D8",lineWidth:1,topColor:"#8FD8D8",smokeColor:"#FFF",labelColor:"#FFF",font:"Inconsolata",showLabel:r.length>0,showTop:r.length>0,showSmoke:r.length>0},f,p,d,m,v,g,y,x;if(this.lat=e,this.lon=t,this.text=r,this.altitude=s,this.scene=h,this.smokeProvider=l,this.dateCreated=Date.now(),c)for(var b in u)null!=c[b]&&(u[b]=c[b]);this.opts=u,this.topVisible=u.showTop,this.smokeVisible=u.showSmoke,this.labelVisible=u.showLabel,this.lineGeometry=new i.Geometry,f=new i.LineBasicMaterial({color:u.lineColor,linewidth:u.lineWidth}),y=o.mapPoint(e,t),this.lineGeometry.vertices.push(new i.Vector3(y.x,y.y,y.z)),this.lineGeometry.vertices.push(new i.Vector3(y.x,y.y,y.z)),this.line=new i.Line(this.lineGeometry,f),p=o.createLabel(r,18,u.labelColor,u.font),(d=new i.Texture(p)).needsUpdate=!0,m=new i.SpriteMaterial({map:d,useScreenCoordinates:!1,opacity:0,depthTest:!0,fog:!0}),this.labelSprite=new i.Sprite(m),this.labelSprite.position={x:y.x*s*1.1,y:y.y*s+(y.y<0?-15:30),z:y.z*s*1.1},this.labelSprite.scale.set(p.width,p.height),(v=new i.Texture(a(u.topColor))).needsUpdate=!0,g=new i.SpriteMaterial({map:v,depthTest:!0,fog:!0,opacity:0}),this.topSprite=new i.Sprite(g),this.topSprite.scale.set(20,20),this.topSprite.position.set(y.x*s,y.y*s,y.z*s),this.smokeVisible&&(this.smokeId=l.setFire(e,t,s));var w=this;(u.showTop||u.showLabel)&&new n.Tween({opacity:0}).to({opacity:1},500).onUpdate(function(){w.topVisible?g.opacity=this.opacity:g.opacity=0,w.labelVisible?m.opacity=this.opacity:m.opacity=0}).delay(1e3).start(),new n.Tween(y).to({x:y.x*s,y:y.y*s,z:y.z*s},1500).easing(n.Easing.Elastic.Out).onUpdate(function(){w.lineGeometry.vertices[1].x=this.x,w.lineGeometry.vertices[1].y=this.y,w.lineGeometry.vertices[1].z=this.z,w.lineGeometry.verticesNeedUpdate=!0}).start(),this.scene.add(this.labelSprite),this.scene.add(this.line),this.scene.add(this.topSprite)};s.prototype.toString=function(){return this.lat+"_"+this.lon},s.prototype.changeAltitude=function(e){var t=o.mapPoint(this.lat,this.lon),r=this;new n.Tween({altitude:this.altitude}).to({altitude:e},1500).easing(n.Easing.Elastic.Out).onUpdate(function(){r.smokeVisible&&r.smokeProvider.changeAltitude(this.altitude,r.smokeId),r.topVisible&&r.topSprite.position.set(t.x*this.altitude,t.y*this.altitude,t.z*this.altitude),r.labelVisible&&(r.labelSprite.position={x:t.x*this.altitude*1.1,y:t.y*this.altitude+(t.y<0?-15:30),z:t.z*this.altitude*1.1}),r.lineGeometry.vertices[1].x=t.x*this.altitude,r.lineGeometry.vertices[1].y=t.y*this.altitude,r.lineGeometry.vertices[1].z=t.z*this.altitude,r.lineGeometry.verticesNeedUpdate=!0}).onComplete(function(){r.altitude=e}).start()},s.prototype.hideTop=function(){this.topVisible&&(this.topSprite.material.opacity=0,this.topVisible=!1)},s.prototype.showTop=function(){this.topVisible||(this.topSprite.material.opacity=1,this.topVisible=!0)},s.prototype.hideLabel=function(){this.labelVisible&&(this.labelSprite.material.opacity=0,this.labelVisible=!1)},s.prototype.showLabel=function(){this.labelVisible||(this.labelSprite.material.opacity=1,this.labelVisible=!0)},s.prototype.hideSmoke=function(){this.smokeVisible&&(this.smokeProvider.extinguish(this.smokeId),this.smokeVisible=!1)},s.prototype.showSmoke=function(){this.smokeVisible||(this.smokeId=this.smokeProvider.setFire(this.lat,this.lon,this.altitude),this.smokeVisible=!0)},s.prototype.age=function(){return Date.now()-this.dateCreated},s.prototype.remove=function(){this.scene.remove(this.labelSprite),this.scene.remove(this.line),this.scene.remove(this.topSprite),this.removed=!0,this.smokeVisible&&this.smokeProvider.extinguish(this.smokeId)},t.exports=s},{"./utils":21,three:12,"tween.js":13}],18:[function(e,t,r){var i=e("./TextureAnimator"),n=e("three"),o=e("./utils"),a=function(e,t,r,i,n,a,s,h){var l=e/r,c=Math.floor((e-i)/n),u,f=(t-25)/(e-i),p=0,d=0,m=0,v=o.hexToRgb(a);return o.renderToCanvas(e*t/r,t*r,function(r){for(var o=0;o<e;o++){o-m*l>=l&&(p=0,d+=t,m++);var a=p+25,u=d+Math.floor(t/2);r.lineWidth=2,r.strokeStyle=h;var g=Math.PI/16,y=-Math.PI+Math.PI/4,x=8,b=Math.floor(e-2*(e-i)/n)+1;o<i&&(x=x*o/i);for(var w=Math.floor((b-i)/2)+i,_=0,M;_<4;_++){if(r.beginPath(),o<i||o>=e)r.arc(a,u,x,_*Math.PI/2+y+g,_*Math.PI/2+y+Math.PI/2-2*g);else if(o>i&&o<w){var S=w-i,T=3*Math.PI/2,C=o-i,A=T/S,E=-Math.PI+Math.PI/4+g+A*C;r.arc(a,u,x,Math.max(_*Math.PI/2+y,E),Math.max(_*Math.PI/2+y+Math.PI/2-2*g,E+Math.PI/2-2*g))}else if(o>=w&&o<b){var S=b-w,T,C=o-w,A=(T=2*_*Math.PI/4)/S,E=Math.PI/2+Math.PI/4+g+A*C;r.arc(a,u,x,E,E+Math.PI/2-2*g)}else if(o>=b&&o<(e-b)/2+b){var S=(e-b)/2,T,C=o-b,A=(T=Math.PI/2)/S,E=_*(Math.PI/2)+Math.PI/4+g+A*C;r.arc(a,u,x,E,E+Math.PI/2-2*g)}else r.arc(a,u,x,_*Math.PI/2+y+g,_*Math.PI/2+y+Math.PI/2-2*g);r.stroke()}for(var P=0;P<n;P++)(M=o-c*P-i)>0&&M*f<t-25&&(r.strokeStyle="rgba("+v.r+","+v.g+","+v.b+","+(.9-M*f/(t-25))+")",r.lineWidth=2,r.beginPath(),r.arc(a,u,M*f,-Math.PI/12,Math.PI/12),r.stroke());r.fillStyle="#000",r.beginPath(),r.arc(a,u,3,0,2*Math.PI),r.fill(),r.strokeStyle=s,r.lineWidth=2,r.beginPath(),o<i?r.arc(a,u,3*o/i,0,2*Math.PI):r.arc(a,u,3,0,2*Math.PI),r.stroke(),p+=t}})},s=function(e,t,r,s,h,l,c){var u,f=o.mapPoint(e,t),p,d,m,v,g,y;f.x*=r,f.y*=r,f.z*=r;var p={numWaves:8,waveColor:"#FFF",coreColor:"#FF0000",shieldColor:"#FFF",size:1};if(this.lat=e,this.lon=t,this.altitude=r,this.scene=s,this.onRemoveList=[],d=50,m=100,v=10,g=Math.floor(6.25),h)for(var x in p)null!=h[x]&&(p[x]=h[x]);this.opts=p,l?(this.canvas=l,c?this.texture=c:(this.texture=new n.Texture(this.canvas),this.texture.needsUpdate=!0,y=Math.floor(d-2*(d-g)/p.numWaves)+1,this.animator=new i(this.texture,v,5,d,80,y))):(this.canvas=a(d,m,v,g,p.numWaves,p.waveColor,p.coreColor,p.shieldColor),this.texture=new n.Texture(this.canvas),this.texture.needsUpdate=!0,y=Math.floor(d-2*(d-g)/p.numWaves)+1,this.animator=new i(this.texture,v,5,d,80,y)),u=new n.PlaneGeometry(150*p.size,150*p.size,1,1),this.material=new n.MeshBasicMaterial({map:this.texture,depthTest:!1,transparent:!0}),this.mesh=new n.Mesh(u,this.material),this.mesh.tiltMultiplier=Math.PI/2*(1-Math.abs(e/90)),this.mesh.tiltDirection=e>0?-1:1,this.mesh.lon=t,this.mesh.position.set(f.x,f.y,f.z),this.mesh.rotation.z=e/90*-1*Math.PI/2,this.mesh.rotation.y=t/180*Math.PI,s.add(this.mesh)};s.prototype.changeAltitude=function(e){var t=o.mapPoint(this.lat,this.lon);t.x*=e,t.y*=e,t.z*=e,this.altitude=e,this.mesh.position.set(t.x,t.y,t.z)},s.prototype.changeCanvas=function(e,t,r,o){numFrames=50,pixels=100,rows=10,waveStart=Math.floor(numFrames/8),e?this.opts.numWaves=e:e=this.opts.numWaves,t?this.opts.waveColor=t:t=this.opts.waveColor,r?this.opts.coreColor=r:r=this.opts.coreColor,o?this.opts.shieldColor=o:o=this.opts.shieldColor,this.canvas=a(numFrames,pixels,rows,waveStart,e,t,r,o),this.texture=new n.Texture(this.canvas),this.texture.needsUpdate=!0,repeatAt=Math.floor(numFrames-2*(numFrames-waveStart)/e)+1,this.animator=new i(this.texture,rows,numFrames/rows,numFrames,80,repeatAt),this.material.map=this.texture},s.prototype.tick=function(e,t,r){this.mesh.lookAt(e),this.mesh.rotateZ(this.mesh.tiltDirection*Math.PI/2),this.mesh.rotateZ(Math.sin(t+this.mesh.lon/180*Math.PI)*this.mesh.tiltMultiplier*this.mesh.tiltDirection*-1),this.animator&&this.animator.update(r)},s.prototype.remove=function(){this.scene.remove(this.mesh);for(var e=0;e<this.onRemoveList.length;e++)this.onRemoveList[e]()},s.prototype.onRemove=function(e){this.onRemoveList.push(e)},s.prototype.toString=function(){return this.lat+"_"+this.lon+"_"+this.altitude},t.exports=s},{"./TextureAnimator":20,"./utils":21,three:12}],19:[function(e,t,r){var i=e("three"),n=e("./utils"),o=["#define PI 3.141592653589793238462643","#define DISTANCE 500.0","attribute float myStartTime;","attribute float myStartLat;","attribute float myStartLon;","attribute float altitude;","attribute float active;","uniform float currentTime;","uniform vec3 color;","varying vec4 vColor;","","vec3 getPos(float lat, float lon)","{","   if (lon < -180.0){","      lon = lon + 360.0;","   }","   float phi = (90.0 - lat) * PI / 180.0;","   float theta = (180.0 - lon) * PI / 180.0;","   float x = DISTANCE * sin(phi) * cos(theta) * altitude;","   float y = DISTANCE * cos(phi) * altitude;","   float z = DISTANCE * sin(phi) * sin(theta) * altitude;","   return vec3(x, y, z);","}","","void main()","{","   float dt = currentTime - myStartTime;","   if (dt < 0.0){","      dt = 0.0;","   }","   if (dt > 0.0 && active > 0.0) {","      dt = mod(dt,1500.0);","   }","   float opacity = 1.0 - dt/ 1500.0;","   if (dt == 0.0 || active == 0.0){","      opacity = 0.0;","   }","   vec3 newPos = getPos(myStartLat, myStartLon - ( dt / 50.0));","   vColor = vec4( color, opacity );","   vec4 mvPosition = modelViewMatrix * vec4( newPos, 1.0 );","   gl_PointSize = 2.5 - (dt / 1500.0);","   gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),a=["varying vec4 vColor;","void main()","{","   gl_FragColor = vColor;","   float depth = gl_FragCoord.z / gl_FragCoord.w;","   float fogFactor = smoothstep(1500.0, 1800.0, depth );","   vec3 fogColor = vec3(0.0);","   gl_FragColor = mix( vColor, vec4( fogColor, gl_FragColor.w), fogFactor );","}"].join("\n"),s=function(e,t){var r={smokeCount:5e3,smokePerPin:30,smokePerSecond:20};if(t)for(var n in r)void 0!==t[n]&&(r[n]=t[n]);this.opts=r,this.geometry=new i.Geometry,this.attributes={myStartTime:{type:"f",value:[]},myStartLat:{type:"f",value:[]},myStartLon:{type:"f",value:[]},altitude:{type:"f",value:[]},active:{type:"f",value:[]}},this.uniforms={currentTime:{type:"f",value:0},color:{type:"c",value:new i.Color("#aaa")}};for(var s=new i.ShaderMaterial({uniforms:this.uniforms,attributes:this.attributes,vertexShader:o,fragmentShader:a,transparent:!0}),n=0;n<r.smokeCount;n++){var h=new i.Vector3;h.set(0,0,0),this.geometry.vertices.push(h),this.attributes.myStartTime.value[n]=0,this.attributes.myStartLat.value[n]=0,this.attributes.myStartLon.value[n]=0,this.attributes.altitude.value[n]=0,this.attributes.active.value[n]=0}this.attributes.myStartTime.needsUpdate=!0,this.attributes.myStartLat.needsUpdate=!0,this.attributes.myStartLon.needsUpdate=!0,this.attributes.altitude.needsUpdate=!0,this.attributes.active.needsUpdate=!0,this.smokeIndex=0,this.totalRunTime=0,e.add(new i.ParticleSystem(this.geometry,s))};s.prototype.setFire=function(e,t,r){for(var i=n.mapPoint(e,t),o=this.smokeIndex,a=0;a<this.opts.smokePerPin;a++)this.geometry.vertices[this.smokeIndex].set(i.x*r,i.y*r,i.z*r),this.geometry.verticesNeedUpdate=!0,this.attributes.myStartTime.value[this.smokeIndex]=this.totalRunTime+(1e3*a/this.opts.smokePerSecond+1500),this.attributes.myStartLat.value[this.smokeIndex]=e,this.attributes.myStartLon.value[this.smokeIndex]=t,this.attributes.altitude.value[this.smokeIndex]=r,this.attributes.active.value[this.smokeIndex]=1,this.attributes.myStartTime.needsUpdate=!0,this.attributes.myStartLat.needsUpdate=!0,this.attributes.myStartLon.needsUpdate=!0,this.attributes.altitude.needsUpdate=!0,this.attributes.active.needsUpdate=!0,this.smokeIndex++,this.smokeIndex=this.smokeIndex%this.geometry.vertices.length;return o},s.prototype.extinguish=function(e){for(var t=0;t<this.opts.smokePerPin;t++)this.attributes.active.value[(t+e)%this.opts.smokeCount]=0,this.attributes.active.needsUpdate=!0},s.prototype.changeAltitude=function(e,t){for(var r=0;r<this.opts.smokePerPin;r++)this.attributes.altitude.value[(r+t)%this.opts.smokeCount]=e,this.attributes.altitude.needsUpdate=!0},s.prototype.tick=function(e){this.totalRunTime=e,this.uniforms.currentTime.value=this.totalRunTime},t.exports=s},{"./utils":21,three:12}],20:[function(e,t,r){var i=e("three"),n=function(e,t,r,n,o,a){null==a&&(this.repeatAtTile=-1),this.shutDownFlag=this.repeatAtTile<0,this.done=!1,this.tilesHorizontal=r,this.tilesVertical=t,this.numberOfTiles=n,e.wrapS=e.wrapT=i.RepeatWrapping,e.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=o,this.currentDisplayTime=0,this.currentTile=0,e.offset.y=1,this.update=function(t){for(this.currentDisplayTime+=t;!this.done&&this.currentDisplayTime>this.tileDisplayDuration;)if(this.shutDownFlag&&this.currentTile>=n)this.done=!0,this.shutDownCb();else{this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile!=n||this.shutDownFlag||(this.currentTile=a);var r=this.currentTile%this.tilesHorizontal;e.offset.x=r/this.tilesHorizontal;var i=Math.floor(this.currentTile/this.tilesHorizontal);e.offset.y=1-i/this.tilesVertical-1/this.tilesVertical}},this.shutDown=function(e){_this.shutDownFlag=!0,_this.shutDownCb=e}};t.exports=n},{three:12}],21:[function(e,t,r){var i={renderToCanvas:function(e,t,r){var i=document.createElement("canvas");return i.width=e,i.height=t,r(i.getContext("2d")),i},mapPoint:function(e,t,r){r||(r=500);var i=(90-e)*Math.PI/180,n=(180-t)*Math.PI/180,o,a,s;return{x:r*Math.sin(i)*Math.cos(n),y:r*Math.cos(i),z:r*Math.sin(i)*Math.sin(n)}},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,r,i){return t+t+r+r+i+i});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null},createLabel:function(e,t,r,i,n){var o=document.createElement("canvas"),a=o.getContext("2d");a.font=t+"pt "+i;var s=a.measureText(e).width;return o.width=s,o.height=t+10,o.width%2&&o.width++,o.height%2&&o.height++,n&&(o.height+=30),a.font=t+"pt "+i,a.textAlign="center",a.textBaseline="middle",a.strokeStyle="black",a.miterLimit=2,a.lineJoin="circle",a.lineWidth=6,a.strokeText(e,o.width/2,o.height/2),a.lineWidth=2,a.fillStyle=r,a.fillText(e,o.width/2,o.height/2),n&&(a.strokeStyle=n,a.lineWidth=4,a.beginPath(),a.moveTo(0,o.height-10),a.lineTo(o.width-1,o.height-10),a.stroke()),o}};t.exports=i},{}]},{},[1]);